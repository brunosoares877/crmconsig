[{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\public\\sw.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\AdminPasswordDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3041,3044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3041,3044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":122,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3745,3748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3745,3748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4950,4953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4950,4953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5017,5020],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5017,5020],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":177,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":177,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5345,5348],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5345,5348],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":178,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":178,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5412,5415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5412,5415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5763,5766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5763,5766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5830,5833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5830,5833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useRef, useEffect } from 'react';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Eye, EyeOff, Shield, Loader2, AlertTriangle } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from 'sonner';\r\n\r\ninterface AdminPasswordDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  onConfirm: () => void;\r\n  title?: string;\r\n  description?: string;\r\n  itemName?: string;\r\n}\r\n\r\nexport const AdminPasswordDialog: React.FC<AdminPasswordDialogProps> = ({\r\n  open,\r\n  onOpenChange,\r\n  onConfirm,\r\n  title = \"Confirmar Exclusão\",\r\n  description = \"Esta ação requer confirmação com senha administrativa\",\r\n  itemName\r\n}) => {\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isVerifying, setIsVerifying] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // Estado interno controlado - força o dialog a permanecer aberto\r\n  const [internalOpen, setInternalOpen] = useState(false);\r\n  const canCloseRef = useRef(false);\r\n  \r\n  // Sincronizar estado externo com interno\r\n  useEffect(() => {\r\n    if (open) {\r\n      // Quando abre externamente, abrir internamente e resetar flag\r\n      setInternalOpen(true);\r\n      canCloseRef.current = false;\r\n      setPassword('');\r\n      setError(null);\r\n    } else if (canCloseRef.current) {\r\n      // Só fechar internamente se permitido\r\n      setInternalOpen(false);\r\n      canCloseRef.current = false;\r\n    }\r\n  }, [open]);\r\n\r\n  // Hash da senha usando Web Crypto API\r\n  const hashPassword = async (password: string): Promise<string> => {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(password);\r\n    const hash = await crypto.subtle.digest('SHA-256', data);\r\n    return Array.from(new Uint8Array(hash))\r\n      .map(b => b.toString(16).padStart(2, '0'))\r\n      .join('');\r\n  };\r\n\r\n  // Verificar senha administrativa\r\n  const handleVerify = async () => {\r\n    if (!password.trim()) {\r\n      setError('Digite a senha administrativa');\r\n      return;\r\n    }\r\n\r\n    setIsVerifying(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não autenticado');\r\n      }\r\n\r\n      const hashedPassword = await hashPassword(password);\r\n\r\n      const { data, error: fetchError } = await supabase\r\n        .from('profiles')\r\n        .select('admin_password_hash')\r\n        .eq('id', userData.user.id)\r\n        .single();\r\n\r\n      if (fetchError) {\r\n        throw new Error('Erro ao verificar senha administrativa');\r\n      }\r\n\r\n      const adminPasswordHash = (data as any)?.admin_password_hash;\r\n      \r\n      if (!adminPasswordHash) {\r\n        throw new Error('Senha administrativa não configurada. Configure em Configurações > Segurança');\r\n      }\r\n\r\n      if (adminPasswordHash !== hashedPassword) {\r\n        setError('Senha administrativa incorreta');\r\n        setIsVerifying(false);\r\n        return;\r\n      }\r\n\r\n      // Senha correta\r\n      toast.success('Senha confirmada com sucesso!');\r\n      setPassword('');\r\n      setError(null);\r\n      \r\n      // Permitir fechar e fechar\r\n      canCloseRef.current = true;\r\n      setInternalOpen(false);\r\n      onOpenChange(false);\r\n      \r\n      // Chamar callback de confirmação\r\n      onConfirm();\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao verificar senha:', error);\r\n      setError(error.message || 'Erro ao verificar senha administrativa');\r\n      toast.error(error.message || 'Erro ao verificar senha administrativa');\r\n    } finally {\r\n      setIsVerifying(false);\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setPassword('');\r\n    setError(null);\r\n    canCloseRef.current = true;\r\n    setInternalOpen(false);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleInternalOpenChange = (newOpen: boolean) => {\r\n    // Permitir fechamento explícito (ex.: botão X do dialog)\r\n    if (!newOpen) {\r\n      canCloseRef.current = true; // libera o fechamento\r\n      setInternalOpen(false);\r\n      onOpenChange(false);\r\n      return;\r\n    }\r\n\r\n    // Abrindo novamente: resetar proteção\r\n    setInternalOpen(true);\r\n    canCloseRef.current = false;\r\n  };\r\n\r\n  return (\r\n    <Dialog \r\n      open={internalOpen} \r\n      onOpenChange={handleInternalOpenChange}\r\n    >\r\n      <DialogContent \r\n        className=\"sm:max-w-md z-[100]\"\r\n        onInteractOutside={(e) => {\r\n          // SEMPRE bloquear cliques fora\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          try {\r\n            if ((e as any).nativeEvent?.stopImmediatePropagation) {\r\n              (e as any).nativeEvent.stopImmediatePropagation();\r\n            }\r\n          } catch (err) {\r\n            // Ignorar\r\n          }\r\n        }}\r\n        onPointerDownOutside={(e) => {\r\n          // SEMPRE bloquear eventos de pointer\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          try {\r\n            if ((e as any).nativeEvent?.stopImmediatePropagation) {\r\n              (e as any).nativeEvent.stopImmediatePropagation();\r\n            }\r\n          } catch (err) {\r\n            // Ignorar\r\n          }\r\n        }}\r\n        onEscapeKeyDown={(e) => {\r\n          // SEMPRE bloquear ESC - só fecha com botão Cancelar ou Confirmar\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          try {\r\n            if ((e as any).nativeEvent?.stopImmediatePropagation) {\r\n              (e as any).nativeEvent.stopImmediatePropagation();\r\n            }\r\n          } catch (err) {\r\n            // Ignorar\r\n          }\r\n        }}\r\n      >\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Shield className=\"w-5 h-5 text-red-600\" />\r\n            {title}\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            {description}\r\n            {itemName && (\r\n              <span className=\"block mt-2 font-semibold text-gray-900\">\r\n                Item: {itemName}\r\n              </span>\r\n            )}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 py-4\">\r\n          <Alert className=\"border-orange-500 bg-orange-50\">\r\n            <AlertTriangle className=\"h-4 w-4 text-orange-600\" />\r\n            <AlertDescription className=\"text-orange-700\">\r\n              Esta ação é irreversível. Digite sua senha administrativa para confirmar.\r\n            </AlertDescription>\r\n          </Alert>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"admin-password\" className=\"text-sm font-medium\">\r\n              Senha Administrativa\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"admin-password\"\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                value={password}\r\n                onChange={(e) => {\r\n                  setPassword(e.target.value);\r\n                  setError(null);\r\n                }}\r\n                placeholder=\"Digite sua senha administrativa\"\r\n                disabled={isVerifying}\r\n                className=\"pr-12\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === 'Enter' && !isVerifying && password.trim()) {\r\n                    handleVerify();\r\n                  }\r\n                }}\r\n                autoFocus\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                onClick={() => setShowPassword(!showPassword)}\r\n              >\r\n                {showPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n            {error && (\r\n              <p className=\"text-sm text-red-600 flex items-center gap-1\">\r\n                <AlertTriangle className=\"h-3 w-3\" />\r\n                {error}\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={handleClose}\r\n            disabled={isVerifying}\r\n          >\r\n            Cancelar\r\n          </Button>\r\n          <Button\r\n            onClick={handleVerify}\r\n            disabled={isVerifying || !password.trim()}\r\n            className=\"bg-red-600 hover:bg-red-700\"\r\n          >\r\n            {isVerifying ? (\r\n              <>\r\n                <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                Verificando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                <Shield className=\"w-4 h-4 mr-2\" />\r\n                Confirmar\r\n              </>\r\n            )}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\AppSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":287,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":287,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7669,7672],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7669,7672],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\r\nimport { Link, useLocation } from \"react-router-dom\";\r\nimport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarMenu,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n} from \"@/components/ui/sidebar\";\r\nimport {\r\n  BarChart3,\r\n  Users,\r\n  Star,\r\n  Calendar,\r\n  Bell,\r\n  CalendarDays,\r\n  TrendingUp,\r\n  DollarSign,\r\n  Settings,\r\n  Users2,\r\n  Camera,\r\n  User,\r\n  Edit,\r\n  Cog,\r\n  Briefcase,\r\n  FileText,\r\n  FolderOpen\r\n} from \"lucide-react\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\n// Menu agrupado por seções\r\nconst items = [\r\n  {\r\n    title: \"Dashboard\",\r\n    url: \"/dashboard\",\r\n    icon: BarChart3,\r\n    group: \"PRINCIPAL\"\r\n  },\r\n  {\r\n    title: \"Leads\",\r\n    url: \"/leads\",\r\n    icon: Users,\r\n    group: \"LEADS\"\r\n  },\r\n  {\r\n    title: \"Máquina de Leads\",\r\n    url: \"/maquina-de-leads\",\r\n    icon: Star,\r\n    group: \"LEADS\",\r\n    highlight: true\r\n  },\r\n  {\r\n    title: \"Agendamentos\",\r\n    url: \"/leads/scheduled\",\r\n    icon: Calendar,\r\n    group: \"LEADS\"\r\n  },\r\n  {\r\n    title: \"Config. Leads\",\r\n    url: \"/leads/config\",\r\n    icon: Cog,\r\n    group: \"LEADS\"\r\n  },\r\n  {\r\n    title: \"Lembretes\",\r\n    url: \"/reminders\",\r\n    icon: Bell,\r\n    group: \"LEMBRETES\"\r\n  },\r\n  {\r\n    title: \"Calendário\",\r\n    url: \"/reminders/calendar\",\r\n    icon: CalendarDays,\r\n    group: \"LEMBRETES\"\r\n  },\r\n  {\r\n    title: \"Notas\",\r\n    url: \"/notes\",\r\n    icon: FileText,\r\n    group: \"LEMBRETES\"\r\n  },\r\n  {\r\n    title: \"Portabilidade\",\r\n    url: \"/portability\",\r\n    icon: TrendingUp,\r\n    group: \"NEGÓCIOS\"\r\n  },\r\n  {\r\n    title: \"Comissões\",\r\n    url: \"/commission\",\r\n    icon: DollarSign,\r\n    group: \"NEGÓCIOS\"\r\n  },\r\n  {\r\n    title: \"Roteiros Operacionais\",\r\n    url: \"/roteiros\",\r\n    icon: FolderOpen,\r\n    group: \"ROTEIROS\"\r\n  },\r\n\r\n  {\r\n    title: \"Funcionários\",\r\n    url: \"/employees\",\r\n    icon: Users2,\r\n    group: \"ADMINISTRAÇÃO\"\r\n  },\r\n  {\r\n    title: \"Configurações\",\r\n    url: \"/settings\",\r\n    icon: Settings,\r\n    group: \"ADMINISTRAÇÃO\"\r\n  },\r\n];\r\n\r\n// Agrupa os itens por grupo\r\nconst groupedItems = items.reduce((acc, item) => {\r\n  if (!acc[item.group]) acc[item.group] = [];\r\n  acc[item.group].push(item);\r\n  return acc;\r\n}, {} as Record<string, typeof items>);\r\n\r\nexport function AppSidebar() {\r\n  const location = useLocation();\r\n  const { user } = useAuth();\r\n  const [profileImage, setProfileImage] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [isAvatarHovered, setIsAvatarHovered] = useState(false);\r\n\r\n  // Load existing profile image on component mount\r\n  useEffect(() => {\r\n    const loadProfileImage = async () => {\r\n      if (!user) return;\r\n\r\n      try {\r\n        // Tentar buscar no bucket avatars primeiro\r\n        const avatarPath = `${user.id}/profile.jpg`;\r\n        const { data: avatarData } = supabase.storage\r\n          .from('avatars')\r\n          .getPublicUrl(avatarPath);\r\n\r\n        // Check if image exists by making a HEAD request\r\n        if (avatarData?.publicUrl) {\r\n          const response = await fetch(avatarData.publicUrl, { method: 'HEAD' });\r\n          if (response.ok) {\r\n            setProfileImage(avatarData.publicUrl);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Fallback: tentar buscar no lead-documents\r\n        const fallbackPath = `${user.id}/profile/profile.jpg`;\r\n        const { data: fallbackData } = supabase.storage\r\n          .from('lead-documents')\r\n          .getPublicUrl(fallbackPath);\r\n\r\n        if (fallbackData?.publicUrl) {\r\n          const fallbackResponse = await fetch(fallbackData.publicUrl, { method: 'HEAD' });\r\n          if (fallbackResponse.ok) {\r\n            setProfileImage(fallbackData.publicUrl);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Tentar outras extensões comuns\r\n        const extensions = ['png', 'gif', 'webp'];\r\n        for (const ext of extensions) {\r\n          const path = `${user.id}/profile.${ext}`;\r\n          const { data } = supabase.storage\r\n            .from('avatars')\r\n            .getPublicUrl(path);\r\n\r\n          if (data?.publicUrl) {\r\n            const response = await fetch(data.publicUrl, { method: 'HEAD' });\r\n            if (response.ok) {\r\n              setProfileImage(data.publicUrl);\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n      } catch (error) {\r\n        console.log('No existing profile image found');\r\n      }\r\n    };\r\n\r\n    loadProfileImage();\r\n  }, [user]);\r\n\r\n  const handleImageUpload = async (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    try {\r\n      setUploading(true);\r\n      const file = event.target.files?.[0];\r\n\r\n      if (!file) {\r\n        toast.error(\"Nenhum arquivo selecionado\");\r\n        return;\r\n      }\r\n\r\n      if (!user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      // Validar tipo de arquivo\r\n      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\r\n      if (!allowedTypes.includes(file.type)) {\r\n        toast.error(\"Formato não suportado. Use: JPG, PNG, GIF ou WebP\");\r\n        return;\r\n      }\r\n\r\n      // Validar tamanho do arquivo (máximo 5MB)\r\n      const maxSize = 5 * 1024 * 1024; // 5MB\r\n      if (file.size > maxSize) {\r\n        toast.error(\"Arquivo muito grande. Tamanho máximo: 5MB\");\r\n        return;\r\n      }\r\n\r\n      const fileExt = file.name.split('.').pop()?.toLowerCase() || 'jpg';\r\n      const fileName = `profile.${fileExt}`;\r\n      // Usar estrutura de pastas: userId/fileName\r\n      const filePath = `${user.id}/${fileName}`;\r\n\r\n      console.log('Uploading file:', { fileName, fileType: file.type, fileSize: file.size, filePath });\r\n\r\n      // Tentar fazer upload para o bucket avatars\r\n      const { error: uploadError } = await supabase.storage\r\n        .from('avatars')\r\n        .upload(filePath, file, {\r\n          upsert: true,\r\n          contentType: file.type\r\n        });\r\n\r\n      if (uploadError) {\r\n        console.error('Upload error:', uploadError);\r\n\r\n        // Se falhar no avatars, tentar no lead-documents como fallback\r\n        console.log('Trying fallback upload to lead-documents...');\r\n        const fallbackPath = `${user.id}/profile/${fileName}`;\r\n\r\n        const { error: fallbackError } = await supabase.storage\r\n          .from('lead-documents')\r\n          .upload(fallbackPath, file, {\r\n            upsert: true,\r\n            contentType: file.type\r\n          });\r\n\r\n        if (fallbackError) {\r\n          throw fallbackError;\r\n        }\r\n\r\n        // Usar URL do fallback\r\n        const { data: fallbackData } = supabase.storage\r\n          .from('lead-documents')\r\n          .getPublicUrl(fallbackPath);\r\n\r\n        if (fallbackData?.publicUrl) {\r\n          setProfileImage(fallbackData.publicUrl);\r\n          toast.success(\"Foto de perfil atualizada com sucesso!\");\r\n          return;\r\n        }\r\n\r\n        throw new Error(\"Erro ao obter URL da imagem\");\r\n      }\r\n\r\n      // Se upload no avatars funcionou\r\n      const { data } = supabase.storage\r\n        .from('avatars')\r\n        .getPublicUrl(filePath);\r\n\r\n      if (data?.publicUrl) {\r\n        setProfileImage(data.publicUrl);\r\n        toast.success(\"Foto de perfil atualizada com sucesso!\");\r\n      } else {\r\n        throw new Error(\"Erro ao obter URL da imagem\");\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error('Error uploading file:', error);\r\n\r\n      if (error.message?.includes('Bucket not found')) {\r\n        toast.error(\"Storage não configurado. Entre em contato com o suporte.\");\r\n      } else if (error.message?.includes('new row violates row-level security') || error.message?.includes('policy')) {\r\n        toast.error(\"Sistema de upload temporariamente indisponível. Tente novamente em alguns minutos.\");\r\n      } else {\r\n        toast.error(`Erro ao fazer upload da foto: ${error.message || 'Erro desconhecido'}`);\r\n      }\r\n    } finally {\r\n      setUploading(false);\r\n      // Limpar o input para permitir o mesmo arquivo novamente\r\n      if (event.target) {\r\n        event.target.value = '';\r\n      }\r\n    }\r\n  };\r\n\r\n  const getInitials = (email: string) => {\r\n    if (!email) return \"U\";\r\n    return email.charAt(0).toUpperCase();\r\n  };\r\n\r\n  // Adiciona focus ao input ao clicar na imagem/ícone\r\n  const inputRef = React.useRef<HTMLInputElement | null>(null);\r\n\r\n  const handleAvatarClick = () => {\r\n    if (inputRef.current && !uploading) {\r\n      inputRef.current.click();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Sidebar className=\"bg-gradient-to-br from-blue-900 via-blue-800 to-indigo-900 border-r border-blue-700/50 sidebar-responsive\">\r\n\r\n\r\n      <SidebarContent className=\"flex-1 pt-3 notebook:pt-4 lg:pt-4\">\r\n        {Object.entries(groupedItems).map(([group, groupItems]) => (\r\n          <SidebarGroup key={group}>\r\n            <SidebarGroupLabel className=\"text-xs font-semibold text-blue-200/80 uppercase tracking-wider\">\r\n              {group}\r\n            </SidebarGroupLabel>\r\n            <SidebarGroupContent>\r\n              <SidebarMenu>\r\n                {groupItems.map((item) => (\r\n                  <SidebarMenuItem key={item.title}>\r\n                    <SidebarMenuButton\r\n                      asChild\r\n                      isActive={location.pathname === item.url}\r\n                      className={\r\n                        \"w-full text-blue-100 hover:text-white hover:bg-blue-700/50 transition-all duration-200 \" +\r\n                        (location.pathname === item.url\r\n                          ? \"bg-blue-600/60 text-white shadow-lg border-l-4 border-blue-300\"\r\n                          : \"\") +\r\n                        (item.highlight\r\n                          ? \" !bg-gradient-to-r !from-orange-600 !to-amber-600 !text-white !border !border-orange-500 font-semibold hover:!from-orange-700 hover:!to-amber-700 shadow-lg\"\r\n                          : \"\")\r\n                      }\r\n                    >\r\n                      <Link to={item.url} className=\"flex items-center gap-3 px-3 py-2\">\r\n                        <item.icon className={\r\n                          \"h-4 w-4 transition-colors duration-200 \" +\r\n                          (item.highlight ? \"!text-white\" :\r\n                            location.pathname === item.url ? \"text-white\" : \"text-blue-200\")\r\n                        } />\r\n                        <span className={\r\n                          \"font-medium transition-colors duration-200 \" +\r\n                          (item.highlight ? \"!text-white\" :\r\n                            location.pathname === item.url ? \"text-white\" : \"text-blue-100\")\r\n                        }>\r\n                          {item.title}\r\n                        </span>\r\n                      </Link>\r\n                    </SidebarMenuButton>\r\n                  </SidebarMenuItem>\r\n                ))}\r\n              </SidebarMenu>\r\n            </SidebarGroupContent>\r\n          </SidebarGroup>\r\n        ))}\r\n      </SidebarContent>\r\n      <SidebarFooter className=\"border-t border-blue-700/50 bg-blue-900/50\">\r\n        <div className=\"pt-4\">\r\n          <div className=\"flex flex-col items-center space-y-3 px-3\">\r\n            {/* Profile Image/Selfie Section */}\r\n            <div className=\"relative\">\r\n              <Avatar\r\n                className={`h-16 w-16 cursor-pointer ring-2 ring-blue-400/30 transition-all duration-300 relative ${isAvatarHovered ? 'ring-blue-300/80 shadow-lg shadow-blue-500/20' : ''\r\n                  }`}\r\n                onClick={handleAvatarClick}\r\n                tabIndex={0}\r\n                onKeyDown={e => {\r\n                  if (e.key === \"Enter\" || e.key === \" \") handleAvatarClick();\r\n                }}\r\n                aria-label={uploading ? \"Enviando foto\" : \"Editar foto de perfil\"}\r\n                role=\"button\"\r\n                onMouseEnter={(e) => {\r\n                  e.stopPropagation();\r\n                  setIsAvatarHovered(true);\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  e.stopPropagation();\r\n                  setIsAvatarHovered(false);\r\n                }}\r\n              >\r\n                {profileImage ? (\r\n                  <AvatarImage src={profileImage} alt=\"Profile\" className=\"h-full w-full object-cover\" loading=\"lazy\" />\r\n                ) : (\r\n                  <AvatarFallback className=\"text-lg bg-blue-600 text-white border-2 border-blue-400/50\">\r\n                    {user ? getInitials(user.email || \"\") : \"U\"}\r\n                  </AvatarFallback>\r\n                )}\r\n                {/* Botão de editar sobreposto (ícone lápis) visível apenas ao hover diretamente no avatar */}\r\n                <div className={`absolute inset-0 bg-black/60 rounded-full flex items-center justify-center transition-opacity duration-300 pointer-events-none z-10 ${isAvatarHovered ? 'opacity-100' : 'opacity-0'\r\n                  }`}>\r\n                  <Edit className=\"h-6 w-6 text-white drop-shadow-lg\" />\r\n                </div>\r\n              </Avatar>\r\n              {/* Input escondido, acionado ao clicar no avatar */}\r\n              <Input\r\n                id=\"profile-upload\"\r\n                ref={inputRef}\r\n                type=\"file\"\r\n                accept=\"image/jpeg,image/jpg,image/png,image/gif,image/webp\"\r\n                onChange={handleImageUpload}\r\n                className=\"hidden\"\r\n                disabled={uploading}\r\n              />\r\n            </div>\r\n\r\n            {/* User Email */}\r\n            <div className=\"text-center w-full\">\r\n              <p className=\"text-sm font-medium truncate px-2 text-white\">\r\n                {user?.email || \"Usuário\"}\r\n              </p>\r\n              {uploading ? (\r\n                <p className=\"text-xs text-blue-300\">Fazendo upload...</p>\r\n              ) : (\r\n                <p className=\"text-xs text-blue-200/70\">\r\n                  Conectado\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </SidebarFooter>\r\n    </Sidebar>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\BundleOptimizer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[762,765],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[762,765],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1542,1545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1542,1545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'bundleMetrics' and 'optimization'. Either include them or remove the dependency array.","line":52,"column":6,"nodeType":"ArrayExpression","endLine":52,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [bundleMetrics, optimization]","fix":{"range":[1739,1741],"text":"[bundleMetrics, optimization]"}}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Progress } from '@/components/ui/progress';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { \r\n  Zap, \r\n  Package, \r\n  Timer, \r\n  TrendingUp, \r\n  Settings, \r\n  CheckCircle, \r\n  AlertTriangle,\r\n  BarChart3,\r\n  Download,\r\n  Trash2,\r\n  RefreshCw\r\n} from 'lucide-react';\r\nimport { useBundleOptimization, useBundleMetrics } from '@/hooks/useBundleOptimization';\r\n\r\ninterface BundleOptimizerProps {\r\n  onSettingsChange?: (settings: any) => void;\r\n}\r\n\r\nexport const BundleOptimizer: React.FC<BundleOptimizerProps> = ({ onSettingsChange }) => {\r\n  const [settings, setSettings] = useState({\r\n    enablePreloading: true,\r\n    enableImageOptimization: true,\r\n    enableCodeSplitting: true,\r\n    aggressiveOptimization: false\r\n  });\r\n\r\n  const optimization = useBundleOptimization({\r\n    enablePreloading: settings.enablePreloading,\r\n    enableImageOptimization: settings.enableImageOptimization,\r\n    enableCodeSplitting: settings.enableCodeSplitting,\r\n    preloadCriticalRoutes: settings.aggressiveOptimization \r\n      ? ['leads', 'dashboard', 'commission', 'settings'] \r\n      : ['leads', 'dashboard']\r\n  });\r\n\r\n  const bundleMetrics = useBundleMetrics();\r\n  const [analysisResults, setAnalysisResults] = useState<any>(null);\r\n\r\n  useEffect(() => {\r\n    // Analisar bundle na inicialização\r\n    const results = optimization.analyzeBundle();\r\n    setAnalysisResults(results);\r\n    bundleMetrics.refresh();\r\n  }, []);\r\n\r\n  const handleSettingChange = (key: string, value: boolean) => {\r\n    const newSettings = { ...settings, [key]: value };\r\n    setSettings(newSettings);\r\n    onSettingsChange?.(newSettings);\r\n  };\r\n\r\n  const performDeepAnalysis = () => {\r\n    const results = optimization.analyzeBundle();\r\n    const unusedCode = optimization.detectUnusedCode();\r\n    \r\n    setAnalysisResults({\r\n      ...results,\r\n      unusedCode,\r\n      suggestions: [\r\n        'Bundle está otimizado para performance',\r\n        'Code splitting implementado corretamente',\r\n        'Lazy loading ativo para componentes pesados'\r\n      ]\r\n    });\r\n  };\r\n\r\n  const formatBytes = (bytes: number) => {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n  };\r\n\r\n  const getOptimizationScore = () => {\r\n    let score = 0;\r\n    if (settings.enablePreloading) score += 25;\r\n    if (settings.enableImageOptimization) score += 25;\r\n    if (settings.enableCodeSplitting) score += 30;\r\n    if (bundleMetrics.getCompressionRatio() > 70) score += 20;\r\n    return Math.min(score, 100);\r\n  };\r\n\r\n  const optimizationScore = getOptimizationScore();\r\n\r\n  return (\r\n    <div className=\"space-y-6 p-6 max-w-6xl mx-auto\">\r\n      {/* Cabeçalho */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h2 className=\"text-3xl font-bold tracking-tight\">Bundle Optimizer</h2>\r\n          <p className=\"text-muted-foreground\">\r\n            Otimize o desempenho e tamanho do bundle da aplicação\r\n          </p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <Badge variant={optimizationScore >= 80 ? \"default\" : \"secondary\"} className=\"text-sm\">\r\n            <Zap className=\"w-4 h-4 mr-1\" />\r\n            Score: {optimizationScore}%\r\n          </Badge>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Geral */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <BarChart3 className=\"w-5 h-5\" />\r\n            Status de Otimização\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Visão geral das otimizações ativas e métricas de performance\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n            <div className=\"text-center p-4 bg-blue-50 rounded-lg\">\r\n              <Package className=\"w-8 h-8 text-blue-600 mx-auto mb-2\" />\r\n              <div className=\"text-2xl font-bold text-blue-700\">\r\n                {formatBytes(bundleMetrics.metrics.totalBundleSize)}\r\n              </div>\r\n              <div className=\"text-sm text-blue-600\">Tamanho Total</div>\r\n            </div>\r\n            \r\n            <div className=\"text-center p-4 bg-green-50 rounded-lg\">\r\n              <Timer className=\"w-8 h-8 text-green-600 mx-auto mb-2\" />\r\n              <div className=\"text-2xl font-bold text-green-700\">\r\n                {Math.round(bundleMetrics.metrics.initialLoadTime)}ms\r\n              </div>\r\n              <div className=\"text-sm text-green-600\">Tempo de Carregamento</div>\r\n            </div>\r\n            \r\n            <div className=\"text-center p-4 bg-purple-50 rounded-lg\">\r\n              <TrendingUp className=\"w-8 h-8 text-purple-600 mx-auto mb-2\" />\r\n              <div className=\"text-2xl font-bold text-purple-700\">\r\n                {Math.round(bundleMetrics.getCompressionRatio())}%\r\n              </div>\r\n              <div className=\"text-sm text-purple-600\">Compressão</div>\r\n            </div>\r\n            \r\n            <div className=\"text-center p-4 bg-orange-50 rounded-lg\">\r\n              <Package className=\"w-8 h-8 text-orange-600 mx-auto mb-2\" />\r\n              <div className=\"text-2xl font-bold text-orange-700\">\r\n                {bundleMetrics.metrics.chunksLoaded}\r\n              </div>\r\n              <div className=\"text-sm text-orange-600\">Chunks Carregados</div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"mt-6\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <span className=\"text-sm font-medium\">Score de Otimização</span>\r\n              <span className=\"text-sm text-muted-foreground\">{optimizationScore}%</span>\r\n            </div>\r\n            <Progress value={optimizationScore} className=\"h-3\" />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Configurações de Otimização */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Settings className=\"w-5 h-5\" />\r\n            Configurações de Otimização\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Configure as otimizações automáticas do bundle\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"space-y-0.5\">\r\n              <div className=\"text-sm font-medium\">Preloading Inteligente</div>\r\n              <div className=\"text-xs text-muted-foreground\">\r\n                Carrega recursos críticos automaticamente\r\n              </div>\r\n            </div>\r\n            <Switch\r\n              checked={settings.enablePreloading}\r\n              onCheckedChange={(checked) => handleSettingChange('enablePreloading', checked)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"space-y-0.5\">\r\n              <div className=\"text-sm font-medium\">Otimização de Imagens</div>\r\n              <div className=\"text-xs text-muted-foreground\">\r\n                Lazy loading e formato WebP automáticos\r\n              </div>\r\n            </div>\r\n            <Switch\r\n              checked={settings.enableImageOptimization}\r\n              onCheckedChange={(checked) => handleSettingChange('enableImageOptimization', checked)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"space-y-0.5\">\r\n              <div className=\"text-sm font-medium\">Code Splitting</div>\r\n              <div className=\"text-xs text-muted-foreground\">\r\n                Divisão automática de código por rotas\r\n              </div>\r\n            </div>\r\n            <Switch\r\n              checked={settings.enableCodeSplitting}\r\n              onCheckedChange={(checked) => handleSettingChange('enableCodeSplitting', checked)}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"space-y-0.5\">\r\n              <div className=\"text-sm font-medium\">Otimização Agressiva</div>\r\n              <div className=\"text-xs text-muted-foreground\">\r\n                Preload de todas as rotas críticas\r\n              </div>\r\n            </div>\r\n            <Switch\r\n              checked={settings.aggressiveOptimization}\r\n              onCheckedChange={(checked) => handleSettingChange('aggressiveOptimization', checked)}\r\n            />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Análise Detalhada */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <BarChart3 className=\"w-5 h-5\" />\r\n            Análise do Bundle\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Informações detalhadas sobre o bundle e sugestões de otimização\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex gap-4 mb-6\">\r\n            <Button onClick={performDeepAnalysis} variant=\"outline\">\r\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n              Analisar Bundle\r\n            </Button>\r\n            <Button onClick={optimization.preloadCriticalResources} variant=\"outline\">\r\n              <Download className=\"w-4 h-4 mr-2\" />\r\n              Preload Crítico\r\n            </Button>\r\n            <Button onClick={optimization.cleanupUnusedResources} variant=\"outline\">\r\n              <Trash2 className=\"w-4 h-4 mr-2\" />\r\n              Limpar Cache\r\n            </Button>\r\n          </div>\r\n\r\n          {analysisResults && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                <div className=\"p-4 border rounded-lg\">\r\n                  <div className=\"text-sm font-medium text-muted-foreground\">Scripts</div>\r\n                  <div className=\"text-2xl font-bold\">{analysisResults.scriptCount}</div>\r\n                </div>\r\n                <div className=\"p-4 border rounded-lg\">\r\n                  <div className=\"text-sm font-medium text-muted-foreground\">Estilos</div>\r\n                  <div className=\"text-2xl font-bold\">{analysisResults.styleCount}</div>\r\n                </div>\r\n                <div className=\"p-4 border rounded-lg\">\r\n                  <div className=\"text-sm font-medium text-muted-foreground\">Tamanho Estimado</div>\r\n                  <div className=\"text-2xl font-bold\">{analysisResults.estimatedSize}KB</div>\r\n                </div>\r\n              </div>\r\n\r\n              {analysisResults.suggestions && (\r\n                <Alert>\r\n                  <CheckCircle className=\"h-4 w-4\" />\r\n                  <AlertDescription>\r\n                    <strong>Status:</strong> {analysisResults.suggestions.join(', ')}\r\n                  </AlertDescription>\r\n                </Alert>\r\n              )}\r\n\r\n              {analysisResults.unusedCode && (\r\n                <Alert>\r\n                  <AlertTriangle className=\"h-4 w-4\" />\r\n                  <AlertDescription>\r\n                    <strong>Código não utilizado:</strong> {analysisResults.unusedCode.unusedCodePercentage}%\r\n                    <br />\r\n                    <strong>Sugestões:</strong> {analysisResults.unusedCode.suggestions.join(', ')}\r\n                  </AlertDescription>\r\n                </Alert>\r\n              )}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Métricas de Performance */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Métricas de Performance</CardTitle>\r\n          <CardDescription>\r\n            Monitoramento em tempo real das métricas de bundle\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n              <div>\r\n                <div className=\"text-sm font-medium mb-2\">Uso de Memória</div>\r\n                <div className=\"text-2xl font-bold text-blue-600\">\r\n                  {formatBytes(optimization.metrics.memoryUsage)}\r\n                </div>\r\n              </div>\r\n              <div>\r\n                <div className=\"text-sm font-medium mb-2\">Cache Hit Rate</div>\r\n                <div className=\"text-2xl font-bold text-green-600\">\r\n                  {Math.round(optimization.metrics.cacheHitRate * 100)}%\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-4 bg-gray-50 rounded-lg\">\r\n              <h4 className=\"font-medium mb-2\">Próximos Passos Recomendados</h4>\r\n              <ul className=\"text-sm space-y-1 text-muted-foreground\">\r\n                <li>• Considere implementar Service Worker para cache offline</li>\r\n                <li>• Configure CDN para assets estáticos</li>\r\n                <li>• Implemente virtual scrolling para listas grandes</li>\r\n                <li>• Use compressão Brotli no servidor</li>\r\n                <li>• Configure preload de recursos críticos</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\CacheManager.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\CookieConsent.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\Dashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11061,11064],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11061,11064],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11082,11085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11082,11085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":385,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":385,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16375,16378],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16375,16378],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Users, PhoneCall, CalendarCheck, TrendingUp, TrendingDown, User, Search, BarChart3, DollarSign, Calendar, FileText, Clock, AlertTriangle, CheckCircle, X } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format, startOfToday, endOfToday, startOfMonth, endOfMonth, differenceInMinutes, startOfWeek, endOfWeek } from \"date-fns\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { toast } from \"sonner\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport MetricsCard from \"@/components/dashboard/MetricsCard\";\r\nimport ProductionCard from \"@/components/dashboard/ProductionCard\";\r\nimport EmployeePerformanceCard from \"@/components/dashboard/EmployeePerformanceCard\";\r\nimport LatestLeadsCard from \"@/components/dashboard/LatestLeadsCard\";\r\nimport { formatLeadDate } from \"@/utils/dateUtils\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\n\r\nfunction isUUID(str) {\r\n  // Regex para UUID v4 padrão\r\n  return /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(str);\r\n}\r\n\r\nconst Dashboard = () => {\r\n  const [metrics, setMetrics] = useState({\r\n    leadsToday: 0,\r\n    leadsThisMonth: 0,\r\n    averageLeadsPerDay: 0,\r\n    averageTimeBetweenLeads: \"0min\",\r\n    monthlyProduction: 0,\r\n    weeklyConversionRate: 0,\r\n    proposalsDigitatedToday: 0,\r\n    emAndamento: 0,\r\n    emAndamentoValue: 0,\r\n    pendente: 0,\r\n    pendenteValue: 0,\r\n    pago: 0,\r\n    pagoValue: 0,\r\n    cancelado: 0,\r\n    canceladoValue: 0\r\n  });\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [dailyProduction, setDailyProduction] = useState([]);\r\n  const [employeeSales, setEmployeeSales] = useState([]);\r\n  const [latestLeads, setLatestLeads] = useState([]);\r\n  const [employeeMap, setEmployeeMap] = useState<{ [id: string]: string }>({});\r\n  const [employeeMapLoaded, setEmployeeMapLoaded] = useState(false);\r\n  const [employeeSalesMap, setEmployeeSalesMap] = useState({});\r\n\r\n  useEffect(() => {\r\n    const fetchMetrics = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        // Get date ranges\r\n        const today = new Date();\r\n        const todayStart = startOfToday().toISOString();\r\n        const todayEnd = endOfToday().toISOString();\r\n        const monthStart = startOfMonth(today).toISOString();\r\n        const monthEnd = endOfMonth(today).toISOString();\r\n        const weekStart = startOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n        const weekEnd = endOfWeek(today, { weekStartsOn: 1 }).toISOString();\r\n\r\n        // Get user ID once\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        const userId = user?.id;\r\n\r\n        // Fetching metrics with optimized parallel queries\r\n\r\n        // Execute all independent queries in parallel using Promise.all\r\n        const [\r\n          leadsTodayResult,\r\n          leadsThisMonthResult,\r\n          proposalsTodayResult,\r\n          emAndamentoResult,\r\n          pendenteResult,\r\n          pagoResult,\r\n          canceladoResult,\r\n          monthLeadsResult,\r\n          monthlyProductionResult,\r\n          weeklyLeadsResult,\r\n          weeklyConvertedResult,\r\n          dailyDataResult,\r\n          employeeDataResult,\r\n          latestLeadsResult,\r\n          statusLeadsResult\r\n        ] = await Promise.all([\r\n          // Count queries\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .gte('created_at', todayStart).lte('created_at', todayEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', todayStart).lte('created_at', todayEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .eq('status', 'negociando').not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .eq('status', 'pendente').not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .eq('status', 'concluido').not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .eq('status', 'cancelado').not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          // Data queries\r\n          supabase.from('leads').select('created_at')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd)\r\n            .order('created_at', { ascending: true }),\r\n          supabase.from('leads').select('amount')\r\n            .not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .gte('created_at', weekStart).lte('created_at', weekEnd),\r\n          supabase.from('leads').select('*', { count: 'exact', head: true })\r\n            .eq('status', 'concluido')\r\n            .gte('created_at', weekStart).lte('created_at', weekEnd),\r\n          supabase.from('leads').select('*')\r\n            .not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', todayStart).lte('created_at', todayEnd),\r\n          supabase.from('leads').select('employee, amount, status, created_at')\r\n            .eq('user_id', userId)\r\n            .not('employee', 'is', null).not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd),\r\n          supabase.from('leads').select('*')\r\n            .order('date', { ascending: false })\r\n            .order('created_at', { ascending: false })\r\n            .limit(6),\r\n          supabase.from('leads').select('status, amount')\r\n            .not('amount', 'is', null).neq('amount', '')\r\n            .gte('created_at', monthStart).lte('created_at', monthEnd)\r\n        ]);\r\n\r\n        // Extract results\r\n        const leadsToday = leadsTodayResult.count || 0;\r\n        const leadsThisMonth = leadsThisMonthResult.count || 0;\r\n        const proposalsDigitatedToday = proposalsTodayResult.count || 0;\r\n        const emAndamento = emAndamentoResult.count || 0;\r\n        const pendente = pendenteResult.count || 0;\r\n        const pago = pagoResult.count || 0;\r\n        const cancelado = canceladoResult.count || 0;\r\n        const monthLeads = monthLeadsResult.data || [];\r\n        const monthlyLeadsWithAmount = monthlyProductionResult.data || [];\r\n        const weeklyLeadsCount = weeklyLeadsResult.count || 0;\r\n        const weeklyConvertedCount = weeklyConvertedResult.count || 0;\r\n        const dailyData = dailyDataResult.data || [];\r\n        const employeeData = employeeDataResult.data || [];\r\n        const latestLeadsData = latestLeadsResult.data || [];\r\n        const statusLeads = statusLeadsResult.data || [];\r\n\r\n        // Calculate average time between leads\r\n        let averageTimeBetweenLeads = \"0min\";\r\n        if (monthLeads.length > 1) {\r\n          let totalMinutesDiff = 0;\r\n          let diffCount = 0;\r\n          for (let i = 1; i < monthLeads.length; i++) {\r\n            const prevDate = new Date(monthLeads[i - 1].created_at);\r\n            const currentDate = new Date(monthLeads[i].created_at);\r\n            const diffMinutes = differenceInMinutes(currentDate, prevDate);\r\n            if (diffMinutes > 0 && diffMinutes < 1440) {\r\n              totalMinutesDiff += diffMinutes;\r\n              diffCount += 1;\r\n            }\r\n          }\r\n          const avgMinutes = diffCount > 0 ? Math.round(totalMinutesDiff / diffCount) : 0;\r\n          averageTimeBetweenLeads = `${avgMinutes}min`;\r\n        }\r\n\r\n        // Calculate average leads per day\r\n        const daysPassed = Math.max(1, new Date().getDate());\r\n        const averageLeadsPerDay = leadsThisMonth ? parseFloat((leadsThisMonth / daysPassed).toFixed(1)) : 0;\r\n\r\n        // Calculate monthly production\r\n        const monthlyProduction = monthlyLeadsWithAmount.reduce((total, lead) => {\r\n          const cleanAmount = lead.amount?.replace(/[^\\d,]/g, '').replace(',', '.') || \"0\";\r\n          const amount = parseFloat(cleanAmount);\r\n          return isNaN(amount) ? total : total + amount;\r\n        }, 0);\r\n\r\n        // Calculate weekly conversion rate\r\n        const weeklyConversionRate = weeklyLeadsCount > 0 ? \r\n          ((weeklyConvertedCount || 0) / weeklyLeadsCount * 100) : 0;\r\n\r\n        // Process employee data\r\n        const employeeSalesMap: { [key: string]: { totalLeadsWithAmount: number; convertedSales: number; totalValue: number } } = {};\r\n        employeeData.forEach(lead => {\r\n          if (lead.employee && lead.amount) {\r\n            if (!employeeSalesMap[lead.employee]) {\r\n              employeeSalesMap[lead.employee] = {\r\n                totalLeadsWithAmount: 0,\r\n                convertedSales: 0,\r\n                totalValue: 0\r\n              };\r\n            }\r\n            const cleanAmount = lead.amount.replace(/[^\\d,]/g, '').replace(',', '.') || \"0\";\r\n            const amount = parseFloat(cleanAmount);\r\n            if (!isNaN(amount)) {\r\n              employeeSalesMap[lead.employee].totalLeadsWithAmount += 1;\r\n              employeeSalesMap[lead.employee].totalValue += amount;\r\n              if (lead.status === 'concluido') {\r\n                employeeSalesMap[lead.employee].convertedSales += 1;\r\n              }\r\n            }\r\n          }\r\n        });\r\n\r\n        // Calculate status sums\r\n        const statusSums = {\r\n          emAndamentoValue: 0,\r\n          pendenteValue: 0,\r\n          pagoValue: 0,\r\n          canceladoValue: 0\r\n        };\r\n        statusLeads.forEach(lead => {\r\n          const cleanAmount = lead.amount?.replace(/[^\\d,]/g, '').replace(',', '.') || \"0\";\r\n          const amount = parseFloat(cleanAmount);\r\n          if (isNaN(amount)) return;\r\n          if (lead.status === 'negociando') statusSums.emAndamentoValue += amount;\r\n          if (lead.status === 'pendente') statusSums.pendenteValue += amount;\r\n          if (lead.status === 'concluido') statusSums.pagoValue += amount;\r\n          if (lead.status === 'cancelado') statusSums.canceladoValue += amount;\r\n        });\r\n\r\n        // Set state\r\n        setDailyProduction(dailyData);\r\n        setEmployeeSalesMap(employeeSalesMap);\r\n        const formattedLatestLeads = latestLeadsData.map(lead => ({\r\n          ...lead,\r\n          createdAt: formatLeadDate((lead as any).date ? (lead as any).date : lead.created_at)\r\n        }));\r\n        setLatestLeads(formattedLatestLeads);\r\n\r\n        // Update metrics\r\n        setMetrics({\r\n          leadsToday: leadsToday || 0,\r\n          leadsThisMonth: leadsThisMonth || 0,\r\n          averageLeadsPerDay: averageLeadsPerDay,\r\n          averageTimeBetweenLeads: averageTimeBetweenLeads,\r\n          monthlyProduction: monthlyProduction,\r\n          weeklyConversionRate: weeklyConversionRate,\r\n          proposalsDigitatedToday: proposalsDigitatedToday || 0,\r\n          emAndamento: emAndamento || 0,\r\n          emAndamentoValue: statusSums.emAndamentoValue,\r\n          pendente: pendente || 0,\r\n          pendenteValue: statusSums.pendenteValue,\r\n          pago: pago || 0,\r\n          pagoValue: statusSums.pagoValue,\r\n          cancelado: cancelado || 0,\r\n          canceladoValue: statusSums.canceladoValue\r\n        });\r\n\r\n        console.log(\"Updated metrics:\", {\r\n          leadsToday: leadsToday || 0,\r\n          leadsThisMonth: leadsThisMonth || 0,\r\n          averageLeadsPerDay: averageLeadsPerDay,\r\n          averageTimeBetweenLeads: averageTimeBetweenLeads,\r\n          monthlyProduction: monthlyProduction,\r\n          weeklyConversionRate: weeklyConversionRate,\r\n          proposalsDigitatedToday: proposalsDigitatedToday || 0,\r\n          emAndamento: emAndamento || 0,\r\n          emAndamentoValue: statusSums.emAndamentoValue,\r\n          pendente: pendente || 0,\r\n          pendenteValue: statusSums.pendenteValue,\r\n          pago: pago || 0,\r\n          pagoValue: statusSums.pagoValue,\r\n          cancelado: cancelado || 0,\r\n          canceladoValue: statusSums.canceladoValue\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error('Error fetching metrics:', error);\r\n        toast.error(\"Erro ao carregar métricas do dashboard\");\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    fetchMetrics();\r\n    \r\n    // Refresh metrics every 30 seconds for real-time updates\r\n    const interval = setInterval(fetchMetrics, 30 * 1000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Buscar funcionários ativos e montar o mapa id -> nome\r\n    getEmployees().then((list: Employee[]) => {\r\n      const map: { [id: string]: string } = {};\r\n      list.forEach(emp => { map[emp.id] = emp.name; });\r\n      setEmployeeMap(map);\r\n      setEmployeeMapLoaded(true);\r\n      console.log('Mapa de funcionários carregado:', map);\r\n    });\r\n  }, []);\r\n\r\n  const calculateChange = (current: number, previous: number) => {\r\n    if (!previous) return {\r\n      value: \"+0%\",\r\n      positive: true\r\n    };\r\n    const change = (current - previous) / previous * 100;\r\n    return {\r\n      value: `${change > 0 ? \"+\" : \"\"}${change.toFixed(1)}%`,\r\n      positive: change >= 0\r\n    };\r\n  };\r\n\r\n  const metricsData = [\r\n    {\r\n      title: \"Leads Hoje\",\r\n      value: metrics.leadsToday.toString(),\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <Users className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-blue-100\",\r\n      iconColor: \"text-blue-700\"\r\n    }, {\r\n      title: \"Total de Leads\",\r\n      value: metrics.leadsThisMonth.toString(),\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <PhoneCall className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-green-100\",\r\n      iconColor: \"text-green-700\"\r\n    }, {\r\n      title: \"Propostas Digitadas\",\r\n      value: metrics.proposalsDigitatedToday.toString(),\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <FileText className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-orange-100\",\r\n      iconColor: \"text-orange-700\"\r\n    }, {\r\n      title: \"Em Andamento\",\r\n      value: metrics.emAndamento.toString(),\r\n      valueTotal: metrics.emAndamentoValue,\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <Clock className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-blue-500\",\r\n      iconColor: \"text-white\",\r\n      statusFilter: \"negociando\",\r\n      clickable: true\r\n    }, {\r\n      title: \"Pendente\",\r\n      value: metrics.pendente.toString(),\r\n      valueTotal: metrics.pendenteValue,\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <AlertTriangle className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-yellow-400\",\r\n      iconColor: \"text-white\",\r\n      statusFilter: \"pendente\",\r\n      clickable: true\r\n    }, {\r\n      title: \"Pago\",\r\n      value: metrics.pago.toString(),\r\n      valueTotal: metrics.pagoValue,\r\n      subtitle: \"\",\r\n      positive: true,\r\n      icon: <CheckCircle className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-green-500\",\r\n      iconColor: \"text-white\",\r\n      statusFilter: \"concluido\",\r\n      clickable: true\r\n    }, {\r\n      title: \"Cancelado\",\r\n      value: metrics.cancelado.toString(),\r\n      valueTotal: metrics.canceladoValue,\r\n      subtitle: \"\",\r\n      positive: false,\r\n      icon: <X className=\"h-4 w-4 lg:h-5 lg:w-5\" />,\r\n      iconBg: \"bg-red-500\",\r\n      iconColor: \"text-white\",\r\n      statusFilter: \"cancelado\",\r\n      clickable: true\r\n    }\r\n  ];\r\n\r\n  // Separe os três primeiros cards de métricas\r\n  const mainMetrics = metricsData.slice(0, 3);\r\n  const otherMetrics = metricsData.slice(3);\r\n\r\n  const employeeSalesArray = useMemo(() => {\r\n    return Object.entries(employeeSalesMap).map(([employeeId, data]) => {\r\n      const d = data as any;\r\n      // Buscar o nome do funcionário no mapa, ou usar o ID como fallback\r\n      const employeeName = employeeMap[employeeId] || employeeId;\r\n      return {\r\n        employee: employeeName, // Exibe o nome do funcionário\r\n        id: employeeId,\r\n        count: d.totalLeadsWithAmount,\r\n        convertedSales: d.convertedSales,\r\n        totalValue: d.totalValue\r\n      };\r\n    });\r\n  }, [employeeSalesMap, employeeMap]);\r\n\r\n  // Sort by total value (highest first)\r\n  employeeSalesArray.sort((a, b) => b.totalValue - a.totalValue);\r\n  console.log(\"Employee sales array final:\", employeeSalesArray);\r\n\r\n  return (\r\n    <div className=\"w-full px-2 sm:px-4 md:px-0 lg:px-0 space-y-4 sm:space-y-6\">\r\n      {/* Metrics Cards Grid (status cards no topo) */}\r\n      <div className=\"w-full grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3 md:gap-4 lg:gap-6\">\r\n        {otherMetrics.map((metric, index) => (\r\n          <MetricsCard key={index} {...metric} />\r\n        ))}\r\n      </div>\r\n\r\n      {/* Main Content Grid */}\r\n      <div className=\"w-full grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6\">\r\n        <div className=\"flex flex-col gap-4 sm:gap-6\">\r\n          <ProductionCard \r\n            dailyProduction={dailyProduction}\r\n            isLoading={isLoading}\r\n          />\r\n          \r\n          {/* Três principais cards de métricas abaixo do ProductionCard */}\r\n          <div className=\"w-full grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3 md:gap-4 lg:gap-6\">\r\n            {mainMetrics.map((metric, index) => (\r\n              <MetricsCard key={index} {...metric} />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        \r\n        <EmployeePerformanceCard \r\n          employeeSales={employeeSalesArray}\r\n          isLoading={isLoading}\r\n        />\r\n      </div>\r\n      \r\n      {/* Latest Leads Full Width */}\r\n      <div className=\"w-full\">\r\n        <LatestLeadsCard \r\n          latestLeads={latestLeads}\r\n          isLoading={isLoading}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\DomainConfigurator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\EmployeeSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\EmptyState.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[601,604],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[601,604],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1764,1767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1764,1767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { UsersRound } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport LeadForm from \"./LeadForm\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst EmptyState = () => {\r\n  const [isOpenDialog, setIsOpenDialog] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  \r\n  const handleLeadSubmit = async (values: any) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Processar payment_period para evitar erro de integer\r\n      const processedData = {\r\n        ...values,\r\n        payment_period: values.payment_period && values.payment_period !== \"\" && values.payment_period !== \"none\" \r\n          ? parseInt(values.payment_period) \r\n          : undefined\r\n      };\r\n\r\n      console.log(\"EmptyState - Lead data to insert:\", processedData);\r\n      console.log(\"EmptyState - Payment period:\", {\r\n        original: values.payment_period,\r\n        processed: processedData.payment_period\r\n      });\r\n\r\n      const { data, error } = await supabase.from(\"leads\").insert({\r\n        ...processedData,\r\n        user_id: userData.user.id,\r\n      });\r\n\r\n      if (error) {\r\n        console.error(\"EmptyState - Database error:\", error);\r\n        throw error;\r\n      }\r\n      \r\n      toast.success(\"Lead cadastrado com sucesso!\");\r\n      setIsOpenDialog(false);\r\n      // Reload the page to show the new lead\r\n      window.location.reload();\r\n    } catch (error: any) {\r\n      console.error(\"EmptyState - Error creating lead:\", error);\r\n      toast.error(`Erro ao cadastrar lead: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-[400px] flex-col items-center justify-center rounded-lg border border-dashed bg-muted/30 p-8 text-center animate-fade-in\">\r\n      <div className=\"flex h-20 w-20 items-center justify-center rounded-full bg-primary/10\">\r\n        <UsersRound className=\"h-10 w-10 text-primary\" />\r\n      </div>\r\n      <h3 className=\"mt-6 text-xl font-semibold\">Nenhum lead encontrado</h3>\r\n      <p className=\"mb-6 mt-2 max-w-sm text-sm text-muted-foreground\">\r\n        Parece que você ainda não tem leads registrados ou os filtros atuais não retornaram resultados.\r\n      </p>\r\n      <div className=\"flex gap-2\">\r\n        <Button variant=\"secondary\">Importar Leads</Button>\r\n        \r\n        <Dialog open={isOpenDialog} onOpenChange={setIsOpenDialog}>\r\n          <DialogTrigger asChild>\r\n            <Button>Adicionar Lead</Button>\r\n          </DialogTrigger>\r\n          <DialogContent className=\"sm:max-w-md\">\r\n            <DialogHeader>\r\n              <DialogTitle>Adicionar Novo Lead</DialogTitle>\r\n              <DialogDescription>\r\n                Preencha os dados do novo lead no formulário abaixo.\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <LeadForm \r\n              onSubmit={handleLeadSubmit}\r\n              onCancel={() => setIsOpenDialog(false)}\r\n              isLoading={isLoading}\r\n            />\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmptyState;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ErrorBoundary.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":161,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":161,"endColumn":29},{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":187,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":187,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":188,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":188,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6255,6258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6255,6258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":190,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":190,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6317,6320],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6317,6320],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { Component, ErrorInfo, ReactNode } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { AlertTriangle, RefreshCw, Home } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  fallback?: ReactNode;\r\n}\r\n\r\ninterface State {\r\n  hasError: boolean;\r\n  error?: Error;\r\n  errorInfo?: ErrorInfo;\r\n}\r\n\r\nclass ErrorBoundary extends Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error): State {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\r\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\r\n    \r\n    // Log error to monitoring service (replace with your service)\r\n    this.logErrorToService(error, errorInfo);\r\n    \r\n    this.setState({\r\n      error,\r\n      errorInfo\r\n    });\r\n\r\n    // Show toast notification\r\n    toast.error('Ops! Algo deu errado. Nossa equipe foi notificada.');\r\n  }\r\n\r\n  logErrorToService = (error: Error, errorInfo: ErrorInfo) => {\r\n    // In production, you would send this to your error tracking service\r\n    // Example: Sentry, LogRocket, Bugsnag, etc.\r\n    \r\n    const errorData = {\r\n      message: error.message,\r\n      stack: error.stack,\r\n      componentStack: errorInfo.componentStack,\r\n      timestamp: new Date().toISOString(),\r\n      userAgent: navigator.userAgent,\r\n      url: window.location.href,\r\n    };\r\n\r\n    // For now, just log to console in development\r\n    if (import.meta.env.DEV) {\r\n      console.error('Error logged:', errorData);\r\n    }\r\n\r\n    // In production, send to your monitoring service:\r\n    // errorTrackingService.captureException(error, { extra: errorData });\r\n  };\r\n\r\n  handleReload = () => {\r\n    window.location.reload();\r\n  };\r\n\r\n  handleGoHome = () => {\r\n    window.location.href = '/';\r\n  };\r\n\r\n  render() {\r\n    if (this.state.hasError) {\r\n      // Custom fallback UI\r\n      if (this.props.fallback) {\r\n        return this.props.fallback;\r\n      }\r\n\r\n      return (\r\n        <div className=\"min-h-screen bg-gray-50 flex items-center justify-center p-4\">\r\n          <Card className=\"w-full max-w-md\">\r\n            <CardHeader className=\"text-center\">\r\n              <div className=\"mx-auto w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n                <AlertTriangle className=\"h-6 w-6 text-red-600\" />\r\n              </div>\r\n              <CardTitle className=\"text-xl font-semibold text-gray-900\">\r\n                Oops! Algo deu errado\r\n              </CardTitle>\r\n              <CardDescription className=\"text-gray-600\">\r\n                Encontramos um erro inesperado. Nossa equipe foi notificada e está trabalhando para resolver.\r\n              </CardDescription>\r\n            </CardHeader>\r\n            \r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex flex-col gap-3\">\r\n                <Button \r\n                  onClick={this.handleReload}\r\n                  className=\"w-full\"\r\n                  variant=\"default\"\r\n                >\r\n                  <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                  Tentar Novamente\r\n                </Button>\r\n                \r\n                <Button \r\n                  onClick={this.handleGoHome}\r\n                  variant=\"outline\"\r\n                  className=\"w-full\"\r\n                >\r\n                  <Home className=\"h-4 w-4 mr-2\" />\r\n                  Voltar ao Início\r\n                </Button>\r\n              </div>\r\n              \r\n              {import.meta.env.DEV && this.state.error && (\r\n                <details className=\"mt-4 p-3 bg-gray-100 rounded-md text-sm\">\r\n                  <summary className=\"cursor-pointer font-medium text-gray-700 mb-2\">\r\n                    Detalhes do Erro (Desenvolvimento)\r\n                  </summary>\r\n                  <div className=\"space-y-2 text-xs text-gray-600\">\r\n                    <div>\r\n                      <strong>Erro:</strong> {this.state.error.message}\r\n                    </div>\r\n                    {this.state.error.stack && (\r\n                      <div>\r\n                        <strong>Stack:</strong>\r\n                        <pre className=\"mt-1 overflow-auto whitespace-pre-wrap\">\r\n                          {this.state.error.stack}\r\n                        </pre>\r\n                      </div>\r\n                    )}\r\n                    {this.state.errorInfo?.componentStack && (\r\n                      <div>\r\n                        <strong>Component Stack:</strong>\r\n                        <pre className=\"mt-1 overflow-auto whitespace-pre-wrap\">\r\n                          {this.state.errorInfo.componentStack}\r\n                        </pre>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </details>\r\n              )}\r\n              \r\n              <div className=\"text-center pt-4 border-t\">\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Se o problema persistir, entre em contato com o suporte.\r\n                </p>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return this.props.children;\r\n  }\r\n}\r\n\r\n// Hook para capturar erros em componentes funcionais\r\nexport const useErrorHandler = () => {\r\n  const handleError = (error: Error, errorInfo?: string) => {\r\n    console.error('Error caught by useErrorHandler:', error);\r\n    \r\n    // Log to monitoring service\r\n    const errorData = {\r\n      message: error.message,\r\n      stack: error.stack,\r\n      info: errorInfo,\r\n      timestamp: new Date().toISOString(),\r\n      url: window.location.href,\r\n    };\r\n\r\n    // Show user-friendly message\r\n    toast.error('Ops! Algo deu errado. Tente novamente.');\r\n    \r\n    // In production, send to monitoring service\r\n    if (import.meta.env.DEV) {\r\n      console.error('Error data:', errorData);\r\n    }\r\n  };\r\n\r\n  return { handleError };\r\n};\r\n\r\n// Wrapper para async operations com error handling\r\nexport const withErrorHandling = async (\r\n  operation: () => Promise<any>,\r\n  errorMessage: string = 'Operação falhou'\r\n): Promise<any> => {\r\n  try {\r\n    return await operation();\r\n  } catch (error) {\r\n    console.error('withErrorHandling caught error:', error);\r\n    toast.error(errorMessage);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport default ErrorBoundary; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\Filters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ForgotPassword.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2494,2497],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2494,2497],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Loader2, Mail, ArrowLeft, Phone, HelpCircle } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { getResetPasswordURL, debugDomainConfig, getDomainInfo, getBaseURL } from '@/utils/domainConfig';\r\nimport { toast } from 'sonner';\r\n\r\ninterface ForgotPasswordProps {\r\n  onBack: () => void;\r\n}\r\n\r\nexport const ForgotPassword: React.FC<ForgotPasswordProps> = ({ onBack }) => {\r\n  const [email, setEmail] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [recoveryMethod, setRecoveryMethod] = useState<'email' | 'support'>('email');\r\n  const [resendCounter, setResendCounter] = useState(0);\r\n\r\n  // Debug da configuração de domínio na primeira carga\r\n  useEffect(() => {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      debugDomainConfig();\r\n    }\r\n  }, []);\r\n\r\n  const handleEmailRecovery = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!email || !email.includes('@')) {\r\n      setMessage({ type: 'error', text: 'Por favor, digite um email válido.' });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const domainInfo = getDomainInfo();\r\n      const redirectURL = `${domainInfo.baseURL}/reset-password`;\r\n      \r\n      // Debug: mostrar URL que será usada\r\n      console.log('🔐 Enviando email de recuperação com redirect:', redirectURL);\r\n      console.log('⚠️ IMPORTANTE: Esta URL deve estar cadastrada nas Redirect URLs do Supabase!');\r\n      console.log('📍 Configure em: Dashboard Supabase → Authentication → URL Configuration');\r\n      \r\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\r\n        redirectTo: redirectURL,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      setMessage({ \r\n        type: 'success', \r\n        text: `Email de recuperação enviado para ${email}. Verifique sua caixa de entrada e spam.` \r\n      });\r\n      setResendCounter(prev => prev + 1);\r\n    } catch (error: any) {\r\n      console.error('Erro ao enviar email de recuperação:', error);\r\n      setMessage({ \r\n        type: 'error', \r\n        text: error.message || 'Erro ao enviar email de recuperação. Tente novamente.' \r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className=\"w-full max-w-md mx-auto\">\r\n      <CardHeader className=\"space-y-1\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"sm\" \r\n            onClick={onBack}\r\n            className=\"p-2\"\r\n          >\r\n            <ArrowLeft className=\"h-4 w-4\" />\r\n          </Button>\r\n          <div>\r\n            <CardTitle className=\"text-2xl\">Recuperar Conta</CardTitle>\r\n            <CardDescription>\r\n              Escolha como você deseja recuperar sua conta\r\n            </CardDescription>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      \r\n      <CardContent className=\"space-y-6\">\r\n        {/* Seletor de Método */}\r\n        <div className=\"grid grid-cols-1 gap-3\">\r\n          <Button\r\n            variant={recoveryMethod === 'email' ? 'default' : 'outline'}\r\n            onClick={() => setRecoveryMethod('email')}\r\n            className=\"flex items-center gap-2 h-12\"\r\n          >\r\n            <Mail className=\"h-4 w-4\" />\r\n            Via Email\r\n          </Button>\r\n          \r\n          <Button\r\n            variant={recoveryMethod === 'support' ? 'default' : 'outline'}\r\n            onClick={() => setRecoveryMethod('support')}\r\n            className=\"flex items-center gap-2 h-12\"\r\n          >\r\n            <HelpCircle className=\"h-4 w-4\" />\r\n            Suporte Manual\r\n          </Button>\r\n        </div>\r\n\r\n        <Separator />\r\n\r\n        {/* Formulário Email */}\r\n        {recoveryMethod === 'email' && (\r\n          <form onSubmit={handleEmailRecovery} className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"email\">Email da Conta</Label>\r\n              <Input\r\n                id=\"email\"\r\n                type=\"email\"\r\n                placeholder=\"seu.email@gmail.com\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                disabled={isLoading}\r\n                className=\"h-11\"\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <Button \r\n              type=\"submit\" \r\n              className=\"w-full h-11\" \r\n              disabled={isLoading}\r\n            >\r\n              {isLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Enviando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Mail className=\"w-4 h-4 mr-2\" />\r\n                  Enviar Email de Recuperação\r\n                </>\r\n              )}\r\n            </Button>\r\n\r\n            {resendCounter > 0 && (\r\n              <p className=\"text-xs text-gray-500 text-center\">\r\n                Email enviado {resendCounter} vez(es). Verifique também a pasta de spam.\r\n              </p>\r\n            )}\r\n          </form>\r\n        )}\r\n\r\n        {/* Suporte Manual */}\r\n        {recoveryMethod === 'support' && (\r\n          <div className=\"space-y-4\">\r\n            <Alert>\r\n              <HelpCircle className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                <strong>Suporte Manual:</strong><br />\r\n                Entre em contato conosco pelos canais abaixo com as seguintes informações:\r\n              </AlertDescription>\r\n            </Alert>\r\n\r\n            <div className=\"space-y-3 text-sm\">\r\n              <div>\r\n                <strong>Informações necessárias:</strong>\r\n                <ul className=\"mt-1 ml-4 list-disc space-y-1\">\r\n                  <li>Nome completo</li>\r\n                  <li>CPF (últimos 4 dígitos)</li>\r\n                  <li>WhatsApp alternativo</li>\r\n                  <li>Data aproximada da criação da conta</li>\r\n                </ul>\r\n              </div>\r\n\r\n              <div>\r\n                <strong>Canais de Contato:</strong>\r\n                <ul className=\"mt-1 ml-4 list-disc space-y-1\">\r\n                  <li>WhatsApp: (11) 99999-9999</li>\r\n                  <li>Email: suporte@leadconsig.com.br</li>\r\n                  <li>Horário: Segunda a Sexta, 9h às 18h</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n\r\n            <Button \r\n              className=\"w-full h-11\" \r\n              onClick={() => window.open('https://wa.me/5511999999999', '_blank')}\r\n            >\r\n              <Phone className=\"h-4 w-4 mr-2\" />\r\n              Entrar em Contato\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Mensagem de Feedback */}\r\n        {message && (\r\n          <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n            <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n              {message.text}\r\n            </AlertDescription>\r\n          </Alert>\r\n        )}\r\n\r\n        {/* Debug de Configuração */}\r\n        <div className=\"pt-4 border-t\">\r\n          <Button \r\n            variant=\"outline\" \r\n            size=\"sm\" \r\n            onClick={() => {\r\n              const config = getDomainInfo();\r\n              alert(`Debug - Configuração Atual:\\n\\nAmbiente: ${config.environment}\\nURL Configurada: ${config.baseURL}\\n\\nPara alterar, edite src/utils/domainConfig.ts`);\r\n            }}\r\n            className=\"text-xs\"\r\n          >\r\n            Ver Config Domínio\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\Header.tsx","messages":[{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useSidebar\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":25,"column":15,"nodeType":"Identifier","endLine":25,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1532,1535],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1532,1535],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3866,3869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3866,3869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Bell, Menu, Settings, User } from \"lucide-react\";\r\nimport { useSidebar } from \"@/components/ui/sidebar\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport SupportButton from \"@/components/SupportButton\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuGroup, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst Header = () => {\r\n  const navigate = useNavigate();\r\n  const isMobile = useIsMobile();\r\n  const { user, signOut } = useAuth();\r\n  const [notifications, setNotifications] = useState<{ id: string; title: string; type: \"reminder\" | \"appointment\"; href: string; dueAt: Date }[]>([]);\r\n  const [loadingNotifs, setLoadingNotifs] = useState(false);\r\n\r\n  // Safely try to use sidebar context\r\n  let sidebar = null;\r\n  try {\r\n    sidebar = useSidebar();\r\n  } catch (error) {\r\n    // useSidebar is not available, component is being used outside SidebarProvider\r\n    console.log(\"Header used outside SidebarProvider context\");\r\n  }\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await signOut();\r\n      navigate(\"/login\");\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao fazer logout:\", error.message);\r\n    }\r\n  };\r\n\r\n  const getInitials = (email: string) => {\r\n    if (!email) return \"U\";\r\n    return email.charAt(0).toUpperCase();\r\n  };\r\n\r\n  // Carregar notificações de lembretes e agendamentos próximos ou vencidos\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    const load = async () => {\r\n      try {\r\n        setLoadingNotifs(true);\r\n        const now = new Date();\r\n        const nowIso = now.toISOString();\r\n        const windowMinutes = 60; // próximos 60 minutos\r\n        const windowDate = new Date(now.getTime() + windowMinutes * 60000).toISOString();\r\n\r\n        // Lembretes: due_date até a próxima 1h e não completados\r\n        const { data: reminders, error: remErr } = await supabase\r\n          .from(\"reminders\")\r\n          .select(\"id, title, due_date\")\r\n          .eq(\"user_id\", user.id)\r\n          .eq(\"is_completed\", false)\r\n          .lte(\"due_date\", windowDate);\r\n        if (remErr) throw remErr;\r\n\r\n        // Agendamentos: data/hora até próxima 1h\r\n        const { data: appointments, error: appErr } = await supabase\r\n          .from(\"appointments\")\r\n          .select(\"id, title, date, time\")\r\n          .eq(\"user_id\", user.id)\r\n          .lte(\"date\", windowDate.split(\"T\")[0]);\r\n        if (appErr) throw appErr;\r\n\r\n        const parsedReminders = (reminders || []).map((r) => ({\r\n          id: `rem-${r.id}`,\r\n          title: r.title || \"Lembrete\",\r\n          type: \"reminder\" as const,\r\n          href: \"/reminders\",\r\n          dueAt: new Date(r.due_date),\r\n        }));\r\n\r\n        const parsedApps = (appointments || []).flatMap((a) => {\r\n          if (!a.date) return [];\r\n          const dtStr = a.time ? `${a.date}T${a.time}` : `${a.date}T00:00:00`;\r\n          const dueAt = new Date(dtStr);\r\n          if (dueAt.getTime() > new Date(windowDate).getTime()) return [];\r\n          return [{\r\n            id: `app-${a.id}`,\r\n            title: a.title || \"Agendamento\",\r\n            type: \"appointment\" as const,\r\n            href: \"/leads/scheduled\",\r\n            dueAt,\r\n          }];\r\n        });\r\n\r\n        const all = [...parsedReminders, ...parsedApps]\r\n          .filter(n => !isNaN(n.dueAt.getTime()))\r\n          .sort((a, b) => a.dueAt.getTime() - b.dueAt.getTime());\r\n\r\n        setNotifications(all);\r\n      } catch (err: any) {\r\n        console.error(\"Erro ao carregar notificações:\", err);\r\n        toast.error(\"Erro ao carregar notificações\");\r\n      } finally {\r\n        setLoadingNotifs(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n    const interval = setInterval(load, 60_000); // atualiza a cada minuto\r\n    return () => clearInterval(interval);\r\n  }, [user]);\r\n\r\n  const hasNotifications = notifications.length > 0;\r\n\r\n  return (\r\n    <header className=\"border-b py-2 px-3 md:py-3 md:px-4 flex justify-between items-center bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 w-full\">\r\n      <div className=\"flex items-center gap-2\">\r\n        {isMobile && sidebar && (\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"icon\" \r\n            onClick={() => sidebar?.setOpenMobile(true)}\r\n            className=\"h-8 w-8 md:h-10 md:w-10\"\r\n          >\r\n            <Menu className=\"h-4 w-4 md:h-5 md:w-5\" />\r\n          </Button>\r\n        )}\r\n        \r\n        {/* Logo aumentada com cores brancas elegantes */}\r\n        <div className=\"flex items-center\">\r\n          <div className=\"w-10 h-10 md:w-12 md:h-12 bg-white border-2 border-gray-200 rounded-xl flex items-center justify-center mr-3 md:mr-4 shadow-md\">\r\n            <div className=\"w-5 h-5 md:w-6 md:h-6 bg-blue-600 rounded-md\"></div>\r\n          </div>\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-slate-900\">LeadConsig</h1>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center gap-1 md:gap-2\">\r\n        <SupportButton />\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"icon\"\r\n              className=\"relative h-8 w-8 md:h-10 md:w-10\"\r\n            >\r\n              <Bell className=\"h-4 w-4 md:h-5 md:w-5\" />\r\n              {hasNotifications && (\r\n                <span className=\"absolute -top-0.5 -right-0.5 h-2 w-2 rounded-full bg-red-500\" />\r\n              )}\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" className=\"w-72\">\r\n            <DropdownMenuLabel className=\"text-sm font-semibold\">\r\n              Notificações\r\n            </DropdownMenuLabel>\r\n            <DropdownMenuSeparator />\r\n            {loadingNotifs && (\r\n              <DropdownMenuItem className=\"text-xs text-muted-foreground\">\r\n                Carregando...\r\n              </DropdownMenuItem>\r\n            )}\r\n            {!loadingNotifs && !hasNotifications && (\r\n              <DropdownMenuItem className=\"text-xs text-muted-foreground\">\r\n                Nenhuma notificação para agora\r\n              </DropdownMenuItem>\r\n            )}\r\n            {!loadingNotifs && hasNotifications && notifications.map((n) => (\r\n              <DropdownMenuItem\r\n                key={n.id}\r\n                className=\"flex flex-col items-start text-xs\"\r\n                onClick={() => navigate(n.href)}\r\n              >\r\n                <span className=\"font-semibold\">\r\n                  {n.type === \"reminder\" ? \"Lembrete\" : \"Agendamento\"}\r\n                </span>\r\n                <span className=\"text-muted-foreground\">{n.title}</span>\r\n                <span className=\"text-[10px] text-muted-foreground\">\r\n                  {n.dueAt.toLocaleString(\"pt-BR\")}\r\n                </span>\r\n              </DropdownMenuItem>\r\n            ))}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n        \r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"icon\" \r\n              className=\"rounded-full h-8 w-8 md:h-10 md:w-10\"\r\n            >\r\n              <Avatar className=\"h-6 w-6 md:h-8 md:w-8\">\r\n                <AvatarFallback className=\"text-xs md:text-sm\">\r\n                  {user ? getInitials(user.email || \"\") : \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent className=\"w-48 md:w-56\" align=\"end\" forceMount>\r\n            <DropdownMenuLabel className=\"font-normal text-xs\">\r\n              <div className=\"flex flex-col space-y-1\">\r\n                <p className=\"text-xs md:text-sm font-medium leading-none truncate\">\r\n                  {user?.email}\r\n                </p>\r\n              </div>\r\n            </DropdownMenuLabel>\r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuGroup>\r\n              {/* Placeholder para futuras opções */}\r\n            </DropdownMenuGroup>\r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem onClick={handleLogout} className=\"text-xs md:text-sm\">\r\n              Sair\r\n            </DropdownMenuItem>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\LeadCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":183,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":183,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7242,7245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7242,7245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":189,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7500,7503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7500,7503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":208,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":208,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7927,7930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7927,7930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":248,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":248,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9258,9261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9258,9261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9722,9725],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9722,9725],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10097,10100],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10097,10100],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10133,10136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10133,10136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":280,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":280,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10338,10341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10338,10341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":325,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":325,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11687,11690],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11687,11690],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11764,11767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11764,11767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11807,11810],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11807,11810],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":328,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":328,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11860,11863],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11860,11863],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11920,11923],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11920,11923],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11985,11988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11985,11988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":331,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":331,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12049,12052],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12049,12052],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":363,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":363,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13053,13056],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13053,13056],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":446,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":446,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16074,16077],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16074,16077],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":465,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":465,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16845,16848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16845,16848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":467,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":467,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16967,16970],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16967,16970],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":485,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":485,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17790,17793],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17790,17793],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":487,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":487,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17926,17929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17926,17929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":527,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":527,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19352,19355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19352,19355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":551,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20033,20036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20033,20036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":551,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":551,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20069,20072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20069,20072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":557,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":557,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20338,20341],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20338,20341],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":603,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":603,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21937,21940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21937,21940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":648,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":648,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23428,23431],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23428,23431],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":853,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":853,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31816,31819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31816,31819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":856,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":856,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32018,32021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32018,32021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":29,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { MoreHorizontal, Phone, Mail, DollarSign, Building, User, Edit, Trash2, Calendar, FileText, Tag, CheckCircle, Clock, AlertTriangle, X, Building2, Copy, Calculator, Package } from \"lucide-react\";\r\nimport { Lead } from \"@/types/models\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport LeadForm from \"./LeadForm\";\r\nimport ClientVisits from \"./leads/ClientVisits\";\r\nimport DocumentUpload from \"./leads/DocumentUpload\";\r\nimport WhatsAppButton from \"./WhatsAppButton\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { getBankName } from \"@/utils/bankUtils\";\r\nimport { useBanks } from \"@/hooks/useBanks\";\r\nimport { formatLeadDate } from \"@/utils/dateUtils\";\r\nimport CommissionConfigSelector from \"@/components/forms/CommissionConfigSelector\";\r\nimport { CommissionCalculationResult } from \"@/hooks/useCommissionConfig\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\n\r\ninterface LeadTag {\r\n  tag_id: string;\r\n  lead_tags: {\r\n    id: string;\r\n    name: string;\r\n    color: string;\r\n  };\r\n}\r\n\r\ninterface LeadCardProps {\r\n  lead: Lead;\r\n  onUpdate: (updatedLead: Lead) => void;\r\n  onDelete: (id: string) => void;\r\n  isSelected?: boolean;\r\n  onSelect?: (id: string, selected: boolean) => void;\r\n  showSelection?: boolean;\r\n}\r\n\r\nconst statusColors = {\r\n  novo: \"bg-blue-100 text-blue-800\",\r\n  contatado: \"bg-yellow-100 text-yellow-800\",\r\n  qualificado: \"bg-purple-100 text-purple-800\",\r\n  pendente: \"bg-amber-100 text-amber-800\",\r\n  negociando: \"bg-orange-100 text-orange-800\",\r\n  concluido: \"bg-green-100 text-green-800\",\r\n  convertido: \"bg-green-100 text-green-800\",\r\n  perdido: \"bg-red-100 text-red-800\",\r\n  cancelado: \"bg-red-100 text-red-800\" // Agora vermelho igual ao perdido\r\n};\r\n\r\nconst statusLabels = {\r\n  novo: \"Novo\",\r\n  contatado: \"Contatado\",\r\n  qualificado: \"Qualificado\",\r\n  pendente: \"Pendente\",\r\n  negociando: \"Em Andamento\",\r\n  concluido: \"Concluído\",\r\n  convertido: \"Convertido\",\r\n  perdido: \"Perdido\",\r\n  cancelado: \"Cancelado\" // Adicionado para status cancelado\r\n};\r\n\r\nconst bankLabels = {\r\n  caixa: \"Caixa\",\r\n  bb: \"Banco do Brasil\",\r\n  itau: \"Itaú\",\r\n  bradesco: \"Bradesco\",\r\n  santander: \"Santander\",\r\n  c6: \"C6 Bank\",\r\n  brb: \"BRB\",\r\n  bmg: \"BMG\",\r\n  pan: \"Banco Pan\",\r\n  ole: \"Banco Olé\",\r\n  daycoval: \"Daycoval\",\r\n  mercantil: \"Mercantil\",\r\n  cetelem: \"Cetelem\",\r\n  safra: \"Safra\",\r\n  inter: \"Inter\",\r\n  original: \"Original\",\r\n  facta: \"Facta\",\r\n  bonsucesso: \"Bonsucesso\",\r\n  banrisul: \"Banrisul\",\r\n  sicoob: \"Sicoob\",\r\n  outro: \"Outro\"\r\n};\r\n\r\nconst LeadCard: React.FC<LeadCardProps> = ({ lead, onUpdate, onDelete, isSelected, onSelect, showSelection }) => {\r\n  const navigate = useNavigate();\r\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\r\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n  const [isUpdating, setIsUpdating] = useState(false);\r\n  const [tags, setTags] = useState<LeadTag[]>([]);\r\n  const [tagsLoading, setTagsLoading] = useState(true);\r\n  const [isCommissionDialogOpen, setIsCommissionDialogOpen] = useState(false);\r\n  const [calculatedCommission, setCalculatedCommission] = useState<{\r\n    value: number;\r\n    percentage: number;\r\n    amount: number;\r\n  } | null>(null);\r\n  const [editCommissionResult, setEditCommissionResult] = useState<CommissionCalculationResult | null>(null);\r\n  const [employeeList, setEmployeeList] = useState<Employee[]>([]);\r\n  const [isStatusChangeConfirmOpen, setIsStatusChangeConfirmOpen] = useState(false);\r\n  const [pendingNewStatus, setPendingNewStatus] = useState<string | null>(null);\r\n  const [hasCommission, setHasCommission] = useState(false);\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [pendingAction, setPendingAction] = useState<'delete' | 'edit' | null>(null);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n  const { banks } = useBanks();\r\n\r\n  useEffect(() => {\r\n    getEmployees().then(setEmployeeList);\r\n    // Verificar se tem senha administrativa configurada\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, []);\r\n\r\n  // Verificar se o lead tem comissão gerada\r\n  useEffect(() => {\r\n    const checkCommission = async () => {\r\n      if (lead.status === 'concluido') {\r\n        try {\r\n          const { data: userData } = await supabase.auth.getUser();\r\n          if (userData.user) {\r\n            const { data: commission } = await supabase\r\n              .from(\"commissions\")\r\n              .select(\"id\")\r\n              .eq(\"lead_id\", lead.id)\r\n              .eq(\"user_id\", userData.user.id)\r\n              .single();\r\n            setHasCommission(!!commission);\r\n          }\r\n        } catch (error) {\r\n          setHasCommission(false);\r\n        }\r\n      } else {\r\n        setHasCommission(false);\r\n      }\r\n    };\r\n    checkCommission();\r\n  }, [lead.id, lead.status]);\r\n\r\n  const getEmployeeNameById = (employeeId: string | undefined, list: Employee[] = employeeList): string => {\r\n    if (!employeeId || employeeId === \"none\") return \"Nenhum funcionário\";\r\n    const emp = list.find(e => e.id === employeeId);\r\n    return emp ? emp.name : \"Funcionário não encontrado\";\r\n  };\r\n\r\n  const resolveBankName = (bankCode?: string) => {\r\n    if (!bankCode) return \"Banco não especificado\";\r\n    const byCode = banks.find(b => b.code && b.code.toLowerCase() === bankCode.toLowerCase());\r\n    if (byCode) return byCode.name;\r\n    const byName = banks.find(b => b.name && b.name.toLowerCase() === bankCode.toLowerCase());\r\n    if (byName) return byName.name;\r\n    return getBankName(bankCode);\r\n  };\r\n\r\n  // Debug apenas quando necessário\r\n  if (lead.employee) {\r\n    console.log(\"LeadCard - Employee:\", lead.employee);\r\n  }\r\n\r\n  useEffect(() => {\r\n    // Buscar as tags atribuídas ao lead\r\n    const fetchTags = async () => {\r\n      setTagsLoading(true);\r\n      try {\r\n        // A query pode retornar um erro de relação caso não haja join, vamos filtrar corretamente\r\n        const { data, error } = await supabase\r\n          .from(\"lead_tag_assignments\")\r\n          .select(\"tag_id, lead_tags(id, name, color)\")\r\n          .eq(\"lead_id\", lead.id);\r\n\r\n        if (error) throw error;\r\n\r\n        // Novamente: filtrar apenas onde lead_tags é um objeto válido, não erro.\r\n        const validTags = (Array.isArray(data) ? data : []).filter(\r\n          (t: any) =>\r\n            t.lead_tags &&\r\n            typeof t.lead_tags === \"object\" &&\r\n            typeof t.lead_tags.id === \"string\" &&\r\n            typeof t.lead_tags.name === \"string\" &&\r\n            typeof t.lead_tags.color === \"string\"\r\n        ).map((t: any) => ({\r\n          tag_id: t.tag_id,\r\n          lead_tags: {\r\n            id: t.lead_tags.id,\r\n            name: t.lead_tags.name,\r\n            color: t.lead_tags.color,\r\n          }\r\n        }));\r\n\r\n        setTags(validTags);\r\n      } catch (error) {\r\n        setTags([]);\r\n      } finally {\r\n        setTagsLoading(false);\r\n      }\r\n    };\r\n    fetchTags();\r\n  }, [lead.id]);\r\n\r\n  const handleUpdateLead = async (values: any) => {\r\n    setIsUpdating(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Separate selectedTags from lead data\r\n      const { selectedTags, ...leadData } = values;\r\n\r\n      // Garantir que o campo employee seja tratado corretamente\r\n      // Se for \"none\" ou vazio, deve ser null\r\n      if (leadData.employee === \"none\" || leadData.employee === \"\" || !leadData.employee) {\r\n        leadData.employee = null;\r\n      }\r\n\r\n      console.log(\"📤 Updating lead - Dados enviados:\", {\r\n        employee: leadData.employee,\r\n        employeeType: typeof leadData.employee,\r\n        allData: leadData,\r\n        hasSelectedTags: selectedTags && selectedTags.length > 0\r\n      });\r\n\r\n      // Update the lead data (without selectedTags)\r\n      const { data, error } = await supabase\r\n        .from(\"leads\")\r\n        .update(leadData)\r\n        .eq(\"id\", lead.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error(\"Database update error:\", error);\r\n        throw error;\r\n      }\r\n\r\n      console.log(\"Lead updated successfully:\", data);\r\n\r\n      // Handle tag assignments separately\r\n      if (selectedTags) {\r\n        // First, delete existing tag assignments for this lead\r\n        await (supabase as any)\r\n          .from('lead_tag_assignments')\r\n          .delete()\r\n          .eq('lead_id', lead.id);\r\n\r\n        // Then, create new tag assignments if any tags were selected\r\n        if (selectedTags.length > 0) {\r\n          const tagAssignments = selectedTags.map((tagId: string) => ({\r\n            lead_id: lead.id,\r\n            tag_id: tagId,\r\n            user_id: userData.user.id,\r\n          }));\r\n\r\n          const { error: tagError } = await (supabase as any)\r\n            .from('lead_tag_assignments')\r\n            .insert(tagAssignments);\r\n\r\n          if (tagError) {\r\n            console.error('Error updating tag assignments:', tagError);\r\n            toast.error('Lead atualizado, mas erro ao aplicar etiquetas');\r\n          }\r\n        }\r\n      }\r\n\r\n      const updatedLead = {\r\n        ...data,\r\n        createdAt: (data as any).date ? formatLeadDate((data as any).date) : formatLeadDate(data.created_at)\r\n      } as Lead;\r\n\r\n      onUpdate(updatedLead);\r\n      toast.success(\"Lead atualizado com sucesso!\");\r\n      setIsEditDialogOpen(false);\r\n    } catch (error: any) {\r\n      console.error(\"Error updating lead:\", error);\r\n      toast.error(`Erro ao atualizar lead: ${error.message}`);\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteLead = async () => {\r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setPendingAction('delete');\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    confirmDeleteLead();\r\n  };\r\n\r\n  const confirmDeleteLead = async () => {\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Convert Lead to JSON-compatible format\r\n      const leadData = {\r\n        id: lead.id,\r\n        user_id: lead.user_id,\r\n        name: lead.name,\r\n        email: lead.email,\r\n        phone: lead.phone,\r\n        phone2: lead.phone2,\r\n        phone3: lead.phone3,\r\n        cpf: lead.cpf,\r\n        status: lead.status,\r\n        source: lead.source,\r\n        notes: lead.notes,\r\n        amount: lead.amount,\r\n        createdAt: lead.createdAt,\r\n        updatedAt: lead.updatedAt,\r\n        scheduledAt: lead.scheduledAt,\r\n        product: lead.product,\r\n        employee: lead.employee,\r\n        created_at: lead.created_at,\r\n        date: (lead as any).date, // Preservar data personalizada se existe\r\n        bank: (lead as any).bank,\r\n        benefit_type: (lead as any).benefit_type,\r\n        payment_period: (lead as any).payment_period,\r\n        representative_mode: (lead as any).representative_mode,\r\n        representative_name: (lead as any).representative_name,\r\n        representative_cpf: (lead as any).representative_cpf\r\n      };\r\n\r\n      // Calculate expiration date (30 days from now)\r\n      const expiresAt = new Date();\r\n      expiresAt.setDate(expiresAt.getDate() + 30);\r\n\r\n      // Move lead to trash instead of deleting permanently\r\n      const { error: trashError } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .insert({\r\n          original_lead_id: lead.id,\r\n          user_id: userData.user.id,\r\n          original_lead_data: leadData,\r\n          deleted_at: new Date().toISOString(),\r\n          expires_at: expiresAt.toISOString()\r\n        });\r\n\r\n      if (trashError) throw trashError;\r\n\r\n      // Remove from active leads\r\n      const { error: deleteError } = await supabase\r\n        .from(\"leads\")\r\n        .delete()\r\n        .eq(\"id\", lead.id);\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      onDelete(lead.id);\r\n      toast.success(\"Lead movido para a lixeira com sucesso!\");\r\n      setIsDeleteDialogOpen(false);\r\n      setPendingAction(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error moving lead to trash:\", error);\r\n      setPendingAction(null);\r\n      toast.error(`Erro ao mover lead para lixeira: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (newStatus: string) => {\r\n    // Se o lead está como \"concluido\" e tem comissão, e está sendo mudado para outro status, pedir confirmação\r\n    if (lead.status === 'concluido' && hasCommission && newStatus !== 'concluido') {\r\n      setPendingNewStatus(newStatus);\r\n      setIsStatusChangeConfirmOpen(true);\r\n      return;\r\n    }\r\n\r\n    // Se o status for \"concluido\" ou \"convertido\" e o lead tiver valor, calcular e criar comissão automaticamente\r\n    if ((newStatus === 'concluido' || newStatus === 'convertido') && lead.amount) {\r\n      await calculateAndShowCommission(newStatus);\r\n      return;\r\n    }\r\n\r\n    // Para outros status, atualizar normalmente\r\n    await updateLeadStatus(newStatus);\r\n  };\r\n\r\n  const handleConfirmStatusChange = async () => {\r\n    if (pendingNewStatus) {\r\n      setIsStatusChangeConfirmOpen(false);\r\n      await updateLeadStatus(pendingNewStatus);\r\n      setPendingNewStatus(null);\r\n    }\r\n  };\r\n\r\n  const calculateAndShowCommission = async (newStatus: string) => {\r\n    setIsUpdating(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      // Verificar se já existe comissão para este lead\r\n      const { data: existingCommission } = await supabase\r\n        .from(\"commissions\")\r\n        .select(\"id\")\r\n        .eq(\"lead_id\", lead.id)\r\n        .eq(\"user_id\", userData.user.id)\r\n        .single();\r\n\r\n      if (existingCommission) {\r\n        // Se já existe comissão, atualizar o status e navegar para página de comissões\r\n        await updateLeadStatus(newStatus);\r\n        if (newStatus === 'concluido') {\r\n          toast.info(\"Lead já possui comissão gerada. Redirecionando para página de comissões...\");\r\n          setTimeout(() => {\r\n            navigate('/commission');\r\n          }, 1000);\r\n        } else {\r\n          toast.info(\"Lead já possui comissão gerada anteriormente.\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Converter valor corretamente removendo caracteres não numéricos\r\n      const cleanAmount = lead.amount.replace(/[^\\d,]/g, '').replace(',', '.');\r\n      const leadAmount = parseFloat(cleanAmount) || 0;\r\n      \r\n      // Usar o novo sistema integrado de comissões\r\n      const { mapProductToCommissionConfig } = await import('@/utils/productMapping');\r\n      const mappedProduct = mapProductToCommissionConfig(lead.product || '');\r\n      \r\n      let commissionValue = 0;\r\n      let percentage = 5; // Padrão\r\n\r\n      // Buscar taxa fixa primeiro\r\n      const { data: rates } = await supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .eq('product', mappedProduct)\r\n        .eq('active', true);\r\n\r\n      if (rates && rates.length > 0) {\r\n        const rate = rates[0] as any;\r\n        if (rate.commission_type === 'fixed') {\r\n          commissionValue = rate.fixed_value || 0;\r\n          percentage = leadAmount > 0 ? (commissionValue / leadAmount) * 100 : 0;\r\n        } else {\r\n          percentage = rate.percentage;\r\n          commissionValue = (leadAmount * percentage) / 100;\r\n        }\r\n      } else {\r\n        // Buscar por faixas de valor ou período\r\n        const { data: tiers } = await supabase\r\n          .from('commission_tiers')\r\n          .select('*')\r\n          .eq('product', mappedProduct)\r\n          .eq('active', true);\r\n\r\n        if (tiers && tiers.length > 0) {\r\n          // Tentar faixas de período primeiro se o lead tem período\r\n          if (lead.payment_period) {\r\n            const periodTiers = tiers.filter((t: any) => t.tier_type === 'period');\r\n            for (const tier of periodTiers) {\r\n              const tierData = tier as any;\r\n              const period = parseInt(lead.payment_period.toString());\r\n              if (tierData.min_period <= period && \r\n                  (!tierData.max_period || period <= tierData.max_period)) {\r\n                if (tierData.commission_type === 'fixed') {\r\n                  commissionValue = tierData.fixed_value || 0;\r\n                  percentage = leadAmount > 0 ? (commissionValue / leadAmount) * 100 : 0;\r\n                } else {\r\n                  percentage = tierData.percentage;\r\n                  commissionValue = (leadAmount * percentage) / 100;\r\n                }\r\n                break;\r\n              }\r\n            }\r\n          }\r\n          \r\n          // Se não encontrou por período, tentar por valor\r\n          if (commissionValue === 0) {\r\n            const valueTiers = tiers.filter((t: any) => !t.tier_type || t.tier_type === 'value');\r\n            for (const tier of valueTiers) {\r\n              const tierData = tier as any;\r\n              if (tierData.min_amount <= leadAmount && \r\n                  (!tierData.max_amount || leadAmount <= tierData.max_amount)) {\r\n                if (tierData.commission_type === 'fixed') {\r\n                  commissionValue = tierData.fixed_value || 0;\r\n                  percentage = leadAmount > 0 ? (commissionValue / leadAmount) * 100 : 0;\r\n                } else {\r\n                  percentage = tierData.percentage;\r\n                  commissionValue = (leadAmount * percentage) / 100;\r\n                }\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Taxa padrão se não encontrou nenhuma configuração\r\n        if (commissionValue === 0) {\r\n          commissionValue = (leadAmount * 5) / 100;\r\n          percentage = 5;\r\n        }\r\n      }\r\n\r\n      setCalculatedCommission({\r\n        value: commissionValue,\r\n        percentage: percentage,\r\n        amount: leadAmount\r\n      });\r\n\r\n      // Primeiro atualizar o status do lead\r\n      await updateLeadStatus(newStatus);\r\n      \r\n      // Se for concluído, criar comissão automaticamente e navegar para página de comissões\r\n      if (newStatus === 'concluido') {\r\n        await createCommissionAndNavigate(commissionValue, percentage, leadAmount);\r\n      } else {\r\n        // Para outros status, mostrar modal de confirmação\r\n        setIsCommissionDialogOpen(true);\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error(\"Error calculating commission:\", error);\r\n      toast.error(`Erro ao calcular comissão: ${error.message}`);\r\n      // Em caso de erro, atualizar o status mesmo assim\r\n      await updateLeadStatus(newStatus);\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  const updateLeadStatus = async (newStatus: string) => {\r\n    setIsUpdating(true);\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"leads\")\r\n        .update({ status: newStatus })\r\n        .eq(\"id\", lead.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      const updatedLead = {\r\n        ...data,\r\n        createdAt: (data as any).date ? formatLeadDate((data as any).date) : formatLeadDate(data.created_at)\r\n      } as Lead;\r\n\r\n      onUpdate(updatedLead);\r\n      const statusLabel = statusLabels[newStatus as keyof typeof statusLabels] || newStatus;\r\n      toast.success(`Lead marcado como ${statusLabel}!`);\r\n    } catch (error: any) {\r\n      console.error(\"Error updating lead status:\", error);\r\n      toast.error(`Erro ao atualizar status: ${error.message}`);\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  // Função para criar comissão automaticamente e navegar\r\n  const createCommissionAndNavigate = async (commissionValue: number, percentage: number, leadAmount: number) => {\r\n    setIsUpdating(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      const employeeName = lead.employee && lead.employee.trim() !== '' ? lead.employee.trim() : 'Não informado';\r\n\r\n      // Inserir dados completos da comissão\r\n      const { data: createdCommission, error } = await supabase\r\n        .from(\"commissions\")\r\n        .insert({\r\n          user_id: userData.user.id,\r\n          lead_id: lead.id,\r\n          amount: leadAmount,\r\n          commission_value: commissionValue,\r\n          percentage: percentage,\r\n          product: lead.product,\r\n          employee: employeeName,\r\n          status: 'in_progress',\r\n          payment_period: 'monthly'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Comissão de R$ ${commissionValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} gerada com sucesso!`);\r\n      \r\n      // Navegar para a página de comissões após um pequeno delay para o toast aparecer\r\n      setTimeout(() => {\r\n        navigate('/commission');\r\n      }, 1000);\r\n\r\n    } catch (error: any) {\r\n      console.error(\"Error creating commission:\", error);\r\n      toast.error(`Erro ao gerar comissão: ${error.message}`);\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  const handleCreateCommission = async () => {\r\n    if (!calculatedCommission) return;\r\n\r\n    setIsUpdating(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      // Inserir dados completos da comissão\r\n      const { error } = await supabase\r\n        .from(\"commissions\")\r\n        .insert({\r\n          user_id: userData.user.id,\r\n          lead_id: lead.id,\r\n          amount: calculatedCommission.amount,\r\n          commission_value: calculatedCommission.value,\r\n          percentage: calculatedCommission.percentage,\r\n          product: lead.product,\r\n          employee: lead.employee && lead.employee.trim() !== '' ? lead.employee.trim() : 'Não informado',\r\n          status: 'in_progress',\r\n          payment_period: 'monthly'\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Comissão de R$ ${calculatedCommission.value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })} gerada com sucesso!`);\r\n      setIsCommissionDialogOpen(false);\r\n      setCalculatedCommission(null);\r\n\r\n      // Navegar para página de comissões\r\n      setTimeout(() => {\r\n        navigate('/commission');\r\n      }, 1000);\r\n\r\n    } catch (error: any) {\r\n      console.error(\"Error creating commission:\", error);\r\n      toast.error(`Erro ao gerar comissão: ${error.message}`);\r\n    } finally {\r\n      setIsUpdating(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrency = (value: string) => {\r\n    if (!value) return \"Não informado\";\r\n    const numericValue = parseFloat(value.replace(/[^\\d,]/g, '').replace(',', '.'));\r\n    if (isNaN(numericValue)) return value;\r\n    return numericValue.toLocaleString('pt-BR', {\r\n      style: 'currency',\r\n      currency: 'BRL'\r\n    });\r\n  };\r\n\r\n  const formatPhone = (phone: string) => {\r\n    if (!phone) return \"\";\r\n    const cleaned = phone.replace(/\\D/g, '');\r\n    if (cleaned.length === 11) {\r\n      return `(${cleaned.slice(0, 2)}) ${cleaned.slice(2, 7)}-${cleaned.slice(7)}`;\r\n    }\r\n    return phone;\r\n  };\r\n\r\n  const formatCPF = (cpf: string) => {\r\n    if (!cpf) return \"\";\r\n    const cleaned = cpf.replace(/\\D/g, '');\r\n    if (cleaned.length === 11) {\r\n      return `${cleaned.slice(0, 3)}.${cleaned.slice(3, 6)}.${cleaned.slice(6, 9)}-${cleaned.slice(9)}`;\r\n    }\r\n    return cpf;\r\n  };\r\n\r\n  const copyToClipboard = (text: string, label: string) => {\r\n    navigator.clipboard.writeText(text).then(() => {\r\n      toast.success(`${label} copiado para a área de transferência!`);\r\n    }).catch(() => {\r\n      toast.error(`Erro ao copiar ${label}`);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card className={`hover:shadow-md transition-shadow ${isSelected ? 'ring-2 ring-blue-500' : ''}`}>\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"space-y-1 flex-1\">\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                <CardTitle className=\"text-lg leading-none\">\r\n                  {lead.name}\r\n                </CardTitle>\r\n                {/* Exibe as etiquetas ao lado do nome */}\r\n                {!tagsLoading && tags.length > 0 && (\r\n                  <div className=\"flex flex-wrap items-center gap-1\">\r\n                    {tags.map(\r\n                      (tag) =>\r\n                        tag.lead_tags && (\r\n                          <Badge\r\n                            key={tag.lead_tags.id}\r\n                            variant=\"outline\"\r\n                            className=\"px-2 py-0.5 text-xs border-0\"\r\n                            style={{\r\n                              backgroundColor: tag.lead_tags.color,\r\n                              color: \"#fff\"\r\n                            }}\r\n                          >\r\n                            {tag.lead_tags.name}\r\n                          </Badge>\r\n                        )\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <CardDescription className=\"text-sm\">\r\n                Cadastrado em {lead.createdAt}\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              {showSelection && (\r\n                <Checkbox\r\n                  checked={isSelected}\r\n                  onCheckedChange={(checked) => onSelect?.(lead.id, !!checked)}\r\n                  className=\"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600\"\r\n                />\r\n              )}\r\n              <Badge className={statusColors[lead.status]}>\r\n                {statusLabels[lead.status]}\r\n              </Badge>\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                  {lead.amount && (\r\n                    <>\r\n                      <DropdownMenuItem \r\n                        onClick={() => handleStatusChange('negociando')}\r\n                        disabled={isUpdating}\r\n                        className=\"text-blue-600\"\r\n                      >\r\n                        <Clock className=\"mr-2 h-4 w-4\" />\r\n                        Marcar como Em Andamento\r\n                      </DropdownMenuItem>\r\n                      <DropdownMenuItem \r\n                        onClick={() => handleStatusChange('pendente')}\r\n                        disabled={isUpdating}\r\n                        className=\"text-yellow-600\"\r\n                      >\r\n                        <AlertTriangle className=\"mr-2 h-4 w-4\" />\r\n                        Marcar como Pendente\r\n                      </DropdownMenuItem>\r\n                      <DropdownMenuItem \r\n                        onClick={() => handleStatusChange('concluido')}\r\n                        disabled={isUpdating}\r\n                        className=\"text-green-600\"\r\n                      >\r\n                        <CheckCircle className=\"mr-2 h-4 w-4\" />\r\n                        Marcar como Concluído\r\n                      </DropdownMenuItem>\r\n                      <DropdownMenuItem \r\n                        onClick={() => handleStatusChange('cancelado')}\r\n                        disabled={isUpdating}\r\n                        className=\"text-red-600\"\r\n                      >\r\n                        <X className=\"mr-2 h-4 w-4\" />\r\n                        Marcar como Cancelado\r\n                      </DropdownMenuItem>\r\n                    </>\r\n                  )}\r\n                  <DropdownMenuItem onClick={async () => {\r\n                    // Se o lead estiver concluído e tiver senha configurada, pedir senha\r\n                    if (lead.status === 'concluido' && hasAdminPwd) {\r\n                      setPendingAction('edit');\r\n                      setShowAdminPasswordDialog(true);\r\n                    } else {\r\n                      setIsEditDialogOpen(true);\r\n                    }\r\n                  }}>\r\n                    <Edit className=\"mr-2 h-4 w-4\" />\r\n                    Editar\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => setIsDeleteDialogOpen(true)}\r\n                    className=\"text-red-600\"\r\n                  >\r\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                    Mover para Lixeira\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        \r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-1 gap-3 text-sm\">\r\n            {lead.phone && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Phone className=\"h-4 w-4 text-blue-500\" />\r\n                  <span className=\"font-medium\">Telefone:</span>\r\n                  <span>{formatPhone(lead.phone)}</span>\r\n                </div>\r\n                <WhatsAppButton \r\n                  phoneNumber={lead.phone}\r\n                  message={`Olá ${lead.name}, sou da equipe LeadConsig. Como posso ajudá-lo?`}\r\n                  variant=\"regular\"\r\n                  label=\"WhatsApp\"\r\n                  className=\"h-8 text-xs px-2\"\r\n                />\r\n              </div>\r\n            )}\r\n\r\n            {lead.cpf && (\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <User className=\"h-4 w-4 text-purple-500\" />\r\n                  <span className=\"font-medium\">CPF:</span>\r\n                  <span className=\"font-mono text-sm\">{formatCPF(lead.cpf)}</span>\r\n                </div>\r\n                <Button \r\n                  variant=\"outline\" \r\n                  size=\"sm\"\r\n                  onClick={() => copyToClipboard(lead.cpf, \"CPF\")}\r\n                  className=\"h-7 text-xs px-2 flex items-center gap-1\"\r\n                >\r\n                  <Copy className=\"h-3 w-3\" />\r\n                  Copiar\r\n                </Button>\r\n              </div>\r\n            )}\r\n            \r\n            {lead.email && (\r\n              <div className=\"flex items-center gap-2\">\r\n                <Mail className=\"h-4 w-4 text-green-500\" />\r\n                <span className=\"font-medium\">E-mail:</span>\r\n                <span className=\"truncate\">{lead.email}</span>\r\n              </div>\r\n            )}\r\n            \r\n            {(lead as any).bank && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <Building2 className=\"h-3 w-3\" />\r\n                <span>{resolveBankName((lead as any).bank)}</span>\r\n              </div>\r\n            )}\r\n            \r\n            {lead.product && (\r\n              <div className=\"flex items-center gap-2\">\r\n                <Package className=\"h-4 w-4 text-blue-500\" />\r\n                <span className=\"font-medium text-sm text-gray-600\">Produto:</span>\r\n                <span className=\"font-medium\">{lead.product}</span>\r\n              </div>\r\n            )}\r\n            \r\n            {lead.amount && (\r\n              <div className=\"flex items-center gap-2\">\r\n                <DollarSign className=\"h-4 w-4 text-green-600\" />\r\n                <span className=\"font-medium\">Valor:</span>\r\n                <span className=\"font-semibold text-green-600\">\r\n                  {formatCurrency(lead.amount)}\r\n                </span>\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"flex items-center gap-2\">\r\n              <User className=\"h-4 w-4 text-orange-500\" />\r\n              <span className=\"font-medium\">Responsável:</span>\r\n              <span>{getEmployeeNameById(lead.employee)}</span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Observação do Lead */}\r\n          <div className=\"border-t pt-3\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <Tag className=\"h-4 w-4 text-gray-500\" />\r\n              <span className=\"font-medium text-sm\">Observação:</span>\r\n            </div>\r\n            <div className=\"text-gray-700 text-sm italic min-h-[20px]\">\r\n              {lead.notes && lead.notes.trim() !== \"\" ? lead.notes : \"Nenhuma observação.\"}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"border-t pt-3\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <Calendar className=\"h-4 w-4 text-gray-500\" />\r\n              <span className=\"font-medium text-sm\">Histórico de Visitas:</span>\r\n            </div>\r\n            <ClientVisits leadId={lead.id} leadName={lead.name} />\r\n          </div>\r\n\r\n          <div className=\"border-t pt-3\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <FileText className=\"h-4 w-4 text-gray-500\" />\r\n              <span className=\"font-medium text-sm\">Documentos:</span>\r\n            </div>\r\n            <DocumentUpload leadId={lead.id} />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>Editar Lead</DialogTitle>\r\n            <DialogDescription>\r\n              Atualize as informações do lead abaixo.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"flex flex-col items-center justify-center text-center w-full\">\r\n            <h2 className=\"text-xl font-bold mb-2\">Detalhes do Lead</h2>\r\n            {/* Responsável em destaque */}\r\n            <div className=\"flex flex-col items-center mb-4\">\r\n              <span className=\"text-base font-semibold text-blue-800\">Responsável</span>\r\n              <span className=\"text-2xl font-bold text-blue-900 bg-blue-100 rounded-full px-4 py-1 mt-1\">\r\n                {getEmployeeNameById(lead.employee)}\r\n              </span>\r\n              {/* Badge 100% deste responsável */}\r\n              {lead.employee && (\r\n                <span className=\"mt-2 inline-block bg-green-100 text-green-800 text-xs font-bold rounded-full px-3 py-0.5\">100% deste responsável</span>\r\n              )}\r\n            </div>\r\n            <LeadForm\r\n              initialData={{\r\n                ...lead,\r\n                payment_period: lead.payment_period?.toString() || \"\",\r\n                employee: lead.employee || null  // Passar null ao invés de \"none\" para manter o valor\r\n              }}\r\n              onSubmit={handleUpdateLead}\r\n              onCancel={() => setIsEditDialogOpen(false)}\r\n              isLoading={isUpdating}\r\n              isEditing={true}\r\n            />\r\n            \r\n            {/* Seletor de Comissão na Edição */}\r\n            {lead.product && (\r\n              <div className=\"mt-6 w-full\">\r\n                <CommissionConfigSelector\r\n                  selectedProduct={lead.product}\r\n                  onConfigSelect={() => {}}\r\n                  selectedConfig={lead.commission_config}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Mover para Lixeira</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Tem certeza que deseja mover o lead \"{lead.name}\" para a lixeira? O lead ficará disponível por 30 dias na lixeira antes de ser excluído automaticamente.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDeleteLead} className=\"bg-red-600 hover:bg-red-700\">\r\n              Mover para Lixeira\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Modal de Geração de Comissão */}\r\n      <Dialog open={isCommissionDialogOpen} onOpenChange={setIsCommissionDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Calculator className=\"h-5 w-5 text-green-600\" />\r\n              Gerar Comissão?\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              O lead foi marcado como <strong>Concluído</strong>. Deseja gerar a comissão automaticamente?\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {calculatedCommission && (\r\n            <div className=\"space-y-4 py-4\">\r\n              <div className=\"bg-gray-50 rounded-lg p-4 space-y-2\">\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-sm font-medium text-gray-600\">Cliente:</span>\r\n                  <span className=\"font-semibold\">{lead.name}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-sm font-medium text-gray-600\">Produto:</span>\r\n                  <span className=\"font-medium\">{lead.product || 'Não informado'}</span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-sm font-medium text-gray-600\">Valor da Venda:</span>\r\n                  <span className=\"font-semibold text-green-600\">\r\n                    {calculatedCommission.amount.toLocaleString('pt-BR', {\r\n                      style: 'currency',\r\n                      currency: 'BRL'\r\n                    })}\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex justify-between items-center\">\r\n                  <span className=\"text-sm font-medium text-gray-600\">Percentual:</span>\r\n                  <span className=\"font-semibold text-blue-600\">{calculatedCommission.percentage}%</span>\r\n                </div>\r\n                <div className=\"border-t pt-2 mt-2\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <span className=\"font-medium text-gray-800\">Comissão:</span>\r\n                    <span className=\"text-lg font-bold text-green-600\">\r\n                      {calculatedCommission.value.toLocaleString('pt-BR', {\r\n                        style: 'currency',\r\n                        currency: 'BRL'\r\n                      })}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <DialogFooter className=\"gap-2\">\r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={() => {\r\n                setIsCommissionDialogOpen(false);\r\n                setCalculatedCommission(null);\r\n              }}\r\n              disabled={isUpdating}\r\n            >\r\n              Agora Não\r\n            </Button>\r\n            <Button \r\n              onClick={handleCreateCommission}\r\n              disabled={isUpdating}\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n            >\r\n              {isUpdating ? \"Gerando...\" : \"✓ Gerar Comissão\"}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Dialog de confirmação para mudança de status quando há comissão */}\r\n      <AlertDialog open={isStatusChangeConfirmOpen} onOpenChange={setIsStatusChangeConfirmOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle className=\"flex items-center gap-2\">\r\n              <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\r\n              Confirmação de Mudança de Status\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription className=\"space-y-2\">\r\n              <p>\r\n                Este lead está marcado como <strong>Concluído</strong> e já possui uma <strong>comissão gerada</strong>.\r\n              </p>\r\n              <p>\r\n                Tem certeza que deseja alterar o status para <strong>{statusLabels[pendingNewStatus as keyof typeof statusLabels] || pendingNewStatus}</strong>?\r\n              </p>\r\n              <p className=\"text-amber-600 font-medium mt-3\">\r\n                ⚠️ A comissão existente não será removida, mas a mudança de status pode afetar relatórios e cálculos futuros.\r\n              </p>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => setPendingNewStatus(null)}>\r\n              Cancelar\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction \r\n              onClick={handleConfirmStatusChange}\r\n              className=\"bg-amber-600 hover:bg-amber-700\"\r\n            >\r\n              Sim, Tenho Certeza\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Dialog de confirmação com senha administrativa */}\r\n      <AdminPasswordDialog\r\n        open={showAdminPasswordDialog}\r\n        onOpenChange={(open) => {\r\n          setShowAdminPasswordDialog(open);\r\n          if (!open) {\r\n            setPendingAction(null);\r\n          }\r\n        }}\r\n        onConfirm={() => {\r\n          if (pendingAction === 'delete') {\r\n            confirmDeleteLead();\r\n          } else if (pendingAction === 'edit') {\r\n            setIsEditDialogOpen(true);\r\n            setPendingAction(null);\r\n          }\r\n        }}\r\n        title={pendingAction === 'delete' ? \"Confirmar Exclusão de Lead\" : \"Confirmar Edição de Lead Concluído\"}\r\n        description={\r\n          pendingAction === 'delete' \r\n            ? \"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n            : \"Este lead está marcado como concluído. Digite sua senha administrativa para editá-lo.\"\r\n        }\r\n        itemName={lead.name}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default React.memo(LeadCard);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\LeadForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1782,1785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1782,1785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'cents' is never reassigned. Use 'const' instead.","line":69,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":69,"endColumn":12,"fix":{"range":[2422,2446],"text":"const cents = v.slice(-2);"}},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useAuth\" is called conditionally. React Hooks must be called in the exact same order in every component render.","line":76,"column":30,"nodeType":"Identifier","endLine":76,"endColumn":37},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2890,2893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2890,2893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'getInitialValues'. Either include it or remove the dependency array.","line":248,"column":6,"nodeType":"ArrayExpression","endLine":248,"endColumn":76,"suggestions":[{"desc":"Update the dependencies array to be: [isEditing, initialData, isInitialized, reset, setValue, employeeList, getInitialValues]","fix":{"range":[9338,9408],"text":"[isEditing, initialData, isInitialized, reset, setValue, employeeList, getInitialValues]"}}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport { z } from \"zod\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\n\r\nimport BenefitTypeSelect from \"@/components/forms/BenefitTypeSelect\";\r\nimport { BankSelect } from \"@/components/forms/BankSelect\";\r\nimport EmployeeSelect from \"@/components/EmployeeSelect\";\r\nimport CommissionConfigSelector from \"@/components/forms/CommissionConfigSelector\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\n\r\nconst formSchema = z.object({\r\n  name: z.string().min(1, \"Nome é obrigatório\"),\r\n  cpf: z.string().optional(),\r\n  phone: z.string().optional(),\r\n  phone2: z.string().optional(),\r\n  bank: z.string().optional(),\r\n  product: z.string().optional(),\r\n  amount: z.string().optional(),\r\n  employee: z.string().optional(),\r\n  notes: z.string().optional(),\r\n  benefit_type: z.string().optional(),\r\n  representative_mode: z.string().optional(),\r\n  representative_name: z.string().optional(),\r\n  representative_cpf: z.string().optional(),\r\n  date: z.string().optional(),\r\n  payment_period: z.string().optional(),\r\n});\r\n\r\ntype FormData = z.infer<typeof formSchema>;\r\n\r\n// Adicionar campo para configuração de comissão\r\ntype ProcessedFormData = FormData & {\r\n  commission_config?: any;\r\n};\r\n\r\ninterface LeadFormProps {\r\n  onSubmit: (data: ProcessedFormData) => void;\r\n  onCancel: () => void;\r\n  initialData?: Partial<FormData>;\r\n  isEditing?: boolean;\r\n  isLoading?: boolean;\r\n}\r\n\r\n// Função para formatar CPF\r\nfunction formatCPF(value: string) {\r\n  return value\r\n    .replace(/\\D/g, \"\")\r\n    .replace(/(\\d{3})(\\d)/, \"$1.$2\")\r\n    .replace(/(\\d{3})(\\d)/, \"$1.$2\")\r\n    .replace(/(\\d{3})(\\d{1,2})$/, \"$1-$2\")\r\n    .slice(0, 14);\r\n}\r\n\r\n// Função para formatar moeda brasileira\r\nfunction formatBRL(value: string) {\r\n  let v = value.replace(/\\D/g, \"\");\r\n  v = (parseInt(v, 10) || 0).toString();\r\n  v = v.padStart(3, \"0\");\r\n  let cents = v.slice(-2);\r\n  let reais = v.slice(0, -2);\r\n  reais = reais.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\r\n  return reais + \",\" + cents;\r\n}\r\n\r\nconst LeadForm: React.FC<LeadFormProps> = ({ onSubmit, onCancel, initialData, isEditing = false, isLoading = false }) => {\r\n  const { user } = useAuth ? useAuth() : { user: null };\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [selectedCommissionConfig, setSelectedCommissionConfig] = useState<any>(null);\r\n  const [availableProducts, setAvailableProducts] = useState<string[]>([]);\r\n  const [loadingProducts, setLoadingProducts] = useState(false);\r\n  const [employeeList, setEmployeeList] = useState<Employee[]>([]);\r\n\r\n  // Processar dados iniciais\r\n  const getInitialValues = () => {\r\n    if (!isEditing || !initialData) {\r\n      return {\r\n        name: \"\",\r\n        cpf: \"\",\r\n        phone: \"\",\r\n        phone2: \"\",\r\n        bank: \"none\",\r\n        product: \"\",\r\n        amount: \"\",\r\n        employee: \"none\",\r\n        notes: \"\",\r\n        benefit_type: \"none\",\r\n        representative_mode: \"nao\",\r\n        representative_name: \"\",\r\n        representative_cpf: \"\",\r\n        date: new Date().toISOString().slice(0, 10),\r\n        payment_period: \"\",\r\n      };\r\n    }\r\n\r\n    // Para edição, processar dados corretamente\r\n    // Processar employee: se tiver valor (não null, não undefined, não \"none\", não vazio), usar ele, senão \"none\"\r\n    const employeeValue = initialData?.employee && \r\n                          initialData.employee !== null && \r\n                          initialData.employee !== undefined &&\r\n                          initialData.employee !== \"none\" && \r\n                          initialData.employee !== \"\" \r\n                          ? initialData.employee \r\n                          : \"none\";\r\n    \r\n    const values = {\r\n      name: initialData?.name || \"\",\r\n      cpf: initialData?.cpf || \"\",\r\n      phone: initialData?.phone || \"\",\r\n      phone2: initialData?.phone2 || \"\",\r\n      bank: initialData?.bank || \"none\",\r\n      product: initialData?.product || \"\",\r\n      amount: initialData?.amount || \"\",\r\n      employee: employeeValue,\r\n      notes: initialData?.notes || \"\",\r\n      benefit_type: initialData?.benefit_type || \"none\",\r\n      representative_mode: initialData?.representative_mode || \"nao\",\r\n      representative_name: initialData?.representative_name || \"\",\r\n      representative_cpf: initialData?.representative_cpf || \"\",\r\n      date: initialData?.date || new Date().toISOString().slice(0, 10),\r\n      payment_period: initialData?.payment_period || \"\",\r\n    };\r\n    \r\n    console.log(\"🔧 Form initialized with:\", {\r\n      employee: values.employee,\r\n      originalEmployee: initialData?.employee\r\n    });\r\n    \r\n    return values;\r\n  };\r\n\r\n  const { register, handleSubmit, formState: { errors }, setValue, watch, reset } = useForm<FormData>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: getInitialValues()\r\n  });\r\n\r\n  const representativeMode = watch(\"representative_mode\");\r\n  const currentProduct = watch(\"product\");\r\n  const currentAmount = watch(\"amount\");\r\n  const currentPeriod = watch(\"payment_period\");\r\n\r\n  // Sincronizar o valor do employee quando a lista de funcionários carregar e houver um valor inicial\r\n  useEffect(() => {\r\n    if (isEditing && initialData?.employee && employeeList.length > 0) {\r\n      const employeeId = initialData.employee;\r\n      const employeeExists = employeeList.find(emp => emp.id === employeeId);\r\n      const currentFormValue = watch(\"employee\");\r\n      \r\n      // Apenas atualizar se o valor atual não corresponder ao valor esperado\r\n      if (currentFormValue !== employeeId) {\r\n        if (employeeExists) {\r\n          console.log(\"🔄 Sincronizando employee no formulário:\", employeeId, \"→\", employeeExists.name);\r\n          setValue(\"employee\", employeeId, { shouldValidate: false, shouldDirty: false });\r\n        } else {\r\n          console.warn(\"⚠️ Funcionário não encontrado na lista:\", employeeId);\r\n          // Manter o ID mesmo que não esteja na lista (funcionário pode ter sido desativado)\r\n          if (currentFormValue === \"none\" || !currentFormValue) {\r\n            setValue(\"employee\", employeeId, { shouldValidate: false, shouldDirty: false });\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }, [employeeList, isEditing, initialData?.employee, setValue, watch]);\r\n\r\n  // Função para buscar produtos das configurações de comissão\r\n  const loadAvailableProducts = async () => {\r\n    try {\r\n      setLoadingProducts(true);\r\n      \r\n      // Buscar produtos das comissões fixas\r\n      const { data: ratesData, error: ratesError } = await supabase\r\n        .from('commission_rates')\r\n        .select('product')\r\n        .eq('active', true);\r\n\r\n      // Buscar produtos das comissões variáveis\r\n      const { data: tiersData, error: tiersError } = await supabase\r\n        .from('commission_tiers')\r\n        .select('product')\r\n        .eq('active', true);\r\n\r\n      if (ratesError) {\r\n        console.error('Erro ao buscar produtos das comissões fixas:', ratesError);\r\n      }\r\n      if (tiersError) {\r\n        console.error('Erro ao buscar produtos das comissões variáveis:', tiersError);\r\n      }\r\n\r\n      // Combinar produtos únicos\r\n      const allProducts = new Set<string>();\r\n      \r\n      if (ratesData) {\r\n        ratesData.forEach(rate => {\r\n          if (rate.product) allProducts.add(rate.product);\r\n        });\r\n      }\r\n      \r\n      if (tiersData) {\r\n        tiersData.forEach(tier => {\r\n          if (tier.product) allProducts.add(tier.product);\r\n        });\r\n      }\r\n\r\n      const uniqueProducts = Array.from(allProducts).sort();\r\n      setAvailableProducts(uniqueProducts);\r\n      \r\n      console.log('📦 Produtos encontrados nas configurações:', uniqueProducts);\r\n      \r\n      if (uniqueProducts.length === 0) {\r\n        toast.info(\"Nenhum produto encontrado nas configurações de comissão. Configure produtos em 'Comissões → Configurar Comissões'\");\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Erro ao carregar produtos:', error);\r\n      toast.error('Erro ao carregar produtos das configurações');\r\n    } finally {\r\n      setLoadingProducts(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isEditing && initialData && isInitialized) {\r\n      const values = getInitialValues();\r\n      console.log(\"🔄 Resetando formulário com valores:\", {\r\n        employee: values.employee,\r\n        originalEmployee: initialData?.employee,\r\n        employeeListLength: employeeList.length\r\n      });\r\n      reset(values);\r\n      \r\n      // Se houver employee e a lista já estiver carregada, garantir que o valor seja definido\r\n      if (values.employee && values.employee !== \"none\" && employeeList.length > 0) {\r\n        setTimeout(() => {\r\n          setValue(\"employee\", values.employee);\r\n          console.log(\"✅ Employee definido após reset:\", values.employee);\r\n        }, 100);\r\n      }\r\n    }\r\n  }, [isEditing, initialData, isInitialized, reset, setValue, employeeList]);\r\n\r\n  useEffect(() => {\r\n    setIsInitialized(true);\r\n    loadAvailableProducts();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    getEmployees().then(setEmployeeList);\r\n  }, []);\r\n\r\n  const onFormSubmit = (data: FormData) => {\r\n    console.log(\"🚀 LeadForm - Submitting data:\", data);\r\n    \r\n    if (!data.name || data.name.trim() === \"\") {\r\n      toast.error(\"Nome é obrigatório\");\r\n      return;\r\n    }\r\n\r\n    // Processar dados do formulário\r\n    // Garantir que o employee seja o valor atual do watch, não apenas do data\r\n    const currentEmployee = watch(\"employee\");\r\n    const employeeValue = currentEmployee && currentEmployee !== \"none\" && currentEmployee !== \"\" ? currentEmployee : null;\r\n    \r\n    const processedData: ProcessedFormData = {\r\n      name: data.name,\r\n      cpf: data.cpf,\r\n      phone: data.phone,\r\n      phone2: data.phone2 || null,\r\n      bank: data.bank && data.bank !== \"none\" ? data.bank : null,\r\n      product: data.product && data.product !== \"none\" ? data.product : null,\r\n      amount: data.amount || null,\r\n      employee: employeeValue, // usar o valor atual do campo\r\n      notes: data.notes || \"\",\r\n      benefit_type: data.benefit_type && data.benefit_type !== \"none\" ? data.benefit_type : null,\r\n      representative_mode: data.representative_mode || \"nao\",\r\n      representative_name: data.representative_mode === \"sim\" && data.representative_name \r\n        ? data.representative_name \r\n        : null,\r\n      representative_cpf: data.representative_mode === \"sim\" && data.representative_cpf \r\n        ? data.representative_cpf \r\n        : null,\r\n      date: data.date || format(new Date(), \"yyyy-MM-dd\"),\r\n      payment_period: data.payment_period || null,\r\n      commission_config: selectedCommissionConfig,\r\n    };\r\n\r\n    console.log(\"📤 LeadForm - Processed data to send:\", {\r\n      employee: processedData.employee,\r\n      employeeType: typeof processedData.employee,\r\n      name: processedData.name,\r\n      originalEmployee: data.employee,\r\n      currentEmployeeFromWatch: currentEmployee,\r\n      commission_config: selectedCommissionConfig,\r\n      allProcessedData: processedData\r\n    });\r\n\r\n    onSubmit(processedData);\r\n  };\r\n\r\n  if (!user) {\r\n    return <div className=\"p-4 text-center text-red-600 font-semibold\">Você precisa estar logado para cadastrar um lead.</div>;\r\n  }\r\n\r\n  if (!isInitialized) {\r\n    return (\r\n      <div className=\"p-8 text-center\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4\"></div>\r\n        <p className=\"text-gray-600\">Carregando formulário...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const getEmployeeNameById = (id: string | undefined) => {\r\n    if (!id || id === \"none\") return \"Nenhum funcionário\";\r\n    const emp = employeeList.find(e => e.id === id);\r\n    return emp ? emp.name : \"Funcionário não encontrado\";\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onFormSubmit)} className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <div>\r\n          <Label htmlFor=\"name\">Nome *</Label>\r\n          <Input id=\"name\" {...register(\"name\")} className={errors.name ? \"border-red-500\" : \"\"} />\r\n          {errors.name && <p className=\"text-red-500 text-sm mt-1\">{errors.name.message}</p>}\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"cpf\">CPF</Label>\r\n          <Input id=\"cpf\" {...register(\"cpf\")}\r\n            placeholder=\"000.000.000-00\"\r\n            maxLength={14}\r\n            onChange={e => setValue(\"cpf\", formatCPF(e.target.value))}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"phone\">Telefone</Label>\r\n          <Input id=\"phone\" {...register(\"phone\")} placeholder=\"(00) 00000-0000\" />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"phone2\">Telefone 2</Label>\r\n          <Input id=\"phone2\" {...register(\"phone2\")} placeholder=\"(00) 00000-0000\" />\r\n        </div>\r\n\r\n        <BankSelect\r\n          value={watch(\"bank\") || \"none\"}\r\n          onValueChange={(value) => setValue(\"bank\", value)}\r\n          label=\"Banco\"\r\n          placeholder=\"Selecione o banco\"\r\n          showNoneOption={true}\r\n        />\r\n\r\n        <div>\r\n          <Label htmlFor=\"product\">Produto</Label>\r\n          <Select \r\n            onValueChange={(value) => {\r\n              setValue(\"product\", value === \"none\" ? \"\" : value);\r\n              setSelectedCommissionConfig(null); // Limpar configuração quando produto mudar\r\n            }}\r\n            value={watch(\"product\") === \"\" || !watch(\"product\") ? \"none\" : watch(\"product\")}\r\n            disabled={loadingProducts}\r\n          >\r\n            <SelectTrigger>\r\n              <SelectValue placeholder={loadingProducts ? \"Carregando produtos...\" : \"Selecione o produto\"} />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"none\">Nenhum produto</SelectItem>\r\n              {availableProducts.map((product) => (\r\n                <SelectItem key={product} value={product}>\r\n                  {product}\r\n                </SelectItem>\r\n              ))}\r\n              {availableProducts.length === 0 && !loadingProducts && (\r\n                <SelectItem value=\"no-products\" disabled>\r\n                  Nenhum produto configurado\r\n                </SelectItem>\r\n              )}\r\n            </SelectContent>\r\n          </Select>\r\n          {availableProducts.length === 0 && !loadingProducts && (\r\n            <p className=\"text-sm text-amber-600 mt-1\">\r\n              ⚠️ Configure produtos em \"Comissões → Configurar Comissões\"\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"amount\">Valor</Label>\r\n          <Input id=\"amount\" {...register(\"amount\")}\r\n            placeholder=\"R$ 0,00\"\r\n            onChange={e => setValue(\"amount\", formatBRL(e.target.value))}\r\n          />\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"payment_period\">Prazo de Pagamento (parcelas)</Label>\r\n          <Select \r\n            onValueChange={(value) => setValue(\"payment_period\", value === \"none\" ? \"\" : value)}\r\n            value={watch(\"payment_period\") === \"\" || !watch(\"payment_period\") ? \"none\" : watch(\"payment_period\")}\r\n          >\r\n            <SelectTrigger>\r\n              <SelectValue placeholder=\"Selecione o prazo\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"none\">Não informado</SelectItem>\r\n              {Array.from({ length: 120 }, (_, i) => i + 1).map(month => (\r\n                <SelectItem key={month} value={month.toString()}>\r\n                  {month}x parcelas\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"employee\">Funcionário</Label>\r\n          <EmployeeSelect\r\n            value={watch(\"employee\") || \"none\"}\r\n            onValueChange={(value) => {\r\n              console.log(\"🎯 Employee changed to (id):\", value);\r\n              setValue(\"employee\", value);\r\n            }}\r\n            placeholder=\"Selecione o funcionário\"\r\n          />\r\n        </div>\r\n\r\n        <BenefitTypeSelect\r\n          value={watch(\"benefit_type\") || \"none\"}\r\n          onValueChange={(value) => setValue(\"benefit_type\", value)}\r\n        />\r\n\r\n        <div>\r\n          <Label htmlFor=\"representative_mode\">Modo Representante</Label>\r\n          <Select onValueChange={(value) => setValue(\"representative_mode\", value)} defaultValue={representativeMode || \"nao\"} value={representativeMode || \"nao\"}>\r\n            <SelectTrigger>\r\n              <SelectValue placeholder=\"Selecione\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              <SelectItem value=\"nao\">Não</SelectItem>\r\n              <SelectItem value=\"sim\">Sim</SelectItem>\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n\r\n        <div>\r\n          <Label htmlFor=\"date\">Data do Lead</Label>\r\n          <Input id=\"date\" type=\"date\" {...register(\"date\")} />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Seção de Configuração de Comissão */}\r\n      {currentProduct && currentProduct !== \"none\" && (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"border-t pt-4\">\r\n            <h3 className=\"text-lg font-semibold mb-4\">💰 Configuração de Comissão</h3>\r\n            <CommissionConfigSelector\r\n              selectedProduct={currentProduct}\r\n              onConfigSelect={setSelectedCommissionConfig}\r\n              selectedConfig={selectedCommissionConfig}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Seção de Representante */}\r\n      {representativeMode === \"sim\" && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 p-4 border rounded-lg bg-gray-50 mt-4\">\r\n          <div>\r\n            <Label htmlFor=\"representative_name\">Nome do Representante</Label>\r\n            <Input id=\"representative_name\" {...register(\"representative_name\")} />\r\n          </div>\r\n          <div>\r\n            <Label htmlFor=\"representative_cpf\">CPF do Representante</Label>\r\n            <Input id=\"representative_cpf\" {...register(\"representative_cpf\")} \r\n              placeholder=\"000.000.000-00\"\r\n              maxLength={14}\r\n              onChange={e => setValue(\"representative_cpf\", formatCPF(e.target.value))}\r\n            />\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div>\r\n        <Label htmlFor=\"notes\">Observações</Label>\r\n        <Textarea id=\"notes\" {...register(\"notes\")} rows={3} />\r\n      </div>\r\n\r\n      <div className=\"flex gap-2 justify-end\">\r\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel} disabled={isLoading}>Cancelar</Button>\r\n        <Button type=\"submit\" disabled={isLoading}>\r\n          {isLoading ? \"Salvando...\" : isEditing ? \"Atualizar\" : \"Criar Lead\"}\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default LeadForm;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\LeadList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4759,4762],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4759,4762],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4780,4783],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4780,4783],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":135,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4968,4971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4968,4971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6093,6096],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6093,6096],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":176,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":176,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6300,6303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6300,6303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8614,8617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8614,8617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8635,8638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8635,8638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":261,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":261,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8823,8826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8823,8826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchLeads', 'fetchLeadsWithTags', and 'selectedTags.length'. Either include them or remove the dependency array.","line":291,"column":6,"nodeType":"ArrayExpression","endLine":291,"endColumn":63,"suggestions":[{"desc":"Update the dependencies array to be: [statusFilter, employeeFilter, productFilter, bankFilter, selectedTags.length, fetchLeadsWithTags, fetchLeads]","fix":{"range":[9784,9841],"text":"[statusFilter, employeeFilter, productFilter, bankFilter, selectedTags.length, fetchLeadsWithTags, fetchLeads]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":327,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":327,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10992,10995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10992,10995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":376,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":376,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12726,12729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12726,12729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":397,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13374,13377],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13374,13377],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":478,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":478,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15840,15843],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15840,15843],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":479,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":479,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15877,15880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15877,15880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":480,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":480,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15922,15925],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15922,15925],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":481,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":481,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15977,15980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15977,15980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":482,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":482,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16039,16042],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16039,16042],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":483,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":483,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16106,16109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16106,16109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":484,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":484,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16172,16175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16172,16175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":512,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":512,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17060,17063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17060,17063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":19,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport LeadCard from \"./LeadCard\";\r\nimport EmptyState from \"./EmptyState\";\r\nimport { Lead } from \"@/types/models\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { Search, Plus, Filter, X, ChevronLeft, ChevronRight, Trash2, Check, Square, CheckSquare } from \"lucide-react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\";\r\nimport { Pagination, PaginationContent, PaginationItem, PaginationLink, PaginationNext, PaginationPrevious } from \"@/components/ui/pagination\";\r\nimport LeadForm from \"./LeadForm\";\r\nimport { Link } from \"react-router-dom\";\r\nimport LeadImportButton from \"@/components/leads/LeadImportButton\";\r\nimport { formatLeadDate } from \"@/utils/dateUtils\";\r\n\r\ninterface LeadListProps {\r\n  searchQuery?: string;\r\n  selectedTags?: string[];\r\n  statusFilter?: string;\r\n  employeeFilter?: string;\r\n  productFilter?: string;\r\n  bankFilter?: string;\r\n}\r\n\r\nconst LEADS_PER_PAGE = 20;\r\n\r\nconst LeadList: React.FC<LeadListProps> = ({\r\n  searchQuery = \"\",\r\n  selectedTags = [],\r\n  statusFilter = \"\",\r\n  employeeFilter = \"\",\r\n  productFilter = \"\",\r\n  bankFilter = \"\"\r\n}) => {\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [filteredLeads, setFilteredLeads] = useState<Lead[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isOpenSheet, setIsOpenSheet] = useState(false);\r\n  const [internalSearchQuery, setInternalSearchQuery] = useState(searchQuery);\r\n  \r\n  // Pagination states\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalLeads, setTotalLeads] = useState(0);\r\n  const [totalPages, setTotalPages] = useState(0);\r\n\r\n  // Multi-selection states\r\n  const [selectedLeads, setSelectedLeads] = useState<Set<string>>(new Set());\r\n  const [isSelectionMode, setIsSelectionMode] = useState(false);\r\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\r\n  const [isDeletingMultiple, setIsDeletingMultiple] = useState(false);\r\n\r\n  const fetchLeads = async (page = 1) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // User authenticated, proceed with queries\r\n\r\n      // Get total count first - create separate query for count\r\n      let countQuery = supabase\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: 'exact', head: true })\r\n        .eq('user_id', userData.user.id);\r\n\r\n      // Apply same filters to count query\r\n      if (statusFilter) {\r\n        countQuery = countQuery.eq('status', statusFilter);\r\n      }\r\n      if (employeeFilter) {\r\n        countQuery = countQuery.eq('employee', employeeFilter);\r\n      }\r\n      if (productFilter) {\r\n        countQuery = countQuery.eq('product', productFilter);\r\n      }\r\n      if (bankFilter) {\r\n        countQuery = countQuery.eq('bank', bankFilter);\r\n      }\r\n\r\n      const { count, error: countError } = await countQuery;\r\n      \r\n      if (countError) {\r\n        console.error('Count error:', countError);\r\n        throw countError;\r\n      }\r\n      \r\n      setTotalLeads(count || 0);\r\n      setTotalPages(Math.ceil((count || 0) / LEADS_PER_PAGE));\r\n\r\n      // Get actual data with same filters\r\n      let dataQuery = supabase\r\n        .from(\"leads\")\r\n        .select(\"*\")\r\n        .eq('user_id', userData.user.id);\r\n\r\n      // Aplicar filtros nos dados\r\n      if (statusFilter) {\r\n        dataQuery = dataQuery.eq('status', statusFilter);\r\n      }\r\n      if (employeeFilter) {\r\n        dataQuery = dataQuery.eq('employee', employeeFilter);\r\n      }\r\n      if (productFilter) {\r\n        dataQuery = dataQuery.eq('product', productFilter);\r\n      }\r\n      if (bankFilter) {\r\n        dataQuery = dataQuery.eq('bank', bankFilter);\r\n      }\r\n\r\n      const from = (page - 1) * LEADS_PER_PAGE;\r\n      const to = from + LEADS_PER_PAGE - 1;\r\n\r\n      const { data, error } = await dataQuery\r\n        .range(from, to)\r\n        .order(\"date\", { ascending: false })\r\n        .order(\"created_at\", { ascending: false });\r\n      \r\n      if (error) {\r\n        console.error('Data error:', error);\r\n        throw error;\r\n      }\r\n\r\n      const formattedLeads = (data || []).map(lead => ({\r\n        ...lead,\r\n        createdAt: formatLeadDate((lead as any).date ? (lead as any).date : lead.created_at),\r\n        status: lead.status || \"novo\"\r\n      })) as Lead[];\r\n\r\n      setLeads(formattedLeads);\r\n      setFilteredLeads(formattedLeads);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching leads:\", error);\r\n      \r\n      // Melhor tratamento de erro\r\n      if (error.message?.includes('Failed to fetch')) {\r\n        toast.error(\"Erro de conexão. Verifique sua internet e tente novamente.\");\r\n      } else if (error.message?.includes('JWT')) {\r\n        toast.error(\"Sessão expirada. Faça login novamente.\");\r\n      } else {\r\n        toast.error(`Erro ao carregar leads: ${error.message || 'Erro desconhecido'}`);\r\n      }\r\n      \r\n      // Em caso de erro, definir estados seguros\r\n      setLeads([]);\r\n      setFilteredLeads([]);\r\n      setTotalLeads(0);\r\n      setTotalPages(0);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchLeadsWithTags = async (page = 1) => {\r\n    if (selectedTags.length === 0) {\r\n      fetchLeads(page);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // First, get leads that have the selected tags\r\n      const { data: tagAssignments, error: tagError } = await (supabase as any)\r\n        .from('lead_tag_assignments')\r\n        .select('lead_id')\r\n        .in('tag_id', selectedTags);\r\n\r\n      if (tagError) throw tagError;\r\n\r\n      const leadIds = tagAssignments?.map((assignment: any) => assignment.lead_id) || [];\r\n\r\n      if (leadIds.length === 0) {\r\n        setLeads([]);\r\n        setFilteredLeads([]);\r\n        setTotalLeads(0);\r\n        setTotalPages(0);\r\n        setIsLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Create count query\r\n      let countQuery = supabase\r\n        .from(\"leads\")\r\n        .select(\"*\", { count: 'exact', head: true })\r\n        .eq('user_id', userData.user.id)\r\n        .in('id', leadIds);\r\n\r\n      // Apply filters to count query\r\n      if (statusFilter) {\r\n        countQuery = countQuery.eq('status', statusFilter);\r\n      }\r\n      if (employeeFilter) {\r\n        countQuery = countQuery.eq('employee', employeeFilter);\r\n      }\r\n      if (productFilter) {\r\n        countQuery = countQuery.eq('product', productFilter);\r\n      }\r\n      if (bankFilter) {\r\n        countQuery = countQuery.eq('bank', bankFilter);\r\n      }\r\n\r\n      // Get total count for filtered leads\r\n      const { count, error: countError } = await countQuery;\r\n      \r\n      if (countError) {\r\n        console.error('Count error:', countError);\r\n        throw countError;\r\n      }\r\n      \r\n      setTotalLeads(count || 0);\r\n      setTotalPages(Math.ceil((count || 0) / LEADS_PER_PAGE));\r\n\r\n      // Get actual data\r\n      let dataQuery = supabase\r\n        .from(\"leads\")\r\n        .select(\"*\")\r\n        .eq('user_id', userData.user.id)\r\n        .in('id', leadIds);\r\n\r\n      // Apply filters to data query\r\n      if (statusFilter) {\r\n        dataQuery = dataQuery.eq('status', statusFilter);\r\n      }\r\n      if (employeeFilter) {\r\n        dataQuery = dataQuery.eq('employee', employeeFilter);\r\n      }\r\n      if (productFilter) {\r\n        dataQuery = dataQuery.eq('product', productFilter);\r\n      }\r\n      if (bankFilter) {\r\n        dataQuery = dataQuery.eq('bank', bankFilter);\r\n      }\r\n\r\n      const from = (page - 1) * LEADS_PER_PAGE;\r\n      const to = from + LEADS_PER_PAGE - 1;\r\n\r\n      const { data, error } = await dataQuery\r\n        .range(from, to)\r\n        .order(\"date\", { ascending: false })\r\n        .order(\"created_at\", { ascending: false });\r\n      \r\n      if (error) {\r\n        console.error('Data error:', error);\r\n        throw error;\r\n      }\r\n\r\n      const formattedLeads = (data || []).map(lead => ({\r\n        ...lead,\r\n        createdAt: formatLeadDate((lead as any).date ? (lead as any).date : lead.created_at),\r\n        status: lead.status || \"novo\"\r\n      })) as Lead[];\r\n\r\n      setLeads(formattedLeads);\r\n      setFilteredLeads(formattedLeads);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching leads with tags:\", error);\r\n      \r\n      // Melhor tratamento de erro\r\n      if (error.message?.includes('Failed to fetch')) {\r\n        toast.error(\"Erro de conexão. Verifique sua internet e tente novamente.\");\r\n      } else if (error.message?.includes('JWT')) {\r\n        toast.error(\"Sessão expirada. Faça login novamente.\");\r\n      } else {\r\n        toast.error(`Erro ao carregar leads: ${error.message || 'Erro desconhecido'}`);\r\n      }\r\n      \r\n      // Em caso de erro, definir estados seguros\r\n      setLeads([]);\r\n      setFilteredLeads([]);\r\n      setTotalLeads(0);\r\n      setTotalPages(0);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // CORRIGIDO: useEffect que causava loop infinito\r\n  useEffect(() => {\r\n    setCurrentPage(1); // Reset to first page when filters change\r\n    if (selectedTags.length > 0) {\r\n      fetchLeadsWithTags(1);\r\n    } else {\r\n      fetchLeads(1);\r\n    }\r\n  }, [statusFilter, employeeFilter, productFilter, bankFilter]); // Removido selectedTags para evitar loop\r\n\r\n  useEffect(() => {\r\n    setInternalSearchQuery(searchQuery);\r\n  }, [searchQuery]);\r\n\r\n  useEffect(() => {\r\n    let result = [...leads];\r\n\r\n    const searchTerms = internalSearchQuery || searchQuery;\r\n    if (searchTerms) {\r\n      const searchLower = searchTerms.toLowerCase();\r\n      result = result.filter(lead => \r\n        lead.name && lead.name.toLowerCase().includes(searchLower) || \r\n        lead.phone && lead.phone.includes(searchTerms) || \r\n        lead.phone2 && lead.phone2.includes(searchTerms) || \r\n        lead.phone3 && lead.phone3.includes(searchTerms) || \r\n        lead.cpf && lead.cpf.includes(searchTerms) || \r\n        lead.email && lead.email?.toLowerCase().includes(searchLower)\r\n      );\r\n    }\r\n\r\n    setFilteredLeads(result);\r\n  }, [leads, searchQuery, internalSearchQuery]);\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setCurrentPage(page);\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    \r\n    if (selectedTags.length > 0) {\r\n      fetchLeadsWithTags(page);\r\n    } else {\r\n      fetchLeads(page);\r\n    }\r\n  };\r\n\r\n  const handleLeadSubmit = async (values: any) => {\r\n    console.log(\"New lead submission:\", values);\r\n    \r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { selectedTags, ...leadData } = values;\r\n      \r\n      // Processar payment_period para evitar erro de integer\r\n      const processedLeadData = {\r\n        ...leadData,\r\n        payment_period: leadData.payment_period && leadData.payment_period !== \"\" && leadData.payment_period !== \"none\" \r\n          ? parseInt(leadData.payment_period) \r\n          : undefined\r\n      };\r\n      \r\n      // Debug: verificar se o campo está sendo processado corretamente\r\n      console.log(\"Lead data to insert:\", processedLeadData);\r\n      console.log(\"Payment period conversion:\", {\r\n        original: leadData.payment_period,\r\n        processed: processedLeadData.payment_period,\r\n        type: typeof processedLeadData.payment_period\r\n      });\r\n\r\n      const { data: leadInsertData, error: leadError } = await supabase\r\n        .from(\"leads\")\r\n        .insert({\r\n          ...processedLeadData,\r\n          user_id: userData.user.id,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (leadError) {\r\n        console.error(\"Database insert error:\", leadError);\r\n        throw leadError;\r\n      }\r\n\r\n      console.log(\"Lead inserted successfully:\", leadInsertData);\r\n\r\n      // Save tag assignments if any tags were selected\r\n      if (selectedTags && selectedTags.length > 0) {\r\n        const tagAssignments = selectedTags.map((tagId: string) => ({\r\n          lead_id: leadInsertData.id,\r\n          tag_id: tagId,\r\n          user_id: userData.user.id,\r\n        }));\r\n\r\n        const { error: tagError } = await (supabase as any)\r\n          .from('lead_tag_assignments')\r\n          .insert(tagAssignments);\r\n\r\n        if (tagError) {\r\n          console.error('Error saving tag assignments:', tagError);\r\n          toast.error('Lead salvo, mas erro ao aplicar etiquetas');\r\n        }\r\n      }\r\n      \r\n      console.log(\"Lead saved successfully:\", leadInsertData);\r\n      toast.success(\"Lead cadastrado com sucesso!\");\r\n      setIsOpenSheet(false);\r\n      \r\n      // Refresh leads based on current filters\r\n      if (selectedTags.length > 0) {\r\n        fetchLeadsWithTags(currentPage);\r\n      } else {\r\n        fetchLeads(currentPage);\r\n      }\r\n      \r\n    } catch (error: any) {\r\n      console.error(\"Error creating lead:\", error);\r\n      toast.error(`Erro ao cadastrar lead: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleLeadUpdate = (updatedLead: Lead) => {\r\n    setLeads(leads.map(lead => lead.id === updatedLead.id ? updatedLead : lead));\r\n  };\r\n\r\n  const handleLeadDelete = (id: string) => {\r\n    setLeads(leads.filter(lead => lead.id !== id));\r\n    // Remove from selection if it was selected\r\n    setSelectedLeads(prev => {\r\n      const newSet = new Set(prev);\r\n      newSet.delete(id);\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  // Multi-selection functions\r\n  const handleSelectLead = (leadId: string, selected: boolean) => {\r\n    setSelectedLeads(prev => {\r\n      const newSet = new Set(prev);\r\n      if (selected) {\r\n        newSet.add(leadId);\r\n      } else {\r\n        newSet.delete(leadId);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  const handleSelectAll = (checked: boolean) => {\r\n    if (checked) {\r\n      setSelectedLeads(new Set(filteredLeads.map(lead => lead.id)));\r\n    } else {\r\n      setSelectedLeads(new Set());\r\n    }\r\n  };\r\n\r\n  const toggleSelectionMode = () => {\r\n    setIsSelectionMode(!isSelectionMode);\r\n    setSelectedLeads(new Set());\r\n  };\r\n\r\n  const handleMultipleDelete = async () => {\r\n    if (selectedLeads.size === 0) return;\r\n\r\n    setIsDeletingMultiple(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const leadsToDelete = leads.filter(lead => selectedLeads.has(lead.id));\r\n      const expiresAt = new Date();\r\n      expiresAt.setDate(expiresAt.getDate() + 30);\r\n\r\n      // Move all selected leads to trash\r\n      const deletedLeadsData = leadsToDelete.map(lead => ({\r\n        original_lead_id: lead.id,\r\n        user_id: userData.user.id,\r\n        original_lead_data: {\r\n          id: lead.id,\r\n          user_id: lead.user_id,\r\n          name: lead.name,\r\n          email: lead.email,\r\n          phone: lead.phone,\r\n          phone2: lead.phone2,\r\n          phone3: lead.phone3,\r\n          cpf: lead.cpf,\r\n          status: lead.status,\r\n          source: lead.source,\r\n          notes: lead.notes,\r\n          amount: lead.amount,\r\n          createdAt: lead.createdAt,\r\n          updatedAt: lead.updatedAt,\r\n          scheduledAt: lead.scheduledAt,\r\n          product: lead.product,\r\n          employee: lead.employee,\r\n          created_at: lead.created_at,\r\n          date: (lead as any).date,\r\n          bank: (lead as any).bank,\r\n          benefit_type: (lead as any).benefit_type,\r\n          payment_period: (lead as any).payment_period,\r\n          representative_mode: (lead as any).representative_mode,\r\n          representative_name: (lead as any).representative_name,\r\n          representative_cpf: (lead as any).representative_cpf\r\n        },\r\n        deleted_at: new Date().toISOString(),\r\n        expires_at: expiresAt.toISOString()\r\n      }));\r\n\r\n      // Insert to deleted_leads table\r\n      const { error: trashError } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .insert(deletedLeadsData);\r\n\r\n      if (trashError) throw trashError;\r\n\r\n      // Delete from active leads\r\n      const { error: deleteError } = await supabase\r\n        .from(\"leads\")\r\n        .delete()\r\n        .in(\"id\", Array.from(selectedLeads));\r\n\r\n      if (deleteError) throw deleteError;\r\n\r\n      // Update local state\r\n      setLeads(leads.filter(lead => !selectedLeads.has(lead.id)));\r\n      setSelectedLeads(new Set());\r\n      setIsSelectionMode(false);\r\n      setIsDeleteDialogOpen(false);\r\n\r\n      toast.success(`${selectedLeads.size} leads movidos para a lixeira com sucesso!`);\r\n    } catch (error: any) {\r\n      console.error(\"Error deleting multiple leads:\", error);\r\n      toast.error(`Erro ao deletar leads: ${error.message}`);\r\n    } finally {\r\n      setIsDeletingMultiple(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center justify-between mb-4\">\r\n        <h2 className=\"text-2xl font-bold\">Leads</h2>\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"text-sm text-muted-foreground mr-2\">\r\n            Mostrando {filteredLeads.length} de {totalLeads} leads\r\n          </span>\r\n          {isSelectionMode && (\r\n            <div className=\"flex items-center gap-2 mr-2\">\r\n              <Checkbox\r\n                checked={selectedLeads.size === filteredLeads.length && filteredLeads.length > 0}\r\n                onCheckedChange={handleSelectAll}\r\n                className=\"data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600\"\r\n              />\r\n              <span className=\"text-sm font-medium\">Selecionar todos</span>\r\n              {selectedLeads.size > 0 && (\r\n                <Button\r\n                  variant=\"destructive\"\r\n                  size=\"sm\"\r\n                  onClick={() => setIsDeleteDialogOpen(true)}\r\n                  disabled={isDeletingMultiple}\r\n                  className=\"ml-2\"\r\n                >\r\n                  <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                  Excluir ({selectedLeads.size})\r\n                </Button>\r\n              )}\r\n            </div>\r\n          )}\r\n          <Button\r\n            variant={isSelectionMode ? \"secondary\" : \"outline\"}\r\n            size=\"sm\"\r\n            onClick={toggleSelectionMode}\r\n            className=\"flex items-center gap-2\"\r\n          >\r\n            {isSelectionMode ? (\r\n              <>\r\n                <X className=\"h-4 w-4\" />\r\n                Cancelar\r\n              </>\r\n            ) : (\r\n              <>\r\n                <CheckSquare className=\"h-4 w-4\" />\r\n                Selecionar\r\n              </>\r\n            )}\r\n          </Button>\r\n          <LeadImportButton />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* REMOVIDO: Filtros antigos duplicados */}\r\n      \r\n      {isLoading ? (\r\n        <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3\">\r\n          {[1, 2, 3].map(i => (\r\n            <div key={i} className=\"h-56 animate-pulse rounded-md bg-gray-100\"></div>\r\n          ))}\r\n        </div>\r\n      ) : filteredLeads.length > 0 ? (\r\n        <>\r\n          <div className=\"grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3\">\r\n            {filteredLeads.map(lead => (\r\n              <LeadCard \r\n                key={lead.id} \r\n                lead={lead} \r\n                onUpdate={handleLeadUpdate} \r\n                onDelete={handleLeadDelete}\r\n                isSelected={selectedLeads.has(lead.id)}\r\n                onSelect={handleSelectLead}\r\n                showSelection={isSelectionMode}\r\n              />\r\n            ))}\r\n          </div>\r\n          \r\n          {/* Pagination Controls */}\r\n          {totalPages > 1 && (\r\n            <div className=\"flex items-center justify-center space-x-6 py-4\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <p className=\"text-sm font-medium\">\r\n                  Página {currentPage} de {totalPages}\r\n                </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  ({totalLeads} leads no total)\r\n                </p>\r\n              </div>\r\n              \r\n              <Pagination>\r\n                <PaginationContent>\r\n                  <PaginationItem>\r\n                    <PaginationPrevious \r\n                      onClick={() => currentPage > 1 && handlePageChange(currentPage - 1)}\r\n                      className={currentPage <= 1 ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\r\n                    />\r\n                  </PaginationItem>\r\n                  \r\n                  {[...Array(Math.min(5, totalPages))].map((_, index) => {\r\n                    const pageNumber = Math.max(1, currentPage - 2) + index;\r\n                    if (pageNumber > totalPages) return null;\r\n                    \r\n                    return (\r\n                      <PaginationItem key={pageNumber}>\r\n                        <PaginationLink\r\n                          onClick={() => handlePageChange(pageNumber)}\r\n                          isActive={pageNumber === currentPage}\r\n                          className=\"cursor-pointer\"\r\n                        >\r\n                          {pageNumber}\r\n                        </PaginationLink>\r\n                      </PaginationItem>\r\n                    );\r\n                  })}\r\n                  \r\n                  <PaginationItem>\r\n                    <PaginationNext \r\n                      onClick={() => currentPage < totalPages && handlePageChange(currentPage + 1)}\r\n                      className={currentPage >= totalPages ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\r\n                    />\r\n                  </PaginationItem>\r\n                </PaginationContent>\r\n              </Pagination>\r\n            </div>\r\n          )}\r\n        </>\r\n      ) : (\r\n        <EmptyState />\r\n      )}\r\n\r\n      {/* Modal de confirmação para exclusão múltipla */}\r\n      <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Excluir Leads Selecionados</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Tem certeza que deseja mover {selectedLeads.size} lead{selectedLeads.size > 1 ? 's' : ''} para a lixeira? \r\n              Os leads ficarão disponíveis por 30 dias na lixeira antes de serem excluídos automaticamente.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeletingMultiple}>Cancelar</AlertDialogCancel>\r\n            <AlertDialogAction \r\n              onClick={handleMultipleDelete} \r\n              className=\"bg-red-600 hover:bg-red-700\"\r\n              disabled={isDeletingMultiple}\r\n            >\r\n              {isDeletingMultiple ? \"Excluindo...\" : \"Excluir Leads\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default React.memo(LeadList);\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\NotesBlock.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2554,2557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2554,2557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":148,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4856,4859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4856,4859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":181,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":181,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5856,5859],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5856,5859],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Plus, Trash2, Edit3, FileText, Loader2, Search } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\n\r\ninterface Note {\r\n  id: string;\r\n  title: string;\r\n  content: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n  user_id: string;\r\n}\r\n\r\nconst NotesBlock = () => {\r\n  const [notes, setNotes] = useState<Note[]>([]);\r\n  const [filteredNotes, setFilteredNotes] = useState<Note[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [editingNote, setEditingNote] = useState<Note | null>(null);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [noteToDelete, setNoteToDelete] = useState<string | null>(null);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n\r\n  // Form state\r\n  const [title, setTitle] = useState(\"\");\r\n  const [content, setContent] = useState(\"\");\r\n\r\n  const fetchNotes = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"notes\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userData.user.id)\r\n        .order(\"updated_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      setNotes((data || []) as Note[]);\r\n      setFilteredNotes((data || []) as Note[]);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao buscar notas:\", error);\r\n      // Se a tabela não existir, apenas mostra array vazio\r\n      if (error.code !== \"PGRST116\") {\r\n        toast.error(`Erro ao carregar notas: ${error.message}`);\r\n      }\r\n      setNotes([]);\r\n      setFilteredNotes([]);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchNotes();\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!searchQuery.trim()) {\r\n      setFilteredNotes(notes);\r\n      return;\r\n    }\r\n\r\n    const query = searchQuery.toLowerCase();\r\n    const filtered = notes.filter(\r\n      (note) =>\r\n        (note.title || '').toLowerCase().includes(query) ||\r\n        (note.content || '').toLowerCase().includes(query)\r\n    );\r\n    setFilteredNotes(filtered);\r\n  }, [searchQuery, notes]);\r\n\r\n  const handleOpenDialog = (note: Note | null = null) => {\r\n    setEditingNote(note);\r\n    if (note) {\r\n      setTitle(note.title);\r\n      setContent(note.content);\r\n    } else {\r\n      resetForm();\r\n    }\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setTitle(\"\");\r\n    setContent(\"\");\r\n    setEditingNote(null);\r\n  };\r\n\r\n  const handleSaveNote = async () => {\r\n    if (!title.trim()) {\r\n      toast.error(\"O título é obrigatório\");\r\n      return;\r\n    }\r\n\r\n    setIsSubmitting(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const noteData = {\r\n        title: title.trim(),\r\n        content: content.trim() || null,\r\n        user_id: userData.user.id,\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n\r\n      if (editingNote) {\r\n        const { error } = await supabase\r\n          .from(\"notes\")\r\n          .update(noteData)\r\n          .eq(\"id\", editingNote.id);\r\n\r\n        if (error) throw error;\r\n        toast.success(\"Nota atualizada com sucesso!\");\r\n      } else {\r\n        const { error } = await supabase.from(\"notes\").insert({\r\n          ...noteData,\r\n          created_at: new Date().toISOString(),\r\n        });\r\n\r\n        if (error) throw error;\r\n        toast.success(\"Nota criada com sucesso!\");\r\n      }\r\n\r\n      setIsDialogOpen(false);\r\n      resetForm();\r\n      await fetchNotes();\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao salvar nota:\", error);\r\n      toast.error(`Erro ao salvar nota: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteNote = async (id: string) => {\r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setNoteToDelete(id);\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    confirmDeleteNote(id);\r\n  };\r\n\r\n  const confirmDeleteNote = async (id?: string) => {\r\n    const noteId = id || noteToDelete;\r\n    if (!noteId) return;\r\n\r\n    try {\r\n      const { error } = await supabase.from(\"notes\").delete().eq(\"id\", noteId);\r\n\r\n      if (error) throw error;\r\n\r\n      setNotes(notes.filter((n) => n.id !== noteId));\r\n      setFilteredNotes(filteredNotes.filter((n) => n.id !== noteId));\r\n      toast.success(\"Nota excluída com sucesso!\");\r\n      setNoteToDelete(null);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao excluir nota:\", error);\r\n      toast.error(`Erro ao excluir nota: ${error.message}`);\r\n      setNoteToDelete(null);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    try {\r\n      return format(new Date(dateString), \"dd/MM/yyyy 'às' HH:mm\", { locale: ptBR });\r\n    } catch (error) {\r\n      return \"Data inválida\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header com busca e botão de nova nota */}\r\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\r\n        <div className=\"flex-1 w-full sm:max-w-md\">\r\n          <div className=\"relative\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n            <Input\r\n              placeholder=\"Buscar notas por título ou conteúdo...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              className=\"pl-10 h-11\"\r\n            />\r\n          </div>\r\n        </div>\r\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n          <DialogTrigger asChild>\r\n            <Button\r\n              size=\"lg\"\r\n              className=\"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto\"\r\n              onClick={() => handleOpenDialog(null)}\r\n            >\r\n              <Plus className=\"mr-2 h-5 w-5\" />\r\n              Nova Nota\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent className=\"sm:max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n            <DialogHeader>\r\n              <DialogTitle className=\"text-xl\">\r\n                {editingNote ? \"Editar Nota\" : \"Nova Nota\"}\r\n              </DialogTitle>\r\n              <DialogDescription>\r\n                {editingNote\r\n                  ? \"Edite os detalhes da sua nota\"\r\n                  : \"Crie uma nova nota para suas anotações rápidas\"}\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n\r\n            <div className=\"space-y-6 py-6\">\r\n              <div className=\"space-y-3\">\r\n                <Label htmlFor=\"title\" className=\"text-sm font-medium\">\r\n                  Título*\r\n                </Label>\r\n                <Input\r\n                  id=\"title\"\r\n                  value={title}\r\n                  onChange={(e) => setTitle(e.target.value)}\r\n                  placeholder=\"Ex: Reunião com cliente, Ideias importantes...\"\r\n                  className=\"h-11\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                <Label htmlFor=\"content\" className=\"text-sm font-medium\">\r\n                  Conteúdo\r\n                </Label>\r\n                <Textarea\r\n                  id=\"content\"\r\n                  value={content}\r\n                  onChange={(e) => setContent(e.target.value)}\r\n                  placeholder=\"Escreva suas anotações aqui...\"\r\n                  rows={8}\r\n                  className=\"resize-none\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <DialogFooter className=\"gap-3\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setIsDialogOpen(false);\r\n                  resetForm();\r\n                }}\r\n                disabled={isSubmitting}\r\n              >\r\n                Cancelar\r\n              </Button>\r\n              <Button\r\n                onClick={handleSaveNote}\r\n                disabled={isSubmitting || !title.trim()}\r\n                className=\"bg-blue-600 hover:bg-blue-700\"\r\n              >\r\n                {isSubmitting ? (\r\n                  <>\r\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                    Salvando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <FileText className=\"mr-2 h-4 w-4\" />\r\n                    {editingNote ? \"Atualizar\" : \"Criar\"} Nota\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n\r\n      {/* Lista de notas */}\r\n      {isLoading ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {[1, 2, 3, 4, 5, 6].map((i) => (\r\n            <Card key={i} className=\"animate-pulse\">\r\n              <div className=\"h-48 bg-gray-100 rounded-md\" />\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : filteredNotes.length > 0 ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n          {filteredNotes.map((note) => (\r\n            <Card\r\n              key={note.id}\r\n              className=\"transition-all duration-200 hover:shadow-lg border-0 shadow-sm hover:shadow-xl hover:-translate-y-1 bg-white flex flex-col\"\r\n            >\r\n              <CardHeader className=\"pb-3 flex-shrink-0\">\r\n                <div className=\"flex items-start justify-between gap-3\">\r\n                  <CardTitle className=\"text-lg font-semibold text-slate-900 line-clamp-2 flex-1\">\r\n                    {note.title}\r\n                  </CardTitle>\r\n                  <div className=\"flex gap-1 flex-shrink-0\">\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-8 w-8 p-0 text-slate-600 hover:text-blue-600\"\r\n                      onClick={() => handleOpenDialog(note)}\r\n                    >\r\n                      <Edit3 className=\"h-4 w-4\" />\r\n                    </Button>\r\n                    <AlertDialog>\r\n                      <AlertDialogTrigger asChild>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          className=\"h-8 w-8 p-0 text-slate-600 hover:text-red-600\"\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </AlertDialogTrigger>\r\n                      <AlertDialogContent>\r\n                        <AlertDialogHeader>\r\n                          <AlertDialogTitle>Tem certeza?</AlertDialogTitle>\r\n                          <AlertDialogDescription>\r\n                            Esta ação não pode ser desfeita. Isso excluirá\r\n                            permanentemente a nota \"{note.title}\".\r\n                          </AlertDialogDescription>\r\n                        </AlertDialogHeader>\r\n                        <AlertDialogFooter>\r\n                          <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                          <AlertDialogAction\r\n                            onClick={() => handleDeleteNote(note.id)}\r\n                            className=\"bg-red-600 hover:bg-red-700\"\r\n                          >\r\n                            Sim, excluir\r\n                          </AlertDialogAction>\r\n                        </AlertDialogFooter>\r\n                      </AlertDialogContent>\r\n                    </AlertDialog>\r\n                  </div>\r\n                </div>\r\n              </CardHeader>\r\n              <CardContent className=\"flex-1 flex flex-col pt-0\">\r\n                {note.content ? (\r\n                  <p className=\"text-sm text-slate-600 leading-relaxed line-clamp-6 mb-4 flex-1\">\r\n                    {note.content}\r\n                  </p>\r\n                ) : (\r\n                  <p className=\"text-sm text-slate-400 italic mb-4 flex-1\">\r\n                    Sem conteúdo\r\n                  </p>\r\n                )}\r\n                <div className=\"text-xs text-slate-500 border-t border-slate-100 pt-3 mt-auto\">\r\n                  <div>\r\n                    Criado: {formatDate(note.created_at)}\r\n                  </div>\r\n                  {note.updated_at !== note.created_at && (\r\n                    <div className=\"mt-1\">\r\n                      Atualizado: {formatDate(note.updated_at)}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <Card className=\"text-center py-16\">\r\n          <CardContent>\r\n            <FileText className=\"h-16 w-16 mx-auto text-gray-400 mb-4\" />\r\n            <h3 className=\"text-xl font-medium text-gray-900 mb-2\">\r\n              {searchQuery\r\n                ? \"Nenhuma nota encontrada\"\r\n                : \"Nenhuma nota ainda\"}\r\n            </h3>\r\n            <p className=\"text-gray-500 text-lg mb-4\">\r\n              {searchQuery\r\n                ? \"Tente buscar com outros termos\"\r\n                : \"Comece criando sua primeira nota!\"}\r\n            </p>\r\n            {!searchQuery && (\r\n              <Button\r\n                onClick={() => handleOpenDialog(null)}\r\n                className=\"bg-blue-600 hover:bg-blue-700\"\r\n              >\r\n                <Plus className=\"mr-2 h-4 w-4\" />\r\n                Criar Primeira Nota\r\n              </Button>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Dialog de confirmação com senha administrativa */}\r\n      {hasAdminPwd && (\r\n        <AdminPasswordDialog\r\n          open={showAdminPasswordDialog}\r\n          onOpenChange={(open) => {\r\n            setShowAdminPasswordDialog(open);\r\n            if (!open) {\r\n              setNoteToDelete(null);\r\n            }\r\n          }}\r\n          onConfirm={() => {\r\n            if (noteToDelete) {\r\n              confirmDeleteNote();\r\n            }\r\n          }}\r\n          title=\"Confirmar Exclusão de Nota\"\r\n          description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n          itemName={noteToDelete ? (notes.find(n => n.id === noteToDelete)?.title || \"Nota\") : undefined}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NotesBlock;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\PageLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ParticleBackground.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\PerformanceMonitor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1603,1606],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1603,1606],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Button } from '@/components/ui/button';\r\nimport { \r\n  Activity, \r\n  Database, \r\n  Zap, \r\n  Clock, \r\n  TrendingUp, \r\n  AlertTriangle,\r\n  CheckCircle,\r\n  X\r\n} from 'lucide-react';\r\n\r\ninterface PerformanceMetrics {\r\n  renderTime: number;\r\n  queryTime: number;\r\n  memoryUsed: number;\r\n  connectionPoolSize: number;\r\n  cacheHitRatio: number;\r\n  timestamp: number;\r\n}\r\n\r\ninterface HealthStatus {\r\n  status: 'healthy' | 'warning' | 'critical' | 'unknown';\r\n  issues: string[];\r\n}\r\n\r\ninterface PerformanceMonitorProps {\r\n  isVisible?: boolean;\r\n  onToggle?: () => void;\r\n  isDevelopment?: boolean;\r\n}\r\n\r\nconst PerformanceMonitor: React.FC<PerformanceMonitorProps> = ({\r\n  isVisible = false,\r\n  onToggle,\r\n  isDevelopment = process.env.NODE_ENV === 'development'\r\n}) => {\r\n  const [metrics, setMetrics] = useState<PerformanceMetrics[]>([]);\r\n  const [isCollecting, setIsCollecting] = useState(false);\r\n\r\n  // Coletar métricas de performance\r\n  const collectMetrics = async () => {\r\n    try {\r\n      const startTime = performance.now();\r\n      \r\n      // Simular query ao banco (em produção seria uma query real de monitoramento)\r\n      await new Promise(resolve => setTimeout(resolve, Math.random() * 100));\r\n      \r\n      const queryTime = performance.now() - startTime;\r\n      const renderTime = performance.now();\r\n      \r\n      // Métricas de memória (aproximadas)\r\n      const memoryInfo = (performance as any).memory;\r\n      const memoryUsed = memoryInfo ? memoryInfo.usedJSHeapSize / 1024 / 1024 : 0;\r\n      \r\n      const newMetric: PerformanceMetrics = {\r\n        renderTime: renderTime % 1000, // Simplificado para demo\r\n        queryTime,\r\n        memoryUsed,\r\n        connectionPoolSize: Math.floor(Math.random() * 10) + 5, // Simulado\r\n        cacheHitRatio: Math.random() * 100,\r\n        timestamp: Date.now()\r\n      };\r\n\r\n      setMetrics(prev => {\r\n        const updated = [...prev, newMetric];\r\n        // Manter apenas os últimos 20 registros\r\n        return updated.slice(-20);\r\n      });\r\n    } catch (error) {\r\n      console.error('Error collecting metrics:', error);\r\n    }\r\n  };\r\n\r\n  // Iniciar/parar coleta de métricas\r\n  useEffect(() => {\r\n    let interval: NodeJS.Timeout;\r\n    \r\n    if (isCollecting && isVisible) {\r\n      interval = setInterval(collectMetrics, 2000); // A cada 2 segundos\r\n    }\r\n    \r\n    return () => {\r\n      if (interval) clearInterval(interval);\r\n    };\r\n  }, [isCollecting, isVisible]);\r\n\r\n  // Métricas calculadas\r\n  const currentMetrics = useMemo(() => {\r\n    if (metrics.length === 0) return null;\r\n    \r\n    const latest = metrics[metrics.length - 1];\r\n    const avgQueryTime = metrics.reduce((sum, m) => sum + m.queryTime, 0) / metrics.length;\r\n    const avgMemory = metrics.reduce((sum, m) => sum + m.memoryUsed, 0) / metrics.length;\r\n    \r\n    return {\r\n      ...latest,\r\n      avgQueryTime,\r\n      avgMemory,\r\n      trend: metrics.length > 1 ? \r\n        (latest.queryTime > metrics[metrics.length - 2].queryTime ? 'up' : 'down') : 'stable'\r\n    };\r\n  }, [metrics]);\r\n\r\n  // Status de saúde geral\r\n  const healthStatus: HealthStatus = useMemo(() => {\r\n    if (!currentMetrics) return { status: 'unknown', issues: [] };\r\n    \r\n    const issues = [];\r\n    if (currentMetrics.queryTime > 1000) issues.push('Query lenta');\r\n    if (currentMetrics.memoryUsed > 100) issues.push('Memória alta');\r\n    if (currentMetrics.cacheHitRatio < 70) issues.push('Cache baixo');\r\n    \r\n    if (issues.length === 0) return { status: 'healthy', issues: [] };\r\n    if (issues.length <= 1) return { status: 'warning', issues };\r\n    return { status: 'critical', issues };\r\n  }, [currentMetrics]);\r\n\r\n  // Não mostrar em produção se não for explicitamente habilitado\r\n  if (!isDevelopment && !isVisible) return null;\r\n\r\n  return (\r\n    <div className=\"fixed bottom-4 right-4 z-50\">\r\n      {!isVisible ? (\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          onClick={onToggle}\r\n          className=\"bg-white/90 backdrop-blur-sm border-gray-200 hover:bg-gray-50\"\r\n        >\r\n          <Activity className=\"w-4 h-4 mr-2\" />\r\n          Performance\r\n        </Button>\r\n      ) : (\r\n        <Card className=\"w-80 bg-white/95 backdrop-blur-sm border shadow-lg\">\r\n          <CardHeader className=\"pb-3\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n                <Activity className=\"w-4 h-4\" />\r\n                Monitor de Performance\r\n                {healthStatus.status === 'healthy' && <CheckCircle className=\"w-4 h-4 text-green-500\" />}\r\n                {healthStatus.status === 'warning' && <AlertTriangle className=\"w-4 h-4 text-yellow-500\" />}\r\n                {healthStatus.status === 'critical' && <AlertTriangle className=\"w-4 h-4 text-red-500\" />}\r\n              </CardTitle>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={() => setIsCollecting(!isCollecting)}\r\n                  className={`h-6 px-2 text-xs ${isCollecting ? 'text-green-600' : 'text-gray-500'}`}\r\n                >\r\n                  {isCollecting ? 'Pausar' : 'Iniciar'}\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={onToggle}\r\n                  className=\"h-6 w-6 p-0\"\r\n                >\r\n                  <X className=\"w-3 h-3\" />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          \r\n          <CardContent className=\"pt-0 space-y-3\">\r\n            {/* Status Geral */}\r\n            <div className=\"flex items-center justify-between\">\r\n              <span className=\"text-xs text-gray-600\">Status Geral</span>\r\n              <Badge \r\n                variant={healthStatus.status === 'healthy' ? 'default' : \r\n                        healthStatus.status === 'warning' ? 'secondary' : 'destructive'}\r\n                className=\"text-xs\"\r\n              >\r\n                {healthStatus.status === 'healthy' && 'Saudável'}\r\n                {healthStatus.status === 'warning' && 'Atenção'}\r\n                {healthStatus.status === 'critical' && 'Crítico'}\r\n                {healthStatus.status === 'unknown' && 'Desconhecido'}\r\n              </Badge>\r\n            </div>\r\n\r\n            {/* Problemas encontrados */}\r\n            {healthStatus.issues.length > 0 && (\r\n              <div className=\"text-xs text-red-600 bg-red-50 p-2 rounded\">\r\n                <div className=\"font-medium mb-1\">Problemas detectados:</div>\r\n                <ul className=\"list-disc list-inside space-y-0.5\">\r\n                  {healthStatus.issues.map((issue, index) => (\r\n                    <li key={index}>{issue}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n\r\n            {currentMetrics && (\r\n              <>\r\n                {/* Tempo de Query */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Database className=\"w-3 h-3 text-blue-500\" />\r\n                    <span className=\"text-xs text-gray-600\">Tempo de Query</span>\r\n                  </div>\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <span className=\"text-xs font-mono\">\r\n                      {currentMetrics.queryTime.toFixed(0)}ms\r\n                    </span>\r\n                    {currentMetrics.trend === 'up' && <TrendingUp className=\"w-3 h-3 text-red-500\" />}\r\n                    {currentMetrics.trend === 'down' && <TrendingUp className=\"w-3 h-3 text-green-500 rotate-180\" />}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Memória */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Zap className=\"w-3 h-3 text-yellow-500\" />\r\n                    <span className=\"text-xs text-gray-600\">Memória JS</span>\r\n                  </div>\r\n                  <span className=\"text-xs font-mono\">\r\n                    {currentMetrics.memoryUsed.toFixed(1)}MB\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Cache Hit Ratio */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Clock className=\"w-3 h-3 text-green-500\" />\r\n                    <span className=\"text-xs text-gray-600\">Cache Hit</span>\r\n                  </div>\r\n                  <span className=\"text-xs font-mono\">\r\n                    {currentMetrics.cacheHitRatio.toFixed(0)}%\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Médias */}\r\n                <div className=\"border-t pt-2 space-y-1\">\r\n                  <div className=\"flex justify-between text-xs text-gray-500\">\r\n                    <span>Média Query:</span>\r\n                    <span className=\"font-mono\">{currentMetrics.avgQueryTime.toFixed(0)}ms</span>\r\n                  </div>\r\n                  <div className=\"flex justify-between text-xs text-gray-500\">\r\n                    <span>Média Memória:</span>\r\n                    <span className=\"font-mono\">{currentMetrics.avgMemory.toFixed(1)}MB</span>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Gráfico simples de tendência */}\r\n                <div className=\"border-t pt-2\">\r\n                  <div className=\"text-xs text-gray-600 mb-1\">Tempo de Query (últimos registros)</div>\r\n                  <div className=\"flex items-end gap-0.5 h-8\">\r\n                    {metrics.slice(-10).map((metric, index) => {\r\n                      const height = Math.min((metric.queryTime / 1000) * 100, 100);\r\n                      return (\r\n                        <div\r\n                          key={index}\r\n                          className={`flex-1 rounded-t ${\r\n                            height > 80 ? 'bg-red-400' : \r\n                            height > 50 ? 'bg-yellow-400' : 'bg-green-400'\r\n                          }`}\r\n                          style={{ height: `${Math.max(height, 5)}%` }}\r\n                          title={`${metric.queryTime.toFixed(0)}ms`}\r\n                        />\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              </>\r\n            )}\r\n\r\n            {!currentMetrics && (\r\n              <div className=\"text-center text-xs text-gray-500 py-4\">\r\n                Clique em \"Iniciar\" para começar o monitoramento\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PerformanceMonitor;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ProtectedRoute.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\SentryManager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[636,639],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[636,639],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Loader2, Bug, Eye, AlertTriangle, CheckCircle, Activity, X } from 'lucide-react';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { useSentryMonitoring } from '@/hooks/useSentryMonitoring';\r\nimport * as Sentry from '@sentry/react';\r\n\r\ninterface SentryStatus {\r\n  isInitialized: boolean;\r\n  hasErrors: boolean;\r\n  totalEvents: number;\r\n  recentErrors: any[];\r\n  performance: {\r\n    averageResponseTime: number;\r\n    errorRate: number;\r\n  };\r\n}\r\n\r\nconst SentryManager: React.FC = () => {\r\n  const [sentryStatus, setSentryStatus] = useState<SentryStatus>({\r\n    isInitialized: false,\r\n    hasErrors: false,\r\n    totalEvents: 0,\r\n    recentErrors: [],\r\n    performance: {\r\n      averageResponseTime: 0,\r\n      errorRate: 0\r\n    }\r\n  });\r\n  \r\n  const [isTestingError, setIsTestingError] = useState(false);\r\n  const [isTestingMessage, setIsTestingMessage] = useState(false);\r\n  \r\n  const { trackAction, trackError, trackMessage } = useSentryMonitoring();\r\n\r\n  useEffect(() => {\r\n    // Verificar se Sentry está inicializado\r\n    const isInitialized = !!import.meta.env.VITE_SENTRY_DSN;\r\n    setSentryStatus(prev => ({\r\n      ...prev,\r\n      isInitialized\r\n    }));\r\n  }, []);\r\n\r\n  const handleTestError = async () => {\r\n    setIsTestingError(true);\r\n    try {\r\n      // Simular erro para teste\r\n      const testError = new Error('Erro de teste do Sentry - ignore esta mensagem');\r\n      trackError(testError, {\r\n        test: true,\r\n        timestamp: new Date().toISOString(),\r\n        source: 'sentry_manager'\r\n      });\r\n      \r\n      alert('Erro de teste enviado com sucesso para o Sentry!');\r\n    } catch (error) {\r\n      console.error('Erro ao enviar teste:', error);\r\n    } finally {\r\n      setIsTestingError(false);\r\n    }\r\n  };\r\n\r\n  const handleTestMessage = async () => {\r\n    setIsTestingMessage(true);\r\n    try {\r\n      trackMessage('Mensagem de teste do Sentry', 'info', {\r\n        test: true,\r\n        timestamp: new Date().toISOString(),\r\n        source: 'sentry_manager'\r\n      });\r\n      \r\n      alert('Mensagem de teste enviada com sucesso para o Sentry!');\r\n    } finally {\r\n      setIsTestingMessage(false);\r\n    }\r\n  };\r\n\r\n  const handleTestAction = () => {\r\n    trackAction('test_action', {\r\n      feature: 'sentry_manager',\r\n      timestamp: new Date().toISOString()\r\n    });\r\n    alert('Ação de teste registrada!');\r\n  };\r\n\r\n  const getSentryStatusColor = () => {\r\n    if (!sentryStatus.isInitialized) return 'text-red-600';\r\n    if (sentryStatus.hasErrors) return 'text-yellow-600';\r\n    return 'text-green-600';\r\n  };\r\n\r\n  const getSentryStatusIcon = () => {\r\n    if (!sentryStatus.isInitialized) {\r\n      return <X className=\"h-4 w-4 text-red-600\" />;\r\n    }\r\n    if (sentryStatus.hasErrors) {\r\n      return <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />;\r\n    }\r\n    return <CheckCircle className=\"h-4 w-4 text-green-600\" />;\r\n  };\r\n\r\n  const getSentryStatusText = () => {\r\n    if (!sentryStatus.isInitialized) return 'Desativado';\r\n    if (sentryStatus.hasErrors) return 'Com alertas';\r\n    return 'Funcionando';\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Bug className=\"h-5 w-5\" />\r\n            Monitoramento de Erros (Sentry)\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Sistema de monitoramento automático de erros e performance em tempo real\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {/* Status Geral */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-600\">Status do Sentry</div>\r\n                <div className={`text-lg font-semibold ${getSentryStatusColor()}`}>\r\n                  {getSentryStatusText()}\r\n                </div>\r\n              </div>\r\n              {getSentryStatusIcon()}\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between p-4 bg-blue-50 rounded-lg\">\r\n              <div>\r\n                <div className=\"text-sm text-blue-600\">Ambiente</div>\r\n                <div className=\"text-lg font-semibold text-blue-700\">\r\n                  {import.meta.env.MODE}\r\n                </div>\r\n              </div>\r\n              <Eye className=\"h-4 w-4 text-blue-600\" />\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-between p-4 bg-green-50 rounded-lg\">\r\n              <div>\r\n                <div className=\"text-sm text-green-600\">Versão</div>\r\n                <div className=\"text-lg font-semibold text-green-700\">\r\n                  {import.meta.env.VITE_APP_VERSION || '1.0.0'}\r\n                </div>\r\n              </div>\r\n              <Activity className=\"h-4 w-4 text-green-600\" />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Funcionalidades do Sentry */}\r\n          <div className=\"bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-4\">\r\n            <h4 className=\"text-sm font-semibold text-gray-900 mb-2\">Funcionalidades Ativas:</h4>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs text-gray-700\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Captura automática de erros</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Monitoramento de performance</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Rastreamento de usuários</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Breadcrumbs de navegação</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Filtros inteligentes</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <CheckCircle className=\"h-3 w-3 text-green-500\" />\r\n                <span>Release tracking</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Informações de Configuração */}\r\n          <div className=\"space-y-2\">\r\n            <h4 className=\"text-sm font-semibold text-gray-900\">Configurações:</h4>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-xs\">\r\n              <div className=\"space-y-1\">\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">DSN Configurado:</span>\r\n                  <Badge variant={import.meta.env.VITE_SENTRY_DSN ? 'default' : 'secondary'}>\r\n                    {import.meta.env.VITE_SENTRY_DSN ? 'Sim' : 'Padrão'}\r\n                  </Badge>\r\n                </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">Sample Rate:</span>\r\n                  <Badge variant=\"outline\">\r\n                    {import.meta.env.MODE === 'production' ? '10%' : '100%'}\r\n                  </Badge>\r\n                </div>\r\n              </div>\r\n              \r\n              <div className=\"space-y-1\">\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">Error Boundaries:</span>\r\n                  <Badge variant=\"default\">Ativo</Badge>\r\n                </div>\r\n                <div className=\"flex justify-between\">\r\n                  <span className=\"text-gray-600\">Session Tracking:</span>\r\n                  <Badge variant=\"default\">Ativo</Badge>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Alertas */}\r\n          {!sentryStatus.isInitialized && (\r\n            <Alert>\r\n              <AlertTriangle className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                <strong>Sentry não inicializado:</strong> Configure a variável VITE_SENTRY_DSN para ativar o monitoramento completo.\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n\r\n          {import.meta.env.MODE === 'development' && (\r\n            <Alert>\r\n              <AlertTriangle className=\"h-4 w-4\" />\r\n              <AlertDescription>\r\n                <strong>Modo desenvolvimento:</strong> O Sentry está configurado para capturar 100% dos eventos.\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Ações de Teste */}\r\n          <div className=\"pt-4 border-t\">\r\n            <h4 className=\"text-sm font-semibold text-gray-900 mb-3\">Testar Funcionalidades:</h4>\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={handleTestError}\r\n                disabled={isTestingError}\r\n                className=\"flex items-center gap-2\"\r\n              >\r\n                {isTestingError ? (\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <Bug className=\"h-4 w-4\" />\r\n                )}\r\n                Testar Erro\r\n              </Button>\r\n              \r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={handleTestMessage}\r\n                disabled={isTestingMessage}\r\n                className=\"flex items-center gap-2\"\r\n              >\r\n                {isTestingMessage ? (\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                ) : (\r\n                  <Activity className=\"h-4 w-4\" />\r\n                )}\r\n                Testar Mensagem\r\n              </Button>\r\n              \r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={handleTestAction}\r\n                className=\"flex items-center gap-2\"\r\n              >\r\n                <Eye className=\"h-4 w-4\" />\r\n                Testar Ação\r\n              </Button>\r\n            </div>\r\n            \r\n            <p className=\"text-xs text-gray-500 mt-2\">\r\n              ℹ️ Os testes são marcados como 'test: true' para fácil identificação no painel do Sentry\r\n            </p>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Benefícios do Monitoramento */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-sm\">Benefícios do Monitoramento</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n            <div className=\"space-y-2\">\r\n              <h5 className=\"font-semibold text-gray-900\">Para Desenvolvedores:</h5>\r\n              <ul className=\"space-y-1 text-gray-600\">\r\n                <li>• Detecção automática de erros</li>\r\n                <li>• Stack traces completos</li>\r\n                <li>• Context de usuário e navegador</li>\r\n                <li>• Performance monitoring</li>\r\n              </ul>\r\n            </div>\r\n            \r\n            <div className=\"space-y-2\">\r\n              <h5 className=\"font-semibold text-gray-900\">Para o Negócio:</h5>\r\n              <ul className=\"space-y-1 text-gray-600\">\r\n                <li>• Maior estabilidade da aplicação</li>\r\n                <li>• Resolução proativa de problemas</li>\r\n                <li>• Melhor experiência do usuário</li>\r\n                <li>• Dados para otimização</li>\r\n              </ul>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Instruções de Configuração */}\r\n      {!import.meta.env.VITE_SENTRY_DSN && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"text-sm\">Como Configurar</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"space-y-3 text-sm\">\r\n              <div>\r\n                <p className=\"font-medium\">1. Criar projeto no Sentry:</p>\r\n                <p className=\"text-gray-600\">Acesse sentry.io e crie um novo projeto React</p>\r\n              </div>\r\n              \r\n              <div>\r\n                <p className=\"font-medium\">2. Configurar variável de ambiente:</p>\r\n                <div className=\"bg-gray-100 p-2 rounded font-mono text-xs\">\r\n                  VITE_SENTRY_DSN=https://your-key@sentry.io/project-id\r\n                </div>\r\n              </div>\r\n              \r\n              <div>\r\n                <p className=\"font-medium\">3. Fazer deploy:</p>\r\n                <p className=\"text-gray-600\">O Sentry será ativado automaticamente em produção</p>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SentryManager; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\StickyQuickNote.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3830,3833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3830,3833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'normalizeNote'. Either include it or remove the dependency array.","line":123,"column":5,"nodeType":"ArrayExpression","endLine":123,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [ensureUuid, normalizeNote]","fix":{"range":[4461,4473],"text":"[ensureUuid, normalizeNote]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'normalizeNote'. Either include it or remove the dependency array.","line":174,"column":6,"nodeType":"ArrayExpression","endLine":174,"endColumn":64,"suggestions":[{"desc":"Update the dependencies array to be: [createDefaultNote, hasUser, fetchRemoteNotes, ensureUuid, normalizeNote]","fix":{"range":[6527,6585],"text":"[createDefaultNote, hasUser, fetchRemoteNotes, ensureUuid, normalizeNote]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":218,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":218,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8062,8065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8062,8065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has missing dependencies: 'clampWidth' and 'notes'. Either include them or remove the dependency array.","line":348,"column":6,"nodeType":"ArrayExpression","endLine":348,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [clampPos, clampWidth, notes]","fix":{"range":[12859,12869],"text":"[clampPos, clampWidth, notes]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":467,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":467,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16862,16865],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16862,16865],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":492,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":492,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17757,17760],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17757,17760],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useState, useCallback, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { StickyNote, Minimize2, Plus, Save, Trash2 } from \"lucide-react\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst STORAGE_NOTES_KEY = \"quickNotesDataV1\";\r\nconst EDGE_PADDING = 0; // encostar o máximo na direita\r\nconst NOTE_WIDTH = 320;\r\nconst MIN_WIDTH = 240;\r\nconst MAX_WIDTH = 520;\r\nconst DEFAULT_HEIGHT = 260;\r\nconst MIN_HEIGHT = 180;\r\nconst MAX_HEIGHT = 600;\r\nconst STACK_GAP = 32;\r\nconst STICKY_TABLE = \"sticky_notes\";\r\n\r\ntype QuickNote = {\r\n  id: string; // deve ser UUID (tabela Supabase usa uuid)\r\n  content: string;\r\n  right?: number; // distância até a borda direita (preferencial)\r\n  x?: number; // legado\r\n  y: number;\r\n  height?: number;\r\n  width?: number;\r\n  minimized: boolean;\r\n};\r\n\r\n/**\r\n * Notas rápidas ao estilo \"sticky note\", fixadas na lateral direita,\r\n * com opção de minimizar e múltiplos blocos. Conteúdo salvo em localStorage\r\n * e opção de salvar uma nota no bloco principal (Supabase).\r\n */\r\nconst StickyQuickNote: React.FC = () => {\r\n  const [notes, setNotes] = useState<QuickNote[]>([]);\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [hasUser, setHasUser] = useState<boolean | null>(null);\r\n  const [userId, setUserId] = useState<string | null>(null);\r\n  const channelRef = useRef<ReturnType<typeof supabase.channel> | null>(null);\r\n  const dragStart = useRef<{ id: string; offsetX: number; offsetY: number } | null>(null);\r\n  const resizeStart = useRef<{ id: string; startX: number; startY: number; startHeight: number; startWidth: number } | null>(null);\r\n\r\n  const generateId = useCallback(() => {\r\n    if (typeof crypto !== \"undefined\" && crypto.randomUUID) {\r\n      return crypto.randomUUID();\r\n    }\r\n    return `note-${Date.now()}-${Math.random().toString(16).slice(2)}`;\r\n  }, []);\r\n\r\n  const ensureUuid = useCallback(\r\n    (id: string) => {\r\n      const uuidRegex =\r\n        /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\r\n      return uuidRegex.test(id) ? id : generateId();\r\n    },\r\n    [generateId]\r\n  );\r\n\r\n  const createDefaultNote = useCallback((): QuickNote => {\r\n    if (typeof window === \"undefined\") {\r\n      return { id: generateId(), content: \"\", minimized: false, right: EDGE_PADDING, y: 16, height: DEFAULT_HEIGHT, width: NOTE_WIDTH };\r\n    }\r\n    const noteHeight = DEFAULT_HEIGHT;\r\n    return {\r\n      id: generateId(),\r\n      content: \"\",\r\n      minimized: false,\r\n      right: Math.max(EDGE_PADDING, EDGE_PADDING),\r\n      y: Math.max(window.innerHeight - noteHeight - EDGE_PADDING, EDGE_PADDING),\r\n      height: DEFAULT_HEIGHT,\r\n      width: NOTE_WIDTH,\r\n    };\r\n  }, [generateId]);\r\n\r\n  // Carregar estado salvo\r\n  // Detectar usuário logado; só renderizar quando logado\r\n  useEffect(() => {\r\n    let active = true;\r\n    supabase.auth.getUser().then(({ data }) => {\r\n      if (!active) return;\r\n      setHasUser(!!data?.user);\r\n      setUserId(data?.user?.id ?? null);\r\n    });\r\n    const { data: sub } = supabase.auth.onAuthStateChange((_event, session) => {\r\n      setHasUser(!!session?.user);\r\n      setUserId(session?.user?.id ?? null);\r\n    });\r\n    return () => {\r\n      active = false;\r\n      sub?.subscription?.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  // Função para buscar notas no Supabase\r\n  const fetchRemoteNotes = useCallback(\r\n    async (uid: string) => {\r\n      const { data, error } = await supabase\r\n        .from(STICKY_TABLE)\r\n        .select(\"id, content, right, y, width, height, minimized\")\r\n        .eq(\"user_id\", uid)\r\n        .order(\"created_at\", { ascending: true });\r\n\r\n      if (!error && data) {\r\n        return data.map((n: any) =>\r\n          normalizeNote({\r\n            id: ensureUuid(n.id),\r\n            content: n.content || \"\",\r\n            right: typeof n.right === \"number\" ? n.right : EDGE_PADDING,\r\n            y: typeof n.y === \"number\" ? n.y : EDGE_PADDING,\r\n            width: typeof n.width === \"number\" ? n.width : NOTE_WIDTH,\r\n            height: typeof n.height === \"number\" ? n.height : DEFAULT_HEIGHT,\r\n            minimized: !!n.minimized,\r\n          })\r\n        ) as QuickNote[];\r\n      }\r\n      if (error) {\r\n        console.warn(\"Falha ao buscar notas rápidas no Supabase:\", error.message);\r\n      }\r\n      return null;\r\n    },\r\n    [ensureUuid]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!hasUser) return; // só carrega para usuários logados\r\n    const load = async () => {\r\n      try {\r\n        // Tenta carregar do Supabase (sincronizado entre dispositivos)\r\n        const { data: userData } = await supabase.auth.getUser();\r\n        if (userData?.user) {\r\n          const remote = await fetchRemoteNotes(userData.user.id);\r\n          if (remote) {\r\n            setNotes(remote); // pode ser [] se usuário quiser nenhuma nota\r\n            setIsLoaded(true);\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Fallback: carregar do localStorage (inclusive array vazio)\r\n        const saved = localStorage.getItem(STORAGE_NOTES_KEY);\r\n        if (saved) {\r\n          const parsed = JSON.parse(saved) as QuickNote[];\r\n          const hydrated = parsed.map((n) => {\r\n            const safeId = ensureUuid(n.id);\r\n            if (typeof n.right === \"number\") {\r\n              return normalizeNote({ ...n, id: safeId, width: n.width ?? NOTE_WIDTH, height: n.height ?? DEFAULT_HEIGHT });\r\n            }\r\n            if (typeof window !== \"undefined\") {\r\n              const width = n.width ?? NOTE_WIDTH;\r\n              const left = typeof n.x === \"number\" ? n.x : window.innerWidth - width - EDGE_PADDING;\r\n              const right = Math.max(EDGE_PADDING, window.innerWidth - width - left);\r\n              return normalizeNote({ ...n, id: safeId, right, height: n.height ?? DEFAULT_HEIGHT, width });\r\n            }\r\n            return normalizeNote({ ...n, id: safeId, right: EDGE_PADDING, height: n.height ?? DEFAULT_HEIGHT, width: n.width ?? NOTE_WIDTH });\r\n          });\r\n          setNotes(hydrated);\r\n          setIsLoaded(true);\r\n          return;\r\n        }\r\n\r\n        // Estado inicial: uma nota no canto inferior direito\r\n        setNotes([createDefaultNote()]);\r\n        setIsLoaded(true);\r\n      } catch (error) {\r\n        console.error(\"Erro ao carregar nota rápida:\", error);\r\n        setNotes([createDefaultNote()]);\r\n        setIsLoaded(true);\r\n      }\r\n    };\r\n\r\n    load();\r\n  }, [createDefaultNote, hasUser, fetchRemoteNotes, ensureUuid]);\r\n\r\n  // Persistir estado\r\n  // Salvar em localStorage e Supabase (quando possível)\r\n  useEffect(() => {\r\n    if (!isLoaded || !hasUser || !userId) return;\r\n\r\n    // Garantir que todos os IDs são UUID antes de salvar\r\n    const sanitized = notes.map((n) => ({ ...n, id: ensureUuid(n.id) }));\r\n    const changed =\r\n      sanitized.length !== notes.length ||\r\n      sanitized.some((n, idx) => n.id !== notes[idx].id);\r\n    if (changed) {\r\n      setNotes(sanitized);\r\n      return; // salvar na próxima execução com estado já saneado\r\n    }\r\n\r\n    try {\r\n      localStorage.setItem(STORAGE_NOTES_KEY, JSON.stringify(notes));\r\n    } catch (error) {\r\n      console.error(\"Erro ao salvar nota rápida local:\", error);\r\n    }\r\n\r\n    const saveCloud = async () => {\r\n      try {\r\n        if (sanitized.length === 0) {\r\n          // nada para upsert; última exclusão já removeu no Supabase\r\n          return;\r\n        }\r\n        const payload = sanitized.map((n) => ({\r\n          id: n.id,\r\n          user_id: userId,\r\n          content: n.content ?? \"\",\r\n          right: n.right ?? EDGE_PADDING,\r\n          y: n.y,\r\n          width: n.width ?? NOTE_WIDTH,\r\n          height: n.height ?? DEFAULT_HEIGHT,\r\n          minimized: n.minimized ?? false,\r\n        }));\r\n\r\n        const { error } = await supabase.from(STICKY_TABLE).upsert(payload);\r\n        if (error) {\r\n          console.warn(\"Falha ao salvar notas rápidas no Supabase:\", error.message);\r\n        }\r\n      } catch (error: any) {\r\n        console.warn(\"Erro ao salvar notas rápidas no Supabase:\", error?.message || error);\r\n      }\r\n    };\r\n\r\n    saveCloud();\r\n  }, [notes, isLoaded, hasUser, userId, ensureUuid]);\r\n\r\n  // Realtime: atualizar quando outro device alterar\r\n  useEffect(() => {\r\n    if (!hasUser || !userId) return;\r\n\r\n    // Evitar múltiplas inscrições: remove canal anterior antes de criar outro\r\n    if (channelRef.current) {\r\n      supabase.removeChannel(channelRef.current);\r\n      channelRef.current = null;\r\n    }\r\n\r\n    const channel = supabase\r\n      .channel(`sticky-notes-${userId}-${Date.now()}`)\r\n      .on(\r\n        \"postgres_changes\",\r\n        { event: \"*\", schema: \"public\", table: STICKY_TABLE, filter: `user_id=eq.${userId}` },\r\n        async () => {\r\n          const remote = await fetchRemoteNotes(userId);\r\n          if (remote) setNotes(remote);\r\n          else setNotes([]);\r\n        }\r\n      )\r\n      .subscribe();\r\n    channelRef.current = channel;\r\n\r\n    return () => {\r\n      if (channelRef.current) {\r\n        supabase.removeChannel(channelRef.current);\r\n        channelRef.current = null;\r\n      } else {\r\n        supabase.removeChannel(channel);\r\n      }\r\n    };\r\n  }, [hasUser, userId, fetchRemoteNotes]);\r\n\r\n  // Atualizar ao focar a janela\r\n  useEffect(() => {\r\n    if (!hasUser || !userId) return;\r\n    const handler = async () => {\r\n      const remote = await fetchRemoteNotes(userId);\r\n      if (remote) setNotes(remote);\r\n      else setNotes([]);\r\n    };\r\n    window.addEventListener(\"focus\", handler);\r\n    return () => window.removeEventListener(\"focus\", handler);\r\n  }, [hasUser, userId, fetchRemoteNotes]);\r\n\r\n  const clampHeight = useCallback(\r\n    (height: number) => Math.min(Math.max(height, MIN_HEIGHT), MAX_HEIGHT),\r\n    []\r\n  );\r\n\r\n  const clampWidth = useCallback((width: number) => {\r\n    if (typeof window === \"undefined\") return Math.min(Math.max(width, MIN_WIDTH), MAX_WIDTH);\r\n    const maxAllowed = Math.min(MAX_WIDTH, Math.max(MIN_WIDTH, window.innerWidth - 40));\r\n    return Math.min(Math.max(width, MIN_WIDTH), maxAllowed);\r\n  }, []);\r\n\r\n  const clampPos = useCallback(\r\n    (right: number, y: number, minimized: boolean, height?: number, width?: number) => {\r\n      if (typeof window === \"undefined\") return { right, y };\r\n      const noteHeight = minimized ? 44 : (height ?? DEFAULT_HEIGHT);\r\n      const noteWidth = clampWidth(width ?? NOTE_WIDTH);\r\n      const maxY = Math.max(window.innerHeight - noteHeight - EDGE_PADDING, EDGE_PADDING);\r\n      const maxRight = Math.max(window.innerWidth - noteWidth - EDGE_PADDING, EDGE_PADDING);\r\n      return {\r\n        right: Math.min(Math.max(right, EDGE_PADDING), maxRight),\r\n        y: Math.min(Math.max(y, EDGE_PADDING), maxY),\r\n      };\r\n    },\r\n    [clampWidth]\r\n  );\r\n\r\n  const normalizeNote = useCallback(\r\n    (note: QuickNote): QuickNote => {\r\n      const width = clampWidth(note.width ?? NOTE_WIDTH);\r\n      const height = clampHeight(note.height ?? DEFAULT_HEIGHT);\r\n      const preferredRight = typeof note.right === \"number\" ? note.right : EDGE_PADDING;\r\n      const snapRight = preferredRight <= EDGE_PADDING + 8 ? EDGE_PADDING : preferredRight;\r\n      const { right, y } = clampPos(snapRight, note.y ?? EDGE_PADDING, note.minimized, height, width);\r\n      return {\r\n        ...note,\r\n        id: ensureUuid(note.id),\r\n        width,\r\n        height,\r\n        right,\r\n        y,\r\n      };\r\n    },\r\n    [clampHeight, clampPos, clampWidth, ensureUuid]\r\n  );\r\n\r\n  const startDrag = (id: string, clientX: number, clientY: number) => {\r\n    const note = notes.find((n) => n.id === id);\r\n    if (!note) return;\r\n    if (typeof window === \"undefined\") return;\r\n    const width = clampWidth(note.width ?? NOTE_WIDTH);\r\n    const currentRight = note.right ?? EDGE_PADDING;\r\n    const currentLeft = window.innerWidth - width - currentRight;\r\n    dragStart.current = {\r\n      id,\r\n      offsetX: clientX - currentLeft,\r\n      offsetY: clientY - note.y,\r\n    };\r\n    window.addEventListener(\"mousemove\", handleMouseMove);\r\n    window.addEventListener(\"mouseup\", handleMouseUp);\r\n  };\r\n\r\n  const handleMouseMove = useCallback((e: MouseEvent) => {\r\n    if (!dragStart.current) return;\r\n    if (typeof window === \"undefined\") return;\r\n    const nextLeft = e.clientX - dragStart.current.offsetX;\r\n    const nextY = e.clientY - dragStart.current.offsetY;\r\n    const movingNote = notes.find((n) => n.id === dragStart.current?.id);\r\n    const width = clampWidth(movingNote?.width ?? NOTE_WIDTH);\r\n    const nextRight = window.innerWidth - width - nextLeft;\r\n    setNotes((prev) =>\r\n      prev.map((n) => {\r\n        if (n.id !== dragStart.current?.id) return n;\r\n        const clamped = clampPos(nextRight, nextY, n.minimized, n.height, n.width);\r\n        return { ...n, ...clamped };\r\n      })\r\n    );\r\n  }, [clampPos]);\r\n\r\n  const handleMouseUp = useCallback(() => {\r\n    dragStart.current = null;\r\n    window.removeEventListener(\"mousemove\", handleMouseMove);\r\n    window.removeEventListener(\"mouseup\", handleMouseUp);\r\n  }, [handleMouseMove]);\r\n\r\n  const startResize = (id: string, clientX: number, clientY: number) => {\r\n    const note = notes.find((n) => n.id === id);\r\n    if (!note || note.minimized) return;\r\n    resizeStart.current = {\r\n      id,\r\n      startX: clientX,\r\n      startY: clientY,\r\n      startHeight: note.height ?? DEFAULT_HEIGHT,\r\n      startWidth: clampWidth(note.width ?? NOTE_WIDTH),\r\n    };\r\n    window.addEventListener(\"mousemove\", handleResize);\r\n    window.addEventListener(\"mouseup\", stopResize);\r\n  };\r\n\r\n  const handleResize = useCallback(\r\n    (e: MouseEvent) => {\r\n      if (!resizeStart.current) return;\r\n      const deltaY = e.clientY - resizeStart.current.startY;\r\n      const deltaX = e.clientX - resizeStart.current.startX;\r\n      const newHeight = clampHeight(resizeStart.current.startHeight + deltaY);\r\n      const newWidth = clampWidth(resizeStart.current.startWidth - deltaX); // arrastar para esquerda aumenta\r\n      setNotes((prev) =>\r\n        prev.map((n) =>\r\n          n.id === resizeStart.current?.id ? { ...n, height: newHeight, width: newWidth } : n\r\n        )\r\n      );\r\n    },\r\n    [clampHeight, clampWidth]\r\n  );\r\n\r\n  const stopResize = useCallback(() => {\r\n    resizeStart.current = null;\r\n    window.removeEventListener(\"mousemove\", handleResize);\r\n    window.removeEventListener(\"mouseup\", stopResize);\r\n  }, [handleResize]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      window.removeEventListener(\"mousemove\", handleMouseMove);\r\n      window.removeEventListener(\"mouseup\", handleMouseUp);\r\n      window.removeEventListener(\"mousemove\", handleResize);\r\n      window.removeEventListener(\"mouseup\", stopResize);\r\n    };\r\n  }, [handleMouseMove, handleMouseUp, handleResize, stopResize]);\r\n\r\n  const addNote = () => {\r\n    setNotes((prev) => {\r\n      const baseRight =\r\n        prev.length && typeof prev[prev.length - 1].right === \"number\"\r\n          ? prev[prev.length - 1].right!\r\n          : createDefaultNote().right ?? EDGE_PADDING;\r\n\r\n      const maxBottom = prev.length\r\n        ? Math.max(\r\n            ...prev.map((n) => {\r\n              const h = n.minimized ? 44 : n.height ?? DEFAULT_HEIGHT;\r\n              return (n.y ?? EDGE_PADDING) + h;\r\n            })\r\n          )\r\n        : createDefaultNote().y + (createDefaultNote().height ?? DEFAULT_HEIGHT);\r\n\r\n      const nextY = maxBottom + STACK_GAP;\r\n\r\n      const next = {\r\n        id: generateId(),\r\n        content: \"\",\r\n        minimized: false,\r\n        height: DEFAULT_HEIGHT,\r\n        width: NOTE_WIDTH,\r\n        ...clampPos(baseRight, nextY, false, DEFAULT_HEIGHT, NOTE_WIDTH),\r\n      };\r\n      return [...prev, next];\r\n    });\r\n  };\r\n\r\n  const updateContent = (id: string, value: string) => {\r\n    setNotes((prev) => prev.map((n) => (n.id === id ? { ...n, content: value } : n)));\r\n  };\r\n\r\n  const toggleMinimize = (id: string, minimized: boolean) => {\r\n    setNotes((prev) =>\r\n      prev.map((n) =>\r\n        n.id === id\r\n          ? {\r\n              ...n,\r\n              minimized,\r\n              ...clampPos(\r\n                n.right ?? EDGE_PADDING,\r\n                n.y,\r\n                minimized,\r\n                n.height,\r\n                n.width\r\n              ),\r\n            }\r\n          : n\r\n      )\r\n    );\r\n  };\r\n\r\n  const deleteNote = async (id: string) => {\r\n    setNotes((prev) => prev.filter((n) => n.id !== id));\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData?.user) return;\r\n      const { error } = await supabase.from(STICKY_TABLE).delete().eq(\"id\", id).eq(\"user_id\", userData.user.id);\r\n      if (error) {\r\n        toast.error(\"Erro ao excluir nota rápida (Supabase).\");\r\n        const remote = await fetchRemoteNotes(userData.user.id);\r\n        if (remote) setNotes(remote);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao excluir nota rápida:\", error);\r\n    }\r\n  };\r\n\r\n  const saveToNotes = async (note: QuickNote) => {\r\n    if (!note.content.trim()) {\r\n      toast.error(\"Escreva algo antes de salvar nas notas.\");\r\n      return;\r\n    }\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n      if (!userData.user) throw new Error(\"Usuário não autenticado\");\r\n\r\n      const title = note.content.trim().slice(0, 40) || \"Nota rápida\";\r\n      const { error } = await supabase.from(\"notes\").insert({\r\n        title,\r\n        content: note.content.trim(),\r\n        user_id: userData.user.id,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n      });\r\n      if (error) throw error;\r\n      toast.success(\"Salvo em Notas com sucesso!\");\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao salvar em Notas:\", error);\r\n      toast.error(error.message || \"Erro ao salvar em Notas\");\r\n    }\r\n  };\r\n\r\n  // Minimizar ao clicar fora de qualquer bloco\r\n  useEffect(() => {\r\n    const handleOutside = (e: MouseEvent) => {\r\n      const target = e.target as HTMLElement | null;\r\n      if (!target) return;\r\n      if (target.closest(\"[data-sticky-note]\")) return;\r\n      if (target.closest(\"[data-sticky-trigger]\")) return;\r\n      setNotes((prev) => prev.map((n) => ({ ...n, minimized: true })));\r\n    };\r\n    document.addEventListener(\"mousedown\", handleOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleOutside);\r\n  }, []);\r\n\r\n  if (!hasUser) return null;\r\n\r\n  const portalRoot = typeof document !== \"undefined\" ? document.body : null;\r\n\r\n  const content = (\r\n    <>\r\n      <button\r\n        className=\"fixed right-3 bottom-3 z-[9999] bg-amber-400 text-amber-900 shadow-lg rounded-full p-2 hover:bg-amber-300 transition-colors border border-amber-500\"\r\n        style={{ pointerEvents: \"auto\" }}\r\n        onMouseDownCapture={(e) => {\r\n          e.stopPropagation();\r\n        }}\r\n        onClick={() => {\r\n          if (!notes.length) {\r\n            setNotes([createDefaultNote()]);\r\n            return;\r\n          }\r\n          addNote();\r\n        }}\r\n        title=\"Novo bloco rápido\"\r\n        data-sticky-trigger\r\n      >\r\n        <Plus className=\"h-5 w-5\" />\r\n      </button>\r\n\r\n      {notes.map((note) =>\r\n        note.minimized ? (\r\n          <button\r\n            key={note.id}\r\n            aria-label=\"Abrir nota rápida\"\r\n            onMouseDownCapture={(e) => {\r\n              e.stopPropagation();\r\n            }}\r\n            onClick={() => toggleMinimize(note.id, false)}\r\n            onMouseDown={(e) => {\r\n              startDrag(note.id, e.clientX, e.clientY);\r\n              e.stopPropagation();\r\n            }}\r\n            style={{ right: note.right ?? EDGE_PADDING, top: note.y, pointerEvents: \"auto\" }}\r\n            className=\"fixed z-[9999] bg-amber-100 text-amber-800 border border-amber-200 shadow-lg rounded-full px-3 py-2 hover:bg-amber-50 transition-colors cursor-move flex items-center gap-2 text-sm font-medium\"\r\n            data-sticky-note\r\n          >\r\n            <StickyNote className=\"h-4 w-4\" />\r\n            Nota rápida\r\n          </button>\r\n        ) : (\r\n          <div\r\n            key={note.id}\r\n            className=\"fixed z-[9999] bg-amber-50 border border-amber-200 shadow-2xl rounded-2xl overflow-hidden ring-1 ring-amber-200/60 cursor-move\"\r\n            style={{ right: note.right ?? EDGE_PADDING, top: note.y, width: clampWidth(note.width ?? NOTE_WIDTH), pointerEvents: \"auto\" }}\r\n            onMouseDownCapture={(e) => {\r\n              e.stopPropagation();\r\n            }}\r\n            onMouseDown={(e) => {\r\n              startDrag(note.id, e.clientX, e.clientY);\r\n              e.stopPropagation();\r\n            }}\r\n            data-sticky-note\r\n          >\r\n            <div className=\"flex items-center justify-between px-4 py-3 bg-amber-100 border-b border-amber-200\">\r\n              <div className=\"flex items-center gap-2 text-amber-900\">\r\n                <div className=\"p-2 bg-amber-200 rounded-lg\">\r\n                  <StickyNote className=\"h-4 w-4\" />\r\n                </div>\r\n                <span className=\"font-semibold text-sm\">Nota rápida</span>\r\n              </div>\r\n              <div className=\"flex items-center gap-1\">\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className=\"h-8 w-8 text-amber-800 hover:bg-amber-200/60 cursor-pointer\"\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    deleteNote(note.id);\r\n                  }}\r\n                  title=\"Excluir bloco\"\r\n                >\r\n                  <Trash2 className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className=\"h-8 w-8 text-amber-800 hover:bg-amber-200/60 cursor-pointer\"\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    saveToNotes(note);\r\n                  }}\r\n                  title=\"Salvar em Notas\"\r\n                >\r\n                  <Save className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className=\"h-8 w-8 text-amber-800 hover:bg-amber-200/60 cursor-pointer\"\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    toggleMinimize(note.id, true);\r\n                  }}\r\n                  title=\"Minimizar\"\r\n                >\r\n                  <Minimize2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"p-4\">\r\n              <Textarea\r\n                value={note.content}\r\n                onChange={(e) => updateContent(note.id, e.target.value)}\r\n                rows={8}\r\n                className=\"bg-white/80 border-amber-200 focus-visible:ring-amber-300 text-amber-900 placeholder:text-amber-500 resize-none cursor-text\"\r\n                placeholder=\"Escreva aqui... (salva automaticamente)\"\r\n                onMouseDown={(e) => e.stopPropagation()}\r\n                style={{ minHeight: 120, height: Math.max(120, (note.height ?? DEFAULT_HEIGHT) - 100) }}\r\n              />\r\n              <div\r\n                className=\"mt-2 w-full flex justify-end\"\r\n                onMouseDown={(e) => {\r\n                  e.stopPropagation();\r\n                  startResize(note.id, e.clientX, e.clientY);\r\n                }}\r\n                onMouseUp={(e) => e.stopPropagation()}\r\n                onClick={(e) => e.stopPropagation()}\r\n              >\r\n                <div\r\n                  className=\"h-4 w-8 cursor-nwse-resize text-amber-700 text-sm select-none flex items-center justify-center\"\r\n                  title=\"Arraste para redimensionar largura/altura\"\r\n                >\r\n                  ↔↕\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )\r\n      )}\r\n    </>\r\n  );\r\n\r\n  return portalRoot ? createPortal(content, portalRoot) : content;\r\n};\r\n\r\nexport default StickyQuickNote;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\SupportButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\TrialBanner.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\TypewriterText.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\WhatsAppButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\WhiteLabelSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\CommissionRateForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2610,2613],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2610,2613],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { CommissionRate } from \"@/types/models\";\r\n\r\nconst formSchema = z.object({\r\n  product: z.string().min(1, { message: \"Produto é obrigatório\" }),\r\n  name: z.string().min(1, { message: \"Nome é obrigatório\" }),\r\n  percentage: z.string().min(1, { message: \"Percentual é obrigatório\" }),\r\n});\r\n\r\ninterface CommissionRateFormProps {\r\n  initialData?: CommissionRate | null;\r\n  onCancel: () => void;\r\n  onSave: () => void;\r\n}\r\n\r\nexport default function CommissionRateForm({ initialData, onCancel, onSave }: CommissionRateFormProps) {\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      product: initialData?.product || \"\",\r\n      name: initialData?.name || \"\",\r\n      percentage: initialData ? String(initialData.percentage) : \"\",\r\n    },\r\n  });\r\n\r\n  const onSubmit = async (values: z.infer<typeof formSchema>) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      \r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n      \r\n      const commissionData = {\r\n        product: values.product,\r\n        name: values.name,\r\n        percentage: parseFloat(values.percentage.replace(\",\", \".\")),\r\n        user_id: userData.user.id,\r\n        active: initialData?.active !== undefined ? initialData.active : true,\r\n      };\r\n      \r\n      if (initialData?.id) {\r\n        // Update existing rate\r\n        const { error } = await supabase\r\n          .from(\"commission_rates\")\r\n          .update(commissionData)\r\n          .eq(\"id\", initialData.id);\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Taxa de comissão atualizada com sucesso\");\r\n      } else {\r\n        // Insert new rate\r\n        const { error } = await supabase\r\n          .from(\"commission_rates\")\r\n          .insert(commissionData);\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Taxa de comissão criada com sucesso\");\r\n      }\r\n      \r\n      onSave();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving commission rate:\", error);\r\n      toast.error(`Erro ao salvar taxa de comissão: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Form {...form}>\r\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\r\n        <FormField\r\n          control={form.control}\r\n          name=\"product\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Produto</FormLabel>\r\n              <FormControl>\r\n                <Input placeholder=\"Ex: Portabilidade, Crefaz, Novo, etc.\" {...field} />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"name\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Nome da Taxa</FormLabel>\r\n              <FormControl>\r\n                <Input placeholder=\"Ex: Taxa padrão, Taxa premium, etc.\" {...field} />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"percentage\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Percentual (%)</FormLabel>\r\n              <FormControl>\r\n                <Input \r\n                  placeholder=\"Ex: 2.5\" \r\n                  {...field} \r\n                  onChange={(e) => {\r\n                    // Allow only numbers and a single comma or dot\r\n                    const value = e.target.value.replace(/[^\\d.,]/g, \"\");\r\n                    // Replace the last dot or comma with the current one\r\n                    const formatted = value.replace(/[.,]/g, (match, index, str) => {\r\n                      return index === str.lastIndexOf(match) ? match : \"\";\r\n                    });\r\n                    field.onChange(formatted);\r\n                  }}\r\n                />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4\">\r\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n            Cancelar\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting}>\r\n            {isSubmitting ? \"Salvando...\" : initialData ? \"Atualizar\" : \"Salvar\"}\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </Form>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\CommissionTierForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3316,3319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3316,3319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'digits' is never reassigned. Use 'const' instead.","line":105,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":105,"endColumn":15,"fix":{"range":[3619,3657],"text":"const digits = value.replace(/\\D/g, \"\");"}},{"ruleId":"prefer-const","severity":2,"message":"'number' is never reassigned. Use 'const' instead.","line":108,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":108,"endColumn":15,"fix":{"range":[3738,3777],"text":"const number = parseInt(digits, 10) || 0;"}}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\r\nimport React, { useState } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n  FormDescription,\r\n} from \"@/components/ui/form\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { CommissionTier } from \"@/types/models\";\r\n\r\nconst formSchema = z.object({\r\n  product: z.string().min(1, { message: \"Produto é obrigatório\" }),\r\n  name: z.string().min(1, { message: \"Nome é obrigatório\" }),\r\n  min_amount: z.string().min(1, { message: \"Valor mínimo é obrigatório\" }),\r\n  max_amount: z.string().optional(),\r\n  percentage: z.string().min(1, { message: \"Percentual é obrigatório\" }),\r\n  has_max: z.boolean().default(true),\r\n});\r\n\r\ninterface CommissionTierFormProps {\r\n  initialData?: CommissionTier | null;\r\n  onCancel: () => void;\r\n  onSave: () => void;\r\n}\r\n\r\nexport default function CommissionTierForm({ initialData, onCancel, onSave }: CommissionTierFormProps) {\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  \r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      product: initialData?.product || \"\",\r\n      name: initialData?.name || \"\",\r\n      min_amount: initialData ? String(initialData.min_amount) : \"\",\r\n      max_amount: initialData?.max_amount ? String(initialData.max_amount) : \"\",\r\n      percentage: initialData ? String(initialData.percentage) : \"\",\r\n      has_max: initialData ? initialData.max_amount !== null : true,\r\n    },\r\n  });\r\n\r\n  const hasMaxValue = form.watch(\"has_max\");\r\n\r\n  const onSubmit = async (values: z.infer<typeof formSchema>) => {\r\n    try {\r\n      setIsSubmitting(true);\r\n      \r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n      \r\n      const commissionData = {\r\n        product: values.product,\r\n        name: values.name,\r\n        min_amount: parseFloat(values.min_amount.replace(/\\./g, \"\").replace(\",\", \".\")),\r\n        max_amount: values.has_max ? parseFloat(values.max_amount?.replace(/\\./g, \"\").replace(\",\", \".\") || \"0\") : null,\r\n        percentage: parseFloat(values.percentage.replace(\",\", \".\")),\r\n        user_id: userData.user.id,\r\n        active: initialData?.active !== undefined ? initialData.active : true,\r\n      };\r\n      \r\n      if (initialData?.id) {\r\n        // Update existing tier\r\n        const { error } = await supabase\r\n          .from(\"commission_tiers\")\r\n          .update(commissionData)\r\n          .eq(\"id\", initialData.id);\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Nível de comissão atualizado com sucesso\");\r\n      } else {\r\n        // Insert new tier\r\n        const { error } = await supabase\r\n          .from(\"commission_tiers\")\r\n          .insert(commissionData);\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Nível de comissão criado com sucesso\");\r\n      }\r\n      \r\n      onSave();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving commission tier:\", error);\r\n      toast.error(`Erro ao salvar nível de comissão: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const formatCurrencyInput = (value: string) => {\r\n    // Remove all non-digit characters\r\n    let digits = value.replace(/\\D/g, \"\");\r\n    \r\n    // Convert to number and back to string to remove leading zeros\r\n    let number = parseInt(digits, 10) || 0;\r\n    let formatted = number.toString();\r\n    \r\n    // Add thousands separators\r\n    if (formatted.length > 3) {\r\n      formatted = formatted.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\r\n    }\r\n    \r\n    return formatted;\r\n  };\r\n\r\n  return (\r\n    <Form {...form}>\r\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\r\n        <FormField\r\n          control={form.control}\r\n          name=\"product\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Produto</FormLabel>\r\n              <FormControl>\r\n                <Input placeholder=\"Ex: Portabilidade, Crefaz, Novo, etc.\" {...field} />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"name\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Nome do Nível</FormLabel>\r\n              <FormControl>\r\n                <Input placeholder=\"Ex: Básico, Intermediário, Premium, etc.\" {...field} />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"min_amount\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Valor Mínimo (R$)</FormLabel>\r\n              <FormControl>\r\n                <Input \r\n                  placeholder=\"Ex: 1000\" \r\n                  {...field} \r\n                  onChange={(e) => {\r\n                    field.onChange(formatCurrencyInput(e.target.value));\r\n                  }}\r\n                />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"has_max\"\r\n          render={({ field }) => (\r\n            <FormItem className=\"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm\">\r\n              <div>\r\n                <FormLabel>Possui valor máximo?</FormLabel>\r\n                <FormDescription>\r\n                  Desative para não ter limite máximo\r\n                </FormDescription>\r\n              </div>\r\n              <FormControl>\r\n                <Switch\r\n                  checked={field.value}\r\n                  onCheckedChange={field.onChange}\r\n                />\r\n              </FormControl>\r\n            </FormItem>\r\n          )}\r\n        />\r\n        \r\n        {hasMaxValue && (\r\n          <FormField\r\n            control={form.control}\r\n            name=\"max_amount\"\r\n            render={({ field }) => (\r\n              <FormItem>\r\n                <FormLabel>Valor Máximo (R$)</FormLabel>\r\n                <FormControl>\r\n                  <Input \r\n                    placeholder=\"Ex: 5000\" \r\n                    {...field} \r\n                    onChange={(e) => {\r\n                      field.onChange(formatCurrencyInput(e.target.value));\r\n                    }}\r\n                  />\r\n                </FormControl>\r\n                <FormMessage />\r\n              </FormItem>\r\n            )}\r\n          />\r\n        )}\r\n        \r\n        <FormField\r\n          control={form.control}\r\n          name=\"percentage\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Percentual (%)</FormLabel>\r\n              <FormControl>\r\n                <Input \r\n                  placeholder=\"Ex: 2.5\" \r\n                  {...field} \r\n                  onChange={(e) => {\r\n                    // Allow only numbers and a single comma or dot\r\n                    const value = e.target.value.replace(/[^\\d.,]/g, \"\");\r\n                    // Replace the last dot or comma with the current one\r\n                    const formatted = value.replace(/[.,]/g, (match, index, str) => {\r\n                      return index === str.lastIndexOf(match) ? match : \"\";\r\n                    });\r\n                    field.onChange(formatted);\r\n                  }}\r\n                />\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4\">\r\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n            Cancelar\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting}>\r\n            {isSubmitting ? \"Salvando...\" : initialData ? \"Atualizar\" : \"Salvar\"}\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </Form>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\DefaultCommissionsButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1073,1076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1073,1076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { createDefaultCommissions } from \"@/utils/defaultCommissions\";\r\nimport { Settings } from \"lucide-react\";\r\n\r\ninterface DefaultCommissionsButtonProps {\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst DefaultCommissionsButton = ({ onSuccess }: DefaultCommissionsButtonProps) => {\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleCreateDefaults = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      const result = await createDefaultCommissions(userData.user.id);\r\n      \r\n      if (result.success) {\r\n        toast.success(\"Comissões padrão criadas com sucesso!\");\r\n        onSuccess();\r\n      } else {\r\n        toast.error(\"Erro ao criar comissões padrão\");\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error creating default commissions:\", error);\r\n      toast.error(\"Erro ao criar comissões padrão\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Button \r\n      onClick={handleCreateDefaults}\r\n      disabled={loading}\r\n      variant=\"outline\"\r\n      className=\"flex items-center gap-2\"\r\n    >\r\n      <Settings className=\"h-4 w-4\" />\r\n      {loading ? \"Criando...\" : \"Criar Comissões Padrão\"}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default DefaultCommissionsButton;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\FixedRateForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2728,2731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2728,2731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { CommissionRate } from \"@/types/models\";\r\n\r\ninterface FixedRateFormProps {\r\n  onCancel: () => void;\r\n  onSave: () => void;\r\n  initialData?: CommissionRate | null;\r\n}\r\n\r\nconst FixedRateForm: React.FC<FixedRateFormProps> = ({ onCancel, onSave, initialData }) => {\r\n  const [product, setProduct] = useState(initialData?.product || \"\");\r\n  const [name, setName] = useState(initialData?.name || \"\");\r\n  const [commissionType, setCommissionType] = useState<'percentage' | 'fixed'>(\r\n    initialData?.commission_type || 'percentage'\r\n  );\r\n  const [percentage, setPercentage] = useState(initialData?.percentage?.toString() || \"\");\r\n  const [fixedValue, setFixedValue] = useState(initialData?.fixed_value?.toString() || \"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!product || !name) {\r\n      toast.error(\"Produto e nome são obrigatórios\");\r\n      return;\r\n    }\r\n\r\n    if (commissionType === 'percentage' && !percentage) {\r\n      toast.error(\"Percentagem é obrigatória para comissão percentual\");\r\n      return;\r\n    }\r\n\r\n    if (commissionType === 'fixed' && !fixedValue) {\r\n      toast.error(\"Valor fixo é obrigatório para comissão fixa\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Usuário não autenticado\");\r\n\r\n      const rateData = {\r\n        product,\r\n        name,\r\n        commission_type: commissionType,\r\n        percentage: commissionType === 'percentage' ? parseFloat(percentage) : 0,\r\n        fixed_value: commissionType === 'fixed' ? parseFloat(fixedValue) : null,\r\n        user_id: user.id,\r\n        active: true,\r\n      };\r\n\r\n      let result;\r\n      if (initialData) {\r\n        result = await supabase\r\n          .from('commission_rates')\r\n          .update(rateData)\r\n          .eq('id', initialData.id);\r\n      } else {\r\n        result = await supabase\r\n          .from('commission_rates')\r\n          .insert(rateData);\r\n      }\r\n\r\n      if (result.error) throw result.error;\r\n\r\n      toast.success(`Taxa de comissão ${initialData ? 'atualizada' : 'criada'} com sucesso!`);\r\n      onSave();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving commission rate:\", error);\r\n      toast.error(`Erro ao ${initialData ? 'atualizar' : 'criar'} taxa de comissão: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"product\">Produto *</Label>\r\n          <Input\r\n            id=\"product\"\r\n            value={product}\r\n            onChange={(e) => setProduct(e.target.value)}\r\n            placeholder=\"Ex: Portabilidade, Crefaz, Novo, etc.\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"name\">Nome da Taxa *</Label>\r\n          <Input\r\n            id=\"name\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"Ex: Taxa padrão, Promoção especial...\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <Label>Tipo de Comissão *</Label>\r\n        <RadioGroup \r\n          value={commissionType} \r\n          onValueChange={(value: 'percentage' | 'fixed') => setCommissionType(value)}\r\n          className=\"flex flex-col space-y-3\"\r\n        >\r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"percentage\" id=\"percentage\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"percentage\" className=\"font-medium cursor-pointer\">\r\n                📊 Comissão Percentual\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Comissão calculada como % do valor da venda\r\n              </p>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"fixed\" id=\"fixed\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"fixed\" className=\"font-medium cursor-pointer\">\r\n                💰 Comissão Fixa\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Valor fixo independente do valor da venda\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </RadioGroup>\r\n      </div>\r\n\r\n      {commissionType === 'percentage' && (\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"percentage-value\">Percentagem (%) *</Label>\r\n          <Input\r\n            id=\"percentage-value\"\r\n            type=\"number\"\r\n            step=\"0.01\"\r\n            min=\"0\"\r\n            max=\"100\"\r\n            value={percentage}\r\n            onChange={(e) => setPercentage(e.target.value)}\r\n            placeholder=\"Ex: 2.5\"\r\n          />\r\n          <p className=\"text-sm text-gray-500\">\r\n            Digite o percentual de comissão (exemplo: 2.5 para 2,5%)\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {commissionType === 'fixed' && (\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"fixed-value\">Valor Fixo (R$) *</Label>\r\n          <Input\r\n            id=\"fixed-value\"\r\n            type=\"number\"\r\n            step=\"0.01\"\r\n            min=\"0\"\r\n            value={fixedValue}\r\n            onChange={(e) => setFixedValue(e.target.value)}\r\n            placeholder=\"Ex: 150.00\"\r\n          />\r\n          <p className=\"text-sm text-gray-500\">\r\n            Digite o valor fixo da comissão em reais\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex justify-end space-x-2 pt-4 border-t\">\r\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n          Cancelar\r\n        </Button>\r\n        <Button type=\"submit\" disabled={loading}>\r\n          {loading ? \"Salvando...\" : (initialData ? \"Atualizar\" : \"Criar\")}\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default FixedRateForm;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\NewCommissionForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":107,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":107,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3549,3552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3549,3552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4160,4163],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4160,4163],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'calculateCommission'. Either include it or remove the dependency array.","line":152,"column":6,"nodeType":"ArrayExpression","endLine":152,"endColumn":61,"suggestions":[{"desc":"Update the dependencies array to be: [watchAmount, watchProduct, commissionTiers, flatRates, calculateCommission]","fix":{"range":[4809,4864],"text":"[watchAmount, watchProduct, commissionTiers, flatRates, calculateCommission]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":217,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":217,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7110,7113],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7110,7113],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'digits' is never reassigned. Use 'const' instead.","line":227,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":227,"endColumn":15,"fix":{"range":[7403,7441],"text":"const digits = value.replace(/\\D/g, \"\");"}},{"ruleId":"prefer-const","severity":2,"message":"'number' is never reassigned. Use 'const' instead.","line":230,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":230,"endColumn":15,"fix":{"range":[7522,7561],"text":"const number = parseInt(digits, 10) || 0;"}}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":2,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { CommissionTier } from \"@/types/models\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\n\r\nconst formSchema = z.object({\r\n  lead_id: z.string().min(1, { message: \"Cliente é obrigatório\" }),\r\n  amount: z.string().min(1, { message: \"Valor é obrigatório\" }),\r\n  status: z.string().min(1, { message: \"Status é obrigatório\" }),\r\n  product: z.string().min(1, { message: \"Produto é obrigatório\" }),\r\n  payment_period: z.string().min(1, { message: \"Período de pagamento é obrigatório\" }),\r\n  employee: z.string().min(1, { message: \"Funcionário é obrigatório\" }),\r\n});\r\n\r\ninterface NewCommissionFormProps {\r\n  leads: Array<{ id: string; name: string }>;\r\n  onSuccess: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\nconst statusOptions = [\r\n  { value: \"pending\", label: \"Pendente\" },\r\n  { value: \"approved\", label: \"Aprovado\" },\r\n  { value: \"paid\", label: \"Pago\" },\r\n  { value: \"cancelled\", label: \"Cancelado\" },\r\n];\r\n\r\nconst periodOptions = [\r\n  { value: \"weekly\", label: \"Semanal\" },\r\n  { value: \"biweekly\", label: \"Quinzenal\" },\r\n  { value: \"monthly\", label: \"Mensal\" },\r\n];\r\n\r\nconst productOptions = [\r\n  { value: \"CREDITO FGTS\", label: \"CRÉDITO FGTS\" },\r\n  { value: \"CREDITO CLT\", label: \"CRÉDITO CLT\" },\r\n  { value: \"CREDITO PIX/CARTAO\", label: \"CRÉDITO PIX/CARTÃO\" },\r\n  { value: \"CREDITO INSS\", label: \"CRÉDITO INSS\" },\r\n  { value: \"PORTABILIDADE INSS\", label: \"PORTABILIDADE INSS\" },\r\n  { value: \"portabilidade\", label: \"Portabilidade\" },\r\n  { value: \"refinanciamento\", label: \"Refinanciamento\" },\r\n  { value: \"crefaz\", label: \"Crefaz\" },\r\n  { value: \"novo\", label: \"Novo\" },\r\n  { value: \"clt\", label: \"CLT\" },\r\n  { value: \"fgts\", label: \"FGTS\" },\r\n];\r\n\r\nexport default function NewCommissionForm({ leads, onSuccess, onCancel }: NewCommissionFormProps) {\r\n  const form = useForm<z.infer<typeof formSchema>>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      lead_id: \"\",\r\n      amount: \"\",\r\n      status: \"pending\",\r\n      product: \"\",\r\n      payment_period: \"monthly\",\r\n      employee: \"\",\r\n    },\r\n  });\r\n\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [commissionTiers, setCommissionTiers] = useState<CommissionTier[]>([]);\r\n  const [calculatedCommission, setCalculatedCommission] = useState<number | null>(null);\r\n  const [flatRates, setFlatRates] = useState<Record<string, number>>({});\r\n  const [employees, setEmployees] = useState<Employee[]>([]);\r\n\r\n  const watchAmount = form.watch(\"amount\");\r\n  const watchProduct = form.watch(\"product\");\r\n\r\n  useEffect(() => {\r\n    // Fetch commission tiers from the database\r\n    async function fetchCommissionTiers() {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"commission_tiers\")\r\n          .select(\"*\")\r\n          .eq(\"active\", true);\r\n\r\n        if (error) throw error;\r\n\r\n        if (data) {\r\n          setCommissionTiers(data as CommissionTier[]);\r\n        }\r\n      } catch (error: any) {\r\n        console.error(\"Error fetching commission tiers:\", error);\r\n      }\r\n    }\r\n\r\n    // Fetch flat commission rates\r\n    async function fetchCommissionRates() {\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from(\"commission_rates\")\r\n          .select(\"*\")\r\n          .eq(\"active\", true);\r\n\r\n        if (error) throw error;\r\n\r\n        if (data) {\r\n          const rateMap: Record<string, number> = {};\r\n          data.forEach(rate => {\r\n            rateMap[rate.product] = rate.percentage;\r\n          });\r\n          setFlatRates(rateMap);\r\n        }\r\n      } catch (error: any) {\r\n        console.error(\"Error fetching commission rates:\", error);\r\n      }\r\n    }\r\n\r\n    // Fetch employees\r\n    async function fetchEmployees() {\r\n      const employeeList = await getEmployees();\r\n      setEmployees(employeeList);\r\n    }\r\n\r\n    fetchCommissionTiers();\r\n    fetchCommissionRates();\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  // Calculate commission based on amount and product whenever they change\r\n  useEffect(() => {\r\n    if (watchAmount && watchProduct) {\r\n      calculateCommission(parseFloat(watchAmount.replace(/\\./g, \"\").replace(\",\", \".\")), watchProduct);\r\n    } else {\r\n      setCalculatedCommission(null);\r\n    }\r\n  }, [watchAmount, watchProduct, commissionTiers, flatRates]);\r\n\r\n  const calculateCommission = (amount: number, product: string) => {\r\n    // First check if there are any tiers for this product\r\n    const productTiers = commissionTiers.filter(tier => tier.product === product);\r\n    \r\n    if (productTiers.length > 0) {\r\n      // Find the applicable tier\r\n      const applicableTier = productTiers.find(tier => {\r\n        const minAmount = tier.min_amount;\r\n        const maxAmount = tier.max_amount;\r\n        \r\n        if (maxAmount === null) {\r\n          // No maximum, just check minimum\r\n          return amount >= minAmount;\r\n        } else {\r\n          // Check if amount is in range\r\n          return amount >= minAmount && amount <= maxAmount;\r\n        }\r\n      });\r\n      \r\n      if (applicableTier) {\r\n        const commission = (amount * applicableTier.percentage) / 100;\r\n        setCalculatedCommission(commission);\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // If no tiers found or no applicable tier, use flat rate\r\n    if (flatRates[product]) {\r\n      const commission = (amount * flatRates[product]) / 100;\r\n      setCalculatedCommission(commission);\r\n    } else {\r\n      setCalculatedCommission(null);\r\n    }\r\n  };\r\n\r\n  async function onSubmit(values: z.infer<typeof formSchema>) {\r\n    setIsSubmitting(true);\r\n\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const amount = parseFloat(values.amount.replace(/\\./g, \"\").replace(\",\", \".\"));\r\n      \r\n      // If we have a calculated commission, use that as the commission amount\r\n      const commissionAmount = calculatedCommission !== null ? calculatedCommission : amount;\r\n\r\n      const { data, error } = await supabase.from(\"commissions\").insert({\r\n        lead_id: values.lead_id,\r\n        amount: amount,\r\n        commission_value: commissionAmount,\r\n        percentage: flatRates[values.product] || 0,\r\n        status: values.status,\r\n        product: values.product,\r\n        payment_period: values.payment_period,\r\n        employee: values.employee,\r\n        user_id: userData.user.id\r\n      });\r\n\r\n      if (error) throw error;\r\n      \r\n      toast.success(\"Comissão cadastrada com sucesso!\");\r\n      onSuccess();\r\n    } catch (error: any) {\r\n      console.error(\"Error creating commission:\", error);\r\n      toast.error(`Erro ao cadastrar comissão: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  }\r\n\r\n  const formatCurrencyInput = (value: string) => {\r\n    // Remove all non-digit characters\r\n    let digits = value.replace(/\\D/g, \"\");\r\n    \r\n    // Convert to number and back to string to remove leading zeros\r\n    let number = parseInt(digits, 10) || 0;\r\n    let formatted = number.toString();\r\n    \r\n    // Add thousands separators\r\n    if (formatted.length > 3) {\r\n      formatted = formatted.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\r\n    }\r\n\r\n    // Add decimal part if value is not zero\r\n    if (number > 0) {\r\n      formatted = formatted + \",00\";\r\n    }\r\n\r\n    return formatted;\r\n  };\r\n  \r\n  return (\r\n    <Form {...form}>\r\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\r\n        <FormField\r\n          control={form.control}\r\n          name=\"lead_id\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Cliente</FormLabel>\r\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                <FormControl>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o cliente\" />\r\n                  </SelectTrigger>\r\n                </FormControl>\r\n                <SelectContent>\r\n                  {leads.map(lead => (\r\n                    <SelectItem key={lead.id} value={lead.id}>\r\n                      {lead.name}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <FormField\r\n          control={form.control}\r\n          name=\"product\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Produto</FormLabel>\r\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                <FormControl>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o produto\" />\r\n                  </SelectTrigger>\r\n                </FormControl>\r\n                <SelectContent>\r\n                  {productOptions.map(option => (\r\n                    <SelectItem key={option.value} value={option.value}>\r\n                      {option.label}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <FormField\r\n          control={form.control}\r\n          name=\"amount\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Valor da Operação</FormLabel>\r\n              <FormControl>\r\n                <div className=\"relative\">\r\n                  <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2\">R$</span>\r\n                  <Input\r\n                    className=\"pl-9\"\r\n                    placeholder=\"0,00\"\r\n                    {...field}\r\n                    onChange={(e) => {\r\n                      const formattedValue = formatCurrencyInput(e.target.value);\r\n                      field.onChange(formattedValue);\r\n                    }}\r\n                  />\r\n                </div>\r\n              </FormControl>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        {calculatedCommission !== null && (\r\n          <div className=\"p-3 bg-green-50 border border-green-200 rounded-md\">\r\n            <p className=\"text-sm font-medium\">\r\n              Comissão calculada: \r\n              <span className=\"text-green-600 ml-2\">\r\n                R$ {calculatedCommission.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n              </span>\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        <FormField\r\n          control={form.control}\r\n          name=\"employee\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Funcionário</FormLabel>\r\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                <FormControl>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o funcionário\" />\r\n                  </SelectTrigger>\r\n                </FormControl>\r\n                <SelectContent>\r\n                  {employees.map(employee => (\r\n                    <SelectItem key={employee.id} value={employee.name}>\r\n                      {employee.name}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <FormField\r\n          control={form.control}\r\n          name=\"payment_period\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Período de Pagamento</FormLabel>\r\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                <FormControl>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o período\" />\r\n                  </SelectTrigger>\r\n                </FormControl>\r\n                <SelectContent>\r\n                  {periodOptions.map(option => (\r\n                    <SelectItem key={option.value} value={option.value}>\r\n                      {option.label}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <FormField\r\n          control={form.control}\r\n          name=\"status\"\r\n          render={({ field }) => (\r\n            <FormItem>\r\n              <FormLabel>Status</FormLabel>\r\n              <Select onValueChange={field.onChange} defaultValue={field.value}>\r\n                <FormControl>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o status\" />\r\n                  </SelectTrigger>\r\n                </FormControl>\r\n                <SelectContent>\r\n                  {statusOptions.map(option => (\r\n                    <SelectItem key={option.value} value={option.value}>\r\n                      {option.label}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <FormMessage />\r\n            </FormItem>\r\n          )}\r\n        />\r\n\r\n        <div className=\"flex justify-end gap-2\">\r\n          <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n            Cancelar\r\n          </Button>\r\n          <Button type=\"submit\" disabled={isSubmitting}>\r\n            {isSubmitting ? \"Salvando...\" : \"Salvar\"}\r\n          </Button>\r\n        </div>\r\n      </form>\r\n    </Form>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\commission\\VariableRateForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3830,3833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3830,3833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { CommissionTier } from \"@/types/models\";\r\n\r\ninterface VariableRateFormProps {\r\n  onCancel: () => void;\r\n  onSave: () => void;\r\n  initialData?: CommissionTier | null;\r\n}\r\n\r\nconst VariableRateForm: React.FC<VariableRateFormProps> = ({ onCancel, onSave, initialData }) => {\r\n  const [product, setProduct] = useState(initialData?.product || \"\");\r\n  const [name, setName] = useState(initialData?.name || \"\");\r\n  const [tierType, setTierType] = useState<'value' | 'period'>(\r\n    initialData?.tier_type || 'value'\r\n  );\r\n  const [commissionType, setCommissionType] = useState<'percentage' | 'fixed'>(\r\n    initialData?.commission_type || 'percentage'\r\n  );\r\n  const [minAmount, setMinAmount] = useState(initialData?.min_amount?.toString() || \"\");\r\n  const [maxAmount, setMaxAmount] = useState(initialData?.max_amount?.toString() || \"\");\r\n  const [minPeriod, setMinPeriod] = useState(initialData?.min_period?.toString() || \"\");\r\n  const [maxPeriod, setMaxPeriod] = useState(initialData?.max_period?.toString() || \"\");\r\n  const [percentage, setPercentage] = useState(initialData?.percentage?.toString() || \"\");\r\n  const [fixedValue, setFixedValue] = useState(initialData?.fixed_value?.toString() || \"\");\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!product || !name) {\r\n      toast.error(\"Produto e nome são obrigatórios\");\r\n      return;\r\n    }\r\n\r\n    if (tierType === 'value' && !minAmount) {\r\n      toast.error(\"Valor mínimo é obrigatório para faixa por valor\");\r\n      return;\r\n    }\r\n\r\n    if (tierType === 'period' && !minPeriod) {\r\n      toast.error(\"Período mínimo é obrigatório para faixa por prazo\");\r\n      return;\r\n    }\r\n\r\n    if (commissionType === 'percentage' && !percentage) {\r\n      toast.error(\"Percentagem é obrigatória para comissão percentual\");\r\n      return;\r\n    }\r\n\r\n    if (commissionType === 'fixed' && !fixedValue) {\r\n      toast.error(\"Valor fixo é obrigatório para comissão fixa\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Usuário não autenticado\");\r\n\r\n      const tierData = {\r\n        product,\r\n        name,\r\n        tier_type: tierType,\r\n        commission_type: commissionType,\r\n        min_amount: tierType === 'value' ? parseFloat(minAmount) : 0,\r\n        max_amount: tierType === 'value' && maxAmount ? parseFloat(maxAmount) : null,\r\n        min_period: tierType === 'period' ? parseInt(minPeriod) : null,\r\n        max_period: tierType === 'period' && maxPeriod ? parseInt(maxPeriod) : null,\r\n        percentage: commissionType === 'percentage' ? parseFloat(percentage) : 0,\r\n        fixed_value: commissionType === 'fixed' ? parseFloat(fixedValue) : null,\r\n        user_id: user.id,\r\n        active: true,\r\n      };\r\n\r\n      let result;\r\n      if (initialData) {\r\n        result = await supabase\r\n          .from('commission_tiers')\r\n          .update(tierData)\r\n          .eq('id', initialData.id);\r\n      } else {\r\n        result = await supabase\r\n          .from('commission_tiers')\r\n          .insert(tierData);\r\n      }\r\n\r\n      if (result.error) throw result.error;\r\n\r\n      toast.success(`Taxa de comissão ${initialData ? 'atualizada' : 'criada'} com sucesso!`);\r\n      onSave();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving commission tier:\", error);\r\n      toast.error(`Erro ao ${initialData ? 'atualizar' : 'criar'} taxa de comissão: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"product\">Produto *</Label>\r\n          <Input\r\n            id=\"product\"\r\n            value={product}\r\n            onChange={(e) => setProduct(e.target.value)}\r\n            placeholder=\"Ex: Portabilidade, Crefaz, Novo, etc.\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"name\">Nome da Taxa *</Label>\r\n          <Input\r\n            id=\"name\"\r\n            value={name}\r\n            onChange={(e) => setName(e.target.value)}\r\n            placeholder=\"Ex: Faixa básica, Faixa premium...\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-4\">\r\n        <Label>Tipo de Faixa *</Label>\r\n        <RadioGroup \r\n          value={tierType} \r\n          onValueChange={(value: 'value' | 'period') => setTierType(value)}\r\n          className=\"flex flex-col space-y-3\"\r\n        >\r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"value\" id=\"tier-value\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"tier-value\" className=\"font-medium cursor-pointer\">\r\n                💰 Por Valor da Venda\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Comissão baseada na faixa do valor da venda (ex: R$ 1.000 a R$ 5.000)\r\n              </p>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"period\" id=\"tier-period\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"tier-period\" className=\"font-medium cursor-pointer\">\r\n                📅 Por Prazo de Pagamento\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Comissão baseada no número de parcelas (ex: 8x a 12x, 13x a 24x)\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </RadioGroup>\r\n      </div>\r\n\r\n      {tierType === 'value' && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"min-amount\">Valor Mínimo (R$) *</Label>\r\n            <Input\r\n              id=\"min-amount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={minAmount}\r\n              onChange={(e) => setMinAmount(e.target.value)}\r\n              placeholder=\"Ex: 1000.00\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"max-amount\">Valor Máximo (R$)</Label>\r\n            <Input\r\n              id=\"max-amount\"\r\n              type=\"number\"\r\n              step=\"0.01\"\r\n              min=\"0\"\r\n              value={maxAmount}\r\n              onChange={(e) => setMaxAmount(e.target.value)}\r\n              placeholder=\"Ex: 5000.00 (vazio = sem limite)\"\r\n            />\r\n            <p className=\"text-sm text-gray-500\">\r\n              Deixe vazio para indicar \"sem limite máximo\"\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {tierType === 'period' && (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"min-period\">Período Mínimo (parcelas) *</Label>\r\n            <Input\r\n              id=\"min-period\"\r\n              type=\"number\"\r\n              min=\"1\"\r\n              value={minPeriod}\r\n              onChange={(e) => setMinPeriod(e.target.value)}\r\n              placeholder=\"Ex: 8\"\r\n            />\r\n            <p className=\"text-sm text-gray-500\">\r\n              Número mínimo de parcelas (ex: 8 para 8x)\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"max-period\">Período Máximo (parcelas)</Label>\r\n            <Input\r\n              id=\"max-period\"\r\n              type=\"number\"\r\n              min=\"1\"\r\n              value={maxPeriod}\r\n              onChange={(e) => setMaxPeriod(e.target.value)}\r\n              placeholder=\"Ex: 12 (vazio = sem limite)\"\r\n            />\r\n            <p className=\"text-sm text-gray-500\">\r\n              Número máximo de parcelas (deixe vazio para sem limite)\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"space-y-4\">\r\n        <Label>Tipo de Comissão *</Label>\r\n        <RadioGroup \r\n          value={commissionType} \r\n          onValueChange={(value: 'percentage' | 'fixed') => setCommissionType(value)}\r\n          className=\"flex flex-col space-y-3\"\r\n        >\r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"percentage\" id=\"percentage\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"percentage\" className=\"font-medium cursor-pointer\">\r\n                📊 Comissão Percentual\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Comissão calculada como % do valor da venda\r\n              </p>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50\">\r\n            <RadioGroupItem value=\"fixed\" id=\"fixed\" />\r\n            <div className=\"flex-1\">\r\n              <Label htmlFor=\"fixed\" className=\"font-medium cursor-pointer\">\r\n                💰 Comissão Fixa\r\n              </Label>\r\n              <p className=\"text-sm text-gray-500\">\r\n                Valor fixo para esta faixa de valores\r\n              </p>\r\n            </div>\r\n          </div>\r\n        </RadioGroup>\r\n      </div>\r\n\r\n      {commissionType === 'percentage' && (\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"percentage-value\">Percentagem (%) *</Label>\r\n          <Input\r\n            id=\"percentage-value\"\r\n            type=\"number\"\r\n            step=\"0.01\"\r\n            min=\"0\"\r\n            max=\"100\"\r\n            value={percentage}\r\n            onChange={(e) => setPercentage(e.target.value)}\r\n            placeholder=\"Ex: 2.5\"\r\n          />\r\n          <p className=\"text-sm text-gray-500\">\r\n            Digite o percentual de comissão (exemplo: 2.5 para 2,5%)\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {commissionType === 'fixed' && (\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"fixed-value\">Valor Fixo (R$) *</Label>\r\n          <Input\r\n            id=\"fixed-value\"\r\n            type=\"number\"\r\n            step=\"0.01\"\r\n            min=\"0\"\r\n            value={fixedValue}\r\n            onChange={(e) => setFixedValue(e.target.value)}\r\n            placeholder=\"Ex: 150.00\"\r\n          />\r\n          <p className=\"text-sm text-gray-500\">\r\n            Digite o valor fixo da comissão para esta faixa\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex justify-end space-x-2 pt-4 border-t\">\r\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n          Cancelar\r\n        </Button>\r\n        <Button type=\"submit\" disabled={loading}>\r\n          {loading ? \"Salvando...\" : (initialData ? \"Atualizar\" : \"Criar\")}\r\n        </Button>\r\n      </div>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default VariableRateForm;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\dashboard\\EmployeePerformanceCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[238,241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[238,241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { User, Award, Crown, Medal, Trophy } from \"lucide-react\";\r\n\r\ninterface EmployeePerformanceCardProps {\r\n  employeeSales: any[];\r\n  isLoading: boolean;\r\n}\r\n\r\nconst EmployeePerformanceCard = ({ employeeSales, isLoading }: EmployeePerformanceCardProps) => {\r\n  const getRankIcon = (index: number) => {\r\n    switch (index) {\r\n      case 0: return <Crown className=\"h-3 w-3\" />;\r\n      case 1: return <Trophy className=\"h-3 w-3\" />;\r\n      case 2: return <Medal className=\"h-3 w-3\" />;\r\n      default: return <Award className=\"h-3 w-3\" />;\r\n    }\r\n  };\r\n\r\n  const getRankColors = (index: number) => {\r\n    switch (index) {\r\n      case 0: return 'bg-gradient-to-br from-yellow-400 to-yellow-500 text-yellow-900 shadow-yellow-200';\r\n      case 1: return 'bg-gradient-to-br from-gray-300 to-gray-400 text-gray-800 shadow-gray-200';\r\n      case 2: return 'bg-gradient-to-br from-orange-400 to-orange-500 text-orange-900 shadow-orange-200';\r\n      default: return 'bg-gradient-to-br from-blue-400 to-blue-500 text-blue-900 shadow-blue-200';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-0 shadow-lg bg-gradient-to-br from-white via-blue-50/30 to-indigo-50/20 hover:shadow-xl transition-all duration-500 group overflow-hidden\">\r\n      {/* Background decoration */}\r\n      <div className=\"absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-blue-100/50 to-transparent rounded-full transform translate-x-12 -translate-y-12\"></div>\r\n      \r\n      <CardHeader className=\"relative z-10\">\r\n        <div className=\"space-y-2\">\r\n          <CardTitle className=\"text-xl font-semibold text-slate-900 flex items-center gap-3\">\r\n            <div className=\"w-2 h-2 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full animate-pulse\"></div>\r\n            Performance dos Funcionários\r\n          </CardTitle>\r\n          <p className=\"text-sm text-slate-600\">\r\n            Ranking por valor total de leads (vendas/convertidos)\r\n          </p>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"relative z-10\">\r\n        {isLoading ? (\r\n          <div className=\"flex items-center justify-center h-32 text-slate-500\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"animate-spin rounded-full h-6 w-6 border-2 border-blue-600 border-t-transparent\"></div>\r\n              <span className=\"text-sm font-medium\">Carregando...</span>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-2 max-h-96 overflow-y-auto\">\r\n            {employeeSales.length === 0 ? (\r\n              <div className=\"text-center py-8 text-slate-500\">\r\n                <div className=\"w-16 h-16 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-sm\">\r\n                  <User className=\"h-8 w-8 text-blue-500\" />\r\n                </div>\r\n                <p className=\"font-medium\">Nenhum lead com valor por funcionário registrado</p>\r\n                <p className=\"text-xs text-slate-400 mt-1\">O ranking aparecerá aqui</p>\r\n              </div>\r\n            ) : (\r\n              employeeSales.map((employee, index) => (\r\n                <div key={employee.id} className=\"flex items-center justify-between p-3 bg-white/80 backdrop-blur-sm rounded-2xl border border-blue-100/50 hover:bg-white hover:shadow-md transition-all duration-300 group/item\">\r\n                  <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                    <div className={`w-10 h-10 rounded-2xl flex items-center justify-center shadow-lg ${getRankColors(index)}`}>\r\n                      {getRankIcon(index)}\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-semibold text-slate-900 truncate group-hover/item:text-blue-700 transition-colors\">{employee.employee}</p>\r\n                      <div className=\"flex items-center gap-2 mt-1\">\r\n                        <span className=\"text-xs text-slate-500\">#{index + 1} colocado</span>\r\n                        {index < 3 && (\r\n                          <span className={`px-2 py-0.5 rounded-full text-xs font-semibold ${\r\n                            index === 0 ? 'bg-yellow-100 text-yellow-800' :\r\n                            index === 1 ? 'bg-gray-100 text-gray-800' :\r\n                            'bg-orange-100 text-orange-800'\r\n                          }`}>\r\n                            {index === 0 ? 'Ouro' : index === 1 ? 'Prata' : 'Bronze'}\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right ml-3\">\r\n                    <p className=\"font-bold text-blue-700 text-base\">\r\n                      {typeof employee.totalValue === 'number'\r\n                        ? employee.totalValue.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })\r\n                        : 'R$ 0,00'}\r\n                    </p>\r\n                    <p className=\"text-xs text-slate-500 font-medium\">\r\n                      {employee.count || 0} leads / {employee.convertedSales || 0} vendas\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default EmployeePerformanceCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\dashboard\\LatestLeadsCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Clock, ArrowRight, Sparkles } from \"lucide-react\";\r\n\r\ninterface LatestLeadsCardProps {\r\n  latestLeads: any[];\r\n  isLoading: boolean;\r\n}\r\n\r\nconst LatestLeadsCard = ({ latestLeads, isLoading }: LatestLeadsCardProps) => {\r\n  const getStatusBadge = (status: string) => {\r\n    const statusConfig = {\r\n      'novo': { \r\n        bg: 'bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800 border-blue-200 shadow-blue-100', \r\n        label: 'Novo',\r\n        icon: '🔵'\r\n      },\r\n      'contatado': { \r\n        bg: 'bg-gradient-to-r from-purple-50 to-purple-100 text-purple-800 border-purple-200 shadow-purple-100', \r\n        label: 'Contatado',\r\n        icon: '📞'\r\n      },\r\n      'qualificado': { \r\n        bg: 'bg-gradient-to-r from-yellow-50 to-yellow-100 text-yellow-800 border-yellow-200 shadow-yellow-100', \r\n        label: 'Qualificado',\r\n        icon: '⭐'\r\n      },\r\n      'negociando': { \r\n        bg: 'bg-gradient-to-r from-orange-50 to-orange-100 text-orange-800 border-orange-200 shadow-orange-100', \r\n        label: 'Negociando',\r\n        icon: '🤝'\r\n      },\r\n      'convertido': { \r\n        bg: 'bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-800 border-emerald-200 shadow-emerald-100', \r\n        label: 'Convertido',\r\n        icon: '✅'\r\n      },\r\n      'perdido': { \r\n        bg: 'bg-gradient-to-r from-red-50 to-red-100 text-red-800 border-red-200 shadow-red-100', \r\n        label: 'Perdido',\r\n        icon: '❌'\r\n      },\r\n      'concluido': {\r\n        color: 'bg-green-100 text-green-800',\r\n        label: 'Concluído',\r\n      },\r\n      'cancelado': {\r\n        color: 'bg-red-100 text-red-800',\r\n        label: 'Cancelado',\r\n      },\r\n    };\r\n    \r\n    const config = statusConfig[status] || statusConfig['novo'];\r\n    return (\r\n      <Badge variant=\"secondary\" className={`${config.bg} border font-semibold shadow-sm px-3 py-1 rounded-full`}>\r\n        <span className=\"mr-1\">{config.icon}</span>\r\n        {config.label}\r\n      </Badge>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-0 shadow-lg bg-gradient-to-br from-white via-slate-50/30 to-gray-50/20 hover:shadow-xl transition-all duration-500 group overflow-hidden\">\r\n      {/* Background decoration */}\r\n      <div className=\"absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-slate-100/50 to-transparent rounded-full transform translate-x-12 -translate-y-12\"></div>\r\n      \r\n      <CardHeader className=\"flex flex-row items-center justify-between relative z-10\">\r\n        <div className=\"space-y-2\">\r\n          <CardTitle className=\"text-xl font-semibold text-slate-900 flex items-center gap-3\">\r\n            <div className=\"w-2 h-2 bg-gradient-to-r from-slate-500 to-gray-500 rounded-full animate-pulse\"></div>\r\n            Últimos Leads\r\n            <Sparkles className=\"h-4 w-4 text-slate-500 group-hover:animate-bounce\" />\r\n          </CardTitle>\r\n          <p className=\"text-sm text-slate-600\">\r\n            Leads cadastrados recentemente\r\n          </p>\r\n        </div>\r\n        <Button variant=\"outline\" size=\"sm\" className=\"hidden sm:flex items-center gap-2 hover:bg-slate-50 border-slate-300 rounded-xl\">\r\n          Ver todos\r\n          <ArrowRight className=\"h-4 w-4\" />\r\n        </Button>\r\n      </CardHeader>\r\n      <CardContent className=\"relative z-10\">\r\n        {isLoading ? (\r\n          <div className=\"flex items-center justify-center h-32 text-slate-500\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"animate-spin rounded-full h-6 w-6 border-2 border-slate-600 border-t-transparent\"></div>\r\n              <span className=\"text-sm font-medium\">Carregando...</span>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"overflow-x-auto rounded-xl border border-slate-200/60 bg-white/50 backdrop-blur-sm\">\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow className=\"border-slate-200/60 bg-slate-50/80\">\r\n                  <TableHead className=\"text-slate-700 font-semibold text-sm py-4\">Nome</TableHead>\r\n                  <TableHead className=\"text-slate-700 font-semibold text-sm hidden sm:table-cell\">Telefone</TableHead>\r\n                  <TableHead className=\"text-slate-700 font-semibold text-sm\">Status</TableHead>\r\n                  <TableHead className=\"text-right text-slate-700 font-semibold text-sm\">Data</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {latestLeads.length === 0 ? (\r\n                  <TableRow>\r\n                    <TableCell colSpan={4} className=\"text-center py-12 text-slate-500\">\r\n                      <div className=\"w-16 h-16 bg-gradient-to-br from-slate-100 to-gray-100 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-sm\">\r\n                        <Clock className=\"h-8 w-8 text-slate-400\" />\r\n                      </div>\r\n                      <p className=\"font-medium\">Nenhum lead cadastrado recentemente</p>\r\n                      <p className=\"text-xs text-slate-400 mt-1\">Novos leads aparecerão aqui</p>\r\n                    </TableCell>\r\n                  </TableRow>\r\n                ) : (\r\n                  latestLeads.map((lead, index) => (\r\n                    <TableRow key={lead.id} className=\"border-slate-100/60 hover:bg-slate-50/50 transition-colors group/row\">\r\n                      <TableCell className=\"font-semibold text-slate-900 py-4 group-hover/row:text-blue-700 transition-colors\">\r\n                        {lead.name}\r\n                      </TableCell>\r\n                      <TableCell className=\"text-slate-600 hidden sm:table-cell\">\r\n                        {lead.phone || \"—\"}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        {getStatusBadge(lead.status)}\r\n                      </TableCell>\r\n                      <TableCell className=\"text-right text-slate-500 text-sm font-medium\">\r\n                        {lead.createdAt}\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  ))\r\n                )}\r\n              </TableBody>\r\n            </Table>\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default LatestLeadsCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\dashboard\\MetricsCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\dashboard\\ProductionCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[220,223],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[220,223],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React from \"react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { TrendingUp, Sparkles } from \"lucide-react\";\r\n\r\ninterface ProductionCardProps {\r\n  dailyProduction: any[];\r\n  isLoading: boolean;\r\n}\r\n\r\nconst ProductionCard = ({ dailyProduction, isLoading }: ProductionCardProps) => {\r\n  const calculateDailyTotal = () => {\r\n    return dailyProduction.reduce((total, lead) => {\r\n      const cleanAmount = lead.amount?.replace(/[^\\d,]/g, '').replace(',', '.') || \"0\";\r\n      const amount = parseFloat(cleanAmount);\r\n      return isNaN(amount) ? total : total + amount;\r\n    }, 0).toFixed(2);\r\n  };\r\n\r\n  return (\r\n    <Card className=\"border-0 shadow-lg bg-gradient-to-br from-white via-emerald-50/30 to-green-50/20 hover:shadow-xl transition-all duration-500 group overflow-hidden\">\r\n      {/* Background decoration */}\r\n      <div className=\"absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-emerald-100/50 to-transparent rounded-full transform translate-x-12 -translate-y-12\"></div>\r\n      \r\n      <CardHeader className=\"flex flex-row items-center justify-between pb-4 relative z-10\">\r\n        <div className=\"space-y-2\">\r\n          <CardTitle className=\"text-xl font-semibold text-slate-900 flex items-center gap-3\">\r\n            <div className=\"w-2 h-2 bg-gradient-to-r from-emerald-500 to-green-500 rounded-full animate-pulse\"></div>\r\n            Produção Diária\r\n            <Sparkles className=\"h-4 w-4 text-emerald-500 group-hover:animate-spin\" />\r\n          </CardTitle>\r\n          <p className=\"text-sm text-slate-600\">\r\n            Leads com valores hoje\r\n          </p>\r\n        </div>\r\n        <div className=\"text-right\">\r\n          <div className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent\">\r\n            R$ {calculateDailyTotal()}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 text-sm text-emerald-700 bg-emerald-50 px-2 py-1 rounded-full border border-emerald-200 mt-1\">\r\n            <TrendingUp className=\"h-3 w-3\" />\r\n            <span className=\"font-medium\">Total hoje</span>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent className=\"relative z-10\">\r\n        {isLoading ? (\r\n          <div className=\"flex items-center justify-center h-32 text-slate-500\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <div className=\"animate-spin rounded-full h-6 w-6 border-2 border-emerald-600 border-t-transparent\"></div>\r\n              <span className=\"text-sm font-medium\">Carregando...</span>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-3 max-h-48 overflow-y-auto\">\r\n            {dailyProduction.length === 0 ? (\r\n              <div className=\"text-center py-8 text-slate-500\">\r\n                <div className=\"w-16 h-16 bg-gradient-to-br from-emerald-100 to-green-100 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-sm\">\r\n                  <TrendingUp className=\"h-8 w-8 text-emerald-500\" />\r\n                </div>\r\n                <p className=\"font-medium\">Nenhum lead com valor registrado hoje</p>\r\n                <p className=\"text-xs text-slate-400 mt-1\">Os leads com valores aparecerão aqui</p>\r\n              </div>\r\n            ) : (\r\n              dailyProduction.slice(0, 5).map((lead, index) => (\r\n                <div key={lead.id} className=\"flex items-center justify-between p-4 bg-white/80 backdrop-blur-sm rounded-2xl border border-emerald-100/50 hover:bg-white hover:shadow-md transition-all duration-300 group/item\">\r\n                  <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n                    <div className=\"w-10 h-10 bg-gradient-to-br from-emerald-500 to-green-500 rounded-xl flex items-center justify-center text-white font-semibold text-sm shadow-sm\">\r\n                      {index + 1}\r\n                    </div>\r\n                    <div className=\"flex-1 min-w-0\">\r\n                      <p className=\"font-semibold text-slate-900 truncate group-hover/item:text-emerald-700 transition-colors\">{lead.name}</p>\r\n                      <p className=\"text-sm text-slate-600 truncate\">{lead.product || \"—\"}</p>\r\n                      <p className=\"text-xs text-slate-500\">Status: {lead.status}</p>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"text-right ml-4\">\r\n                    <p className=\"font-bold text-emerald-700 text-lg\">\r\n                      {lead.amount ? `R$ ${lead.amount}` : \"—\"}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default ProductionCard;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\forms\\BankSelect.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\forms\\BenefitTypeSelect.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5553,5556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5553,5556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useMemo, useEffect } from \"react\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Search } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nconst DEFAULT_BENEFIT_TYPES = [\r\n  { code: \"01\", description: \"Pensão por morte – trabalhador rural\" },\r\n  { code: \"02\", description: \"Pensão por morte acidentária\" },\r\n  { code: \"03\", description: \"Pensão por morte – empregador rural\" },\r\n  { code: \"04\", description: \"Aposentadoria por invalidez – trabalhador rural\" },\r\n  { code: \"05\", description: \"Aposentadoria por invalidez acidentária – trabalhador rural\" },\r\n  { code: \"06\", description: \"Aposentadoria por invalidez – empregador rural\" },\r\n  { code: \"07\", description: \"Aposentadoria por velhice – trabalhador rural\" },\r\n  { code: \"08\", description: \"Aposentadoria por idade – empregador rural\" },\r\n  { code: \"11\", description: \"Amparo previdenciário por invalidez – trabalhador rural\" },\r\n  { code: \"12\", description: \"Amparo previdenciário por idade – trabalhador rural\" },\r\n  { code: \"18\", description: \"Auxílio-inclusão\" },\r\n  { code: \"19\", description: \"Pensão de estudante\" },\r\n  { code: \"20\", description: \"Pensão por morte de ex-diplomata\" },\r\n  { code: \"21\", description: \"Pensão por morte previdenciária\" },\r\n  { code: \"22\", description: \"Pensão por morte estatutária\" },\r\n  { code: \"23\", description: \"Pensão por morte de ex-combatente\" },\r\n  { code: \"24\", description: \"Pensão especial – ato institucional\" },\r\n  { code: \"26\", description: \"Pensão por morte especial\" },\r\n  { code: \"27\", description: \"Pensão por morte de servidor público federal\" },\r\n  { code: \"28\", description: \"Pensão por morte – Regime Geral\" },\r\n  { code: \"29\", description: \"Pensão por morte de ex-combatente marítimo\" },\r\n  { code: \"30\", description: \"Renda mensal vitalícia por incapacidade\" },\r\n  { code: \"32\", description: \"Aposentadoria por invalidez previdenciária\" },\r\n  { code: \"33\", description: \"Aposentadoria por invalidez de aeronauta\" },\r\n  { code: \"34\", description: \"Aposentadoria por invalidez de ex-combatente marítimo\" },\r\n  { code: \"37\", description: \"Aposentadoria de extranumerário da CAPIN\" },\r\n  { code: \"38\", description: \"Aposentadoria de extranumerário – funcionários públicos\" },\r\n  { code: \"40\", description: \"Renda mensal vitalícia por idade\" },\r\n  { code: \"41\", description: \"Aposentadoria por idade\" },\r\n  { code: \"42\", description: \"Aposentadoria por tempo de contribuição\" },\r\n  { code: \"43\", description: \"Aposentadoria por tempo de contribuição de ex-combatente\" },\r\n  { code: \"44\", description: \"Aposentadoria especial de aeronauta\" },\r\n  { code: \"45\", description: \"Aposentadoria por tempo de serviço – jornalista\" },\r\n  { code: \"46\", description: \"Aposentadoria especial\" },\r\n  { code: \"49\", description: \"Aposentadoria ordinária\" },\r\n  { code: \"51\", description: \"Aposentadoria por invalidez – extinto plano básico\" },\r\n  { code: \"52\", description: \"Aposentadoria por idade – extinto plano básico\" },\r\n  { code: \"54\", description: \"Pensão indenizatória a cargo da União\" },\r\n  { code: \"55\", description: \"Pensão por morte – extinto plano básico\" },\r\n  { code: \"56\", description: \"Pensão mensal vitalícia – síndrome da talidomida\" },\r\n  { code: \"57\", description: \"Aposentadoria por tempo de serviço de professores\" },\r\n  { code: \"58\", description: \"Aposentadoria de anistiados\" },\r\n  { code: \"59\", description: \"Pensão por morte de anistiados\" },\r\n  { code: \"60\", description: \"Benefício indenizatório a cargo da União\" },\r\n  { code: \"72\", description: \"Aposentadoria por tempo de serviço\" },\r\n  { code: \"78\", description: \"Aposentadoria por idade (ex-combatente marítimo)\" },\r\n  { code: \"81\", description: \"Aposentadoria compulsória (ex‑SASSE)\" },\r\n  { code: \"82\", description: \"Aposentadoria por tempo de serviço (ex‑SASSE)\" },\r\n  { code: \"83\", description: \"Aposentadoria por invalidez (ex‑SASSE)\" },\r\n  { code: \"84\", description: \"Pensão por morte (ex‑SASSE)\" },\r\n  { code: \"87\", description: \"Amparo assistencial à pessoa com deficiência\" },\r\n  { code: \"88\", description: \"Amparo assistencial à pessoa idosa\" },\r\n  { code: \"89\", description: \"Pensão especial – vítimas de hemodiálise\" },\r\n  { code: \"92\", description: \"Aposentadoria por invalidez por acidente de trabalho\" },\r\n  { code: \"93\", description: \"Pensão por morte por acidente de trabalho\" },\r\n  { code: \"96\", description: \"Pensão especial – hanseníase\" }\r\n];\r\n\r\ninterface BenefitTypeSelectProps {\r\n  value?: string;\r\n  onValueChange: (value: string) => void;\r\n  defaultValue?: string;\r\n}\r\n\r\nconst BenefitTypeSelect: React.FC<BenefitTypeSelectProps> = ({ value, onValueChange, defaultValue }) => {\r\n  const [searchTerm, setSearchTerm] = useState(\"\");\r\n  const [dbBenefitTypes, setDbBenefitTypes] = useState([]);\r\n\r\n  useEffect(() => {\r\n    fetchBenefitTypes();\r\n  }, []);\r\n\r\n  const fetchBenefitTypes = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('benefit_types')\r\n        .select('*')\r\n        .order('description');\r\n\r\n      if (error) throw error;\r\n      setDbBenefitTypes(data || []);\r\n    } catch (error) {\r\n      console.error('Error fetching benefit types:', error);\r\n    }\r\n  };\r\n\r\n  const allBenefitTypes = useMemo(() => {\r\n    // Combine default benefit types with database benefit types\r\n    const combined = [...DEFAULT_BENEFIT_TYPES];\r\n    \r\n    dbBenefitTypes.forEach((dbBenefit: any) => {\r\n      // Check if benefit already exists\r\n      const exists = combined.find(benefit => benefit.code === dbBenefit.code);\r\n      if (!exists) {\r\n        combined.push({\r\n          code: dbBenefit.code,\r\n          description: dbBenefit.description\r\n        });\r\n      }\r\n    });\r\n    \r\n    return combined.sort((a, b) => a.description.localeCompare(b.description));\r\n  }, [dbBenefitTypes]);\r\n\r\n  const filteredBenefits = useMemo(() => {\r\n    if (!searchTerm) return allBenefitTypes;\r\n    \r\n    const search = searchTerm.toLowerCase();\r\n    return allBenefitTypes.filter(benefit => \r\n      benefit.code.includes(search) || \r\n      benefit.description.toLowerCase().includes(search)\r\n    );\r\n  }, [searchTerm, allBenefitTypes]);\r\n\r\n  return (\r\n    <div>\r\n      <Label htmlFor=\"benefit_type\">Tipo de Benefício</Label>\r\n      <Select value={value} onValueChange={onValueChange} defaultValue={defaultValue}>\r\n        <SelectTrigger>\r\n          <SelectValue placeholder=\"Selecione o tipo\" />\r\n        </SelectTrigger>\r\n        <SelectContent className=\"bg-white border border-gray-200 shadow-lg z-50\">\r\n          <div className=\"p-2 border-b\">\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Pesquisar por código ou descrição...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"pl-8\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"max-h-[200px] overflow-y-auto\">\r\n            <SelectItem value=\"none\">Não informado</SelectItem>\r\n            {filteredBenefits.length > 0 ? (\r\n              filteredBenefits.map((benefit) => (\r\n                <SelectItem key={benefit.code} value={benefit.code}>\r\n                  {benefit.code} - {benefit.description}\r\n                </SelectItem>\r\n              ))\r\n            ) : (\r\n              <div className=\"p-2 text-sm text-muted-foreground text-center\">\r\n                Nenhum benefício encontrado\r\n              </div>\r\n            )}\r\n          </div>\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default BenefitTypeSelect;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\forms\\CommissionConfigSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1339,1342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1339,1342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":41,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":41,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1373,1376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1373,1376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Calculator, Zap, Percent, DollarSign, Clock, TrendingUp } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { mapProductToCommissionConfig } from \"@/utils/productMapping\";\r\n\r\ninterface CommissionRate {\r\n  id: string;\r\n  product: string;\r\n  name: string;\r\n  commission_type: 'percentage' | 'fixed';\r\n  percentage?: number;\r\n  fixed_value?: number;\r\n  active: boolean;\r\n}\r\n\r\ninterface CommissionTier {\r\n  id: string;\r\n  product: string;\r\n  name: string;\r\n  tier_type: 'value' | 'period';\r\n  min_amount?: number;\r\n  max_amount?: number;\r\n  min_period?: number;\r\n  max_period?: number;\r\n  commission_type: 'percentage' | 'fixed';\r\n  percentage?: number;\r\n  fixed_value?: number;\r\n  active: boolean;\r\n}\r\n\r\ninterface CommissionConfigSelectorProps {\r\n  selectedProduct: string;\r\n  onConfigSelect: (config: any) => void;\r\n  selectedConfig?: any;\r\n}\r\n\r\nconst CommissionConfigSelector: React.FC<CommissionConfigSelectorProps> = ({\r\n  selectedProduct,\r\n  onConfigSelect,\r\n  selectedConfig\r\n}) => {\r\n  const [showConfigs, setShowConfigs] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [fixedRates, setFixedRates] = useState<CommissionRate[]>([]);\r\n  const [variableTiers, setVariableTiers] = useState<CommissionTier[]>([]);\r\n  const [selectedOption, setSelectedOption] = useState<string>(selectedConfig?.id || 'product-only');\r\n\r\n  const mappedProduct = mapProductToCommissionConfig(selectedProduct);\r\n\r\n  useEffect(() => {\r\n    if (selectedConfig) {\r\n      setSelectedOption(selectedConfig.id);\r\n    } else {\r\n      setSelectedOption('product-only');\r\n    }\r\n  }, [selectedConfig]);\r\n\r\n  const loadCommissionConfigs = async () => {\r\n    if (!selectedProduct) {\r\n      toast.error(\"Selecione um produto primeiro\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Buscar configurações fixas\r\n      const { data: ratesData, error: ratesError } = await supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .eq('product', mappedProduct)\r\n        .eq('active', true);\r\n\r\n      // Buscar configurações variáveis\r\n      const { data: tiersData, error: tiersError } = await supabase\r\n        .from('commission_tiers')\r\n        .select('*')\r\n        .eq('product', mappedProduct)\r\n        .eq('active', true)\r\n        .order('min_amount', { ascending: true })\r\n        .order('min_period', { ascending: true });\r\n\r\n      if (ratesError) throw ratesError;\r\n      if (tiersError) throw tiersError;\r\n\r\n      setFixedRates(ratesData || []);\r\n      setVariableTiers(tiersData || []);\r\n      setShowConfigs(true);\r\n\r\n      if ((ratesData?.length || 0) + (tiersData?.length || 0) === 0) {\r\n        toast.info(`Nenhuma configuração de comissão encontrada para ${mappedProduct}`);\r\n      } else {\r\n        toast.success(`${(ratesData?.length || 0) + (tiersData?.length || 0)} configurações encontradas!`);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Erro ao carregar configurações:', error);\r\n      toast.error('Erro ao carregar configurações de comissão');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleConfigSelect = (optionId: string) => {\r\n    setSelectedOption(optionId);\r\n    \r\n    if (optionId === 'product-only') {\r\n      onConfigSelect(null);\r\n      return;\r\n    }\r\n\r\n    // Buscar configuração selecionada\r\n    const fixedConfig = fixedRates.find(rate => rate.id === optionId);\r\n    const variableConfig = variableTiers.find(tier => tier.id === optionId);\r\n    \r\n    const config = fixedConfig || variableConfig;\r\n    if (config) {\r\n      onConfigSelect({\r\n        id: config.id,\r\n        type: fixedConfig ? 'fixed' : 'variable',\r\n        name: config.name,\r\n        product: config.product,\r\n        commission_type: config.commission_type,\r\n        percentage: config.percentage,\r\n        fixed_value: config.fixed_value,\r\n        tier_type: variableConfig?.tier_type,\r\n        min_amount: variableConfig?.min_amount,\r\n        max_amount: variableConfig?.max_amount,\r\n        min_period: variableConfig?.min_period,\r\n        max_period: variableConfig?.max_period\r\n      });\r\n    }\r\n  };\r\n\r\n  const formatRange = (tier: CommissionTier) => {\r\n    if (tier.tier_type === 'value') {\r\n      const min = tier.min_amount ? `R$ ${tier.min_amount.toLocaleString('pt-BR')}` : 'R$ 0';\r\n      const max = tier.max_amount ? `R$ ${tier.max_amount.toLocaleString('pt-BR')}` : 'sem limite';\r\n      return `${min} - ${max}`;\r\n    } else {\r\n      const min = tier.min_period ? `${tier.min_period}x` : '0x';\r\n      const max = tier.max_period ? `${tier.max_period}x` : 'sem limite';\r\n      return `${min} - ${max}`;\r\n    }\r\n  };\r\n\r\n  const formatCommissionValue = (rate: CommissionRate | CommissionTier) => {\r\n    if (rate.commission_type === 'fixed') {\r\n      return `R$ ${rate.fixed_value?.toLocaleString('pt-BR') || '0'}`;\r\n    } else {\r\n      return `${rate.percentage || 0}%`;\r\n    }\r\n  };\r\n\r\n  if (!selectedProduct) {\r\n    return (\r\n      <div className=\"p-4 text-center text-gray-500\">\r\n        <Calculator className=\"h-12 w-12 mx-auto mb-2 text-gray-400\" />\r\n        <p>Selecione um produto para ver as configurações de comissão</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <Button\r\n          type=\"button\"\r\n          onClick={loadCommissionConfigs}\r\n          disabled={loading}\r\n          className=\"flex items-center gap-2\"\r\n          variant=\"outline\"\r\n        >\r\n          <Zap className=\"h-4 w-4\" />\r\n          {loading ? 'Carregando...' : 'Gerar Tabelas de Comissão'}\r\n        </Button>\r\n        {/* Removido: exibição do mapeamento do produto */}\r\n      </div>\r\n\r\n      {showConfigs && (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Calculator className=\"h-5 w-5\" />\r\n              Configurações de Comissão\r\n            </CardTitle>\r\n            <CardDescription>\r\n              Escolha como calcular a comissão para este produto\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            <div>\r\n              <Label htmlFor=\"commission-config\">Configuração de Comissão</Label>\r\n              <Select value={selectedOption} onValueChange={handleConfigSelect}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Selecione uma configuração\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"product-only\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <Badge variant=\"outline\">Apenas Produto</Badge>\r\n                      <span>Usar configuração padrão</span>\r\n                    </div>\r\n                  </SelectItem>\r\n                  \r\n                  {fixedRates.length > 0 && (\r\n                    <>\r\n                      <Separator />\r\n                      <div className=\"px-2 py-1 text-sm font-medium text-gray-600\">\r\n                        💰 Comissões Fixas\r\n                      </div>\r\n                      {fixedRates.map((rate) => (\r\n                        <SelectItem key={rate.id} value={rate.id}>\r\n                          <div className=\"flex items-center justify-between w-full\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {rate.commission_type === 'fixed' ? (\r\n                                <DollarSign className=\"h-4 w-4 text-green-600\" />\r\n                              ) : (\r\n                                <Percent className=\"h-4 w-4 text-blue-600\" />\r\n                              )}\r\n                              <span>{rate.name}</span>\r\n                            </div>\r\n                            <Badge variant=\"secondary\">\r\n                              {formatCommissionValue(rate)}\r\n                            </Badge>\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                  \r\n                  {variableTiers.length > 0 && (\r\n                    <>\r\n                      <Separator />\r\n                      <div className=\"px-2 py-1 text-sm font-medium text-gray-600\">\r\n                        📊 Comissões Variáveis\r\n                      </div>\r\n                      {variableTiers.map((tier) => (\r\n                        <SelectItem key={tier.id} value={tier.id}>\r\n                          <div className=\"flex items-center justify-between w-full\">\r\n                            <div className=\"flex items-center gap-2\">\r\n                              {tier.tier_type === 'value' ? (\r\n                                <TrendingUp className=\"h-4 w-4 text-purple-600\" />\r\n                              ) : (\r\n                                <Clock className=\"h-4 w-4 text-orange-600\" />\r\n                              )}\r\n                              <div>\r\n                                <span className=\"font-medium\">{tier.name}</span>\r\n                                <div className=\"text-xs text-gray-500\">\r\n                                  {formatRange(tier)}\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            <Badge variant=\"secondary\">\r\n                              {formatCommissionValue(tier)}\r\n                            </Badge>\r\n                          </div>\r\n                        </SelectItem>\r\n                      ))}\r\n                    </>\r\n                  )}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {selectedOption !== 'product-only' && (\r\n              <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\r\n                <div className=\"flex items-center gap-2 mb-2\">\r\n                  <Badge variant=\"default\">Configuração Selecionada</Badge>\r\n                </div>\r\n                {(() => {\r\n                  const config = fixedRates.find(r => r.id === selectedOption) || \r\n                              variableTiers.find(t => t.id === selectedOption);\r\n                  if (!config) return null;\r\n                  \r\n                  return (\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex justify-between items-center\">\r\n                        <span className=\"font-medium\">{config.name}</span>\r\n                        <Badge variant=\"outline\">\r\n                          {formatCommissionValue(config)}\r\n                        </Badge>\r\n                      </div>\r\n                      {'tier_type' in config && (\r\n                        <div className=\"text-sm text-gray-600\">\r\n                          Faixa: {formatRange(config as CommissionTier)}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })()}\r\n              </div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CommissionConfigSelector; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads-premium\\LeadPremiumChat.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchMensagens'. Either include it or remove the dependency array.","line":173,"column":6,"nodeType":"ArrayExpression","endLine":173,"endColumn":15,"suggestions":[{"desc":"Update the dependencies array to be: [fetchMensagens, lead.id]","fix":{"range":[5163,5172],"text":"[fetchMensagens, lead.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useEffect, useRef } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { ArrowLeft, Send, User, Headphones } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\n\r\ninterface LeadPremium {\r\n  id: string;\r\n  nome: string;\r\n  telefone: string;\r\n  mensagem: string;\r\n  origem: string;\r\n  modalidade: string;\r\n  status: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface Mensagem {\r\n  id: string;\r\n  conteudo: string;\r\n  remetente: 'lead' | 'atendente';\r\n  created_at: string;\r\n}\r\n\r\ninterface LeadPremiumChatProps {\r\n  lead: LeadPremium;\r\n  onBack: () => void;\r\n  onLeadUpdate: (updatedLead: LeadPremium) => void;\r\n}\r\n\r\nconst LeadPremiumChat: React.FC<LeadPremiumChatProps> = ({ lead, onBack, onLeadUpdate }) => {\r\n  const [mensagens, setMensagens] = useState<Mensagem[]>([]);\r\n  const [novaMensagem, setNovaMensagem] = useState(\"\");\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isSending, setIsSending] = useState(false);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  const getModalidadeBadgeColor = (modalidade: string) => {\r\n    switch (modalidade) {\r\n      case \"Aposentado\":\r\n        return \"bg-blue-100 text-blue-800 border-blue-200\";\r\n      case \"Bolsa Família\":\r\n        return \"bg-green-100 text-green-800 border-green-200\";\r\n      case \"FGTS\":\r\n        return \"bg-purple-100 text-purple-800 border-purple-200\";\r\n      default:\r\n        return \"bg-gray-100 text-gray-800 border-gray-200\";\r\n    }\r\n  };\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  const fetchMensagens = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('mensagens_premium')\r\n        .select('*')\r\n        .eq('lead_id', lead.id)\r\n        .order('created_at', { ascending: true });\r\n\r\n      if (error) {\r\n        console.error('Erro ao buscar mensagens:', error);\r\n        toast.error(\"Erro ao carregar mensagens\");\r\n        return;\r\n      }\r\n\r\n      // Tipagem correta dos dados vindos do Supabase\r\n      const mensagensTyped: Mensagem[] = (data || []).map(msg => ({\r\n        id: msg.id,\r\n        conteudo: msg.conteudo,\r\n        remetente: msg.remetente as 'lead' | 'atendente',\r\n        created_at: msg.created_at\r\n      }));\r\n\r\n      setMensagens(mensagensTyped);\r\n    } catch (error) {\r\n      console.error('Erro ao buscar mensagens:', error);\r\n      toast.error(\"Erro ao carregar mensagens\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const enviarMensagem = async () => {\r\n    if (!novaMensagem.trim() || isSending) return;\r\n\r\n    setIsSending(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('mensagens_premium')\r\n        .insert({\r\n          lead_id: lead.id,\r\n          user_id: user.id,\r\n          conteudo: novaMensagem.trim(),\r\n          remetente: 'atendente'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Erro ao enviar mensagem:', error);\r\n        toast.error(\"Erro ao enviar mensagem\");\r\n        return;\r\n      }\r\n\r\n      // Tipagem correta da nova mensagem\r\n      const novaMensagemTyped: Mensagem = {\r\n        id: data.id,\r\n        conteudo: data.conteudo,\r\n        remetente: data.remetente as 'lead' | 'atendente',\r\n        created_at: data.created_at\r\n      };\r\n\r\n      setMensagens(prev => [...prev, novaMensagemTyped]);\r\n      setNovaMensagem(\"\");\r\n    } catch (error) {\r\n      console.error('Erro ao enviar mensagem:', error);\r\n      toast.error(\"Erro ao enviar mensagem\");\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  const atualizarStatus = async (novoStatus: string) => {\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('leads_premium')\r\n        .update({ status: novoStatus })\r\n        .eq('id', lead.id)\r\n        .eq('user_id', user.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) {\r\n        console.error('Erro ao atualizar status:', error);\r\n        toast.error(\"Erro ao atualizar status\");\r\n        return;\r\n      }\r\n\r\n      onLeadUpdate(data);\r\n      toast.success(\"Status atualizado com sucesso!\");\r\n    } catch (error) {\r\n      console.error('Erro ao atualizar status:', error);\r\n      toast.error(\"Erro ao atualizar status\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchMensagens();\r\n  }, [lead.id]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [mensagens]);\r\n\r\n  // Adicionar mensagem inicial se não existir\r\n  useEffect(() => {\r\n    if (!isLoading && mensagens.length === 0 && lead.mensagem) {\r\n      const addInitialMessage = async () => {\r\n        try {\r\n          const { data: { user } } = await supabase.auth.getUser();\r\n          if (!user) return;\r\n\r\n          const { data, error } = await supabase\r\n            .from('mensagens_premium')\r\n            .insert({\r\n              lead_id: lead.id,\r\n              user_id: user.id,\r\n              conteudo: lead.mensagem,\r\n              remetente: 'lead'\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n          if (!error && data) {\r\n            const mensagemTyped: Mensagem = {\r\n              id: data.id,\r\n              conteudo: data.conteudo,\r\n              remetente: data.remetente as 'lead' | 'atendente',\r\n              created_at: data.created_at\r\n            };\r\n            setMensagens([mensagemTyped]);\r\n          }\r\n        } catch (error) {\r\n          console.error('Erro ao adicionar mensagem inicial:', error);\r\n        }\r\n      };\r\n\r\n      addInitialMessage();\r\n    }\r\n  }, [isLoading, mensagens.length, lead]);\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-4\">\r\n      <Button variant=\"outline\" size=\"sm\" onClick={onBack}>\r\n        <ArrowLeft className=\"h-4 w-4\" />\r\n      </Button>\r\n      <Select value={lead.status} onValueChange={atualizarStatus}>\r\n        <SelectTrigger className=\"w-48\">\r\n          <SelectValue />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"Novo\">Novo</SelectItem>\r\n          <SelectItem value=\"Em atendimento\">Em atendimento</SelectItem>\r\n          <SelectItem value=\"Fechado\">Fechado</SelectItem>\r\n          <SelectItem value=\"Perdido\">Perdido</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout \r\n      title={`Chat com ${lead.nome}`}\r\n      subtitle={`📱 ${lead.telefone} • 📍 ${lead.origem}`}\r\n      headerActions={headerActions}\r\n      showTrialBanner={false}\r\n    >\r\n      <div className=\"flex flex-col gap-4\">\r\n        {/* Badge da modalidade */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <Badge className={getModalidadeBadgeColor(lead.modalidade)}>\r\n            {lead.modalidade}\r\n          </Badge>\r\n        </div>\r\n\r\n        {/* Área de Mensagens */}\r\n        <Card className=\"flex-1 flex flex-col h-[calc(100vh-300px)]\">\r\n          <CardContent className=\"flex-1 flex flex-col p-4\">\r\n            <div className=\"flex-1 overflow-y-auto space-y-4 mb-4\">\r\n              {isLoading ? (\r\n                <div className=\"text-center py-8\">Carregando conversa...</div>\r\n              ) : mensagens.length === 0 ? (\r\n                <div className=\"text-center py-8 text-gray-500\">\r\n                  <User className=\"h-12 w-12 mx-auto mb-2 text-gray-300\" />\r\n                  <p>Nenhuma mensagem ainda</p>\r\n                </div>\r\n              ) : (\r\n                mensagens.map((mensagem) => (\r\n                  <div\r\n                    key={mensagem.id}\r\n                    className={`flex ${mensagem.remetente === 'atendente' ? 'justify-end' : 'justify-start'}`}\r\n                  >\r\n                    <div className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\r\n                      mensagem.remetente === 'atendente'\r\n                        ? 'bg-blue-500 text-white'\r\n                        : 'bg-gray-100 text-gray-900'\r\n                    }`}>\r\n                      <div className=\"flex items-center gap-1 mb-1\">\r\n                        {mensagem.remetente === 'atendente' ? (\r\n                          <Headphones className=\"h-3 w-3\" />\r\n                        ) : (\r\n                          <User className=\"h-3 w-3\" />\r\n                        )}\r\n                        <span className=\"text-xs opacity-75\">\r\n                          {mensagem.remetente === 'atendente' ? 'Atendente' : lead.nome}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-sm\">{mensagem.conteudo}</p>\r\n                      <p className={`text-xs mt-1 ${\r\n                        mensagem.remetente === 'atendente' ? 'text-blue-100' : 'text-gray-500'\r\n                      }`}>\r\n                        {format(new Date(mensagem.created_at), \"HH:mm\", { locale: ptBR })}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                ))\r\n              )}\r\n              <div ref={messagesEndRef} />\r\n            </div>\r\n\r\n            {/* Campo de Envio */}\r\n            <div className=\"flex gap-2\">\r\n              <Input\r\n                placeholder=\"Digite sua mensagem...\"\r\n                value={novaMensagem}\r\n                onChange={(e) => setNovaMensagem(e.target.value)}\r\n                onKeyPress={(e) => e.key === 'Enter' && enviarMensagem()}\r\n                disabled={isSending}\r\n              />\r\n              <Button onClick={enviarMensagem} disabled={!novaMensagem.trim() || isSending}>\r\n                <Send className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default LeadPremiumChat;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\AddLeadButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[640,643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[640,643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2163,2166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2163,2166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2577,2580],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2577,2580],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Plus } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport LeadForm from \"@/components/LeadForm\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst AddLeadButton = ({ onLeadAdded }: { onLeadAdded?: () => void }) => {\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  const handleFormSubmit = async (values: any) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { selectedTags, ...leadData } = values;\r\n\r\n      // Processar payment_period para evitar erro de integer\r\n      const processedLeadData = {\r\n        ...leadData,\r\n        payment_period: leadData.payment_period && leadData.payment_period !== \"\" && leadData.payment_period !== \"none\" \r\n          ? parseInt(leadData.payment_period) \r\n          : undefined\r\n      };\r\n\r\n      console.log(\"AddLeadButton - Lead data to insert:\", processedLeadData);\r\n      console.log(\"AddLeadButton - Payment period:\", {\r\n        original: leadData.payment_period,\r\n        processed: processedLeadData.payment_period\r\n      });\r\n\r\n      const { data: leadInsertData, error: leadError } = await supabase\r\n        .from(\"leads\")\r\n        .insert({\r\n          ...processedLeadData,\r\n          user_id: userData.user.id,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (leadError) {\r\n        console.error(\"AddLeadButton - Database error:\", leadError);\r\n        throw leadError;\r\n      }\r\n\r\n      // Save tag assignments if any tags were selected\r\n      if (selectedTags && selectedTags.length > 0) {\r\n        const tagAssignments = selectedTags.map((tagId: string) => ({\r\n          lead_id: leadInsertData.id,\r\n          tag_id: tagId,\r\n          user_id: userData.user.id,\r\n        }));\r\n\r\n        const { error: tagError } = await (supabase as any)\r\n          .from('lead_tag_assignments')\r\n          .insert(tagAssignments);\r\n\r\n        if (tagError) {\r\n          console.error('Error saving tag assignments:', tagError);\r\n          toast.error('Lead salvo, mas erro ao aplicar etiquetas');\r\n        }\r\n      }\r\n      \r\n      toast.success(\"Lead cadastrado com sucesso!\");\r\n      setIsOpen(false);\r\n      if (onLeadAdded) onLeadAdded();\r\n    } catch (error: any) {\r\n      console.error(\"AddLeadButton - Error creating lead:\", error);\r\n      toast.error(`Erro ao cadastrar lead: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button className=\"bg-blue-600 hover:bg-blue-700\">\r\n          <Plus className=\"mr-2 h-4 w-4\" />\r\n          Cadastrar Lead\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-[600px] max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>Cadastrar Novo Lead</DialogTitle>\r\n          <DialogDescription>\r\n            Preencha os dados do novo lead no formulário abaixo.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <LeadForm \r\n          onSubmit={handleFormSubmit} \r\n          onCancel={() => setIsOpen(false)}\r\n          isLoading={isLoading}\r\n        />\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AddLeadButton;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\ClientVisits.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2359,2362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2359,2362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchVisits'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchVisits, leadId]","fix":{"range":[2544,2552],"text":"[fetchVisits, leadId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":110,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":110,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3514,3517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3514,3517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Calendar, Clock, Plus, Eye } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\n\r\ninterface ClientVisit {\r\n  id: string;\r\n  lead_id: string;\r\n  visit_date: string;\r\n  visit_type: string;\r\n  observations: string;\r\n  created_at: string;\r\n}\r\n\r\ninterface ClientVisitsProps {\r\n  leadId: string;\r\n  leadName: string;\r\n}\r\n\r\nconst visitTypeLabels = {\r\n  primeira_visita: \"Primeira Visita\",\r\n  retorno: \"Retorno\",\r\n  contato_telefonico: \"Contato Telefônico\",\r\n  whatsapp: \"WhatsApp\",\r\n  email: \"E-mail\"\r\n};\r\n\r\nconst visitTypeColors = {\r\n  primeira_visita: \"bg-blue-100 text-blue-800\",\r\n  retorno: \"bg-green-100 text-green-800\",\r\n  contato_telefonico: \"bg-yellow-100 text-yellow-800\",\r\n  whatsapp: \"bg-emerald-100 text-emerald-800\",\r\n  email: \"bg-purple-100 text-purple-800\"\r\n};\r\n\r\nconst ClientVisits: React.FC<ClientVisitsProps> = ({ leadId, leadName }) => {\r\n  const [visits, setVisits] = useState<ClientVisit[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showAddDialog, setShowAddDialog] = useState(false);\r\n  const [showHistoryDialog, setShowHistoryDialog] = useState(false);\r\n  const [formData, setFormData] = useState({\r\n    visit_date: format(new Date(), 'yyyy-MM-dd'),\r\n    visit_type: '',\r\n    observations: ''\r\n  });\r\n\r\n  const fetchVisits = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"client_visits\")\r\n        .select(\"*\")\r\n        .eq(\"lead_id\", leadId)\r\n        .order(\"visit_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setVisits(data || []);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching visits:\", error);\r\n      toast.error(\"Erro ao carregar histórico de visitas\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchVisits();\r\n  }, [leadId]);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!formData.visit_type) {\r\n      toast.error(\"Selecione o tipo de visita\");\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { error } = await supabase\r\n        .from(\"client_visits\")\r\n        .insert({\r\n          lead_id: leadId,\r\n          user_id: userData.user.id,\r\n          visit_date: formData.visit_date,\r\n          visit_type: formData.visit_type,\r\n          observations: formData.observations\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"Visita registrada com sucesso!\");\r\n      setShowAddDialog(false);\r\n      setFormData({\r\n        visit_date: format(new Date(), 'yyyy-MM-dd'),\r\n        visit_type: '',\r\n        observations: ''\r\n      });\r\n      fetchVisits();\r\n    } catch (error: any) {\r\n      console.error(\"Error saving visit:\", error);\r\n      toast.error(\"Erro ao registrar visita\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-2\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <Dialog open={showAddDialog} onOpenChange={setShowAddDialog}>\r\n          <DialogTrigger asChild>\r\n            <Button variant=\"outline\" size=\"sm\">\r\n              <Plus className=\"h-4 w-4 mr-1\" />\r\n              Nova Visita\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent className=\"sm:max-w-md\">\r\n            <DialogHeader>\r\n              <DialogTitle>Registrar Nova Visita</DialogTitle>\r\n              <DialogDescription>\r\n                Registre uma nova visita ou contato com {leadName}\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"visit_date\">Data da Visita</Label>\r\n                <Input\r\n                  id=\"visit_date\"\r\n                  type=\"date\"\r\n                  value={formData.visit_date}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, visit_date: e.target.value }))}\r\n                  required\r\n                />\r\n              </div>\r\n              \r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"visit_type\">Tipo de Contato</Label>\r\n                <Select value={formData.visit_type} onValueChange={(value) => setFormData(prev => ({ ...prev, visit_type: value }))}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Selecione o tipo\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"primeira_visita\">Primeira Visita</SelectItem>\r\n                    <SelectItem value=\"retorno\">Retorno</SelectItem>\r\n                    <SelectItem value=\"contato_telefonico\">Contato Telefônico</SelectItem>\r\n                    <SelectItem value=\"whatsapp\">WhatsApp</SelectItem>\r\n                    <SelectItem value=\"email\">E-mail</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"observations\">Observações</Label>\r\n                <Textarea\r\n                  id=\"observations\"\r\n                  placeholder=\"Descreva o que aconteceu durante a visita...\"\r\n                  value={formData.observations}\r\n                  onChange={(e) => setFormData(prev => ({ ...prev, observations: e.target.value }))}\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              <DialogFooter>\r\n                <Button type=\"button\" variant=\"outline\" onClick={() => setShowAddDialog(false)}>\r\n                  Cancelar\r\n                </Button>\r\n                <Button type=\"submit\" disabled={isLoading}>\r\n                  {isLoading ? \"Salvando...\" : \"Registrar Visita\"}\r\n                </Button>\r\n              </DialogFooter>\r\n            </form>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        {visits.length > 0 && (\r\n          <Dialog open={showHistoryDialog} onOpenChange={setShowHistoryDialog}>\r\n            <DialogTrigger asChild>\r\n              <Button variant=\"outline\" size=\"sm\">\r\n                <Eye className=\"h-4 w-4 mr-1\" />\r\n                Ver Histórico ({visits.length})\r\n              </Button>\r\n            </DialogTrigger>\r\n            <DialogContent className=\"sm:max-w-2xl max-h-[80vh] overflow-y-auto\">\r\n              <DialogHeader>\r\n                <DialogTitle>Histórico de Visitas - {leadName}</DialogTitle>\r\n                <DialogDescription>\r\n                  Todas as interações registradas com este cliente\r\n                </DialogDescription>\r\n              </DialogHeader>\r\n              <div className=\"space-y-4\">\r\n                {visits.map((visit) => (\r\n                  <Card key={visit.id}>\r\n                    <CardHeader className=\"pb-3\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <CardTitle className=\"text-sm flex items-center gap-2\">\r\n                          <Calendar className=\"h-4 w-4\" />\r\n                          {format(new Date(visit.visit_date), \"dd 'de' MMMM 'de' yyyy\", { locale: ptBR })}\r\n                        </CardTitle>\r\n                        <Badge className={visitTypeColors[visit.visit_type as keyof typeof visitTypeColors]}>\r\n                          {visitTypeLabels[visit.visit_type as keyof typeof visitTypeLabels]}\r\n                        </Badge>\r\n                      </div>\r\n                      <CardDescription className=\"flex items-center gap-1 text-xs\">\r\n                        <Clock className=\"h-3 w-3\" />\r\n                        Registrado em {format(new Date(visit.created_at), \"dd/MM/yyyy 'às' HH:mm\", { locale: ptBR })}\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                    {visit.observations && (\r\n                      <CardContent className=\"pt-0\">\r\n                        <p className=\"text-sm text-muted-foreground\">{visit.observations}</p>\r\n                      </CardContent>\r\n                    )}\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            </DialogContent>\r\n          </Dialog>\r\n        )}\r\n      </div>\r\n      \r\n      {visits.length > 0 && (\r\n        <div className=\"text-xs text-muted-foreground\">\r\n          Última visita: {format(new Date(visits[0].visit_date), \"dd/MM/yyyy\", { locale: ptBR })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ClientVisits;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\CsvParser.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\DocumentUpload.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1937,1940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1937,1940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2373,2376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2373,2376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchDocumentCount' and 'fetchDocuments'. Either include them or remove the dependency array.","line":87,"column":6,"nodeType":"ArrayExpression","endLine":87,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchDocumentCount, fetchDocuments, leadId]","fix":{"range":[2944,2952],"text":"[fetchDocumentCount, fetchDocuments, leadId]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4421,4424],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4421,4424],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5228,5231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5228,5231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":232,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":232,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7656,7659],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7656,7659],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":459,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":459,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16859,16862],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16859,16862],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":460,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16956,16959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16956,16959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Paperclip, X, File, FileText, Image, Loader2, Eye } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\n\r\ninterface DocumentUploadProps {\r\n  leadId: string;\r\n}\r\n\r\ninterface Document {\r\n  id: string;\r\n  file_name: string;\r\n  file_type: string;\r\n  file_path: string;\r\n  created_at: string;\r\n}\r\n\r\nconst DocumentUpload: React.FC<DocumentUploadProps> = ({ leadId }) => {\r\n  const [documents, setDocuments] = useState<Document[]>([]);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [progress, setProgress] = useState(0);\r\n  const [isDocumentsDialogOpen, setIsDocumentsDialogOpen] = useState(false);\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [documentToDelete, setDocumentToDelete] = useState<Document | null>(null);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n  const [imageUrls, setImageUrls] = useState<Record<string, string>>({});\r\n  const [loadingImages, setLoadingImages] = useState<Record<string, boolean>>({});\r\n  const [hasDocumentsFlag, setHasDocumentsFlag] = useState(false);\r\n  const fileInputRef = useRef<HTMLInputElement>(null);\r\n  \r\n  const fetchDocumentCount = async () => {\r\n    try {\r\n      const { count, error } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"id\", { count: \"exact\", head: true })\r\n        .eq(\"lead_id\", leadId);\r\n\r\n      if (error) throw error;\r\n      setHasDocumentsFlag(!!count && count > 0);\r\n    } catch (error: any) {\r\n      console.error(\"Error counting documents:\", error);\r\n    }\r\n  };\r\n  \r\n  const fetchDocuments = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from(\"documents\")\r\n        .select(\"*\")\r\n        .eq(\"lead_id\", leadId);\r\n        \r\n      if (error) throw error;\r\n      \r\n      const docs = data || [];\r\n      setDocuments(docs);\r\n      setHasDocumentsFlag(docs.length > 0);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching documents:\", error);\r\n      toast.error(`Erro ao buscar documentos: ${error.message}`);\r\n    }\r\n  };\r\n  \r\n  // Manter o modal principal aberto enquanto o dialog de senha estiver ativo\r\n  useEffect(() => {\r\n    if (showAdminPasswordDialog && !isDocumentsDialogOpen) {\r\n      setIsDocumentsDialogOpen(true);\r\n    }\r\n  }, [showAdminPasswordDialog, isDocumentsDialogOpen]);\r\n  \r\n  useEffect(() => {\r\n    if (leadId) {\r\n      fetchDocumentCount();\r\n      fetchDocuments();\r\n    }\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, [leadId]);\r\n\r\n  const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n    \r\n    setIsUploading(true);\r\n    setProgress(0);\r\n    \r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) throw new Error(\"Usuário não autenticado\");\r\n      \r\n      const userId = userData.user.id;\r\n      const totalFiles = files.length;\r\n      let successCount = 0;\r\n      let errorCount = 0;\r\n      \r\n      // Processar todos os arquivos\r\n      for (let i = 0; i < totalFiles; i++) {\r\n        const file = files[i];\r\n        const fileProgress = Math.round(((i + 1) / totalFiles) * 100);\r\n        setProgress(fileProgress);\r\n        \r\n        try {\r\n          const filePath = `${userId}/${leadId}/${Date.now()}_${i}_${file.name}`;\r\n      \r\n          const { error: uploadError } = await supabase.storage\r\n        .from(\"lead-documents\")\r\n        .upload(filePath, file, {\r\n          cacheControl: \"3600\",\r\n          upsert: false\r\n        });\r\n        \r\n      if (uploadError) throw uploadError;\r\n      \r\n      const { error: dbError } = await supabase.from(\"documents\").insert({\r\n        lead_id: leadId,\r\n        user_id: userId,\r\n        file_name: file.name,\r\n        file_path: filePath,\r\n        file_type: file.type,\r\n      });\r\n      \r\n      if (dbError) throw dbError;\r\n      \r\n          successCount++;\r\n        } catch (fileError: any) {\r\n          console.error(`Error uploading file ${file.name}:`, fileError);\r\n          errorCount++;\r\n        }\r\n      }\r\n      \r\n      // Mostrar mensagem de sucesso/erro\r\n      if (successCount > 0 && errorCount === 0) {\r\n        toast.success(`${successCount} ${successCount === 1 ? 'documento enviado' : 'documentos enviados'} com sucesso!`);\r\n      } else if (successCount > 0 && errorCount > 0) {\r\n        toast.warning(`${successCount} ${successCount === 1 ? 'documento enviado' : 'documentos enviados'}, ${errorCount} ${errorCount === 1 ? 'erro' : 'erros'}`);\r\n      } else {\r\n        toast.error(`Erro ao enviar ${totalFiles === 1 ? 'documento' : 'documentos'}`);\r\n      }\r\n      \r\n      await fetchDocuments();\r\n      setProgress(100);\r\n      setHasDocumentsFlag(true);\r\n    } catch (error: any) {\r\n      console.error(\"Error uploading documents:\", error);\r\n      toast.error(`Erro ao enviar documentos: ${error.message}`);\r\n    } finally {\r\n      setIsUploading(false);\r\n      setTimeout(() => setProgress(0), 1000);\r\n      e.target.value = \"\";\r\n    }\r\n  };\r\n\r\n  const handleDeleteClick = (document: Document, e?: React.MouseEvent) => {\r\n    // Prevenir propagação de eventos\r\n    if (e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    \r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setDocumentToDelete(document);\r\n      setShowAdminPasswordDialog(true);\r\n      setIsDocumentsDialogOpen(true); // garantir que o modal principal permanece aberto\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    executeDelete(document);\r\n  };\r\n\r\n  const confirmDeleteDocument = async () => {\r\n    const docToDelete = documentToDelete;\r\n    if (docToDelete) {\r\n      await executeDelete(docToDelete);\r\n      setDocumentToDelete(null);\r\n    }\r\n  };\r\n\r\n  const executeDelete = async (document: Document) => {\r\n    try {\r\n      if (!document || !document.id || !document.file_path) {\r\n        throw new Error('Dados do documento inválidos');\r\n      }\r\n\r\n      const { error: storageError } = await supabase.storage\r\n        .from(\"lead-documents\")\r\n        .remove([document.file_path]);\r\n        \r\n      if (storageError) {\r\n        console.error('Erro ao remover do storage:', storageError);\r\n        throw storageError;\r\n      }\r\n      \r\n      const { error: dbError } = await supabase\r\n        .from(\"documents\")\r\n        .delete()\r\n        .eq(\"id\", document.id);\r\n        \r\n      if (dbError) {\r\n        console.error('Erro ao deletar do banco:', dbError);\r\n        throw dbError;\r\n      }\r\n      \r\n      // Atualizar lista de documentos e flag localmente (sem novo fetch pesado)\r\n      setDocuments(prevDocs => {\r\n        const next = prevDocs.filter(doc => doc.id !== document.id);\r\n        setHasDocumentsFlag(next.length > 0);\r\n        return next;\r\n      });\r\n      \r\n      // Remover URL da imagem se existir\r\n      if (imageUrls[document.id]) {\r\n        setImageUrls(prevUrls => {\r\n          const newUrls = { ...prevUrls };\r\n          delete newUrls[document.id];\r\n          return newUrls;\r\n        });\r\n      }\r\n      \r\n      toast.success(\"Documento excluído com sucesso!\");\r\n      \r\n    } catch (error: any) {\r\n      console.error(\"Error deleting document:\", error);\r\n      const errorMessage = error?.message || 'Erro desconhecido ao excluir documento';\r\n      toast.error(`Erro ao excluir documento: ${errorMessage}`);\r\n      throw error; // Re-throw para que o chamador possa tratar\r\n    }\r\n  };\r\n\r\n  const getDocumentIcon = (type: string, size: \"small\" | \"large\" = \"small\") => {\r\n    const sizeClass = size === \"large\" ? \"h-16 w-16\" : \"h-5 w-5\";\r\n    if (type.startsWith(\"image/\")) {\r\n      return <Image className={`${sizeClass} text-blue-500`} />;\r\n    } else if (type.includes(\"pdf\")) {\r\n      return <FileText className={`${sizeClass} text-red-500`} />;\r\n    } else {\r\n      return <File className={`${sizeClass} text-gray-500`} />;\r\n    }\r\n  };\r\n\r\n  const getFileUrl = async (path: string) => {\r\n    const { data } = await supabase.storage\r\n      .from(\"lead-documents\")\r\n      .createSignedUrl(path, 60);\r\n      \r\n    return data?.signedUrl;\r\n  };\r\n\r\n  // Carregar URLs das imagens para preview\r\n  useEffect(() => {\r\n    const loadImageUrls = async () => {\r\n      const imageDocs = documents.filter(doc => doc.file_type.startsWith(\"image/\"));\r\n      if (imageDocs.length === 0) return;\r\n\r\n      const urls: Record<string, string> = {};\r\n      const loading: Record<string, boolean> = {};\r\n\r\n      for (const doc of imageDocs) {\r\n        loading[doc.id] = true;\r\n        setLoadingImages(prev => ({ ...prev, [doc.id]: true }));\r\n        try {\r\n          const url = await getFileUrl(doc.file_path);\r\n          if (url) {\r\n            urls[doc.id] = url;\r\n          }\r\n        } catch (error) {\r\n          console.error(`Error loading image for ${doc.id}:`, error);\r\n        }\r\n        loading[doc.id] = false;\r\n        setLoadingImages(prev => ({ ...prev, [doc.id]: false }));\r\n      }\r\n\r\n      setImageUrls(prev => ({ ...prev, ...urls }));\r\n    };\r\n\r\n    if (documents.length > 0) {\r\n      loadImageUrls();\r\n    }\r\n  }, [documents]);\r\n\r\n  const handleDocumentClick = async (document: Document) => {\r\n    try {\r\n      const url = await getFileUrl(document.file_path);\r\n      if (url) {\r\n        window.open(url, \"_blank\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error opening document:\", error);\r\n    }\r\n  };\r\n\r\n  const hasDocuments = hasDocumentsFlag || documents.length > 0;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <h3 className=\"text-lg font-medium\">Documentos</h3>\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"sm\"\r\n            type=\"button\"\r\n            className={`p-1 h-8 w-8 ${hasDocuments ? \"text-green-600 hover:text-green-700 hover:bg-green-50\" : \"text-gray-400 hover:text-gray-600 hover:bg-gray-50\"}`}\r\n            onClick={() => setIsDocumentsDialogOpen(true)}\r\n            title={hasDocuments ? \"Ver documentos anexados\" : \"Nenhum documento anexado\"}\r\n          >\r\n            <Eye className={`h-5 w-5 ${hasDocuments ? \"text-green-600\" : \"text-gray-400\"}`} />\r\n          </Button>\r\n        </div>\r\n        <div>\r\n          <Input\r\n            type=\"file\"\r\n            id=\"document-upload\"\r\n            ref={fileInputRef}\r\n            className=\"hidden\"\r\n            onChange={handleFileChange}\r\n            disabled={isUploading}\r\n            accept=\".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.xls,.xlsx\"\r\n            multiple\r\n          />\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            type=\"button\"\r\n            className={`flex items-center ${isUploading ? \"opacity-50\" : \"\"}`}\r\n            disabled={isUploading}\r\n            onClick={() => fileInputRef.current?.click()}\r\n          >\r\n            <Paperclip className=\"mr-2 h-4 w-4\" />\r\n            {isUploading ? `Enviando... ${progress}%` : \"Anexar documentos\"}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <Dialog\r\n        open={isDocumentsDialogOpen || showAdminPasswordDialog}\r\n        onOpenChange={(open) => {\r\n          // Não permitir fechar enquanto o dialog de senha estiver aberto\r\n          if (!open && showAdminPasswordDialog) {\r\n            return;\r\n          }\r\n          setIsDocumentsDialogOpen(open);\r\n          if (!open) {\r\n            setShowAdminPasswordDialog(false);\r\n            setDocumentToDelete(null);\r\n          } else {\r\n            fetchDocuments().catch(() => {});\r\n          }\r\n        }}\r\n      >\r\n        <DialogContent\r\n          className=\"sm:max-w-4xl max-h-[90vh] overflow-y-auto\"\r\n          onInteractOutside={(e) => {\r\n            if (showAdminPasswordDialog) {\r\n              e.preventDefault();\r\n            }\r\n          }}\r\n          onPointerDownOutside={(e) => {\r\n            if (showAdminPasswordDialog) {\r\n              e.preventDefault();\r\n            }\r\n          }}\r\n          onEscapeKeyDown={(e) => {\r\n            if (showAdminPasswordDialog) {\r\n              e.preventDefault();\r\n            }\r\n          }}\r\n        >\r\n          <DialogHeader>\r\n            <DialogTitle>Documentos Anexados</DialogTitle>\r\n            <DialogDescription>\r\n              Visualize e gerencie os documentos anexados a este lead\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n\r\n          <div className=\"space-y-4 mt-4\">\r\n            {documents.length > 0 ? (\r\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4\">\r\n                {documents.map((document) => {\r\n                  const isImage = document.file_type.startsWith(\"image/\");\r\n                  const imageUrl = imageUrls[document.id];\r\n                  const isLoading = loadingImages[document.id];\r\n\r\n                  return (\r\n                  <div \r\n                    key={document.id} \r\n                      className=\"relative group bg-gray-50 rounded-lg border border-gray-200 hover:border-gray-300 hover:shadow-md transition-all overflow-hidden\"\r\n                      onClick={(e) => {\r\n                        // Prevenir clique no card se estiver clicando no botão de deletar\r\n                        const target = e.target as HTMLElement;\r\n                        const button = target.closest('button');\r\n                        if (button && button.type === 'button' && button.classList.contains('bg-red-500')) {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          return;\r\n                        }\r\n                      }}\r\n                    >\r\n                      {/* Preview de imagem ou ícone */}\r\n                    <div \r\n                        className=\"w-full aspect-square bg-white flex items-center justify-center cursor-pointer overflow-hidden\"\r\n                      onClick={() => handleDocumentClick(document)}\r\n                    >\r\n                        {isImage ? (\r\n                          isLoading ? (\r\n                            <Loader2 className=\"h-12 w-12 text-gray-400 animate-spin\" />\r\n                          ) : imageUrl ? (\r\n                            <img \r\n                              src={imageUrl} \r\n                              alt={document.file_name}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <Image className=\"h-12 w-12 text-gray-400\" />\r\n                          )\r\n                        ) : (\r\n                          <div className=\"flex flex-col items-center justify-center p-4 h-full\">\r\n                            {getDocumentIcon(document.file_type, \"large\")}\r\n                            <span className=\"mt-3 text-xs text-gray-600 text-center px-2 line-clamp-2 font-medium\">\r\n                              {document.file_name}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n\r\n                      {/* Overlay com informações e botão de deletar */}\r\n                      <div className=\"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all flex items-center justify-center opacity-0 group-hover:opacity-100\">\r\n                        <div className=\"flex flex-col items-center gap-2\">\r\n                          <span className=\"text-white text-xs font-medium text-center px-2 line-clamp-2\">\r\n                        {document.file_name}\r\n                      </span>\r\n                          <span className=\"text-white/80 text-xs\">\r\n                            {new Date(document.created_at).toLocaleDateString('pt-BR')}\r\n                      </span>\r\n                    </div>\r\n                      </div>\r\n\r\n                      {/* Botão de deletar */}\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                        type=\"button\"\r\n                        className=\"absolute top-2 right-2 h-8 w-8 p-0 bg-red-500/90 hover:bg-red-600 text-white opacity-0 group-hover:opacity-100 transition-opacity z-50\"\r\n                        onClick={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                          try {\r\n                            if (e.nativeEvent && typeof (e.nativeEvent as any).stopImmediatePropagation === 'function') {\r\n                              (e.nativeEvent as any).stopImmediatePropagation();\r\n                            }\r\n                          } catch (err) {\r\n                            // Ignorar\r\n                          }\r\n                          handleDeleteClick(document, e);\r\n                        }}\r\n                        onMouseDown={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                        }}\r\n                        onPointerDown={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                        }}\r\n                        onTouchStart={(e) => {\r\n                          e.preventDefault();\r\n                          e.stopPropagation();\r\n                      }}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8\">\r\n                <FileText className=\"h-12 w-12 mx-auto text-gray-400 mb-4\" />\r\n                <p className=\"text-sm text-gray-500\">\r\n                  Nenhum documento anexado ainda.\r\n                </p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Dialog de confirmação com senha administrativa - Renderizado FORA do dialog principal */}\r\n      {hasAdminPwd && (\r\n        <AdminPasswordDialog\r\n          open={showAdminPasswordDialog}\r\n          onOpenChange={(open) => {\r\n            if (!open) {\r\n              setShowAdminPasswordDialog(false);\r\n              setDocumentToDelete(null);\r\n            }\r\n            if (open) {\r\n              setShowAdminPasswordDialog(true);\r\n            }\r\n          }}\r\n          onConfirm={async () => {\r\n            if (documentToDelete) {\r\n              await confirmDeleteDocument();\r\n              setShowAdminPasswordDialog(false);\r\n            }\r\n          }}\r\n          title=\"Confirmar Exclusão de Documento\"\r\n          description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n          itemName={documentToDelete?.file_name}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DocumentUpload;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\ImportLeads.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":123,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":123,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4349,4352],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4349,4352],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Loader2, Upload, AlertTriangle, CheckCircle } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { downloadCsvTemplate } from \"@/utils/csvTemplate\";\r\nimport { CsvParser, CsvLead, CsvParseResult } from \"./CsvParser\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { getBankName } from \"@/utils/bankUtils\";\r\n\r\nconst ImportLeads = ({\r\n  onLeadsImported\r\n}: {\r\n  onLeadsImported: () => void;\r\n}) => {\r\n  const [open, setOpen] = useState(false);\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [isUploading, setIsUploading] = useState(false);\r\n  const [parseResult, setParseResult] = useState<CsvParseResult | null>(null);\r\n  const [countInCurrentMonth, setCountInCurrentMonth] = useState(true);\r\n\r\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const selectedFile = e.target.files?.[0];\r\n    if (selectedFile) {\r\n      setFile(selectedFile);\r\n      parseCSV(selectedFile);\r\n    }\r\n  };\r\n\r\n  const parseCSV = (file: File) => {\r\n    const reader = new FileReader();\r\n    reader.onload = e => {\r\n      const text = e.target?.result as string;\r\n      \r\n      try {\r\n        const result = CsvParser.parseFile(text);\r\n        setParseResult(result);\r\n        \r\n        if (result.errors.length > 0) {\r\n          console.warn(\"CSV parsing warnings:\", result.errors);\r\n        }\r\n        \r\n        if (result.leads.length === 0) {\r\n          toast.error(\"Nenhum lead válido encontrado no arquivo\", {\r\n            action: {\r\n              label: \"Baixar Modelo\",\r\n              onClick: downloadCsvTemplate\r\n            }\r\n          });\r\n        } else {\r\n          toast.success(`${result.leads.length} leads prontos para importação`);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"Error parsing CSV:\", error);\r\n        toast.error(\"Erro ao processar arquivo CSV\");\r\n        setParseResult(null);\r\n      }\r\n    };\r\n    \r\n    reader.onerror = () => {\r\n      console.error(\"Error reading file\");\r\n      toast.error(\"Erro ao ler o arquivo\");\r\n      setParseResult(null);\r\n    };\r\n    \r\n    reader.readAsText(file, 'UTF-8');\r\n  };\r\n\r\n  const handleImport = async () => {\r\n    if (!file || !parseResult || parseResult.leads.length === 0) return;\r\n    \r\n    setIsUploading(true);\r\n    \r\n    try {\r\n      const { data: { session }, error: sessionError } = await supabase.auth.getSession();\r\n      \r\n      if (sessionError || !session?.user) {\r\n        throw new Error(\"Sessão expirada. Faça login novamente.\");\r\n      }\r\n\r\n      // Define a data de criação baseada na opção escolhida\r\n      const createdAt = countInCurrentMonth \r\n        ? new Date().toISOString()\r\n        : new Date(new Date().getFullYear(), new Date().getMonth() - 1, 1).toISOString();\r\n\r\n      const leadsToInsert = parseResult.leads.map(lead => ({\r\n        name: lead.name,\r\n        cpf: lead.cpf,\r\n        phone: lead.phone,\r\n        bank: lead.bank,\r\n        product: lead.product,\r\n        amount: lead.amount,\r\n        employee: lead.employee,\r\n        status: \"novo\",\r\n        user_id: session.user.id,\r\n        date: countInCurrentMonth \r\n          ? new Date().toISOString().slice(0, 10)\r\n          : new Date(new Date().getFullYear(), new Date().getMonth() - 1, 1).toISOString().slice(0, 10),\r\n        created_at: createdAt,\r\n        updated_at: new Date().toISOString()\r\n      }));\r\n\r\n      const { error } = await supabase\r\n        .from(\"leads\")\r\n        .insert(leadsToInsert);\r\n\r\n      if (error) {\r\n        console.error(\"Database error:\", error);\r\n        throw new Error(`Erro ao salvar leads: ${error.message}`);\r\n      }\r\n\r\n      const monthText = countInCurrentMonth ? \"no mês atual\" : \"no mês anterior\";\r\n      toast.success(`${parseResult.leads.length} leads importados com sucesso ${monthText}!`);\r\n      setOpen(false);\r\n      setFile(null);\r\n      setParseResult(null);\r\n      setCountInCurrentMonth(true); // Reset to default\r\n      onLeadsImported();\r\n      \r\n    } catch (error: any) {\r\n      console.error(\"Import error:\", error);\r\n      toast.error(error.message);\r\n    } finally {\r\n      setIsUploading(false);\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFile(null);\r\n    setParseResult(null);\r\n    setCountInCurrentMonth(true);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex items-center gap-2\">\r\n        <Button variant=\"outline\" onClick={() => setOpen(true)}>\r\n          <Upload className=\"h-4 w-4 mr-2\" />\r\n          Importar Leads\r\n        </Button>\r\n      </div>\r\n\r\n      <Dialog open={open} onOpenChange={(isOpen) => {\r\n        setOpen(isOpen);\r\n        if (!isOpen) resetForm();\r\n      }}>\r\n        <DialogContent className=\"sm:max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>Importar Leads via CSV</DialogTitle>\r\n            <DialogDescription>\r\n              Faça upload de um arquivo CSV com os leads. Todos os campos são opcionais! O sistema preencherá automaticamente dados em branco: Nome, CPF, Telefone, Banco, Produto, Data, Valor, Funcionário.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid w-full max-w-sm items-center gap-1.5\">\r\n              <Input \r\n                id=\"csv-upload\" \r\n                type=\"file\" \r\n                accept=\".csv\" \r\n                onChange={handleFileChange} \r\n                disabled={isUploading} \r\n              />\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Todos os campos são opcionais! Dados em branco serão preenchidos automaticamente\r\n              </p>\r\n            </div>\r\n\r\n            <div className=\"flex items-center space-x-2 p-4 border rounded-lg bg-muted/30\">\r\n              <Checkbox \r\n                id=\"count-current-month\" \r\n                checked={countInCurrentMonth}\r\n                onCheckedChange={(checked) => setCountInCurrentMonth(checked as boolean)}\r\n              />\r\n              <label \r\n                htmlFor=\"count-current-month\" \r\n                className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\r\n              >\r\n                Contabilizar valores no mês atual\r\n              </label>\r\n            </div>\r\n            <p className=\"text-xs text-muted-foreground ml-6\">\r\n              {countInCurrentMonth \r\n                ? \"Os leads importados serão contabilizados no mês atual para relatórios e métricas.\"\r\n                : \"Os leads importados serão contabilizados no mês anterior.\"\r\n              }\r\n            </p>\r\n\r\n            {parseResult && (\r\n              <div className=\"space-y-3\">\r\n                {parseResult.errors.length > 0 && (\r\n                  <Alert variant=\"destructive\">\r\n                    <AlertTriangle className=\"h-4 w-4\" />\r\n                    <AlertDescription>\r\n                      <div className=\"font-medium mb-1\">Problemas encontrados:</div>\r\n                      <ul className=\"text-sm space-y-1\">\r\n                        {parseResult.errors.slice(0, 5).map((error, index) => (\r\n                          <li key={index}>• {error}</li>\r\n                        ))}\r\n                        {parseResult.errors.length > 5 && (\r\n                          <li>• ... e mais {parseResult.errors.length - 5} erros</li>\r\n                        )}\r\n                      </ul>\r\n                    </AlertDescription>\r\n                  </Alert>\r\n                )}\r\n\r\n                {parseResult.leads.length > 0 && (\r\n                  <Alert>\r\n                    <CheckCircle className=\"h-4 w-4\" />\r\n                    <AlertDescription>\r\n                      <strong>{parseResult.leads.length}</strong> leads válidos encontrados de <strong>{parseResult.totalRows}</strong> linhas processadas\r\n                    </AlertDescription>\r\n                  </Alert>\r\n                )}\r\n\r\n                {parseResult.leads.length > 0 && (\r\n                  <div>\r\n                    <h3 className=\"font-medium mb-2\">Pré-visualização (primeiros 5 leads)</h3>\r\n                    <div className=\"border rounded-md overflow-x-auto max-h-64\">\r\n                      <table className=\"min-w-full text-sm\">\r\n                        <thead className=\"bg-muted/50\">\r\n                          <tr>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Nome</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">CPF</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Telefone</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Banco</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Produto</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Valor</th>\r\n                            <th className=\"px-3 py-2 text-left text-xs font-medium\">Funcionário</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {parseResult.leads.slice(0, 5).map((lead, index) => (\r\n                            <tr key={index} className=\"border-t\">\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.name}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.cpf}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.phone}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{getBankName(lead.bank) || \"-\"}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.product}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.amount}</td>\r\n                              <td className=\"px-3 py-2 text-xs\">{lead.employee}</td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                    {parseResult.leads.length > 5 && (\r\n                      <p className=\"text-xs text-muted-foreground mt-1\">\r\n                        Mostrando apenas 5 primeiros registros\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)} disabled={isUploading}>\r\n              Cancelar\r\n            </Button>\r\n            <Button \r\n              onClick={handleImport} \r\n              disabled={!parseResult || parseResult.leads.length === 0 || isUploading}\r\n            >\r\n              {isUploading && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              {isUploading ? 'Importando...' : `Importar ${parseResult?.leads.length || 0} Leads`}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ImportLeads;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\leads\\LeadImportButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\roteiros\\DocumentViewer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\roteiros\\VideoPlayer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\FAQ.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\FeaturesList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\RoteirosCard3D.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\SalesHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\SubscriptionPlans.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\sales\\Testimonials.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\AccountSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":124,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":124,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3727,3730],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3727,3730],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Form,\r\n  FormControl,\r\n  FormDescription,\r\n  FormField,\r\n  FormItem,\r\n  FormLabel,\r\n  FormMessage,\r\n} from \"@/components/ui/form\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { useToast } from \"@/components/ui/use-toast\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CircleCheck, User, Phone, Loader2, Save } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface ProfileData {\r\n  first_name?: string;\r\n  last_name?: string;\r\n  whatsapp?: string;\r\n}\r\n\r\nexport default function AccountSection() {\r\n  const { user, isPrivilegedUser } = useAuth();\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [profile, setProfile] = useState<ProfileData>({});\r\n\r\n  const form = useForm({\r\n    defaultValues: {\r\n      email: user?.email || \"\",\r\n      fullName: \"\",\r\n      whatsapp: \"\",\r\n    },\r\n  });\r\n\r\n  // Carregar dados do perfil\r\n  useEffect(() => {\r\n    const fetchProfile = async () => {\r\n      if (!user?.id) return;\r\n      \r\n      setIsLoading(true);\r\n      try {\r\n        const { data, error } = await supabase\r\n          .from('profiles')\r\n          .select('first_name, last_name, whatsapp')\r\n          .eq('id', user.id)\r\n          .single();\r\n\r\n        if (error && error.code !== 'PGRST116') {\r\n          console.error('Error fetching profile:', error);\r\n          return;\r\n        }\r\n\r\n        if (data) {\r\n          setProfile(data);\r\n          // Combinar first_name e last_name para exibir como full_name\r\n          const fullName = `${data.first_name || ''} ${data.last_name || ''}`.trim();\r\n          \r\n          form.reset({\r\n            email: user?.email || \"\",\r\n            fullName: fullName,\r\n            whatsapp: data.whatsapp ? maskPhone(data.whatsapp) : \"\",\r\n          });\r\n        }\r\n      } catch (error) {\r\n        console.error('Error fetching profile:', error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchProfile();\r\n  }, [user?.id, user?.email, form]);\r\n\r\n  // Função para formatar telefone\r\n  const maskPhone = (value: string) => {\r\n    const digits = value.replace(/\\D/g, '');\r\n    if (digits.length <= 2) {\r\n      return `(${digits}`;\r\n    }\r\n    if (digits.length <= 7) {\r\n      return `(${digits.slice(0, 2)}) ${digits.slice(2)}`;\r\n    }\r\n    return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7, 11)}`;\r\n  };\r\n\r\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const masked = maskPhone(e.target.value);\r\n    form.setValue('whatsapp', masked);\r\n  };\r\n\r\n  const onSubmit = async (data: { email: string; fullName: string; whatsapp: string }) => {\r\n    if (!user?.id) return;\r\n\r\n    setIsSaving(true);\r\n    try {\r\n      // Dividir nome completo em first_name e last_name\r\n      const nameParts = data.fullName.trim().split(' ');\r\n      const firstName = nameParts[0] || '';\r\n      const lastName = nameParts.slice(1).join(' ') || '';\r\n\r\n      const updateData = {\r\n        first_name: firstName,\r\n        last_name: lastName,\r\n        whatsapp: data.whatsapp.replace(/\\D/g, ''), // Salvar apenas números\r\n      };\r\n\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .upsert({\r\n          id: user.id,\r\n          ...updateData\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      setProfile(prev => ({ ...prev, ...updateData }));\r\n      toast.success(\"Informações da conta atualizadas com sucesso!\");\r\n    } catch (error: any) {\r\n      console.error(\"Error updating profile:\", error);\r\n      toast.error(`Erro ao atualizar informações: ${error.message}`);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"space-y-6\">\r\n        <div>\r\n          <h3 className=\"text-lg font-medium\">Conta</h3>\r\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n            Gerencie suas informações de conta\r\n          </p>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center justify-center py-8\">\r\n          <Loader2 className=\"h-6 w-6 animate-spin text-blue-600\" />\r\n          <span className=\"ml-2 text-sm text-gray-600\">Carregando informações...</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h3 className=\"text-lg font-medium\">Conta</h3>\r\n        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n          Gerencie suas informações de conta\r\n        </p>\r\n      </div>\r\n      \r\n      {isPrivilegedUser && (\r\n        <div className=\"bg-green-50 border border-green-100 rounded-lg p-4 mb-6 flex items-center\">\r\n          <CircleCheck className=\"h-5 w-5 text-green-500 mr-2 flex-shrink-0\" />\r\n          <div>\r\n            <h4 className=\"text-green-700 font-medium\">Acesso Vitalício Ativo</h4>\r\n            <p className=\"text-sm text-green-600\">\r\n              Seu email foi identificado como um usuário com acesso vitalício a todas as funcionalidades \r\n              do sistema. Você tem acesso completo sem necessidade de assinatura.\r\n            </p>\r\n          </div>\r\n          <Badge className=\"ml-auto bg-green-500\">Usuário Premium</Badge>\r\n        </div>\r\n      )}\r\n      \r\n      <Form {...form}>\r\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\r\n          {/* Nome Completo */}\r\n          <FormField\r\n            control={form.control}\r\n            name=\"fullName\"\r\n            render={({ field }) => (\r\n              <FormItem>\r\n                <FormLabel className=\"flex items-center gap-2\">\r\n                  <User className=\"h-4 w-4 text-blue-600\" />\r\n                  Nome Completo\r\n                </FormLabel>\r\n                <FormControl>\r\n                  <Input \r\n                    placeholder=\"Digite seu nome completo\" \r\n                    {...field} \r\n                    disabled={isSaving}\r\n                    className=\"h-11\"\r\n                  />\r\n                </FormControl>\r\n                <FormDescription>\r\n                  Este nome será usado em relatórios e comunicações\r\n                </FormDescription>\r\n                <FormMessage />\r\n              </FormItem>\r\n            )}\r\n          />\r\n\r\n          {/* WhatsApp */}\r\n          <FormField\r\n            control={form.control}\r\n            name=\"whatsapp\"\r\n            render={({ field }) => (\r\n              <FormItem>\r\n                <FormLabel className=\"flex items-center gap-2\">\r\n                  <Phone className=\"h-4 w-4 text-green-600\" />\r\n                  WhatsApp\r\n                </FormLabel>\r\n                <FormControl>\r\n                  <Input \r\n                    placeholder=\"(99) 99999-9999\" \r\n                    {...field}\r\n                    onChange={handlePhoneChange}\r\n                    disabled={isSaving}\r\n                    maxLength={15}\r\n                    className=\"h-11\"\r\n                  />\r\n                </FormControl>\r\n                <FormDescription>\r\n                  Número do WhatsApp para contato e notificações\r\n                </FormDescription>\r\n                <FormMessage />\r\n              </FormItem>\r\n            )}\r\n          />\r\n\r\n          {/* Email (somente leitura) */}\r\n          <FormField\r\n            control={form.control}\r\n            name=\"email\"\r\n            render={({ field }) => (\r\n              <FormItem>\r\n                <FormLabel>Email</FormLabel>\r\n                <FormControl>\r\n                  <Input \r\n                    placeholder=\"seu@email.com\" \r\n                    {...field} \r\n                    disabled \r\n                    className=\"h-11 bg-gray-50\"\r\n                  />\r\n                </FormControl>\r\n                <FormDescription>\r\n                  Este é o email associado à sua conta (não pode ser alterado)\r\n                </FormDescription>\r\n                <FormMessage />\r\n              </FormItem>\r\n            )}\r\n          />\r\n\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <Button \r\n              type=\"submit\" \r\n              disabled={isSaving}\r\n              className=\"flex items-center gap-2 bg-blue-600 hover:bg-blue-700\"\r\n            >\r\n              {isSaving ? (\r\n                <>\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  Salvando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Save className=\"h-4 w-4\" />\r\n                  Salvar alterações\r\n                </>\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </form>\r\n      </Form>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\AdminPasswordSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":131,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":131,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4483,4486],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4483,4486],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6850,6853],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6850,6853],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":246,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":246,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8440,8443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8440,8443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":298,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":298,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10005,10008],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10005,10008],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":334,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":334,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11142,11145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11142,11145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Loader2, Eye, EyeOff, Shield, CheckCircle, AlertTriangle, Mail, Key } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from 'sonner';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\n\r\nexport const AdminPasswordSection: React.FC = () => {\r\n  const [adminPassword, setAdminPassword] = useState('');\r\n  const [confirmAdminPassword, setConfirmAdminPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    admin: false,\r\n    confirm: false,\r\n    current: false,\r\n    new: false,\r\n    newConfirm: false\r\n  });\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [hasAdminPassword, setHasAdminPassword] = useState(false);\r\n  const [showResetDialog, setShowResetDialog] = useState(false);\r\n  const [isSendingEmail, setIsSendingEmail] = useState(false);\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [isVerified, setIsVerified] = useState(false);\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmNewPassword, setConfirmNewPassword] = useState('');\r\n  const [isVerifying, setIsVerifying] = useState(false);\r\n\r\n  // Verificar se já existe senha administrativa\r\n  useEffect(() => {\r\n    checkAdminPassword();\r\n  }, []);\r\n\r\n  const checkAdminPassword = async () => {\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) return;\r\n\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('admin_password_hash')\r\n        .eq('id', userData.user.id)\r\n        .single();\r\n\r\n      if (!error && data?.admin_password_hash) {\r\n        setHasAdminPassword(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao verificar senha administrativa:', error);\r\n    }\r\n  };\r\n\r\n  // Função para alternar visibilidade da senha\r\n  const togglePasswordVisibility = (field: 'admin' | 'confirm' | 'current' | 'new' | 'newConfirm') => {\r\n    setShowPasswords(prev => ({\r\n      ...prev,\r\n      [field]: !prev[field]\r\n    }));\r\n  };\r\n\r\n  // Hash da senha usando Web Crypto API\r\n  const hashPassword = async (password: string): Promise<string> => {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(password);\r\n    const hash = await crypto.subtle.digest('SHA-256', data);\r\n    return Array.from(new Uint8Array(hash))\r\n      .map(b => b.toString(16).padStart(2, '0'))\r\n      .join('');\r\n  };\r\n\r\n  // Validar formulário\r\n  const validateForm = () => {\r\n    if (adminPassword.length < 6) {\r\n      setMessage({ type: 'error', text: 'A senha administrativa deve ter pelo menos 6 caracteres.' });\r\n      return false;\r\n    }\r\n\r\n    if (adminPassword !== confirmAdminPassword) {\r\n      setMessage({ type: 'error', text: 'As senhas não coincidem.' });\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Configurar senha administrativa\r\n  const handleSetAdminPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      const hashedPassword = await hashPassword(adminPassword);\r\n\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .upsert({\r\n          id: userData.user.id,\r\n          admin_password_hash: hashedPassword\r\n        }, {\r\n          onConflict: 'id'\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha administrativa configurada com sucesso!' \r\n      });\r\n      \r\n      setAdminPassword('');\r\n      setConfirmAdminPassword('');\r\n      setHasAdminPassword(true);\r\n      toast.success('Senha administrativa configurada com sucesso!');\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao configurar senha administrativa:', error);\r\n      setMessage({ type: 'error', text: 'Erro ao configurar senha administrativa. Tente novamente.' });\r\n      toast.error('Erro ao configurar senha administrativa.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Solicitar redefinição de senha por email\r\n  const handleRequestReset = async () => {\r\n    setIsSendingEmail(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user?.email) {\r\n        throw new Error('Email não encontrado.');\r\n      }\r\n\r\n      // Gerar token único para redefinição\r\n      const resetToken = crypto.randomUUID();\r\n      const expiresAt = new Date();\r\n      expiresAt.setHours(expiresAt.getHours() + 1); // Válido por 1 hora\r\n\r\n      // Salvar token no banco\r\n      const { error: tokenError } = await supabase\r\n        .from('admin_password_resets')\r\n        .upsert({\r\n          user_id: userData.user.id,\r\n          token: resetToken,\r\n          expires_at: expiresAt.toISOString()\r\n        }, {\r\n          onConflict: 'user_id'\r\n        });\r\n\r\n      if (tokenError) {\r\n        // Se a tabela não existir, informar ao usuário\r\n        console.error('Erro ao salvar token:', tokenError);\r\n        if (tokenError.code === 'PGRST116' || tokenError.message.includes('does not exist')) {\r\n          toast.error('Tabela de redefinição não encontrada. Execute a migração SQL primeiro.');\r\n          return;\r\n        }\r\n        throw tokenError;\r\n      }\r\n\r\n      // Gerar link de redefinição\r\n      const resetLink = `${window.location.origin}/reset-admin-password?token=${resetToken}`;\r\n      \r\n      // TODO: Implementar envio de email real via Supabase Edge Function\r\n      // Por enquanto, copiar link para área de transferência\r\n      try {\r\n        await navigator.clipboard.writeText(resetLink);\r\n        toast.success(\r\n          `Link de redefinição copiado para área de transferência! O link será enviado por email em produção.`,\r\n          { duration: 8000 }\r\n        );\r\n      } catch (err) {\r\n        // Fallback: mostrar o link\r\n        toast.success(\r\n          `Link de redefinição: ${resetLink.substring(0, 50)}... (Em produção, será enviado por email)`,\r\n          { duration: 10000 }\r\n        );\r\n      }\r\n\r\n      setShowResetDialog(false);\r\n      \r\n    } catch (error: any) {\r\n      console.error('Erro ao solicitar redefinição:', error);\r\n      toast.error('Erro ao solicitar redefinição. Tente novamente.');\r\n    } finally {\r\n      setIsSendingEmail(false);\r\n    }\r\n  };\r\n\r\n  // Verificar senha atual para ter acesso total\r\n  const handleVerifyCurrentPassword = async () => {\r\n    if (!currentPassword.trim()) {\r\n      setMessage({ type: 'error', text: 'Digite sua senha administrativa atual.' });\r\n      return;\r\n    }\r\n\r\n    setIsVerifying(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      const hashedPassword = await hashPassword(currentPassword);\r\n\r\n      const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('admin_password_hash')\r\n        .eq('id', userData.user.id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      if (!data?.admin_password_hash) {\r\n        setMessage({ type: 'error', text: 'Senha administrativa não configurada.' });\r\n        setIsVerifying(false);\r\n        return;\r\n      }\r\n\r\n      if (data.admin_password_hash !== hashedPassword) {\r\n        setMessage({ type: 'error', text: 'Senha administrativa incorreta.' });\r\n        setIsVerifying(false);\r\n        return;\r\n      }\r\n\r\n      // Senha correta\r\n      setIsVerified(true);\r\n      setMessage({ type: 'success', text: 'Senha verificada com sucesso! Agora você pode alterar ou remover a senha administrativa.' });\r\n      toast.success('Acesso liberado!');\r\n    } catch (error: any) {\r\n      console.error('Erro ao verificar senha:', error);\r\n      setMessage({ type: 'error', text: 'Erro ao verificar senha administrativa. Tente novamente.' });\r\n      toast.error('Erro ao verificar senha administrativa.');\r\n    } finally {\r\n      setIsVerifying(false);\r\n    }\r\n  };\r\n\r\n  // Alterar senha administrativa (após verificação)\r\n  const handleChangeAdminPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (newPassword.length < 6) {\r\n      setMessage({ type: 'error', text: 'A nova senha deve ter pelo menos 6 caracteres.' });\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmNewPassword) {\r\n      setMessage({ type: 'error', text: 'As senhas não coincidem.' });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      const hashedPassword = await hashPassword(newPassword);\r\n\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .update({ admin_password_hash: hashedPassword })\r\n        .eq('id', userData.user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha administrativa alterada com sucesso!' \r\n      });\r\n      \r\n      setNewPassword('');\r\n      setConfirmNewPassword('');\r\n      setCurrentPassword('');\r\n      setIsVerified(false);\r\n      toast.success('Senha administrativa alterada com sucesso!');\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao alterar senha administrativa:', error);\r\n      setMessage({ type: 'error', text: 'Erro ao alterar senha administrativa. Tente novamente.' });\r\n      toast.error('Erro ao alterar senha administrativa.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Remover senha administrativa (após verificação)\r\n  const handleRemoveAdminPassword = async () => {\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      const { error } = await supabase\r\n        .from('profiles')\r\n        .update({ admin_password_hash: null })\r\n        .eq('id', userData.user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha administrativa removida com sucesso!' \r\n      });\r\n      \r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmNewPassword('');\r\n      setIsVerified(false);\r\n      setHasAdminPassword(false);\r\n      toast.success('Senha administrativa removida com sucesso!');\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao remover senha administrativa:', error);\r\n      setMessage({ type: 'error', text: 'Erro ao remover senha administrativa. Tente novamente.' });\r\n      toast.error('Erro ao remover senha administrativa.');\r\n    }\r\n  };\r\n\r\n  // Limpar formulário\r\n  const handleClearForm = () => {\r\n    setAdminPassword('');\r\n    setConfirmAdminPassword('');\r\n    setCurrentPassword('');\r\n    setNewPassword('');\r\n    setConfirmNewPassword('');\r\n    setMessage(null);\r\n    setIsVerified(false);\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Key className=\"w-5 h-5 text-purple-600\" />\r\n            Senha Administrativa\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Configure uma senha administrativa para confirmar exclusões e ações sensíveis\r\n          </CardDescription>\r\n        </CardHeader>\r\n        \r\n        <CardContent className=\"space-y-6\">\r\n          {hasAdminPassword ? (\r\n            <div className=\"space-y-6\">\r\n              <Alert className=\"border-green-500 bg-green-50\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-600\" />\r\n                <AlertDescription className=\"text-green-700\">\r\n                  Senha administrativa já configurada. Esta senha será solicitada ao excluir itens importantes.\r\n                </AlertDescription>\r\n              </Alert>\r\n\r\n              {!isVerified ? (\r\n                <div className=\"space-y-4\">\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"currentPassword\" className=\"text-sm font-medium\">\r\n                      Digite sua senha administrativa atual para ter acesso total\r\n                    </Label>\r\n                    <div className=\"relative\">\r\n                      <Input\r\n                        id=\"currentPassword\"\r\n                        type={showPasswords.current ? \"text\" : \"password\"}\r\n                        value={currentPassword}\r\n                        onChange={(e) => {\r\n                          setCurrentPassword(e.target.value);\r\n                          setMessage(null);\r\n                        }}\r\n                        placeholder=\"Digite sua senha administrativa atual\"\r\n                        disabled={isVerifying}\r\n                        className=\"pr-12\"\r\n                        onKeyDown={(e) => {\r\n                          if (e.key === 'Enter' && !isVerifying && currentPassword.trim()) {\r\n                            handleVerifyCurrentPassword();\r\n                          }\r\n                        }}\r\n                        autoFocus\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                        onClick={() => togglePasswordVisibility('current')}\r\n                      >\r\n                        {showPasswords.current ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <Button\r\n                    type=\"button\"\r\n                    onClick={handleVerifyCurrentPassword}\r\n                    disabled={isVerifying || !currentPassword.trim()}\r\n                    className=\"w-full\"\r\n                  >\r\n                    {isVerifying ? (\r\n                      <>\r\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                        Verificando...\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <Shield className=\"w-4 h-4 mr-2\" />\r\n                        Verificar e Ter Acesso Total\r\n                      </>\r\n                    )}\r\n                  </Button>\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-6\">\r\n                  <Alert className=\"border-blue-500 bg-blue-50\">\r\n                    <CheckCircle className=\"h-4 w-4 text-blue-600\" />\r\n                    <AlertDescription className=\"text-blue-700\">\r\n                      Acesso liberado! Agora você pode alterar ou remover a senha administrativa.\r\n                    </AlertDescription>\r\n                  </Alert>\r\n\r\n                  {/* Formulário para alterar senha */}\r\n                  <form onSubmit={handleChangeAdminPassword} className=\"space-y-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"newPassword\" className=\"text-sm font-medium\">\r\n                        Nova Senha Administrativa\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <Input\r\n                          id=\"newPassword\"\r\n                          type={showPasswords.new ? \"text\" : \"password\"}\r\n                          value={newPassword}\r\n                          onChange={(e) => setNewPassword(e.target.value)}\r\n                          placeholder=\"Digite a nova senha administrativa\"\r\n                          disabled={isLoading}\r\n                          className=\"pr-12\"\r\n                        />\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                          onClick={() => togglePasswordVisibility('new')}\r\n                        >\r\n                          {showPasswords.new ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"confirmNewPassword\" className=\"text-sm font-medium\">\r\n                        Confirmar Nova Senha\r\n                      </Label>\r\n                      <div className=\"relative\">\r\n                        <Input\r\n                          id=\"confirmNewPassword\"\r\n                          type={showPasswords.newConfirm ? \"text\" : \"password\"}\r\n                          value={confirmNewPassword}\r\n                          onChange={(e) => setConfirmNewPassword(e.target.value)}\r\n                          placeholder=\"Confirme a nova senha\"\r\n                          disabled={isLoading}\r\n                          className=\"pr-12\"\r\n                        />\r\n                        <button\r\n                          type=\"button\"\r\n                          className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                          onClick={() => togglePasswordVisibility('newConfirm')}\r\n                        >\r\n                          {showPasswords.newConfirm ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-3\">\r\n                      <Button\r\n                        type=\"submit\"\r\n                        disabled={isLoading || !newPassword || !confirmNewPassword || newPassword !== confirmNewPassword}\r\n                        className=\"flex-1\"\r\n                      >\r\n                        {isLoading ? (\r\n                          <>\r\n                            <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                            Alterando...\r\n                          </>\r\n                        ) : (\r\n                          <>\r\n                            <Key className=\"w-4 h-4 mr-2\" />\r\n                            Alterar Senha\r\n                          </>\r\n                        )}\r\n                      </Button>\r\n                      <Button\r\n                        type=\"button\"\r\n                        variant=\"destructive\"\r\n                        onClick={handleRemoveAdminPassword}\r\n                        disabled={isLoading}\r\n                      >\r\n                        <Shield className=\"w-4 h-4 mr-2\" />\r\n                        Remover Senha\r\n                      </Button>\r\n                    </div>\r\n                  </form>\r\n\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    onClick={() => {\r\n                      setIsVerified(false);\r\n                      setCurrentPassword('');\r\n                      setNewPassword('');\r\n                      setConfirmNewPassword('');\r\n                      setMessage(null);\r\n                    }}\r\n                    className=\"w-full\"\r\n                  >\r\n                    Cancelar\r\n                  </Button>\r\n                </div>\r\n              )}\r\n\r\n              <Separator />\r\n\r\n              <div className=\"flex gap-3\">\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={() => setShowResetDialog(true)}\r\n                  className=\"flex-1\"\r\n                >\r\n                  <Mail className=\"w-4 h-4 mr-2\" />\r\n                  Solicitar Redefinição por Email\r\n                </Button>\r\n              </div>\r\n\r\n              <div className=\"text-sm text-gray-600 space-y-2\">\r\n                <p className=\"font-medium\">Como funciona:</p>\r\n                <ul className=\"list-disc list-inside space-y-1 text-xs\">\r\n                  <li>A senha administrativa será solicitada ao excluir leads, comissões, lembretes e outros itens importantes</li>\r\n                  <li>Digite sua senha atual acima para alterar ou remover a senha administrativa</li>\r\n                  <li>Ou solicite uma redefinição por email se esqueceu a senha</li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <form onSubmit={handleSetAdminPassword} className=\"space-y-4\">\r\n              <Alert className=\"border-blue-500 bg-blue-50\">\r\n                <Shield className=\"h-4 w-4 text-blue-600\" />\r\n                <AlertDescription className=\"text-blue-700\">\r\n                  Configure uma senha administrativa para proteger ações de exclusão. Esta senha será solicitada sempre que você tentar excluir itens importantes.\r\n                </AlertDescription>\r\n              </Alert>\r\n\r\n              {/* Senha Administrativa */}\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"adminPassword\" className=\"text-sm font-medium\">\r\n                  Senha Administrativa\r\n                </Label>\r\n                <div className=\"relative\">\r\n                  <Input\r\n                    id=\"adminPassword\"\r\n                    type={showPasswords.admin ? \"text\" : \"password\"}\r\n                    value={adminPassword}\r\n                    onChange={(e) => setAdminPassword(e.target.value)}\r\n                    placeholder=\"Digite sua senha administrativa\"\r\n                    disabled={isLoading}\r\n                    className=\"pr-12\"\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                    onClick={() => togglePasswordVisibility('admin')}\r\n                  >\r\n                    {showPasswords.admin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Confirmar Senha Administrativa */}\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"confirmAdminPassword\" className=\"text-sm font-medium\">\r\n                  Confirmar Senha Administrativa\r\n                </Label>\r\n                <div className=\"relative\">\r\n                  <Input\r\n                    id=\"confirmAdminPassword\"\r\n                    type={showPasswords.confirm ? \"text\" : \"password\"}\r\n                    value={confirmAdminPassword}\r\n                    onChange={(e) => setConfirmAdminPassword(e.target.value)}\r\n                    placeholder=\"Confirme sua senha administrativa\"\r\n                    disabled={isLoading}\r\n                    className=\"pr-12\"\r\n                    autoComplete=\"new-password\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                    onClick={() => togglePasswordVisibility('confirm')}\r\n                  >\r\n                    {showPasswords.confirm ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                  </button>\r\n                </div>\r\n                \r\n                {/* Indicador de confirmação */}\r\n                {confirmAdminPassword && (\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    {adminPassword === confirmAdminPassword ? (\r\n                      <>\r\n                        <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                        <span className=\"text-green-600\">Senhas coincidem</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <AlertTriangle className=\"w-4 h-4 text-red-500\" />\r\n                        <span className=\"text-red-500\">Senhas não coincidem</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Mensagem de feedback */}\r\n              {message && (\r\n                <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n                  <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n                    {message.text}\r\n                  </AlertDescription>\r\n                </Alert>\r\n              )}\r\n\r\n              {/* Botões */}\r\n              <div className=\"flex gap-3 pt-4\">\r\n                <Button\r\n                  type=\"submit\"\r\n                  disabled={isLoading || !adminPassword || !confirmAdminPassword || adminPassword !== confirmAdminPassword}\r\n                  className=\"flex-1\"\r\n                >\r\n                  {isLoading ? (\r\n                    <>\r\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                      Configurando...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Shield className=\"w-4 h-4 mr-2\" />\r\n                      Configurar Senha Administrativa\r\n                    </>\r\n                  )}\r\n                </Button>\r\n                \r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"outline\"\r\n                  onClick={handleClearForm}\r\n                  disabled={isLoading}\r\n                >\r\n                  Limpar\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Dialog de solicitação de redefinição */}\r\n      <Dialog open={showResetDialog} onOpenChange={setShowResetDialog}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Mail className=\"w-5 h-5 text-blue-600\" />\r\n              Solicitar Redefinição de Senha Administrativa\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Um link de redefinição será enviado para seu email cadastrado. O link será válido por 1 hora.\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <DialogFooter>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowResetDialog(false)}\r\n              disabled={isSendingEmail}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={handleRequestReset}\r\n              disabled={isSendingEmail}\r\n              className=\"bg-blue-600 hover:bg-blue-700\"\r\n            >\r\n              {isSendingEmail ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Enviando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Mail className=\"w-4 h-4 mr-2\" />\r\n                  Enviar Email\r\n                </>\r\n              )}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\AppearanceSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\LogoutButton.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[624,627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[624,627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { useToast } from \"@/components/ui/use-toast\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport default function LogoutButton() {\r\n  const { signOut } = useAuth();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      await signOut();\r\n      toast({\r\n        title: \"Logout realizado\",\r\n        description: \"Você foi desconectado com sucesso\",\r\n      });\r\n      navigate(\"/login\");\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao fazer logout:\", error.message);\r\n      toast({\r\n        title: \"Erro\",\r\n        description: \"Ocorreu um erro ao tentar desconectar\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Button onClick={handleLogout} variant=\"destructive\">\r\n      Sair\r\n    </Button>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\NotificationSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\PasswordSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4199,4202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4199,4202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { Loader2, Eye, EyeOff, Lock, Shield, CheckCircle, AlertTriangle } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from 'sonner';\r\n\r\nexport const PasswordSection: React.FC = () => {\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    current: false,\r\n    new: false,\r\n    confirm: false\r\n  });\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  // Função para alternar visibilidade da senha\r\n  const togglePasswordVisibility = (field: 'current' | 'new' | 'confirm') => {\r\n    setShowPasswords(prev => ({\r\n      ...prev,\r\n      [field]: !prev[field]\r\n    }));\r\n  };\r\n\r\n  // Validações\r\n  const validateForm = () => {\r\n    if (!currentPassword.trim()) {\r\n      setMessage({ type: 'error', text: 'Digite sua senha atual.' });\r\n      return false;\r\n    }\r\n\r\n    if (newPassword.length < 6) {\r\n      setMessage({ type: 'error', text: 'A nova senha deve ter pelo menos 6 caracteres.' });\r\n      return false;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setMessage({ type: 'error', text: 'As senhas não coincidem.' });\r\n      return false;\r\n    }\r\n\r\n    if (currentPassword === newPassword) {\r\n      setMessage({ type: 'error', text: 'A nova senha deve ser diferente da atual.' });\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Verificar força da senha\r\n  const getPasswordStrength = (password: string) => {\r\n    let strength = 0;\r\n    const checks = {\r\n      length: password.length >= 8,\r\n      lowercase: /[a-z]/.test(password),\r\n      uppercase: /[A-Z]/.test(password),\r\n      numbers: /\\d/.test(password),\r\n      symbols: /[!@#$%^&*(),.?\":{}|<>]/.test(password)\r\n    };\r\n\r\n    strength = Object.values(checks).filter(Boolean).length;\r\n\r\n    if (strength <= 2) return { level: 'weak', color: 'red', text: 'Fraca' };\r\n    if (strength <= 3) return { level: 'medium', color: 'yellow', text: 'Média' };\r\n    if (strength <= 4) return { level: 'good', color: 'blue', text: 'Boa' };\r\n    return { level: 'strong', color: 'green', text: 'Forte' };\r\n  };\r\n\r\n  const passwordStrength = newPassword ? getPasswordStrength(newPassword) : null;\r\n\r\n  // Alterar senha\r\n  const handleChangePassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      // Primeiro, tentar fazer login com a senha atual para verificar se está correta\r\n      const { data: user } = await supabase.auth.getUser();\r\n      if (!user.user?.email) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      // Tentar fazer signIn com a senha atual para validar\r\n      const { error: signInError } = await supabase.auth.signInWithPassword({\r\n        email: user.user.email,\r\n        password: currentPassword\r\n      });\r\n\r\n      if (signInError) {\r\n        throw new Error('Senha atual incorreta.');\r\n      }\r\n\r\n      // Se chegou até aqui, a senha atual está correta, agora atualizar\r\n      const { error: updateError } = await supabase.auth.updateUser({\r\n        password: newPassword\r\n      });\r\n\r\n      if (updateError) {\r\n        throw updateError;\r\n      }\r\n\r\n      // Sucesso\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha alterada com sucesso!' \r\n      });\r\n      \r\n      // Limpar formulário\r\n      setCurrentPassword('');\r\n      setNewPassword('');\r\n      setConfirmPassword('');\r\n      \r\n      toast.success('Senha alterada com sucesso!');\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao alterar senha:', error);\r\n      \r\n      let errorMessage = 'Erro ao alterar senha. Tente novamente.';\r\n      \r\n      if (error.message?.includes('Senha atual incorreta')) {\r\n        errorMessage = 'Senha atual incorreta. Verifique e tente novamente.';\r\n      } else if (error.message?.includes('weak password') || error.message?.includes('password is too weak')) {\r\n        errorMessage = 'A nova senha é muito fraca. Use uma senha mais forte.';\r\n      } else if (error.message?.includes('same password')) {\r\n        errorMessage = 'A nova senha deve ser diferente da atual.';\r\n      }\r\n      \r\n      setMessage({ type: 'error', text: errorMessage });\r\n      toast.error(errorMessage);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Limpar formulário\r\n  const handleClearForm = () => {\r\n    setCurrentPassword('');\r\n    setNewPassword('');\r\n    setConfirmPassword('');\r\n    setMessage(null);\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <Shield className=\"w-5 h-5 text-blue-600\" />\r\n          Alterar Senha\r\n        </CardTitle>\r\n        <CardDescription>\r\n          Mantenha sua conta segura alterando sua senha regularmente\r\n        </CardDescription>\r\n      </CardHeader>\r\n      \r\n      <CardContent className=\"space-y-6\">\r\n        <form onSubmit={handleChangePassword} className=\"space-y-4\">\r\n          \r\n          {/* Senha Atual */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"currentPassword\" className=\"text-sm font-medium\">\r\n              Senha Atual\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"currentPassword\"\r\n                type={showPasswords.current ? \"text\" : \"password\"}\r\n                value={currentPassword}\r\n                onChange={(e) => setCurrentPassword(e.target.value)}\r\n                placeholder=\"Digite sua senha atual\"\r\n                disabled={isLoading}\r\n                className=\"pr-12\"\r\n                autoComplete=\"current-password\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                onClick={() => togglePasswordVisibility('current')}\r\n              >\r\n                {showPasswords.current ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          <Separator className=\"my-4\" />\r\n\r\n          {/* Nova Senha */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"newPassword\" className=\"text-sm font-medium\">\r\n              Nova Senha\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"newPassword\"\r\n                type={showPasswords.new ? \"text\" : \"password\"}\r\n                value={newPassword}\r\n                onChange={(e) => setNewPassword(e.target.value)}\r\n                placeholder=\"Digite sua nova senha\"\r\n                disabled={isLoading}\r\n                className=\"pr-12\"\r\n                autoComplete=\"new-password\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                onClick={() => togglePasswordVisibility('new')}\r\n              >\r\n                {showPasswords.new ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Indicador de força da senha */}\r\n            {newPassword && passwordStrength && (\r\n              <div className=\"space-y-2\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <span>Força da senha:</span>\r\n                  <span className={`font-medium text-${passwordStrength.color}-600`}>\r\n                    {passwordStrength.text}\r\n                  </span>\r\n                </div>\r\n                <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                  <div\r\n                    className={`h-2 rounded-full bg-${passwordStrength.color}-500 transition-all duration-300`}\r\n                    style={{ width: `${(Object.values(getPasswordStrength(newPassword)).filter(Boolean).length - 1) * 25}%` }}\r\n                  ></div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Dicas de senha */}\r\n            <div className=\"text-xs text-gray-500 space-y-1\">\r\n              <p>A senha deve conter:</p>\r\n              <div className=\"grid grid-cols-2 gap-1\">\r\n                <span className={newPassword.length >= 8 ? 'text-green-600' : 'text-gray-400'}>\r\n                  ✓ 8+ caracteres\r\n                </span>\r\n                <span className={/[A-Z]/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                  ✓ Maiúscula\r\n                </span>\r\n                <span className={/[a-z]/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                  ✓ Minúscula\r\n                </span>\r\n                <span className={/\\d/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                  ✓ Número\r\n                </span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Confirmar Nova Senha */}\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium\">\r\n              Confirmar Nova Senha\r\n            </Label>\r\n            <div className=\"relative\">\r\n              <Input\r\n                id=\"confirmPassword\"\r\n                type={showPasswords.confirm ? \"text\" : \"password\"}\r\n                value={confirmPassword}\r\n                onChange={(e) => setConfirmPassword(e.target.value)}\r\n                placeholder=\"Confirme sua nova senha\"\r\n                disabled={isLoading}\r\n                className=\"pr-12\"\r\n                autoComplete=\"new-password\"\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                onClick={() => togglePasswordVisibility('confirm')}\r\n              >\r\n                {showPasswords.confirm ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Indicador de confirmação */}\r\n            {confirmPassword && (\r\n              <div className=\"flex items-center gap-2 text-sm\">\r\n                {newPassword === confirmPassword ? (\r\n                  <>\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                    <span className=\"text-green-600\">Senhas coincidem</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <AlertTriangle className=\"w-4 h-4 text-red-500\" />\r\n                    <span className=\"text-red-500\">Senhas não coincidem</span>\r\n                  </>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Mensagem de feedback */}\r\n          {message && (\r\n            <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n              <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n                {message.text}\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n\r\n          {/* Botões */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <Button\r\n              type=\"submit\"\r\n              disabled={isLoading || !currentPassword || !newPassword || !confirmPassword || newPassword !== confirmPassword}\r\n              className=\"flex-1\"\r\n            >\r\n              {isLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Alterando...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"w-4 h-4 mr-2\" />\r\n                  Alterar Senha\r\n                </>\r\n              )}\r\n            </Button>\r\n            \r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleClearForm}\r\n              disabled={isLoading}\r\n            >\r\n              Limpar\r\n            </Button>\r\n          </div>\r\n        </form>\r\n\r\n        {/* Dicas de segurança */}\r\n        <div className=\"pt-4 border-t\">\r\n          <h4 className=\"text-sm font-medium text-gray-900 mb-2\">Dicas de Segurança</h4>\r\n          <div className=\"text-xs text-gray-600 space-y-1\">\r\n            <p>• Use uma senha única que você não usa em outros sites</p>\r\n            <p>• Combine letras maiúsculas e minúsculas, números e símbolos</p>\r\n            <p>• Evite usar informações pessoais como datas de nascimento</p>\r\n            <p>• Considere usar um gerenciador de senhas</p>\r\n            <p>• Altere sua senha regularmente (a cada 3-6 meses)</p>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\SecuritySection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\settings\\SettingsSidebar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":36,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":36,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default:\r\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary:\r\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive:\r\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface BadgeProps\r\n  extends React.HTMLAttributes<HTMLDivElement>,\r\n    VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return (\r\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\r\n  )\r\n}\r\n\r\nexport { Badge, badgeVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":58,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":58,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500/50 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 relative overflow-hidden\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 shadow-lg hover:shadow-xl shadow-blue-500/25 hover:shadow-blue-500/40 hover:scale-[1.02] active:scale-[0.98]\",\r\n        destructive:\r\n          \"bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 shadow-lg hover:shadow-xl shadow-red-500/25 hover:shadow-red-500/40 hover:scale-[1.02] active:scale-[0.98]\",\r\n        outline:\r\n          \"border-2 border-slate-300 bg-white/80 backdrop-blur-sm hover:bg-slate-50 hover:border-slate-400 text-slate-700 hover:text-slate-900 shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]\",\r\n        secondary:\r\n          \"bg-gradient-to-r from-slate-100 to-slate-200 text-slate-900 hover:from-slate-200 hover:to-slate-300 shadow-sm hover:shadow-md hover:scale-[1.02] active:scale-[0.98]\",\r\n        ghost: \"text-slate-700 hover:bg-slate-100/80 hover:text-slate-900 rounded-lg hover:scale-[1.02] active:scale-[0.98]\",\r\n        link: \"text-blue-600 underline-offset-4 hover:underline hover:text-blue-700\",\r\n        blue: \"bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 shadow-lg hover:shadow-xl shadow-blue-500/25 hover:shadow-blue-500/40 hover:scale-[1.02] active:scale-[0.98]\",\r\n      },\r\n      size: {\r\n        default: \"h-11 px-6 py-2.5\",\r\n        sm: \"h-9 rounded-lg px-4 text-xs\",\r\n        lg: \"h-13 rounded-xl px-8 text-base\",\r\n        icon: \"h-11 w-11\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    return (\r\n      <Comp\r\n        className={cn(buttonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nButton.displayName = \"Button\"\r\n\r\nexport { Button, buttonVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[724,775],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\r\nimport { Command as CommandPrimitive } from \"cmdk\"\r\nimport { Search } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nCommand.displayName = CommandPrimitive.displayName\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => (\r\n  <CommandPrimitive.Empty\r\n    ref={ref}\r\n    className=\"py-6 text-center text-sm\"\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 h-px bg-border\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName\r\n\r\nconst CommandShortcut = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return (\r\n    <span\r\n      className={cn(\r\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\nCommandShortcut.displayName = \"CommandShortcut\"\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\custom-calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":168,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":168,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport {\r\n  Controller,\r\n  ControllerProps,\r\n  FieldPath,\r\n  FieldValues,\r\n  FormProvider,\r\n  useFormContext,\r\n} from \"react-hook-form\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Label } from \"@/components/ui/label\"\r\n\r\nconst Form = FormProvider\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\r\n> = {\r\n  name: TName\r\n}\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\r\n  {} as FormFieldContextValue\r\n)\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  )\r\n}\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext)\r\n  const itemContext = React.useContext(FormItemContext)\r\n  const { getFieldState, formState } = useFormContext()\r\n\r\n  const fieldState = getFieldState(fieldContext.name, formState)\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\")\r\n  }\r\n\r\n  const { id } = itemContext\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  }\r\n}\r\n\r\ntype FormItemContextValue = {\r\n  id: string\r\n}\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>(\r\n  {} as FormItemContextValue\r\n)\r\n\r\nconst FormItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ className, ...props }, ref) => {\r\n  const id = React.useId()\r\n\r\n  return (\r\n    <FormItemContext.Provider value={{ id }}>\r\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\r\n    </FormItemContext.Provider>\r\n  )\r\n})\r\nFormItem.displayName = \"FormItem\"\r\n\r\nconst FormLabel = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\r\n>(({ className, ...props }, ref) => {\r\n  const { error, formItemId } = useFormField()\r\n\r\n  return (\r\n    <Label\r\n      ref={ref}\r\n      className={cn(error && \"text-destructive\", className)}\r\n      htmlFor={formItemId}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormLabel.displayName = \"FormLabel\"\r\n\r\nconst FormControl = React.forwardRef<\r\n  React.ElementRef<typeof Slot>,\r\n  React.ComponentPropsWithoutRef<typeof Slot>\r\n>(({ ...props }, ref) => {\r\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\r\n\r\n  return (\r\n    <Slot\r\n      ref={ref}\r\n      id={formItemId}\r\n      aria-describedby={\r\n        !error\r\n          ? `${formDescriptionId}`\r\n          : `${formDescriptionId} ${formMessageId}`\r\n      }\r\n      aria-invalid={!!error}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormControl.displayName = \"FormControl\"\r\n\r\nconst FormDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => {\r\n  const { formDescriptionId } = useFormField()\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formDescriptionId}\r\n      className={cn(\"text-sm text-muted-foreground\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nFormDescription.displayName = \"FormDescription\"\r\n\r\nconst FormMessage = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, children, ...props }, ref) => {\r\n  const { error, formMessageId } = useFormField()\r\n  const body = error ? String(error?.message) : children\r\n\r\n  if (!body) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <p\r\n      ref={ref}\r\n      id={formMessageId}\r\n      className={cn(\"text-sm font-medium text-destructive\", className)}\r\n      {...props}\r\n    >\r\n      {body}\r\n    </p>\r\n  )\r\n})\r\nFormMessage.displayName = \"FormMessage\"\r\n\r\nexport {\r\n  useFormField,\r\n  Form,\r\n  FormItem,\r\n  FormLabel,\r\n  FormControl,\r\n  FormDescription,\r\n  FormMessage,\r\n  FormField,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":119,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":119,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\r\nimport { cva } from \"class-variance-authority\"\r\nimport { ChevronDown } from \"lucide-react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst NavigationMenu = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <NavigationMenuViewport />\r\n  </NavigationMenuPrimitive.Root>\r\n))\r\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\r\n\r\nconst NavigationMenuList = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\r\n\r\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\r\n\r\nconst navigationMenuTriggerStyle = cva(\r\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\"\r\n)\r\n\r\nconst NavigationMenuTrigger = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\r\n    {...props}\r\n  >\r\n    {children}{\" \"}\r\n    <ChevronDown\r\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\r\n      aria-hidden=\"true\"\r\n    />\r\n  </NavigationMenuPrimitive.Trigger>\r\n))\r\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\r\n\r\nconst NavigationMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\r\n\r\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\r\n\r\nconst NavigationMenuViewport = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\r\n>(({ className, ...props }, ref) => (\r\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\r\n    <NavigationMenuPrimitive.Viewport\r\n      className={cn(\r\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\r\n        className\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\nNavigationMenuViewport.displayName =\r\n  NavigationMenuPrimitive.Viewport.displayName\r\n\r\nconst NavigationMenuIndicator = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Indicator\r\n    ref={ref}\r\n    className={cn(\r\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\r\n  </NavigationMenuPrimitive.Indicator>\r\n))\r\nNavigationMenuIndicator.displayName =\r\n  NavigationMenuPrimitive.Indicator.displayName\r\n\r\nexport {\r\n  navigationMenuTriggerStyle,\r\n  NavigationMenu,\r\n  NavigationMenuList,\r\n  NavigationMenuItem,\r\n  NavigationMenuContent,\r\n  NavigationMenuTrigger,\r\n  NavigationMenuLink,\r\n  NavigationMenuIndicator,\r\n  NavigationMenuViewport,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":763,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":763,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport { Slot } from \"@radix-ui/react-slot\"\r\nimport { VariantProps, cva } from \"class-variance-authority\"\r\nimport { PanelLeft } from \"lucide-react\"\r\n\r\nimport { useIsMobile } from \"@/hooks/use-mobile\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Input } from \"@/components/ui/input\"\r\nimport { Separator } from \"@/components/ui/separator\"\r\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\"\r\nimport { Skeleton } from \"@/components/ui/skeleton\"\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\"\r\n\r\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\"\r\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\r\nconst SIDEBAR_WIDTH = \"15rem\"\r\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\r\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\r\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\r\n\r\ntype SidebarContext = {\r\n  state: \"expanded\" | \"collapsed\"\r\n  open: boolean\r\n  setOpen: (open: boolean) => void\r\n  openMobile: boolean\r\n  setOpenMobile: (open: boolean) => void\r\n  isMobile: boolean\r\n  toggleSidebar: () => void\r\n}\r\n\r\nconst SidebarContext = React.createContext<SidebarContext | null>(null)\r\n\r\nfunction useSidebar() {\r\n  const context = React.useContext(SidebarContext)\r\n  if (!context) {\r\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\r\n  }\r\n\r\n  return context\r\n}\r\n\r\nconst SidebarProvider = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    defaultOpen?: boolean\r\n    open?: boolean\r\n    onOpenChange?: (open: boolean) => void\r\n  }\r\n>(\r\n  (\r\n    {\r\n      defaultOpen = true,\r\n      open: openProp,\r\n      onOpenChange: setOpenProp,\r\n      className,\r\n      style,\r\n      children,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const isMobile = useIsMobile()\r\n    const [openMobile, setOpenMobile] = React.useState(false)\r\n\r\n    // This is the internal state of the sidebar.\r\n    // We use openProp and setOpenProp for control from outside the component.\r\n    const [_open, _setOpen] = React.useState(defaultOpen)\r\n    const open = openProp ?? _open\r\n    const setOpen = React.useCallback(\r\n      (value: boolean | ((value: boolean) => boolean)) => {\r\n        const openState = typeof value === \"function\" ? value(open) : value\r\n        if (setOpenProp) {\r\n          setOpenProp(openState)\r\n        } else {\r\n          _setOpen(openState)\r\n        }\r\n\r\n        // This sets the cookie to keep the sidebar state.\r\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\r\n      },\r\n      [setOpenProp, open]\r\n    )\r\n\r\n    // Helper to toggle the sidebar.\r\n    const toggleSidebar = React.useCallback(() => {\r\n      return isMobile\r\n        ? setOpenMobile((open) => !open)\r\n        : setOpen((open) => !open)\r\n    }, [isMobile, setOpen, setOpenMobile])\r\n\r\n    // Adds a keyboard shortcut to toggle the sidebar.\r\n    React.useEffect(() => {\r\n      const handleKeyDown = (event: KeyboardEvent) => {\r\n        if (\r\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\r\n          (event.metaKey || event.ctrlKey)\r\n        ) {\r\n          event.preventDefault()\r\n          toggleSidebar()\r\n        }\r\n      }\r\n\r\n      window.addEventListener(\"keydown\", handleKeyDown)\r\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\r\n    }, [toggleSidebar])\r\n\r\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\r\n    // This makes it easier to style the sidebar with Tailwind classes.\r\n    const state = open ? \"expanded\" : \"collapsed\"\r\n\r\n    const contextValue = React.useMemo<SidebarContext>(\r\n      () => ({\r\n        state,\r\n        open,\r\n        setOpen,\r\n        isMobile,\r\n        openMobile,\r\n        setOpenMobile,\r\n        toggleSidebar,\r\n      }),\r\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\r\n    )\r\n\r\n    return (\r\n      <SidebarContext.Provider value={contextValue}>\r\n        <TooltipProvider delayDuration={0}>\r\n          <div\r\n            style={\r\n              {\r\n                \"--sidebar-width\": SIDEBAR_WIDTH,\r\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\r\n                ...style,\r\n              } as React.CSSProperties\r\n            }\r\n            className={cn(\r\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\r\n              className\r\n            )}\r\n            ref={ref}\r\n            {...props}\r\n          >\r\n            {children}\r\n          </div>\r\n        </TooltipProvider>\r\n      </SidebarContext.Provider>\r\n    )\r\n  }\r\n)\r\nSidebarProvider.displayName = \"SidebarProvider\"\r\n\r\nconst Sidebar = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    side?: \"left\" | \"right\"\r\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\r\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\r\n  }\r\n>(\r\n  (\r\n    {\r\n      side = \"left\",\r\n      variant = \"sidebar\",\r\n      collapsible = \"offcanvas\",\r\n      className,\r\n      children,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\r\n\r\n    if (collapsible === \"none\") {\r\n      return (\r\n        <div\r\n          className={cn(\r\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\r\n            className\r\n          )}\r\n          ref={ref}\r\n          {...props}\r\n        >\r\n          {children}\r\n        </div>\r\n      )\r\n    }\r\n\r\n    if (isMobile) {\r\n      return (\r\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\r\n          <SheetContent\r\n            data-sidebar=\"sidebar\"\r\n            data-mobile=\"true\"\r\n            className={cn(\r\n              \"w-[--sidebar-width] p-0 text-sidebar-foreground [&>button]:hidden\",\r\n              className\r\n            )}\r\n            style={\r\n              {\r\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\r\n              } as React.CSSProperties\r\n            }\r\n            side={side}\r\n          >\r\n            <div className={cn(\"flex h-full w-full flex-col\", className)}>{children}</div>\r\n          </SheetContent>\r\n        </Sheet>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className=\"group peer hidden md:block text-sidebar-foreground\"\r\n        data-state={state}\r\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\r\n        data-variant={variant}\r\n        data-side={side}\r\n      >\r\n        {/* This is what handles the sidebar gap on desktop */}\r\n        <div\r\n          className={cn(\r\n            \"duration-200 relative h-svh w-[--sidebar-width] bg-transparent transition-[width] ease-linear\",\r\n            \"group-data-[collapsible=offcanvas]:w-0\",\r\n            \"group-data-[side=right]:rotate-180\",\r\n            variant === \"floating\" || variant === \"inset\"\r\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\r\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\r\n          )}\r\n        />\r\n        <div\r\n          className={cn(\r\n            \"duration-200 fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] ease-linear md:flex\",\r\n            side === \"left\"\r\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\r\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\r\n            // Ajustar padding para floating/inset\r\n            variant === \"floating\" || variant === \"inset\"\r\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\r\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\r\n            className\r\n          )}\r\n          {...props}\r\n        >\r\n          <div\r\n            data-sidebar=\"sidebar\"\r\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\r\n          >\r\n            {children}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n)\r\nSidebar.displayName = \"Sidebar\"\r\n\r\nconst SidebarTrigger = React.forwardRef<\r\n  React.ElementRef<typeof Button>,\r\n  React.ComponentProps<typeof Button>\r\n>(({ className, onClick, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <Button\r\n      ref={ref}\r\n      data-sidebar=\"trigger\"\r\n      variant=\"ghost\"\r\n      size=\"icon\"\r\n      className={cn(\"h-7 w-7\", className)}\r\n      onClick={(event) => {\r\n        onClick?.(event)\r\n        toggleSidebar()\r\n      }}\r\n      {...props}\r\n    >\r\n      <PanelLeft />\r\n      <span className=\"sr-only\">Toggle Sidebar</span>\r\n    </Button>\r\n  )\r\n})\r\nSidebarTrigger.displayName = \"SidebarTrigger\"\r\n\r\nconst SidebarRail = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\">\r\n>(({ className, ...props }, ref) => {\r\n  const { toggleSidebar } = useSidebar()\r\n\r\n  return (\r\n    <button\r\n      ref={ref}\r\n      data-sidebar=\"rail\"\r\n      aria-label=\"Toggle Sidebar\"\r\n      tabIndex={-1}\r\n      onClick={toggleSidebar}\r\n      title=\"Toggle Sidebar\"\r\n      className={cn(\r\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\r\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\r\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\r\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\r\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\r\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarRail.displayName = \"SidebarRail\"\r\n\r\nconst SidebarInset = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"main\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <main\r\n      ref={ref}\r\n      className={cn(\r\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\r\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInset.displayName = \"SidebarInset\"\r\n\r\nconst SidebarInput = React.forwardRef<\r\n  React.ElementRef<typeof Input>,\r\n  React.ComponentProps<typeof Input>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Input\r\n      ref={ref}\r\n      data-sidebar=\"input\"\r\n      className={cn(\r\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarInput.displayName = \"SidebarInput\"\r\n\r\nconst SidebarHeader = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"header\"\r\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarHeader.displayName = \"SidebarHeader\"\r\n\r\nconst SidebarFooter = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"footer\"\r\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarFooter.displayName = \"SidebarFooter\"\r\n\r\nconst SidebarSeparator = React.forwardRef<\r\n  React.ElementRef<typeof Separator>,\r\n  React.ComponentProps<typeof Separator>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <Separator\r\n      ref={ref}\r\n      data-sidebar=\"separator\"\r\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarSeparator.displayName = \"SidebarSeparator\"\r\n\r\nconst SidebarContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"content\"\r\n      className={cn(\r\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarContent.displayName = \"SidebarContent\"\r\n\r\nconst SidebarGroup = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"group\"\r\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroup.displayName = \"SidebarGroup\"\r\n\r\nconst SidebarGroupLabel = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"div\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-label\"\r\n      className={cn(\r\n        \"duration-200 flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\r\n\r\nconst SidebarGroupAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\r\n>(({ className, asChild = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"group-action\"\r\n      className={cn(\r\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\r\n\r\nconst SidebarGroupContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"group-content\"\r\n    className={cn(\"w-full text-sm\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\r\n\r\nconst SidebarMenu = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<\"ul\">\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu\"\r\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenu.displayName = \"SidebarMenu\"\r\n\r\nconst SidebarMenuItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<\"li\">\r\n>(({ className, ...props }, ref) => (\r\n  <li\r\n    ref={ref}\r\n    data-sidebar=\"menu-item\"\r\n    className={cn(\"group/menu-item relative\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\r\n\r\nconst sidebarMenuButtonVariants = cva(\r\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n        outline:\r\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\r\n      },\r\n      size: {\r\n        default: \"h-8 text-sm\",\r\n        sm: \"h-7 text-xs\",\r\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst SidebarMenuButton = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean\r\n    isActive?: boolean\r\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\r\n  } & VariantProps<typeof sidebarMenuButtonVariants>\r\n>(\r\n  (\r\n    {\r\n      asChild = false,\r\n      isActive = false,\r\n      variant = \"default\",\r\n      size = \"default\",\r\n      tooltip,\r\n      className,\r\n      ...props\r\n    },\r\n    ref\r\n  ) => {\r\n    const Comp = asChild ? Slot : \"button\"\r\n    const { isMobile, state } = useSidebar()\r\n\r\n    const button = (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"menu-button\"\r\n        data-size={size}\r\n        data-active={isActive}\r\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\r\n        {...props}\r\n      />\r\n    )\r\n\r\n    if (!tooltip) {\r\n      return button\r\n    }\r\n\r\n    if (typeof tooltip === \"string\") {\r\n      tooltip = {\r\n        children: tooltip,\r\n      }\r\n    }\r\n\r\n    return (\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n        <TooltipContent\r\n          side=\"right\"\r\n          align=\"center\"\r\n          hidden={state !== \"collapsed\" || isMobile}\r\n          {...tooltip}\r\n        />\r\n      </Tooltip>\r\n    )\r\n  }\r\n)\r\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\r\n\r\nconst SidebarMenuAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean\r\n    showOnHover?: boolean\r\n  }\r\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-action\"\r\n      className={cn(\r\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        showOnHover &&\r\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\r\n\r\nconst SidebarMenuBadge = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\">\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    data-sidebar=\"menu-badge\"\r\n    className={cn(\r\n      \"absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground select-none pointer-events-none\",\r\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\r\n      \"peer-data-[size=sm]/menu-button:top-1\",\r\n      \"peer-data-[size=default]/menu-button:top-1.5\",\r\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n      \"group-data-[collapsible=icon]:hidden\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\r\n\r\nconst SidebarMenuSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    showIcon?: boolean\r\n  }\r\n>(({ className, showIcon = false, ...props }, ref) => {\r\n  // Random width between 50 to 90%.\r\n  const width = React.useMemo(() => {\r\n    return `${Math.floor(Math.random() * 40) + 50}%`\r\n  }, [])\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-skeleton\"\r\n      className={cn(\"rounded-md h-8 flex gap-2 px-2 items-center\", className)}\r\n      {...props}\r\n    >\r\n      {showIcon && (\r\n        <Skeleton\r\n          className=\"size-4 rounded-md\"\r\n          data-sidebar=\"menu-skeleton-icon\"\r\n        />\r\n      )}\r\n      <Skeleton\r\n        className=\"h-4 flex-1 max-w-[--skeleton-width]\"\r\n        data-sidebar=\"menu-skeleton-text\"\r\n        style={\r\n          {\r\n            \"--skeleton-width\": width,\r\n          } as React.CSSProperties\r\n        }\r\n      />\r\n    </div>\r\n  )\r\n})\r\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\r\n\r\nconst SidebarMenuSub = React.forwardRef<\r\n  HTMLUListElement,\r\n  React.ComponentProps<\"ul\">\r\n>(({ className, ...props }, ref) => (\r\n  <ul\r\n    ref={ref}\r\n    data-sidebar=\"menu-sub\"\r\n    className={cn(\r\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\r\n      \"group-data-[collapsible=icon]:hidden\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\r\n\r\nconst SidebarMenuSubItem = React.forwardRef<\r\n  HTMLLIElement,\r\n  React.ComponentProps<\"li\">\r\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\r\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\r\n\r\nconst SidebarMenuSubButton = React.forwardRef<\r\n  HTMLAnchorElement,\r\n  React.ComponentProps<\"a\"> & {\r\n    asChild?: boolean\r\n    size?: \"sm\" | \"md\"\r\n    isActive?: boolean\r\n  }\r\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"a\"\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(\r\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\r\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\r\n        size === \"sm\" && \"text-xs\",\r\n        size === \"md\" && \"text-sm\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n})\r\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\r\n\r\nexport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupAction,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarInput,\r\n  SidebarInset,\r\n  SidebarMenu,\r\n  SidebarMenuAction,\r\n  SidebarMenuBadge,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n  SidebarMenuSkeleton,\r\n  SidebarMenuSub,\r\n  SidebarMenuSubButton,\r\n  SidebarMenuSubItem,\r\n  SidebarProvider,\r\n  SidebarRail,\r\n  SidebarSeparator,\r\n  SidebarTrigger,\r\n  useSidebar,\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\"\r\nimport { Toaster as Sonner, toast } from \"sonner\"\r\n\r\ntype ToasterProps = React.ComponentProps<typeof Sonner>\r\n\r\nconst Toaster = ({ ...props }: ToasterProps) => {\r\n  const { theme = \"system\" } = useTheme()\r\n\r\n  return (\r\n    <Sonner\r\n      theme={theme as ToasterProps[\"theme\"]}\r\n      className=\"toaster group\"\r\n      toastOptions={{\r\n        classNames: {\r\n          toast:\r\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\r\n          description: \"group-[.toast]:text-muted-foreground\",\r\n          actionButton:\r\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\r\n          cancelButton:\r\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\r\n        },\r\n      }}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\n\r\nexport { Toaster, toast }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":6,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":6,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[79,166],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport * as React from \"react\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nexport interface TextareaProps\r\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\r\n\r\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <textarea\r\n        className={cn(\r\n          \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\r\n          className\r\n        )}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    )\r\n  }\r\n)\r\nTextarea.displayName = \"Textarea\"\r\n\r\nexport { Textarea }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":43,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":43,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\"\r\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"@/lib/utils\"\r\n\r\nconst toggleVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-transparent\",\r\n        outline:\r\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-3\",\r\n        sm: \"h-9 px-2.5\",\r\n        lg: \"h-11 px-5\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst Toggle = React.forwardRef<\r\n  React.ElementRef<typeof TogglePrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\r\n    VariantProps<typeof toggleVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <TogglePrimitive.Root\r\n    ref={ref}\r\n    className={cn(toggleVariants({ variant, size, className }))}\r\n    {...props}\r\n  />\r\n))\r\n\r\nToggle.displayName = TogglePrimitive.Root.displayName\r\n\r\nexport { Toggle, toggleVariants }\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\contexts\\AuthContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":95,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":95,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect, useState } from 'react';\r\nimport { User, Session } from '@supabase/supabase-js';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\ninterface AuthContextType {\r\n  user: User | null;\r\n  session: Session | null;\r\n  signIn: (email: string, password: string) => Promise<void>;\r\n  signUp: (email: string, password: string, company: string) => Promise<void>;\r\n  signOut: () => Promise<void>;\r\n  isPrivilegedUser: boolean;\r\n}\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\n\r\n// List of privileged emails that have full lifetime access\r\nconst PRIVILEGED_EMAILS = ['brunosoares877@gmail.com', 'solutioninveste@gmail.com'];\r\n\r\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [session, setSession] = useState<Session | null>(null);\r\n  const [isPrivilegedUser, setIsPrivilegedUser] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    // Set up auth state listener FIRST\r\n    const { data: { subscription } } = supabase.auth.onAuthStateChange(\r\n      (event, session) => {\r\n        setSession(session);\r\n        setUser(session?.user ?? null);\r\n        \r\n        // Check if the user is privileged\r\n        if (session?.user?.email) {\r\n          const isPrUser = PRIVILEGED_EMAILS.includes(session.user.email.toLowerCase());\r\n          console.log(\"User email:\", session.user.email, \"Is privileged:\", isPrUser);\r\n          setIsPrivilegedUser(isPrUser);\r\n        } else {\r\n          setIsPrivilegedUser(false);\r\n        }\r\n        \r\n        // Redirect to dashboard on successful login using window.location\r\n        if (event === 'SIGNED_IN' && window.location.pathname === '/login') {\r\n          window.location.href = '/dashboard';\r\n        }\r\n      }\r\n    );\r\n\r\n    // THEN check for existing session\r\n    supabase.auth.getSession().then(({ data: { session } }) => {\r\n      setSession(session);\r\n      setUser(session?.user ?? null);\r\n      \r\n      // Check if the user is privileged\r\n      if (session?.user?.email) {\r\n        const isPrUser = PRIVILEGED_EMAILS.includes(session.user.email.toLowerCase());\r\n        console.log(\"Initial check - User email:\", session.user.email, \"Is privileged:\", isPrUser);\r\n        setIsPrivilegedUser(isPrUser);\r\n      }\r\n    });\r\n\r\n    return () => subscription.unsubscribe();\r\n  }, []);\r\n\r\n  const signIn = async (email: string, password: string) => {\r\n    const { error } = await supabase.auth.signInWithPassword({ email, password });\r\n    if (error) throw error;\r\n    window.location.href = '/dashboard';\r\n  };\r\n\r\n  const signUp = async (email: string, password: string, company: string) => {\r\n    const { error } = await supabase.auth.signUp({\r\n      email,\r\n      password,\r\n      options: {\r\n        data: {\r\n          company_name: company\r\n        }\r\n      }\r\n    });\r\n    if (error) throw error;\r\n    window.location.href = '/dashboard';\r\n  };\r\n\r\n  const signOut = async () => {\r\n    await supabase.auth.signOut();\r\n    window.location.href = '/login';\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, session, signIn, signUp, signOut, isPrivilegedUser }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (context === undefined) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\contexts\\SubscriptionContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":19,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":19,"endColumn":29},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'startTrial'. Either include it or remove the dependency array.","line":109,"column":6,"nodeType":"ArrayExpression","endLine":109,"endColumn":24,"suggestions":[{"desc":"Update the dependencies array to be: [isPrivilegedUser, startTrial]","fix":{"range":[3858,3876],"text":"[isPrivilegedUser, startTrial]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport { SubscriptionService } from '@/services/subscriptionService';\r\n\r\ntype SubscriptionStatus = 'trial' | 'expired' | 'active';\r\n\r\ninterface SubscriptionContextType {\r\n  status: SubscriptionStatus;\r\n  trialDaysLeft: number;\r\n  subscriptionEndDate: string | null;\r\n  isTrialActive: boolean;\r\n  isSubscriptionActive: boolean;\r\n  startTrial: () => void;\r\n  refreshSubscription: () => Promise<void>;\r\n}\r\n\r\nconst SubscriptionContext = createContext<SubscriptionContextType | undefined>(undefined);\r\n\r\nexport const useSubscription = () => {\r\n  const context = useContext(SubscriptionContext);\r\n  if (context === undefined) {\r\n    throw new Error('useSubscription must be used within a SubscriptionProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const SubscriptionProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [status, setStatus] = useState<SubscriptionStatus>('expired');\r\n  const [trialStartDate, setTrialStartDate] = useState<string | null>(null);\r\n  const [subscriptionEndDate, setSubscriptionEndDate] = useState<string | null>(null);\r\n  const [trialDaysLeft, setTrialDaysLeft] = useState(0);\r\n  const { isPrivilegedUser } = useAuth();\r\n\r\n  // Função para sincronizar assinatura do backend\r\n  const syncSubscriptionFromBackend = async () => {\r\n    try {\r\n      const subscription = await SubscriptionService.getActiveSubscription();\r\n\r\n      if (subscription && subscription.status === 'active') {\r\n        const endDate = new Date(subscription.end_date);\r\n        if (endDate > new Date()) {\r\n          setStatus('active');\r\n          setSubscriptionEndDate(subscription.end_date);\r\n          // Limpar trial se houver assinatura paga\r\n          localStorage.removeItem('trialStartDate');\r\n          setTrialStartDate(null);\r\n          setTrialDaysLeft(0);\r\n          return true;\r\n        }\r\n      }\r\n      return false;\r\n    } catch (err) {\r\n      console.error('Erro ao sincronizar assinatura:', err);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Função pública para revalidar assinatura\r\n  const refreshSubscription = async () => {\r\n    await syncSubscriptionFromBackend();\r\n  };\r\n\r\n  // Load subscription data on mount\r\n  useEffect(() => {\r\n    const loadSubscriptionStatus = async () => {\r\n      // For privileged users, always consider them as having an active subscription\r\n      if (isPrivilegedUser) {\r\n        setStatus('active');\r\n        setSubscriptionEndDate('9999-12-31'); // Far future date\r\n        return;\r\n      }\r\n\r\n      // 1. Primeiro, verificar se há assinatura paga no backend\r\n      const hasActiveSubscription = await syncSubscriptionFromBackend();\r\n      if (hasActiveSubscription) {\r\n        return; // Já configurou tudo\r\n      }\r\n\r\n      // 2. Se não há assinatura paga, verificar trial no localStorage\r\n      const storedTrialStartDate = localStorage.getItem('trialStartDate');\r\n\r\n      if (storedTrialStartDate) {\r\n        const startDate = new Date(storedTrialStartDate);\r\n        const now = new Date();\r\n        const trialEndDate = new Date(startDate);\r\n        trialEndDate.setDate(trialEndDate.getDate() + 7); // 7-day trial\r\n\r\n        if (trialEndDate > now) {\r\n          setStatus('trial');\r\n          setTrialStartDate(storedTrialStartDate);\r\n\r\n          // Calculate days left\r\n          const diffTime = trialEndDate.getTime() - now.getTime();\r\n          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n          setTrialDaysLeft(diffDays);\r\n        } else {\r\n          setStatus('expired');\r\n          setTrialStartDate(null);\r\n          setTrialDaysLeft(0);\r\n        }\r\n      }\r\n      // 3. Auto-start trial if no trial or subscription exists yet\r\n      else {\r\n        startTrial();\r\n      }\r\n    };\r\n\r\n    loadSubscriptionStatus();\r\n  }, [isPrivilegedUser]);\r\n\r\n  // Update trial days left every hour\r\n  useEffect(() => {\r\n    if (status === 'trial' && trialStartDate) {\r\n      const updateDaysLeft = () => {\r\n        const startDate = new Date(trialStartDate);\r\n        const now = new Date();\r\n        const trialEndDate = new Date(startDate);\r\n        trialEndDate.setDate(trialEndDate.getDate() + 7); // 7-day trial\r\n\r\n        if (trialEndDate > now) {\r\n          const diffTime = trialEndDate.getTime() - now.getTime();\r\n          const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n          setTrialDaysLeft(diffDays);\r\n        } else {\r\n          setStatus('expired');\r\n          setTrialDaysLeft(0);\r\n        }\r\n      };\r\n\r\n      // Update immediately\r\n      updateDaysLeft();\r\n\r\n      // Set interval to check hourly\r\n      const intervalId = setInterval(updateDaysLeft, 1000 * 60 * 60); // Check every hour\r\n      return () => clearInterval(intervalId);\r\n    }\r\n  }, [status, trialStartDate]);\r\n\r\n  // Periodically check for subscription updates from backend (every 5 minutes)\r\n  useEffect(() => {\r\n    if (!isPrivilegedUser) {\r\n      const intervalId = setInterval(async () => {\r\n        await syncSubscriptionFromBackend();\r\n      }, 5 * 60 * 1000); // 5 minutes\r\n\r\n      return () => clearInterval(intervalId);\r\n    }\r\n  }, [isPrivilegedUser]);\r\n\r\n  const startTrial = () => {\r\n    // Don't start trial for privileged users\r\n    if (isPrivilegedUser) return;\r\n\r\n    const now = new Date().toISOString();\r\n    localStorage.setItem('trialStartDate', now);\r\n    setTrialStartDate(now);\r\n    setStatus('trial');\r\n    setTrialDaysLeft(7);\r\n  };\r\n\r\n  const value = {\r\n    status,\r\n    trialDaysLeft,\r\n    subscriptionEndDate,\r\n    isTrialActive: status === 'trial',\r\n    isSubscriptionActive: status === 'active',\r\n    startTrial,\r\n    refreshSubscription,\r\n  };\r\n\r\n  return (\r\n    <SubscriptionContext.Provider value={value}>\r\n      {children}\r\n    </SubscriptionContext.Provider>\r\n  );\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\contexts\\ThemeContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":28,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":28,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useEffect } from 'react';\r\n\r\ninterface ThemeContextType {\r\n  theme: 'light';\r\n}\r\n\r\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\r\n\r\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\r\n  // Aplicar sempre o tema claro\r\n  useEffect(() => {\r\n    const root = window.document.documentElement;\r\n    \r\n    // Remover todas as classes de tema\r\n    root.classList.remove('dark', 'light', 'classic-dark');\r\n    \r\n    // Aplicar apenas o tema claro\r\n    root.classList.add('light');\r\n  }, []);\r\n\r\n  return (\r\n    <ThemeContext.Provider value={{ theme: 'light' }}>\r\n      {children}\r\n    </ThemeContext.Provider>\r\n  );\r\n}\r\n\r\nexport const useTheme = () => {\r\n  const context = useContext(ThemeContext);\r\n  if (context === undefined) {\r\n    throw new Error('useTheme must be used within a ThemeProvider');\r\n  }\r\n  return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\contexts\\WhiteLabelContext.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":129,"column":14,"nodeType":"Identifier","messageId":"namedExport","endLine":129,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\ninterface WhiteLabelConfig {\r\n  primaryColor: string;\r\n  secondaryColor: string;\r\n  logoUrl: string | null;\r\n}\r\n\r\ninterface WhiteLabelContextType {\r\n  config: WhiteLabelConfig;\r\n  updateConfig: (newConfig: Partial<WhiteLabelConfig>) => Promise<void>;\r\n  uploadLogo: (file: File) => Promise<string | null>;\r\n  isLoading: boolean;\r\n}\r\n\r\nconst defaultConfig: WhiteLabelConfig = {\r\n  primaryColor: '#0078D7',\r\n  secondaryColor: '#00A2ED',\r\n  logoUrl: null,\r\n};\r\n\r\nconst WhiteLabelContext = createContext<WhiteLabelContextType | undefined>(undefined);\r\n\r\nexport const WhiteLabelProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [config, setConfig] = useState<WhiteLabelConfig>(defaultConfig);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const loadConfig = async () => {\r\n      setIsLoading(true);\r\n      try {\r\n        const { data: { session } } = await supabase.auth.getSession();\r\n        \r\n        if (session?.user) {\r\n          // Load config from Supabase or localStorage\r\n          const storedConfig = localStorage.getItem(`whiteLabel_${session.user.id}`);\r\n          \r\n          if (storedConfig) {\r\n            setConfig(JSON.parse(storedConfig));\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Error loading white label config:', error);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    \r\n    loadConfig();\r\n  }, []);\r\n\r\n  // Apply CSS variables when config changes\r\n  useEffect(() => {\r\n    document.documentElement.style.setProperty('--primary', config.primaryColor);\r\n    document.documentElement.style.setProperty('--secondary', config.secondaryColor);\r\n  }, [config]);\r\n\r\n  const updateConfig = async (newConfig: Partial<WhiteLabelConfig>) => {\r\n    try {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      \r\n      if (!session?.user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n      \r\n      const updatedConfig = { ...config, ...newConfig };\r\n      \r\n      // Save to localStorage\r\n      localStorage.setItem(`whiteLabel_${session.user.id}`, JSON.stringify(updatedConfig));\r\n      \r\n      setConfig(updatedConfig);\r\n      \r\n      return Promise.resolve();\r\n    } catch (error) {\r\n      return Promise.reject(error);\r\n    }\r\n  };\r\n\r\n  const uploadLogo = async (file: File): Promise<string | null> => {\r\n    try {\r\n      setIsLoading(true);\r\n      \r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      \r\n      if (!session?.user) {\r\n        throw new Error('User not authenticated');\r\n      }\r\n      \r\n      const fileExt = file.name.split('.').pop();\r\n      const fileName = `${session.user.id}/logo.${fileExt}`;\r\n      \r\n      // Upload to storage\r\n      const { data, error } = await supabase.storage\r\n        .from('white-label')\r\n        .upload(fileName, file, { upsert: true });\r\n      \r\n      if (error) {\r\n        throw error;\r\n      }\r\n      \r\n      // Get public URL\r\n      const { data: publicUrlData } = supabase.storage\r\n        .from('white-label')\r\n        .getPublicUrl(fileName);\r\n      \r\n      const logoUrl = publicUrlData.publicUrl;\r\n      \r\n      // Update config with new logo URL\r\n      await updateConfig({ logoUrl });\r\n      \r\n      return logoUrl;\r\n    } catch (error) {\r\n      console.error('Error uploading logo:', error);\r\n      return null;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <WhiteLabelContext.Provider value={{ config, updateConfig, uploadLogo, isLoading }}>\r\n      {children}\r\n    </WhiteLabelContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useWhiteLabel = () => {\r\n  const context = useContext(WhiteLabelContext);\r\n  if (!context) {\r\n    throw new Error('useWhiteLabel must be used within a WhiteLabelProvider');\r\n  }\r\n  return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useBanks.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3124,3127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3124,3127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3243,3246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3243,3246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4637,4640],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4637,4640],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\n// Default banks from LeadsConfig\r\nconst DEFAULT_BANKS = [\r\n  { code: \"001\", name: \"Banco do Brasil\" },\r\n  { code: \"003\", name: \"Banco da Amazônia\" },\r\n  { code: \"004\", name: \"Banco do Nordeste\" },\r\n  { code: \"021\", name: \"Banestes (Banco do Estado do Espírito Santo)\" },\r\n  { code: \"025\", name: \"Banco Alfa\" },\r\n  { code: \"033\", name: \"Santander\" },\r\n  { code: \"041\", name: \"Banrisul\" },\r\n  { code: \"070\", name: \"BRB (Banco de Brasília)\" },\r\n  { code: \"077\", name: \"Banco Inter\" },\r\n  { code: \"104\", name: \"Caixa Econômica Federal\" },\r\n  { code: \"121\", name: \"Agibank\" },\r\n  { code: \"212\", name: \"Banco Original\" },\r\n  { code: \"237\", name: \"Bradesco\" },\r\n  { code: \"318\", name: \"Banco BMG\" },\r\n  { code: \"320\", name: \"CCB Brasil (China Construction Bank)\" },\r\n  { code: \"336\", name: \"C6 Bank\" },\r\n  { code: \"341\", name: \"Itaú Unibanco\" },\r\n  { code: \"371\", name: \"Banco Bari\" },\r\n  { code: \"389\", name: \"Banco Mercantil do Brasil\" },\r\n  { code: \"422\", name: \"Banco Safra\" },\r\n  { code: \"604\", name: \"Banco Industrial\" },\r\n  { code: \"623\", name: \"Banco PAN\" },\r\n  { code: \"640\", name: \"Banco Inbursa\" },\r\n  { code: \"654\", name: \"Banco A.J. Renner (Parati Financeira)\" },\r\n  { code: \"655\", name: \"Banco Votorantim (BV Financeira)\" },\r\n  { code: \"707\", name: \"Banco Daycoval\" },\r\n  { code: \"739\", name: \"Cetelem (BNP Paribas)\" },\r\n  { code: \"743\", name: \"Banco Semear\" },\r\n  { code: \"777\", name: \"Banco JP Morgan (atua em nichos)\" }\r\n];\r\n\r\nexport interface Bank {\r\n  code: string;\r\n  name: string;\r\n}\r\n\r\ninterface ConfigBank {\r\n  id: string;\r\n  name: string;\r\n  code: string;\r\n}\r\n\r\n// Utility functions from LeadsConfig\r\nfunction getRemovedIds(key: string): string[] {\r\n  return JSON.parse(localStorage.getItem(key) || '[]');\r\n}\r\n\r\nfunction getEditedItems<T>(key: string): T[] {\r\n  return JSON.parse(localStorage.getItem(key) || '[]');\r\n}\r\n\r\nexport const useBanks = () => {\r\n  const [banks, setBanks] = useState<Bank[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const fetchBanks = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n\r\n      // Get configured banks from localStorage (same logic as LeadsConfig)\r\n      const savedBanks = localStorage.getItem('configBanks');\r\n      const configuredBanks = savedBanks ? JSON.parse(savedBanks) : [];\r\n      const removedBankIds = getRemovedIds('removedBanks');\r\n      const editedBanks = getEditedItems<ConfigBank>('editedBanks');\r\n      const allBanks: Bank[] = [];\r\n\r\n      // Tenta carregar bancos do Supabase (persistência multi-dispositivo)\r\n      let supabaseBanks: Bank[] = [];\r\n      try {\r\n        const { data: userData } = await supabase.auth.getUser();\r\n        if (userData.user) {\r\n          const { data, error } = await supabase\r\n            .from('banks')\r\n            .select('name, code')\r\n            .eq('user_id', userData.user.id)\r\n            .order('name');\r\n          if (error) throw error;\r\n          supabaseBanks = (data || []).map((b: any) => ({\r\n            name: b.name,\r\n            code: b.code || \"\",\r\n          }));\r\n        }\r\n      } catch (err: any) {\r\n        console.warn('Falha ao carregar bancos do Supabase (usando localStorage):', err?.message || err);\r\n      }\r\n      \r\n      // Add default banks with generated IDs\r\n      DEFAULT_BANKS.forEach(bank => {\r\n        const id = `default-${bank.code}`;\r\n        // Se foi removido, não adiciona\r\n        if (removedBankIds.includes(id)) return;\r\n        // Se foi editado, adiciona editado\r\n        const edited = editedBanks.find(b => b.id === id);\r\n        if (edited) {\r\n          allBanks.push({ code: edited.code, name: edited.name });\r\n        } else {\r\n          allBanks.push({ code: bank.code, name: bank.name });\r\n        }\r\n      });\r\n      \r\n      // Add configured banks (user-added)\r\n      configuredBanks.forEach((configBank: ConfigBank) => {\r\n        const exists = allBanks.find(bank => bank.code === configBank.code || bank.name === configBank.name);\r\n        if (!exists) {\r\n          allBanks.push({ code: configBank.code, name: configBank.name });\r\n        }\r\n      });\r\n\r\n      // Add bancos do Supabase\r\n      supabaseBanks.forEach((sb) => {\r\n        const exists = allBanks.find(bank => bank.code === sb.code || bank.name === sb.name);\r\n        if (!exists) {\r\n          allBanks.push(sb);\r\n        }\r\n      });\r\n\r\n      // Sort alphabetically by name\r\n      allBanks.sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n      setBanks(allBanks);\r\n    } catch (err: any) {\r\n      console.error('Erro ao buscar bancos das configurações:', err);\r\n      setError(err.message || 'Erro ao carregar bancos');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchBanks();\r\n\r\n    // Listen for changes in localStorage (from LeadsConfig)\r\n    const handleStorageChange = (e: StorageEvent) => {\r\n      if (e.key === 'configBanks' || e.key === 'removedBanks' || e.key === 'editedBanks') {\r\n        fetchBanks();\r\n      }\r\n    };\r\n\r\n    // Listen for custom event from LeadsConfig\r\n    const handleCustomStorageChange = () => {\r\n      fetchBanks();\r\n    };\r\n\r\n    window.addEventListener('storage', handleStorageChange);\r\n    window.addEventListener('configDataChanged', handleCustomStorageChange);\r\n\r\n    return () => {\r\n      window.removeEventListener('storage', handleStorageChange);\r\n      window.removeEventListener('configDataChanged', handleCustomStorageChange);\r\n    };\r\n  }, []);\r\n\r\n  return {\r\n    banks,\r\n    isLoading,\r\n    error,\r\n    refetch: fetchBanks\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useBundleOptimization.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1970,1973],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1970,1973],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5194,5197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5194,5197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6137,6140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6137,6140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6241,6244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6241,6244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback, useRef, useState } from 'react';\r\nimport { initIntelligentPreloading, preloadRoute } from '@/utils/lazyLoading';\r\n\r\ninterface BundleOptimizationConfig {\r\n  enablePreloading?: boolean;\r\n  enableImageOptimization?: boolean;\r\n  enableCodeSplitting?: boolean;\r\n  preloadCriticalRoutes?: string[];\r\n  lazyLoadThreshold?: number;\r\n}\r\n\r\ninterface PerformanceMetrics {\r\n  bundleSize: number;\r\n  loadTime: number;\r\n  chunkCount: number;\r\n  cacheHitRate: number;\r\n  memoryUsage: number;\r\n}\r\n\r\nexport const useBundleOptimization = (config: BundleOptimizationConfig = {}) => {\r\n  const {\r\n    enablePreloading = true,\r\n    enableImageOptimization = true,\r\n    enableCodeSplitting = true,\r\n    preloadCriticalRoutes = ['leads', 'dashboard'],\r\n    lazyLoadThreshold = 0.1\r\n  } = config;\r\n\r\n  const [metrics, setMetrics] = useState<PerformanceMetrics>({\r\n    bundleSize: 0,\r\n    loadTime: 0,\r\n    chunkCount: 0,\r\n    cacheHitRate: 0,\r\n    memoryUsage: 0\r\n  });\r\n\r\n  const cleanupRef = useRef<(() => void) | null>(null);\r\n\r\n  // Inicializar otimizações\r\n  useEffect(() => {\r\n    let cleanup: (() => void) | undefined;\r\n\r\n    if (enablePreloading) {\r\n      cleanup = initIntelligentPreloading();\r\n      cleanupRef.current = cleanup;\r\n\r\n      // Preload rotas críticas\r\n      setTimeout(() => {\r\n        preloadCriticalRoutes.forEach(route => {\r\n          preloadRoute(route);\r\n        });\r\n      }, 1000);\r\n    }\r\n\r\n    return () => {\r\n      if (cleanup) {\r\n        cleanup();\r\n      }\r\n    };\r\n  }, [enablePreloading, preloadCriticalRoutes]);\r\n\r\n  // Monitorar métricas de performance\r\n  useEffect(() => {\r\n    const updateMetrics = () => {\r\n      const performance = window.performance;\r\n      const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;\r\n      \r\n      setMetrics(prev => ({\r\n        ...prev,\r\n        loadTime: navigation.loadEventEnd - navigation.fetchStart,\r\n        memoryUsage: (performance as any).memory?.usedJSHeapSize || 0\r\n      }));\r\n    };\r\n\r\n    // Atualizar métricas quando a página carregar\r\n    if (document.readyState === 'complete') {\r\n      updateMetrics();\r\n    } else {\r\n      window.addEventListener('load', updateMetrics);\r\n    }\r\n\r\n    // Monitorar mudanças de performance periodicamente\r\n    const interval = setInterval(updateMetrics, 30000); // 30 segundos\r\n\r\n    return () => {\r\n      window.removeEventListener('load', updateMetrics);\r\n      clearInterval(interval);\r\n    };\r\n  }, []);\r\n\r\n  // Otimização de imagens lazy\r\n  const optimizeImage = useCallback((img: HTMLImageElement) => {\r\n    if (!enableImageOptimization) return;\r\n\r\n    // Adicionar lazy loading nativo\r\n    img.loading = 'lazy';\r\n    \r\n    // Otimizar formato baseado no suporte do browser\r\n    if (img.src && !img.src.includes('data:')) {\r\n      const supportsWebP = () => {\r\n        const canvas = document.createElement('canvas');\r\n        return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\r\n      };\r\n\r\n      if (supportsWebP() && !img.src.includes('.webp')) {\r\n        // Sugerir conversão para WebP (implementar no servidor)\r\n        console.log('Imagem pode ser otimizada para WebP:', img.src);\r\n      }\r\n    }\r\n  }, [enableImageOptimization]);\r\n\r\n  // Hook para otimizar componentes pesados\r\n  const optimizeHeavyComponent = useCallback((componentRef: HTMLElement | null) => {\r\n    if (!componentRef || !enableCodeSplitting) return;\r\n\r\n    // Implementar Intersection Observer para renderização sob demanda\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach(entry => {\r\n          if (entry.isIntersecting) {\r\n            // Componente está visível, pode carregar conteúdo pesado\r\n            entry.target.setAttribute('data-loaded', 'true');\r\n            observer.unobserve(entry.target);\r\n          }\r\n        });\r\n      },\r\n      { threshold: lazyLoadThreshold }\r\n    );\r\n\r\n    observer.observe(componentRef);\r\n\r\n    return () => observer.disconnect();\r\n  }, [enableCodeSplitting, lazyLoadThreshold]);\r\n\r\n  // Preload recursos críticos\r\n  const preloadCriticalResources = useCallback(() => {\r\n    // Preload CSS crítico\r\n    const criticalCSS = document.querySelectorAll('link[rel=\"preload\"][as=\"style\"]');\r\n    if (criticalCSS.length === 0) {\r\n      const link = document.createElement('link');\r\n      link.rel = 'preload';\r\n      link.as = 'style';\r\n      link.href = '/assets/index.css';\r\n      document.head.appendChild(link);\r\n    }\r\n\r\n    // Preload fontes críticas\r\n    const fonts = [\r\n      '/fonts/inter-latin-wght-normal.woff2'\r\n    ];\r\n\r\n    fonts.forEach(fontPath => {\r\n      const link = document.createElement('link');\r\n      link.rel = 'preload';\r\n      link.as = 'font';\r\n      link.type = 'font/woff2';\r\n      link.crossOrigin = 'anonymous';\r\n      link.href = fontPath;\r\n      document.head.appendChild(link);\r\n    });\r\n  }, []);\r\n\r\n  // Limpar recursos não utilizados\r\n  const cleanupUnusedResources = useCallback(() => {\r\n    // Remover event listeners não utilizados\r\n    if (cleanupRef.current) {\r\n      cleanupRef.current();\r\n    }\r\n\r\n    // Garbage collection manual se disponível\r\n    if ('gc' in window) {\r\n      (window as any).gc();\r\n    }\r\n  }, []);\r\n\r\n  // Analisar e reportar performance do bundle\r\n  const analyzeBundle = useCallback(() => {\r\n    const scripts = Array.from(document.querySelectorAll('script[src]'));\r\n    const styles = Array.from(document.querySelectorAll('link[rel=\"stylesheet\"]'));\r\n    \r\n    const bundleInfo = {\r\n      scriptCount: scripts.length,\r\n      styleCount: styles.length,\r\n      totalAssets: scripts.length + styles.length,\r\n      estimatedSize: scripts.length * 50 + styles.length * 20 // Estimativa em KB\r\n    };\r\n\r\n    setMetrics(prev => ({\r\n      ...prev,\r\n      bundleSize: bundleInfo.estimatedSize,\r\n      chunkCount: bundleInfo.scriptCount\r\n    }));\r\n\r\n    return bundleInfo;\r\n  }, []);\r\n\r\n  // Detectar e reportar código não utilizado\r\n  const detectUnusedCode = useCallback(() => {\r\n    if ('coverage' in window.performance) {\r\n      // API de Coverage (quando disponível)\r\n      const coverage = (window.performance as any).coverage;\r\n      if (coverage) {\r\n        const unusedRatio = coverage.reduce((acc: number, entry: any) => {\r\n          return acc + (1 - entry.used / entry.total);\r\n        }, 0) / coverage.length;\r\n\r\n        return {\r\n          unusedCodePercentage: Math.round(unusedRatio * 100),\r\n          suggestions: [\r\n            'Considere implementar tree-shaking mais agressivo',\r\n            'Remova dependências não utilizadas',\r\n            'Implemente code splitting para rotas'\r\n          ]\r\n        };\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }, []);\r\n\r\n  // Resource hints automáticos\r\n  const addResourceHints = useCallback((urls: string[]) => {\r\n    urls.forEach(url => {\r\n      // DNS prefetch para domínios externos\r\n      if (url.includes('://') && !url.includes(window.location.hostname)) {\r\n        const link = document.createElement('link');\r\n        link.rel = 'dns-prefetch';\r\n        link.href = new URL(url).origin;\r\n        document.head.appendChild(link);\r\n      }\r\n\r\n      // Preconnect para recursos críticos\r\n      if (url.includes('supabase.co') || url.includes('sentry.io')) {\r\n        const link = document.createElement('link');\r\n        link.rel = 'preconnect';\r\n        link.href = new URL(url).origin;\r\n        document.head.appendChild(link);\r\n      }\r\n    });\r\n  }, []);\r\n\r\n  return {\r\n    // Métricas\r\n    metrics,\r\n    \r\n    // Funções de otimização\r\n    optimizeImage,\r\n    optimizeHeavyComponent,\r\n    preloadCriticalResources,\r\n    cleanupUnusedResources,\r\n    analyzeBundle,\r\n    detectUnusedCode,\r\n    addResourceHints,\r\n    \r\n    // Configurações\r\n    config: {\r\n      enablePreloading,\r\n      enableImageOptimization,\r\n      enableCodeSplitting,\r\n      preloadCriticalRoutes,\r\n      lazyLoadThreshold\r\n    }\r\n  };\r\n};\r\n\r\n// Hook específico para monitoramento de performance do bundle\r\nexport const useBundleMetrics = () => {\r\n  const [metrics, setMetrics] = useState({\r\n    initialLoadTime: 0,\r\n    totalBundleSize: 0,\r\n    chunksLoaded: 0,\r\n    cacheHits: 0,\r\n    compressionRatio: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    const observer = new PerformanceObserver((list) => {\r\n      list.getEntries().forEach((entry) => {\r\n        if (entry.entryType === 'resource') {\r\n          const resourceEntry = entry as PerformanceResourceTiming;\r\n          \r\n          if (resourceEntry.name.includes('.js') || resourceEntry.name.includes('.css')) {\r\n            setMetrics(prev => ({\r\n              ...prev,\r\n              chunksLoaded: prev.chunksLoaded + 1,\r\n              totalBundleSize: prev.totalBundleSize + (resourceEntry.transferSize || 0)\r\n            }));\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe({ entryTypes: ['resource'] });\r\n\r\n    return () => observer.disconnect();\r\n  }, []);\r\n\r\n  const getCompressionRatio = useCallback(() => {\r\n    const resources = performance.getEntriesByType('resource') as PerformanceResourceTiming[];\r\n    const jsResources = resources.filter(r => r.name.includes('.js'));\r\n    \r\n    if (jsResources.length > 0) {\r\n      const totalUncompressed = jsResources.reduce((acc, r) => acc + (r.decodedBodySize || 0), 0);\r\n      const totalCompressed = jsResources.reduce((acc, r) => acc + (r.transferSize || 0), 0);\r\n      \r\n      return totalCompressed > 0 ? (1 - totalCompressed / totalUncompressed) * 100 : 0;\r\n    }\r\n    \r\n    return 0;\r\n  }, []);\r\n\r\n  return {\r\n    metrics,\r\n    getCompressionRatio,\r\n    refresh: () => {\r\n      const navigation = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming;\r\n      setMetrics(prev => ({\r\n        ...prev,\r\n        initialLoadTime: navigation.loadEventEnd - navigation.fetchStart,\r\n        compressionRatio: getCompressionRatio()\r\n      }));\r\n    }\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useCacheMetrics.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useCommissionConfig.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'ratesQuery' is never reassigned. Use 'const' instead.","line":41,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":41,"endColumn":21,"fix":{"range":[1366,1529],"text":"const ratesQuery = supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .eq('active', true)\r\n        .order('created_at', { ascending: true });"}},{"ruleId":"prefer-const","severity":2,"message":"'tiersQuery' is never reassigned. Use 'const' instead.","line":47,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":47,"endColumn":21,"fix":{"range":[1539,1753],"text":"const tiersQuery = supabase\r\n        .from('commission_tiers')\r\n        .select('*')\r\n        .eq('active', true)\r\n        .order('min_amount', { ascending: true })\r\n        .order('min_period', { ascending: true });"}}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { useState, useEffect, useMemo } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { CommissionRate, CommissionTier } from '@/types/models';\r\nimport { mapProductToCommissionConfig } from '@/utils/productMapping';\r\n\r\nexport interface CommissionConfigOption {\r\n  id: string;\r\n  name: string;\r\n  type: 'fixed_rate' | 'value_tier' | 'period_tier';\r\n  commission_type: 'percentage' | 'fixed';\r\n  value: number; // percentual ou valor fixo\r\n  product: string; // Nome do produto\r\n  min_amount?: number;\r\n  max_amount?: number;\r\n  min_period?: number;\r\n  max_period?: number;\r\n}\r\n\r\nexport interface CommissionCalculationResult {\r\n  option: CommissionConfigOption;\r\n  calculatedValue: number;\r\n  percentage: number;\r\n}\r\n\r\nexport const useCommissionConfig = (productName?: string) => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [rates, setRates] = useState<CommissionRate[]>([]);\r\n  const [tiers, setTiers] = useState<CommissionTier[]>([]);\r\n  const [selectedOption, setSelectedOption] = useState<CommissionConfigOption | null>(null);\r\n\r\n  // Carregar configurações uma única vez\r\n  useEffect(() => {\r\n    loadCommissionConfig();\r\n  }, []);\r\n\r\n  const loadCommissionConfig = async () => {\r\n    try {\r\n      setLoading(true);\r\n\r\n      // Sempre carregar todas as configurações - o filtro será feito no componente\r\n      let ratesQuery = supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .eq('active', true)\r\n        .order('created_at', { ascending: true });\r\n\r\n      let tiersQuery = supabase\r\n        .from('commission_tiers')\r\n        .select('*')\r\n        .eq('active', true)\r\n        .order('min_amount', { ascending: true })\r\n        .order('min_period', { ascending: true });\r\n\r\n      const { data: ratesData, error: ratesError } = await ratesQuery;\r\n      const { data: tiersData, error: tiersError } = await tiersQuery;\r\n\r\n      if (ratesError) throw ratesError;\r\n      if (tiersError) throw tiersError;\r\n\r\n      setRates((ratesData || []) as CommissionRate[]);\r\n      setTiers((tiersData || []) as CommissionTier[]);\r\n\r\n    } catch (error) {\r\n      console.error('Erro ao carregar configurações de comissão:', error);\r\n      setRates([]);\r\n      setTiers([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Converter configurações para opções selecionáveis\r\n  const availableOptions = useMemo(() => {\r\n    const options: CommissionConfigOption[] = [];\r\n\r\n    // Adicionar taxas fixas\r\n    rates.forEach(rate => {\r\n      options.push({\r\n        id: `rate_${rate.id}`,\r\n        name: rate.name || `Taxa ${rate.commission_type === 'fixed' ? 'Fixa' : 'Percentual'}`,\r\n        type: 'fixed_rate',\r\n        commission_type: rate.commission_type,\r\n        value: rate.commission_type === 'fixed' ? (rate.fixed_value || 0) : rate.percentage,\r\n        product: rate.product\r\n      });\r\n    });\r\n\r\n    // Adicionar faixas de valor\r\n    tiers.filter(tier => !tier.tier_type || tier.tier_type === 'value').forEach(tier => {\r\n      options.push({\r\n        id: `tier_${tier.id}`,\r\n        name: tier.name || `Faixa de Valor`,\r\n        type: 'value_tier',\r\n        commission_type: tier.commission_type,\r\n        value: tier.commission_type === 'fixed' ? (tier.fixed_value || 0) : tier.percentage,\r\n        product: tier.product,\r\n        min_amount: tier.min_amount,\r\n        max_amount: tier.max_amount\r\n      });\r\n    });\r\n\r\n    // Adicionar faixas de período\r\n    tiers.filter(tier => tier.tier_type === 'period').forEach(tier => {\r\n      options.push({\r\n        id: `tier_${tier.id}`,\r\n        name: tier.name || `Faixa de Período`,\r\n        type: 'period_tier',\r\n        commission_type: tier.commission_type,\r\n        value: tier.commission_type === 'fixed' ? (tier.fixed_value || 0) : tier.percentage,\r\n        product: tier.product,\r\n        min_period: tier.min_period,\r\n        max_period: tier.max_period\r\n      });\r\n    });\r\n\r\n    return options;\r\n  }, [rates, tiers]);\r\n\r\n  // Calcular comissão baseada na opção selecionada\r\n  const calculateCommission = (\r\n    option: CommissionConfigOption,\r\n    amount: number,\r\n    paymentPeriod?: number\r\n  ): CommissionCalculationResult | null => {\r\n    if (!option || amount <= 0) return null;\r\n\r\n    // Para taxas fixas (fixed_rate), não aplicar validação de faixa\r\n    if (option.type === 'fixed_rate') {\r\n      let calculatedValue: number;\r\n      let percentage: number;\r\n\r\n      if (option.commission_type === 'fixed') {\r\n        calculatedValue = option.value;\r\n        percentage = amount > 0 ? (calculatedValue / amount) * 100 : 0;\r\n      } else {\r\n        percentage = option.value;\r\n        calculatedValue = (amount * percentage) / 100;\r\n      }\r\n\r\n      return {\r\n        option,\r\n        calculatedValue,\r\n        percentage\r\n      };\r\n    }\r\n\r\n    // Para faixas de valor (value_tier), verificar apenas se há faixas definidas\r\n    if (option.type === 'value_tier') {\r\n      // Se não há min nem max definidos, aceitar qualquer valor\r\n      const hasMinAmount = option.min_amount !== null && option.min_amount !== undefined;\r\n      const hasMaxAmount = option.max_amount !== null && option.max_amount !== undefined;\r\n      \r\n      if (hasMinAmount && amount < option.min_amount!) return null;\r\n      if (hasMaxAmount && amount > option.max_amount!) return null;\r\n    }\r\n\r\n    // Para faixas de período (period_tier), verificar apenas se período foi fornecido\r\n    if (option.type === 'period_tier') {\r\n      // Se não há período informado mas a validação exige, retornar null\r\n      if (!paymentPeriod) {\r\n        // Mas se não há restrições de período definidas, aceitar\r\n        const hasMinPeriod = option.min_period !== null && option.min_period !== undefined;\r\n        const hasMaxPeriod = option.max_period !== null && option.max_period !== undefined;\r\n        \r\n        if (hasMinPeriod || hasMaxPeriod) return null;\r\n      } else {\r\n        // Se há período, validar as faixas\r\n        const hasMinPeriod = option.min_period !== null && option.min_period !== undefined;\r\n        const hasMaxPeriod = option.max_period !== null && option.max_period !== undefined;\r\n        \r\n        if (hasMinPeriod && paymentPeriod < option.min_period!) return null;\r\n        if (hasMaxPeriod && paymentPeriod > option.max_period!) return null;\r\n      }\r\n    }\r\n\r\n    // Calcular valor da comissão\r\n    let calculatedValue: number;\r\n    let percentage: number;\r\n\r\n    if (option.commission_type === 'fixed') {\r\n      calculatedValue = option.value;\r\n      percentage = amount > 0 ? (calculatedValue / amount) * 100 : 0;\r\n    } else {\r\n      percentage = option.value;\r\n      calculatedValue = (amount * percentage) / 100;\r\n    }\r\n\r\n    return {\r\n      option,\r\n      calculatedValue,\r\n      percentage\r\n    };\r\n  };\r\n\r\n  // Encontrar automaticamente a melhor opção baseada no valor e período\r\n  const findBestOption = (amount: number, paymentPeriod?: number): CommissionConfigOption | null => {\r\n    if (amount <= 0) return null;\r\n\r\n    // Filtrar opções pelo produto se especificado\r\n    const filteredOptions = productName \r\n      ? availableOptions.filter(opt => opt.product === productName)\r\n      : availableOptions;\r\n\r\n    if (filteredOptions.length === 0) return null;\r\n\r\n    // Lista de opções válidas baseadas na validação\r\n    const validOptions: CommissionConfigOption[] = [];\r\n\r\n    for (const option of filteredOptions) {\r\n      // Testar se a opção é válida fazendo um cálculo de teste\r\n      const testResult = calculateCommission(option, amount, paymentPeriod);\r\n      if (testResult) {\r\n        validOptions.push(option);\r\n      }\r\n    }\r\n\r\n    if (validOptions.length === 0) {\r\n      // Se não há opções válidas, retornar a primeira taxa fixa disponível\r\n      const fixedRates = filteredOptions.filter(opt => opt.type === 'fixed_rate');\r\n      return fixedRates[0] || filteredOptions[0] || null;\r\n    }\r\n\r\n    // Prioridade de seleção:\r\n    // 1. Faixas de período (se período foi fornecido)\r\n    // 2. Faixas de valor (mais específicas)\r\n    // 3. Taxas fixas (mais genéricas)\r\n\r\n    // 1. Tentar encontrar por período se fornecido\r\n    if (paymentPeriod) {\r\n      const periodOptions = validOptions.filter(opt => opt.type === 'period_tier');\r\n      if (periodOptions.length > 0) {\r\n        // Retornar a que tem a faixa mais específica (menor range)\r\n        return periodOptions.sort((a, b) => {\r\n          const rangeA = (a.max_period || Infinity) - (a.min_period || 0);\r\n          const rangeB = (b.max_period || Infinity) - (b.min_period || 0);\r\n          return rangeA - rangeB;\r\n        })[0];\r\n      }\r\n    }\r\n\r\n    // 2. Tentar encontrar por faixa de valor\r\n    const valueOptions = validOptions.filter(opt => opt.type === 'value_tier');\r\n    if (valueOptions.length > 0) {\r\n      // Retornar a que tem a faixa mais específica (menor range)\r\n      return valueOptions.sort((a, b) => {\r\n        const rangeA = (a.max_amount || Infinity) - (a.min_amount || 0);\r\n        const rangeB = (b.max_amount || Infinity) - (b.min_amount || 0);\r\n        return rangeA - rangeB;\r\n      })[0];\r\n    }\r\n\r\n    // 3. Taxa fixa como fallback\r\n    const fixedRates = validOptions.filter(opt => opt.type === 'fixed_rate');\r\n    return fixedRates[0] || validOptions[0];\r\n  };\r\n\r\n  return {\r\n    loading,\r\n    availableOptions,\r\n    selectedOption,\r\n    setSelectedOption,\r\n    calculateCommission,\r\n    findBestOption,\r\n    hasOptions: availableOptions.length > 0\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useOptimizedLeads.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1716,1719],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1716,1719],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2416,2419],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2416,2419],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5212,5215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5212,5215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":192,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":192,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5937,5940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5937,5940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useDebounce } from './usePerformanceOptimization';\r\n\r\ninterface Lead {\r\n  id: string;\r\n  name: string;\r\n  status: string;\r\n  phone: string;\r\n  cpf: string;\r\n  amount?: number;\r\n  created_at: string;\r\n  user_id: string;\r\n}\r\n\r\ninterface LeadStats {\r\n  total: number;\r\n  new: number;\r\n  qualified: number;\r\n  converted: number;\r\n}\r\n\r\ninterface UseOptimizedLeadsOptions {\r\n  pageSize?: number;\r\n  enableCache?: boolean;\r\n  cacheDuration?: number;\r\n}\r\n\r\nexport const useOptimizedLeads = (options: UseOptimizedLeadsOptions = {}) => {\r\n  const {\r\n    pageSize = 20,\r\n    enableCache = true,\r\n    cacheDuration = 5 * 60 * 1000 // 5 minutos\r\n  } = options;\r\n\r\n  // Estados\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [stats, setStats] = useState<LeadStats>({ total: 0, new: 0, qualified: 0, converted: 0 });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [hasNextPage, setHasNextPage] = useState(false);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalCount, setTotalCount] = useState(0);\r\n\r\n  // Filtros\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [statusFilter, setStatusFilter] = useState('all');\r\n  const [sortBy, setSortBy] = useState<'created_at' | 'name'>('created_at');\r\n  const [sortOrder, setSortOrder] = useState<'asc' | 'desc'>('desc');\r\n\r\n  // Debounce search para evitar consultas excessivas\r\n  const debouncedSearch = useDebounce(searchQuery, 300);\r\n\r\n  // Cache simples em memória\r\n  const [cache, setCache] = useState<Map<string, { data: any; timestamp: number }>>(new Map());\r\n\r\n  // Função para gerar chave de cache\r\n  const getCacheKey = useCallback((page: number, search: string, status: string, sort: string, order: string) => {\r\n    return `leads_${page}_${search}_${status}_${sort}_${order}`;\r\n  }, []);\r\n\r\n  // Função para verificar cache\r\n  const getCachedData = useCallback((key: string) => {\r\n    if (!enableCache) return null;\r\n    \r\n    const cached = cache.get(key);\r\n    if (cached && Date.now() - cached.timestamp < cacheDuration) {\r\n      return cached.data;\r\n    }\r\n    return null;\r\n  }, [cache, enableCache, cacheDuration]);\r\n\r\n  // Função para salvar no cache\r\n  const setCachedData = useCallback((key: string, data: any) => {\r\n    if (!enableCache) return;\r\n    \r\n    setCache(prev => {\r\n      const newCache = new Map(prev);\r\n      newCache.set(key, { data, timestamp: Date.now() });\r\n      \r\n      // Limitar tamanho do cache (máximo 50 entradas)\r\n      if (newCache.size > 50) {\r\n        const firstKey = newCache.keys().next().value;\r\n        newCache.delete(firstKey);\r\n      }\r\n      \r\n      return newCache;\r\n    });\r\n  }, [enableCache]);\r\n\r\n  // Buscar estatísticas otimizadas\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) return;\r\n\r\n      // Query otimizada para estatísticas - apenas status e user_id\r\n      const { data: allLeads, error: leadsError } = await supabase\r\n        .from('leads')\r\n        .select('status')\r\n        .eq('user_id', userData.user.id);\r\n\r\n      if (leadsError) throw leadsError;\r\n\r\n      const calculatedStats = (allLeads || []).reduce((acc, lead) => {\r\n        acc.total++;\r\n        if (lead.status === 'novo') acc.new++;\r\n        if (lead.status === 'qualificado') acc.qualified++;\r\n        if (lead.status === 'convertido') acc.converted++;\r\n        return acc;\r\n      }, { total: 0, new: 0, qualified: 0, converted: 0 });\r\n\r\n      setStats(calculatedStats);\r\n    } catch (error) {\r\n      console.error('Error fetching stats:', error);\r\n    }\r\n  }, []);\r\n\r\n  // Buscar leads com otimizações\r\n  const fetchLeads = useCallback(async (\r\n    page: number = 1,\r\n    search: string = '',\r\n    status: string = 'all',\r\n    sort: string = 'created_at',\r\n    order: string = 'desc',\r\n    useCache: boolean = true\r\n  ) => {\r\n    const cacheKey = getCacheKey(page, search, status, sort, order);\r\n    \r\n    // Verificar cache primeiro\r\n    if (useCache) {\r\n      const cachedData = getCachedData(cacheKey);\r\n      if (cachedData) {\r\n        setLeads(cachedData.leads);\r\n        setTotalCount(cachedData.totalCount);\r\n        setHasNextPage(cachedData.hasNextPage);\r\n        return cachedData;\r\n      }\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) throw new Error('Usuário não autenticado');\r\n\r\n      // Construir query otimizada - apenas campos essenciais\r\n      let query = supabase\r\n        .from('leads')\r\n        .select('id, name, status, phone, cpf, created_at', { count: 'exact' })\r\n        .eq('user_id', userData.user.id);\r\n\r\n      // Aplicar filtros\r\n      if (status !== 'all') {\r\n        query = query.eq('status', status);\r\n      }\r\n\r\n      // Busca textual\r\n      if (search.trim()) {\r\n        query = query.or(`name.ilike.%${search}%,cpf.ilike.%${search}%,phone.ilike.%${search}%`);\r\n      }\r\n\r\n      // Ordenação\r\n      query = query.order(sort as any, { ascending: order === 'asc' });\r\n\r\n      // Paginação\r\n      const from = (page - 1) * pageSize;\r\n      const to = from + pageSize - 1;\r\n      query = query.range(from, to);\r\n\r\n      const { data: leadsData, error: leadsError, count } = await query;\r\n\r\n      if (leadsError) throw leadsError;\r\n\r\n      const result = {\r\n        leads: (leadsData || []) as Lead[],\r\n        totalCount: count || 0,\r\n        hasNextPage: (count || 0) > page * pageSize\r\n      };\r\n\r\n      // Salvar no cache\r\n      setCachedData(cacheKey, result);\r\n\r\n      // Atualizar estado\r\n      setLeads(result.leads);\r\n      setTotalCount(result.totalCount);\r\n      setHasNextPage(result.hasNextPage);\r\n\r\n      return result;\r\n\r\n    } catch (error: any) {\r\n      setError(error.message);\r\n      console.error('Error fetching leads:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [pageSize, getCacheKey, getCachedData, setCachedData]);\r\n\r\n  // Buscar página seguinte\r\n  const fetchNextPage = useCallback(() => {\r\n    if (hasNextPage && !isLoading) {\r\n      const nextPage = currentPage + 1;\r\n      setCurrentPage(nextPage);\r\n      fetchLeads(nextPage, debouncedSearch, statusFilter, sortBy, sortOrder);\r\n    }\r\n  }, [hasNextPage, isLoading, currentPage, debouncedSearch, statusFilter, sortBy, sortOrder, fetchLeads]);\r\n\r\n  // Resetar para primeira página\r\n  const resetToFirstPage = useCallback(() => {\r\n    setCurrentPage(1);\r\n    fetchLeads(1, debouncedSearch, statusFilter, sortBy, sortOrder);\r\n  }, [debouncedSearch, statusFilter, sortBy, sortOrder, fetchLeads]);\r\n\r\n  // Invalidar cache\r\n  const invalidateCache = useCallback(() => {\r\n    setCache(new Map());\r\n  }, []);\r\n\r\n  // Buscar leads quando filtros mudam\r\n  useEffect(() => {\r\n    resetToFirstPage();\r\n  }, [debouncedSearch, statusFilter, sortBy, sortOrder, resetToFirstPage]);\r\n\r\n  // Buscar estatísticas na montagem\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [fetchStats]);\r\n\r\n  // Métricas calculadas\r\n  const metrics = useMemo(() => ({\r\n    conversionRate: stats.total > 0 ? ((stats.converted / stats.total) * 100).toFixed(1) : '0.0',\r\n    totalPages: Math.ceil(totalCount / pageSize),\r\n    currentPageInfo: {\r\n      from: (currentPage - 1) * pageSize + 1,\r\n      to: Math.min(currentPage * pageSize, totalCount),\r\n      total: totalCount\r\n    }\r\n  }), [stats, totalCount, pageSize, currentPage]);\r\n\r\n  return {\r\n    // Dados\r\n    leads,\r\n    stats,\r\n    metrics,\r\n    \r\n    // Estado\r\n    isLoading,\r\n    error,\r\n    hasNextPage,\r\n    currentPage,\r\n    totalCount,\r\n    \r\n    // Filtros\r\n    searchQuery,\r\n    statusFilter,\r\n    sortBy,\r\n    sortOrder,\r\n    \r\n    // Ações\r\n    setSearchQuery,\r\n    setStatusFilter,\r\n    setSortBy,\r\n    setSortOrder,\r\n    fetchNextPage,\r\n    resetToFirstPage,\r\n    invalidateCache,\r\n    refetch: () => fetchLeads(currentPage, debouncedSearch, statusFilter, sortBy, sortOrder, false),\r\n    refetchStats: fetchStats\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\usePerformanceOptimization.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'CACHE_DURATION'. Either include it or remove the dependency array.","line":32,"column":6,"nodeType":"ArrayExpression","endLine":32,"endColumn":13,"suggestions":[{"desc":"Update the dependencies array to be: [CACHE_DURATION, cache]","fix":{"range":[999,1006],"text":"[CACHE_DURATION, cache]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1628,1631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1628,1631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":151,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":151,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4296,4299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4296,4299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useCallback, useMemo } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\n\r\n// Hook para debounce de busca\r\nexport const useDebounce = (value: string, delay: number) => {\r\n  const [debouncedValue, setDebouncedValue] = useState(value);\r\n\r\n  useEffect(() => {\r\n    const handler = setTimeout(() => {\r\n      setDebouncedValue(value);\r\n    }, delay);\r\n\r\n    return () => {\r\n      clearTimeout(handler);\r\n    };\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n};\r\n\r\n// Hook para cache simples\r\nexport const useCache = <T>(key: string, initialData: T) => {\r\n  const [cache, setCache] = useState<Map<string, { data: T; timestamp: number }>>(new Map());\r\n  const CACHE_DURATION = 5 * 60 * 1000; // 5 minutos\r\n\r\n  const getCachedData = useCallback((cacheKey: string): T | null => {\r\n    const cached = cache.get(cacheKey);\r\n    if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {\r\n      return cached.data;\r\n    }\r\n    return null;\r\n  }, [cache]);\r\n\r\n  const setCachedData = useCallback((cacheKey: string, data: T) => {\r\n    setCache(prev => new Map(prev).set(cacheKey, { data, timestamp: Date.now() }));\r\n  }, []);\r\n\r\n  const clearCache = useCallback(() => {\r\n    setCache(new Map());\r\n  }, []);\r\n\r\n  return { getCachedData, setCachedData, clearCache };\r\n};\r\n\r\n// Hook para otimização de consultas\r\nexport const useOptimizedQuery = () => {\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { getCachedData, setCachedData } = useCache('query-cache', null);\r\n\r\n  const executeQuery = useCallback(async (\r\n    queryKey: string,\r\n    queryFn: () => Promise<any>,\r\n    useCache = true\r\n  ) => {\r\n    if (useCache) {\r\n      const cached = getCachedData(queryKey);\r\n      if (cached) {\r\n        return cached;\r\n      }\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await queryFn();\r\n      if (useCache) {\r\n        setCachedData(queryKey, result);\r\n      }\r\n      return result;\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [getCachedData, setCachedData]);\r\n\r\n  return { executeQuery, isLoading };\r\n};\r\n\r\n// Hook para paginação otimizada\r\nexport const usePagination = (itemsPerPage: number = 20) => {\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalItems, setTotalItems] = useState(0);\r\n  \r\n  const totalPages = useMemo(() => Math.ceil(totalItems / itemsPerPage), [totalItems, itemsPerPage]);\r\n  \r\n  const paginationInfo = useMemo(() => ({\r\n    from: (currentPage - 1) * itemsPerPage,\r\n    to: currentPage * itemsPerPage - 1,\r\n    currentPage,\r\n    totalPages,\r\n    totalItems,\r\n    itemsPerPage\r\n  }), [currentPage, totalPages, totalItems, itemsPerPage]);\r\n\r\n  const goToPage = useCallback((page: number) => {\r\n    if (page >= 1 && page <= totalPages) {\r\n      setCurrentPage(page);\r\n    }\r\n  }, [totalPages]);\r\n\r\n  const nextPage = useCallback(() => goToPage(currentPage + 1), [currentPage, goToPage]);\r\n  const prevPage = useCallback(() => goToPage(currentPage - 1), [currentPage, goToPage]);\r\n  const resetPage = useCallback(() => setCurrentPage(1), []);\r\n\r\n  return {\r\n    ...paginationInfo,\r\n    setTotalItems,\r\n    goToPage,\r\n    nextPage,\r\n    prevPage,\r\n    resetPage\r\n  };\r\n};\r\n\r\n// Hook para lazy loading de imagens\r\nexport const useLazyImage = (src: string) => {\r\n  const [imageSrc, setImageSrc] = useState<string | null>(null);\r\n  const [isLoaded, setIsLoaded] = useState(false);\r\n  const [error, setError] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const img = new Image();\r\n    img.onload = () => {\r\n      setImageSrc(src);\r\n      setIsLoaded(true);\r\n    };\r\n    img.onerror = () => {\r\n      setError(true);\r\n    };\r\n    img.src = src;\r\n  }, [src]);\r\n\r\n  return { imageSrc, isLoaded, error };\r\n};\r\n\r\n// Hook para otimização de performance geral\r\nexport const usePerformanceOptimization = () => {\r\n  const [performanceMetrics, setPerformanceMetrics] = useState({\r\n    renderTime: 0,\r\n    queryTime: 0,\r\n    lastUpdate: Date.now()\r\n  });\r\n\r\n  const measureRenderTime = useCallback((startTime: number) => {\r\n    const renderTime = performance.now() - startTime;\r\n    setPerformanceMetrics(prev => ({\r\n      ...prev,\r\n      renderTime,\r\n      lastUpdate: Date.now()\r\n    }));\r\n  }, []);\r\n\r\n  const measureQueryTime = useCallback(async (queryFn: () => Promise<any>) => {\r\n    const startTime = performance.now();\r\n    const result = await queryFn();\r\n    const queryTime = performance.now() - startTime;\r\n    \r\n    setPerformanceMetrics(prev => ({\r\n      ...prev,\r\n      queryTime,\r\n      lastUpdate: Date.now()\r\n    }));\r\n    \r\n    return result;\r\n  }, []);\r\n\r\n  // Otimização automática baseada em métricas\r\n  const shouldOptimize = useMemo(() => {\r\n    return performanceMetrics.renderTime > 100 || performanceMetrics.queryTime > 1000;\r\n  }, [performanceMetrics]);\r\n\r\n  return {\r\n    performanceMetrics,\r\n    measureRenderTime,\r\n    measureQueryTime,\r\n    shouldOptimize\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\hooks\\useSentryMonitoring.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[373,376],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[373,376],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[443,446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[443,446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":18,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[556,559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[556,559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1245,1248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1245,1248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1379,1382],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1379,1382],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1563,1566],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1563,1566],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5012,5015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5012,5015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useCallback } from 'react';\r\nimport { \r\n  setUserContext, \r\n  clearUserContext, \r\n  configureSentryForPage, \r\n  trackUserAction,\r\n  captureError,\r\n  captureMessage,\r\n  addBreadcrumb,\r\n  trackApiCall,\r\n  withSentryProfiling,\r\n  recordMetric\r\n} from '@/utils/sentry';\r\n\r\ninterface SentryHookReturn {\r\n  trackAction: (action: string, data?: Record<string, any>) => void;\r\n  trackError: (error: Error, context?: Record<string, any>) => void;\r\n  trackMessage: (message: string, level?: 'info' | 'warning' | 'error', context?: Record<string, any>) => void;\r\n  trackApiCall: <T>(url: string, method: string, apiCall: () => Promise<T>) => Promise<T>;\r\n  trackMetric: (name: string, value: number, unit?: string, tags?: Record<string, string>) => void;\r\n  setUser: (user: { id?: string; email?: string; username?: string; subscription?: string }) => void;\r\n  clearUser: () => void;\r\n  configurePage: (pageName: string, additionalTags?: Record<string, string>) => void;\r\n  withProfiling: <T>(operationName: string, operation: () => Promise<T>, tags?: Record<string, string>) => Promise<T>;\r\n}\r\n\r\nexport const useSentryMonitoring = (): SentryHookReturn => {\r\n  \r\n  const trackAction = useCallback((action: string, data?: Record<string, any>) => {\r\n    trackUserAction(action, data);\r\n  }, []);\r\n\r\n  const trackError = useCallback((error: Error, context?: Record<string, any>) => {\r\n    captureError(error, context);\r\n  }, []);\r\n\r\n  const trackMessage = useCallback((message: string, level: 'info' | 'warning' | 'error' = 'info', context?: Record<string, any>) => {\r\n    captureMessage(message, level, context);\r\n  }, []);\r\n\r\n  const trackApi = useCallback(<T>(url: string, method: string, apiCall: () => Promise<T>) => {\r\n    return trackApiCall(url, method, apiCall);\r\n  }, []);\r\n\r\n  const trackMetric = useCallback((name: string, value: number, unit: string = 'none', tags?: Record<string, string>) => {\r\n    recordMetric(name, value, unit, tags);\r\n  }, []);\r\n\r\n  const setUser = useCallback((user: { id?: string; email?: string; username?: string; subscription?: string }) => {\r\n    setUserContext(user);\r\n  }, []);\r\n\r\n  const clearUser = useCallback(() => {\r\n    clearUserContext();\r\n  }, []);\r\n\r\n  const configurePage = useCallback((pageName: string, additionalTags?: Record<string, string>) => {\r\n    configureSentryForPage(pageName, additionalTags);\r\n  }, []);\r\n\r\n  const withProfiling = useCallback(<T>(operationName: string, operation: () => Promise<T>, tags?: Record<string, string>) => {\r\n    return withSentryProfiling(operationName, operation, tags);\r\n  }, []);\r\n\r\n  return {\r\n    trackAction,\r\n    trackError,\r\n    trackMessage,\r\n    trackApiCall: trackApi,\r\n    trackMetric,\r\n    setUser,\r\n    clearUser,\r\n    configurePage,\r\n    withProfiling\r\n  };\r\n};\r\n\r\n// Hook específico para páginas\r\nexport const useSentryPageTracking = (pageName: string, additionalTags?: Record<string, string>) => {\r\n  const { configurePage } = useSentryMonitoring();\r\n\r\n  useEffect(() => {\r\n    configurePage(pageName, additionalTags);\r\n    \r\n    // Breadcrumb para tempo gasto na página\r\n    const startTime = Date.now();\r\n    \r\n    return () => {\r\n      const timeSpent = Date.now() - startTime;\r\n      addBreadcrumb(`Saiu da página: ${pageName}`, 'navigation', {\r\n        page: pageName,\r\n        timeSpent: `${timeSpent}ms`\r\n      });\r\n    };\r\n  }, [pageName, additionalTags, configurePage]);\r\n};\r\n\r\n// Hook para monitoramento de performance de operações\r\nexport const useSentryPerformanceTracking = () => {\r\n  const trackOperation = useCallback(async <T>(\r\n    operationName: string,\r\n    operation: () => Promise<T>,\r\n    tags?: Record<string, string>\r\n  ): Promise<T> => {\r\n    return withSentryProfiling(operationName, operation, tags);\r\n  }, []);\r\n\r\n  const trackSyncOperation = useCallback(<T>(\r\n    operationName: string,\r\n    operation: () => T,\r\n    tags?: Record<string, string>\r\n  ): T => {\r\n    const startTime = Date.now();\r\n    \r\n    try {\r\n      addBreadcrumb(`Iniciando operação sync: ${operationName}`, 'performance', tags);\r\n      const result = operation();\r\n      \r\n      const duration = Date.now() - startTime;\r\n      addBreadcrumb(`Operação sync concluída: ${operationName}`, 'performance', {\r\n        ...tags,\r\n        duration: `${duration}ms`,\r\n        status: 'success'\r\n      });\r\n      \r\n      return result;\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime;\r\n      addBreadcrumb(`Operação sync falhou: ${operationName}`, 'performance', {\r\n        ...tags,\r\n        duration: `${duration}ms`,\r\n        status: 'error'\r\n      });\r\n      \r\n      captureError(error as Error, { operation: operationName, ...tags });\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    trackOperation,\r\n    trackSyncOperation\r\n  };\r\n};\r\n\r\n// Hook para monitoramento de formulários\r\nexport const useSentryFormTracking = (formName: string) => {\r\n  const { trackAction, trackError } = useSentryMonitoring();\r\n\r\n  const trackFormSubmit = useCallback((formData?: Record<string, any>) => {\r\n    trackAction('form_submit', {\r\n      form: formName,\r\n      ...formData\r\n    });\r\n  }, [formName, trackAction]);\r\n\r\n  const trackFormError = useCallback((error: Error, fieldName?: string) => {\r\n    trackError(error, {\r\n      form: formName,\r\n      field: fieldName\r\n    });\r\n  }, [formName, trackError]);\r\n\r\n  const trackFieldInteraction = useCallback((fieldName: string, action: 'focus' | 'blur' | 'change') => {\r\n    addBreadcrumb(`Form field ${action}: ${fieldName}`, 'user_interaction', {\r\n      form: formName,\r\n      field: fieldName,\r\n      action\r\n    });\r\n  }, [formName]);\r\n\r\n  return {\r\n    trackFormSubmit,\r\n    trackFormError,\r\n    trackFieldInteraction\r\n  };\r\n};\r\n\r\n// Hook para rastreamento de APIs específicas\r\nexport const useSentryApiTracking = () => {\r\n  const { trackApiCall } = useSentryMonitoring();\r\n\r\n  const trackSupabaseCall = useCallback(<T>(operation: string, apiCall: () => Promise<T>) => {\r\n    return trackApiCall(`supabase/${operation}`, 'POST', apiCall);\r\n  }, [trackApiCall]);\r\n\r\n  const trackHttpCall = useCallback(<T>(url: string, method: string, apiCall: () => Promise<T>) => {\r\n    return trackApiCall(url, method, apiCall);\r\n  }, [trackApiCall]);\r\n\r\n  return {\r\n    trackSupabaseCall,\r\n    trackHttpCall\r\n  };\r\n};\r\n\r\n// Hook para monitoramento de autenticação\r\nexport const useSentryAuthTracking = () => {\r\n  const { setUser, clearUser, trackAction } = useSentryMonitoring();\r\n\r\n  const trackLogin = useCallback((user: { id?: string; email?: string; username?: string; subscription?: string }) => {\r\n    setUser(user);\r\n    trackAction('login', {\r\n      userId: user.id,\r\n      email: user.email,\r\n      subscription: user.subscription\r\n    });\r\n  }, [setUser, trackAction]);\r\n\r\n  const trackLogout = useCallback(() => {\r\n    trackAction('logout');\r\n    clearUser();\r\n  }, [trackAction, clearUser]);\r\n\r\n  const trackSubscriptionChange = useCallback((oldPlan: string, newPlan: string) => {\r\n    trackAction('subscription_change', {\r\n      oldPlan,\r\n      newPlan\r\n    });\r\n  }, [trackAction]);\r\n\r\n  return {\r\n    trackLogin,\r\n    trackLogout,\r\n    trackSubscriptionChange\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\integrations\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\integrations\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Commission.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1978,1981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1978,1981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3846,3849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3846,3849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4099,4102],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4099,4102],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":76,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":79,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4612,4615],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4612,4615],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchCommissions'. Either include it or remove the dependency array.","line":140,"column":6,"nodeType":"ArrayExpression","endLine":140,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchCommissions]","fix":{"range":[4898,4900],"text":"[fetchCommissions]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5459,5462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5459,5462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":202,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":202,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6690,6693],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6690,6693],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":236,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":236,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8185,8188],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8185,8188],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":311,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":311,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11204,11207],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11204,11207],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":335,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":335,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12159,12162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12159,12162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":359,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":359,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13111,13114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13111,13114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":362,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":362,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13244,13247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13244,13247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":381,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":381,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14133,14136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14133,14136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":386,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":386,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14291,14294],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14291,14294],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":456,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":456,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17332,17335],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17332,17335],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'commissionsByEmployee' is never reassigned. Use 'const' instead.","line":572,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":572,"endColumn":32,"fix":{"range":[21945,22043],"text":"const commissionsByEmployee = filterCommissionsByEmployee(allCommissionsData || [], reportEmployee);"}},{"ruleId":"prefer-const","severity":2,"message":"'commissionsData' is never reassigned. Use 'const' instead.","line":575,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":575,"endColumn":26,"fix":{"range":[22088,23211],"text":"const commissionsData = commissionsByEmployee.filter(commission => {\r\n        if (!commission.lead) return false;\r\n        \r\n        // Usar a data personalizada do lead, ou created_at como fallback\r\n        const leadDateStr = (commission.lead as any).date || commission.lead.created_at;\r\n        if (!leadDateStr) return false;\r\n        \r\n        // Converter para data local\r\n        let leadDate;\r\n        if ((commission.lead as any).date) {\r\n          const [year, month, day] = (commission.lead as any).date.split('-');\r\n          leadDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\r\n        } else {\r\n          leadDate = new Date(leadDateStr);\r\n        }\r\n        \r\n        const startDate = new Date(reportDateFrom);\r\n        const endDate = new Date(reportDateTo);\r\n        endDate.setHours(23, 59, 59, 999);\r\n        \r\n        const isInRange = leadDate >= startDate && leadDate <= endDate;\r\n        \r\n        if (isInRange) {\r\n          console.log(`📅 Incluindo: ${commission.lead.name} (${leadDate.toLocaleDateString('pt-BR')})`);\r\n        }\r\n        \r\n        return isInRange;\r\n      });"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":579,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":579,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22334,22337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22334,22337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":584,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":584,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22520,22523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22520,22523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":585,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":585,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22591,22594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22591,22594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":616,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":616,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23798,23801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23798,23801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[23927,23930],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[23927,23930],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":633,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":633,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24646,24649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24646,24649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":633,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":633,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[24663,24666],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[24663,24666],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":643,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":643,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25073,25076],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25073,25076],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":646,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":646,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25196,25199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25196,25199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":647,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":647,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25306,25309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25306,25309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":661,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":661,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25903,25906],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25903,25906],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":689,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":689,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26830,26833],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26830,26833],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":696,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":696,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27071,27074],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27071,27074],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":720,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":720,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28092,28095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28092,28095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":769,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":769,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29978,29981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29978,29981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":770,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":770,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30062,30065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30062,30065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":787,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":787,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30623,30626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30623,30626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":807,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":807,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31394,31397],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31394,31397],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":827,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":827,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32041,32044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32041,32044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":900,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":900,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34487,34490],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34487,34490],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":903,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":903,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34642,34645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34642,34645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":903,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":903,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34682,34685],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34682,34685],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":944,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":944,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36350,36353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36350,36353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1076,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1076,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[42400,42403],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[42400,42403],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'currentY' is never reassigned. Use 'const' instead.","line":1132,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":1132,"endColumn":19,"fix":{"range":[44532,44551],"text":"const currentY = 110;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1148,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1148,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45244,45247],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45244,45247],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1297,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1297,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[50701,50704],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[50701,50704],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1323,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1323,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51875,51878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51875,51878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1331,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1331,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52197,52200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52197,52200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1372,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1372,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54075,54078],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54075,54078],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1460,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1460,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[57504,57507],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[57504,57507],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1550,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1550,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61418,61421],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61418,61421],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1577,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1577,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62624,62627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62624,62627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1890,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1890,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[76798,76801],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[76798,76801],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1895,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1895,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[77130,77133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[77130,77133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2286,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2286,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[95050,95053],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[95050,95053],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2328,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2328,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[97164,97167],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[97164,97167],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2377,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2377,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99256,99259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99256,99259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2380,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2380,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99427,99430],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99427,99430],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2392,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2392,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99878,99881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99878,99881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2393,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2393,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[99964,99967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[99964,99967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":57,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":3,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCaption,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { CustomCalendar } from \"@/components/ui/custom-calendar\";\r\nimport { CalendarIcon, Search, Trash2, Settings, FileText, Download, Send, CheckCircle, User } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Lead,\r\n  type Commission as CommissionType\r\n} from \"@/types/models\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\nimport { mapProductToCommissionConfig } from \"@/utils/productMapping\";\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\n\r\n// Declarar tipo para autoTable\r\ndeclare module 'jspdf' {\r\n  interface jsPDF {\r\n    autoTable: (options: any) => jsPDF;\r\n    lastAutoTable: {\r\n      finalY: number;\r\n    };\r\n  }\r\n}\r\n\r\nconst Commission = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [leads, setLeads] = useState<Partial<Lead>[]>([]);\r\n  const [commissions, setCommissions] = useState<CommissionType[]>([]);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [employeeFilter, setEmployeeFilter] = useState<string>(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"\");\r\n  const [productFilter, setProductFilter] = useState<string>(\"\");\r\n  const [dateFrom, setDateFrom] = useState<Date>();\r\n  const [dateTo, setDateTo] = useState<Date>();\r\n  const [currentMonth, setCurrentMonth] = useState(new Date());\r\n  const [employees, setEmployees] = useState<string[]>([]);\r\n  const [employeeMap, setEmployeeMap] = useState<Record<string, string>>({}); // Mapa ID -> Nome\r\n  const [totalCommissionsPending, setTotalCommissionsPending] = useState(0);\r\n  const [totalCommissionsApproved, setTotalCommissionsApproved] = useState(0);\r\n  const [totalCommissionsPaid, setTotalCommissionsPaid] = useState(0);\r\n  const [deletingCommission, setDeletingCommission] = useState<string | null>(null);\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [commissionToDelete, setCommissionToDelete] = useState<string | null>(null);\r\n\r\n  const { isPrivilegedUser } = useAuth();\r\n\r\n  // Lista de produtos únicos para filtro\r\n  const [products, setProducts] = useState<string[]>([]);\r\n\r\n  // Estados para relatório de pagamento\r\n  const [showPaymentReport, setShowPaymentReport] = useState(false);\r\n  const [reportEmployee, setReportEmployee] = useState<string>(\"all\");\r\n  const [reportDateFrom, setReportDateFrom] = useState<string>(\"\");\r\n  const [reportDateTo, setReportDateTo] = useState<string>(\"\");\r\n  const [paymentReport, setPaymentReport] = useState<any>(null);\r\n  const [generatingReport, setGeneratingReport] = useState(false);\r\n\r\n  // Estados para personalização do PDF\r\n  const [showPdfCustomization, setShowPdfCustomization] = useState(false);\r\n  const [pdfReportData, setPdfReportData] = useState<any>(null);\r\n  const [pdfColumns, setPdfColumns] = useState({\r\n    numero: true,\r\n    cliente: true,\r\n    data: true,\r\n    produto: true,\r\n    valorVenda: true,\r\n    percentagem: true,\r\n    valorComissao: true,\r\n    status: true,\r\n    cpf: false,\r\n    telefone: false,\r\n    banco: false,\r\n    observacoes: false\r\n  });\r\n\r\n  // Estados para configuração do WhatsApp\r\n  const [showWhatsAppConfig, setShowWhatsAppConfig] = useState(false);\r\n  const [currentReportForWhatsApp, setCurrentReportForWhatsApp] = useState<any>(null);\r\n  const [whatsAppConfig, setWhatsAppConfig] = useState({\r\n    includeCommissionValues: true,\r\n    includePercentages: true,\r\n    includeIndividualCommissions: true,\r\n    includeTotal: true\r\n  });\r\n\r\n  useEffect(() => {\r\n    fetchCommissions();\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // Removido toast de boas-vindas que pode estar interferindo\r\n  }, [isPrivilegedUser]);\r\n\r\n  const fetchEmployees = async () => {\r\n    try {\r\n      const employeeList = await getEmployees();\r\n      setEmployees(employeeList.map(employee => employee.name));\r\n      \r\n      // Criar mapa de ID -> Nome para exibir nomes ao invés de UUIDs\r\n      const map: Record<string, string> = {};\r\n      employeeList.forEach(employee => {\r\n        map[employee.id] = employee.name;\r\n      });\r\n      setEmployeeMap(map);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching employees:\", error);\r\n    }\r\n  };\r\n\r\n  const fetchCommissions = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n      \r\n      let query = supabase\r\n        .from(\"commissions\")\r\n        .select(`\r\n          *,\r\n          lead:lead_id (\r\n            id, name, product, amount, status, employee, date, created_at\r\n          )\r\n        `)\r\n        .eq(\"user_id\", userData.user.id);\r\n\r\n      if (statusFilter && statusFilter !== \"all\") {\r\n        query = query.eq(\"status\", statusFilter);\r\n      }\r\n\r\n      if (productFilter && productFilter !== \"all\") {\r\n        query = query.eq(\"product\", productFilter);\r\n      }\r\n\r\n      query = query.order(\"created_at\", { ascending: false });\r\n      \r\n      const { data, error } = await query;\r\n      \r\n      if (error) {\r\n        throw error;\r\n      }\r\n      \r\n      if (data) {\r\n        console.log(\"🔍 DEBUG: Dados brutos das comissões do banco:\", data);\r\n        \r\n        let processedCommissions = data.map((item, index) => {\r\n          const commission = item as any;\r\n          \r\n          console.log(`🔍 DEBUG Comissão ${index + 1}:`, {\r\n            id: commission.id,\r\n            employee_commission: commission.employee,\r\n            lead_data: commission.lead,\r\n            lead_employee: commission.lead?.employee,\r\n            final_employee: commission.employee || commission.lead?.employee || 'Não informado'\r\n          });\r\n          \r\n          const amount = typeof commission.amount === 'number' ? commission.amount : 0;\r\n          \r\n          let commissionValue = 0;\r\n          let percentageValue = 0;\r\n          \r\n          // Se existir commission_value na base, usar ele\r\n          if (commission.commission_value !== undefined && commission.commission_value !== null) {\r\n            commissionValue = Number(commission.commission_value) || 0;\r\n          } else {\r\n            // Calcular comissão padrão (5% se não tiver configuração específica)\r\n            commissionValue = amount * 0.05; // 5% padrão\r\n          }\r\n          \r\n          // Se existir percentage na base, usar ele\r\n          if (commission.percentage !== undefined && commission.percentage !== null) {\r\n            percentageValue = Number(commission.percentage) || 0;\r\n          } else {\r\n            percentageValue = 5; // 5% padrão\r\n          }\r\n          \r\n          let leadData = commission.lead;\r\n          if (leadData && typeof leadData.status === 'string') {\r\n            leadData = {\r\n              ...leadData,\r\n              status: leadData.status as any\r\n            };\r\n          }\r\n          \r\n          return {\r\n            ...commission,\r\n            commission_value: commissionValue,\r\n            percentage: percentageValue,\r\n            lead: leadData,\r\n            employee: commission.employee || leadData?.employee || 'Não informado'\r\n          } as CommissionType;\r\n        });\r\n\r\n        // Filtrar por data do lead (não da comissão)\r\n        if (dateFrom || dateTo) {\r\n          processedCommissions = processedCommissions.filter(commission => {\r\n            if (!commission.lead) return false;\r\n            \r\n            // Usar a data personalizada do lead, ou created_at como fallback\r\n            const leadDateStr = commission.lead.date || commission.lead.created_at;\r\n            if (!leadDateStr) return false;\r\n            \r\n            // Converter para data local sem problemas de timezone\r\n            let leadDate;\r\n            if (commission.lead.date) {\r\n              // Se é uma data personalizada (formato YYYY-MM-DD), fazer parse manual\r\n              const [year, month, day] = commission.lead.date.split('-');\r\n              leadDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\r\n            } else {\r\n              // Se é created_at, usar Date normal\r\n              leadDate = new Date(leadDateStr);\r\n            }\r\n            \r\n            if (dateFrom && leadDate < dateFrom) {\r\n              return false;\r\n            }\r\n            \r\n            if (dateTo) {\r\n              const endDate = new Date(dateTo);\r\n              endDate.setHours(23, 59, 59, 999);\r\n              if (leadDate > endDate) {\r\n                return false;\r\n              }\r\n            }\r\n            \r\n            return true;\r\n          });\r\n        }\r\n        \r\n        setCommissions(processedCommissions);\r\n        \r\n        // Extrair produtos únicos para filtro\r\n        const uniqueProducts = [...new Set(processedCommissions.map(c => c.product).filter(Boolean))];\r\n        setProducts(uniqueProducts);\r\n        \r\n        const inProgressTotal = processedCommissions\r\n          .filter(c => c.status === \"in_progress\")\r\n          .reduce((acc, curr) => acc + (Number(curr.commission_value) || 0), 0);\r\n\r\n        const pendingTotal = processedCommissions\r\n          .filter(c => c.status === \"pending\")\r\n          .reduce((acc, curr) => acc + (Number(curr.commission_value) || 0), 0);\r\n          \r\n        const completedTotal = processedCommissions\r\n          .filter(c => c.status === \"completed\" || c.status === \"approved\" || c.status === \"paid\")\r\n          .reduce((acc, curr) => acc + (Number(curr.commission_value) || 0), 0);\r\n          \r\n        const cancelledTotal = processedCommissions\r\n          .filter(c => c.status === \"cancelled\")\r\n          .reduce((acc, curr) => acc + (Number(curr.commission_value) || 0), 0);\r\n        \r\n        setTotalCommissionsPending(pendingTotal);\r\n        setTotalCommissionsApproved(completedTotal);\r\n        setTotalCommissionsPaid(inProgressTotal);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching commissions:\", error);\r\n      toast.error(`Erro ao carregar comissões: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Função para calcular valor da comissão com base nas configurações\r\n  const calculateCommissionValue = async (leadProduct: string, amount: number, paymentPeriod?: number): Promise<number> => {\r\n    try {\r\n      // Mapear produto do lead para produto da configuração\r\n      const mappedProduct = mapProductToCommissionConfig(leadProduct);\r\n      \r\n      console.log(`Calculando comissão: ${leadProduct} → ${mappedProduct}, valor: R$ ${amount}, prazo: ${paymentPeriod}x`);\r\n\r\n      // Buscar taxa fixa primeiro\r\n      const { data: rates } = await supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .eq('product', mappedProduct)\r\n        .eq('active', true);\r\n\r\n      if (rates && rates.length > 0) {\r\n        const rate = rates[0] as any;\r\n        console.log(`Taxa fixa encontrada:`, rate);\r\n        \r\n        if (rate.commission_type === 'fixed') {\r\n          const commission = rate.fixed_value || 0;\r\n          console.log(`Comissão fixa: R$ ${commission}`);\r\n          return commission;\r\n        } else {\r\n          const commission = (amount * rate.percentage) / 100;\r\n          console.log(`Comissão percentual: ${rate.percentage}% = R$ ${commission}`);\r\n          return commission;\r\n        }\r\n      }\r\n\r\n      // Se não encontrou taxa fixa, buscar por faixas de valor ou período\r\n      const { data: tiers } = await supabase\r\n        .from('commission_tiers')\r\n        .select('*')\r\n        .eq('product', mappedProduct)\r\n        .eq('active', true);\r\n\r\n      if (tiers && tiers.length > 0) {\r\n        // Buscar primeiro por faixas de período se o prazo estiver disponível\r\n        if (paymentPeriod && paymentPeriod > 0) {\r\n          const periodTiers = tiers.filter((tier: any) => tier.tier_type === 'period');\r\n          \r\n          for (const tier of periodTiers) {\r\n            const tierData = tier as any;\r\n            if (tierData.min_period <= paymentPeriod && \r\n                (tierData.max_period === null || paymentPeriod <= tierData.max_period)) {\r\n              console.log(`Faixa de período encontrada:`, tierData);\r\n              \r\n              if (tierData.commission_type === 'fixed') {\r\n                const commission = tierData.fixed_value || 0;\r\n                console.log(`Comissão fixa por prazo: R$ ${commission}`);\r\n                return commission;\r\n              } else {\r\n                const commission = (amount * tierData.percentage) / 100;\r\n                console.log(`Comissão percentual por prazo: ${tierData.percentage}% = R$ ${commission}`);\r\n                return commission;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // Se não encontrou por período, buscar por faixas de valor\r\n        const valueTiers = tiers.filter((tier: any) => \r\n          !tier.tier_type || tier.tier_type === 'value'\r\n        );\r\n\r\n        for (const tier of valueTiers) {\r\n          const tierData = tier as any;\r\n          if (tierData.min_amount <= amount && \r\n              (tierData.max_amount === null || amount <= tierData.max_amount)) {\r\n            console.log(`Faixa de valor encontrada:`, tierData);\r\n            \r\n            if (tierData.commission_type === 'fixed') {\r\n              const commission = tierData.fixed_value || 0;\r\n              console.log(`Comissão fixa por faixa: R$ ${commission}`);\r\n              return commission;\r\n            } else {\r\n              const commission = (amount * tierData.percentage) / 100;\r\n              console.log(`Comissão percentual por faixa: ${tierData.percentage}% = R$ ${commission}`);\r\n              return commission;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // Comissões padrão específicas por produto quando não há configuração\r\n      let defaultPercentage = 5; // Taxa padrão geral\r\n      \r\n      if (mappedProduct === 'CREDITO FGTS' || leadProduct.includes('SAQUE') || leadProduct.includes('FGTS')) {\r\n        defaultPercentage = 15; // 15% para FGTS\r\n        console.log(`Taxa padrão para FGTS aplicada: ${defaultPercentage}%`);\r\n      } else if (mappedProduct === 'CREDITO CLT' || leadProduct.includes('EMPRESTIMO') || leadProduct.includes('CLT')) {\r\n        defaultPercentage = 2; // 2% para CLT\r\n        console.log(`Taxa padrão para CLT aplicada: ${defaultPercentage}%`);\r\n      } else if (mappedProduct === 'CREDITO PIX/CARTAO' || leadProduct.includes('CARTAO') || leadProduct.includes('PIX')) {\r\n        defaultPercentage = 1.5; // 1.5% para PIX/CARTAO\r\n        console.log(`Taxa padrão para PIX/CARTAO aplicada: ${defaultPercentage}%`);\r\n      } else if (mappedProduct === 'CREDITO INSS' || leadProduct.includes('INSS') || leadProduct.includes('NOVO')) {\r\n        defaultPercentage = 3; // 3% para INSS\r\n        console.log(`Taxa padrão para INSS aplicada: ${defaultPercentage}%`);\r\n      }\r\n\r\n      const defaultCommission = (amount * defaultPercentage) / 100;\r\n      console.log(`Taxa padrão aplicada: ${defaultPercentage}% = R$ ${defaultCommission}`);\r\n      return defaultCommission;\r\n    } catch (error) {\r\n      console.error(\"Error calculating commission:\", error);\r\n      const defaultCommission = (amount * 5) / 100;\r\n      console.log(`Erro - usando taxa padrão: 5% = R$ ${defaultCommission}`);\r\n      return defaultCommission;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  const handleDeleteCommission = async (commissionId: string) => {\r\n    // Abrir dialog de confirmação com senha administrativa\r\n    setCommissionToDelete(commissionId);\r\n    setShowAdminPasswordDialog(true);\r\n  };\r\n\r\n  const confirmDeleteCommission = async () => {\r\n    if (!commissionToDelete) return;\r\n\r\n    try {\r\n      setDeletingCommission(commissionToDelete);\r\n      \r\n      const { error } = await supabase\r\n        .from(\"commissions\")\r\n        .delete()\r\n        .eq(\"id\", commissionToDelete);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"Comissão removida com sucesso!\");\r\n      fetchCommissions(); // Recarregar dados\r\n      setCommissionToDelete(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error deleting commission:\", error);\r\n      toast.error(`Erro ao excluir comissão: ${error.message}`);\r\n      setCommissionToDelete(null);\r\n    } finally {\r\n      setDeletingCommission(null);\r\n    }\r\n  };\r\n\r\n  const handleSearch = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setSearch(e.target.value);\r\n  };\r\n\r\n  const handleSearchClick = () => {\r\n    fetchCommissions();\r\n  };\r\n\r\n  const clearFilters = () => {\r\n    setDateFrom(undefined);\r\n    setDateTo(undefined);\r\n    setEmployeeFilter(\"\");\r\n    setStatusFilter(\"\");\r\n    setProductFilter(\"\");\r\n    setSearch(\"\");\r\n    // Recarregar dados após limpar filtros\r\n    setTimeout(() => fetchCommissions(), 100);\r\n  };\r\n\r\n  const filteredCommissions = commissions.filter((commission) => {\r\n    const searchTerm = search.toLowerCase();\r\n    const matchesSearch = \r\n      commission.lead?.name?.toLowerCase().includes(searchTerm) ||\r\n      commission.product?.toLowerCase().includes(searchTerm) ||\r\n      commission.status?.toLowerCase().includes(searchTerm) ||\r\n      commission.payment_period?.toLowerCase().includes(searchTerm) ||\r\n      commission.employee?.toLowerCase().includes(searchTerm) ||\r\n      commission.lead?.employee?.toLowerCase().includes(searchTerm) ||\r\n      String(commission.amount).toLowerCase().includes(searchTerm) ||\r\n      String(commission.commission_value).toLowerCase().includes(searchTerm);\r\n    \r\n    // Filtro por funcionário/responsável\r\n    const matchesEmployee = employeeFilter === \"\" || employeeFilter === \"all\" || \r\n      (commission.employee && (commission.employee === employeeFilter || employeeMap[commission.employee] === employeeFilter)) || \r\n      (commission.lead?.employee && (commission.lead.employee === employeeFilter || employeeMap[commission.lead.employee] === employeeFilter));\r\n    \r\n    return matchesSearch && matchesEmployee;\r\n  });\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case \"in_progress\":\r\n        return <Badge variant=\"outline\" className=\"bg-blue-100 text-blue-800 border-blue-300\">Em Andamento</Badge>;\r\n      case \"pending\":\r\n        return <Badge variant=\"outline\" className=\"bg-yellow-100 text-yellow-800 border-yellow-300\">Pendente</Badge>;\r\n      case \"completed\":\r\n        return <Badge variant=\"outline\" className=\"bg-green-100 text-green-800 border-green-300\">Concluído</Badge>;\r\n      case \"cancelled\":\r\n        return <Badge variant=\"outline\" className=\"bg-red-100 text-red-800 border-red-300\">Cancelado</Badge>;\r\n      // Manter compatibilidade com status antigos\r\n      case \"approved\":\r\n        return <Badge variant=\"outline\" className=\"bg-green-100 text-green-800 border-green-300\">Aprovado</Badge>;\r\n      case \"paid\":\r\n        return <Badge variant=\"outline\" className=\"bg-purple-100 text-purple-800 border-purple-300\">Pago</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n\r\n\r\n  // Função para gerar relatório de pagamento\r\n  const generatePaymentReport = async () => {\r\n    if (!reportDateFrom || !reportDateTo) {\r\n      toast.error(\"Selecione o período para o relatório\");\r\n      return;\r\n    }\r\n\r\n    setGeneratingReport(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      console.log(`🔍 Gerando relatório de pagamento`);\r\n      console.log(`📅 Período: ${reportDateFrom} até ${reportDateTo}`);\r\n      console.log(`👤 Funcionário: ${reportEmployee}`);\r\n\r\n      // Buscar todas as comissões do usuário\r\n      const { data: allCommissionsData, error } = await supabase\r\n        .from('commissions')\r\n        .select(`\r\n          *,\r\n          lead:lead_id (*)\r\n        `)\r\n        .eq('user_id', userData.user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      console.log(`📊 Total de comissões encontradas: ${allCommissionsData?.length || 0}`);\r\n      \r\n      // Debug: verificar dados da primeira comissão\r\n      if (allCommissionsData && allCommissionsData.length > 0) {\r\n        console.log('🔍 DEBUG: Primeira comissão completa:', allCommissionsData[0]);\r\n        console.log('🔍 DEBUG: Lead da primeira comissão:', allCommissionsData[0].lead);\r\n        \r\n        if (allCommissionsData[0].lead) {\r\n          console.log('🔍 DEBUG: Campos disponíveis no lead:');\r\n          Object.keys(allCommissionsData[0].lead).forEach(key => {\r\n            console.log(`   ${key}: ${allCommissionsData[0].lead[key]}`);\r\n          });\r\n        }\r\n      }\r\n\r\n      // Filtrar por funcionário usando a função melhorada\r\n      let commissionsByEmployee = filterCommissionsByEmployee(allCommissionsData || [], reportEmployee);\r\n\r\n      // Filtrar por data do lead\r\n      let commissionsData = commissionsByEmployee.filter(commission => {\r\n        if (!commission.lead) return false;\r\n        \r\n        // Usar a data personalizada do lead, ou created_at como fallback\r\n        const leadDateStr = (commission.lead as any).date || commission.lead.created_at;\r\n        if (!leadDateStr) return false;\r\n        \r\n        // Converter para data local\r\n        let leadDate;\r\n        if ((commission.lead as any).date) {\r\n          const [year, month, day] = (commission.lead as any).date.split('-');\r\n          leadDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\r\n        } else {\r\n          leadDate = new Date(leadDateStr);\r\n        }\r\n        \r\n        const startDate = new Date(reportDateFrom);\r\n        const endDate = new Date(reportDateTo);\r\n        endDate.setHours(23, 59, 59, 999);\r\n        \r\n        const isInRange = leadDate >= startDate && leadDate <= endDate;\r\n        \r\n        if (isInRange) {\r\n          console.log(`📅 Incluindo: ${commission.lead.name} (${leadDate.toLocaleDateString('pt-BR')})`);\r\n        }\r\n        \r\n        return isInRange;\r\n      });\r\n\r\n      console.log(`🎯 Comissões após todos os filtros: ${commissionsData.length}`);\r\n\r\n      if (commissionsData.length === 0) {\r\n        console.log(`⚠️ Nenhuma comissão encontrada para os filtros aplicados`);\r\n        toast.info('Nenhuma comissão encontrada para o período e funcionário selecionados');\r\n        setPaymentReport(null);\r\n        return;\r\n      }\r\n\r\n      if (reportEmployee && reportEmployee !== \"all\") {\r\n        // Relatório individual\r\n        const employeeCommissions = commissionsData;\r\n        const totalAmount = employeeCommissions.reduce((sum: number, c: any) => sum + (parseFloat(c.amount) || 0), 0);\r\n        const totalCommissionValue = employeeCommissions.reduce((sum: number, c: any) => sum + (parseFloat(c.commission_value) || 0), 0);\r\n\r\n        console.log(`📋 Relatório individual para ${reportEmployee}:`);\r\n        console.log(`   - Total de vendas: ${employeeCommissions.length}`);\r\n        console.log(`   - Valor total: R$ ${totalAmount.toFixed(2)}`);\r\n        console.log(`   - Comissões: R$ ${totalCommissionValue.toFixed(2)}`);\r\n\r\n        setPaymentReport({\r\n          employee: reportEmployee,\r\n          commissions: employeeCommissions,\r\n          totalAmount,\r\n          totalCommissionValue,\r\n          totalLeads: employeeCommissions.length\r\n        });\r\n      } else {\r\n        // Relatório de todos os funcionários\r\n        const employeeGroups = commissionsData.reduce((groups: any, commission: any) => {\r\n          const empId = commission.employee || commission.lead?.employee;\r\n          const emp = empId ? (employeeMap[empId] || empId) : 'Não informado';\r\n          if (!groups[emp]) {\r\n            groups[emp] = [];\r\n          }\r\n          groups[emp].push(commission);\r\n          return groups;\r\n        }, {});\r\n\r\n        const reports = Object.entries(employeeGroups).map(([emp, comms]: [string, any]) => ({\r\n          employee: emp,\r\n          commissions: comms,\r\n          totalAmount: comms.reduce((sum: number, c: any) => sum + (parseFloat(c.amount) || 0), 0),\r\n          totalCommissionValue: comms.reduce((sum: number, c: any) => sum + (parseFloat(c.commission_value) || 0), 0),\r\n          totalLeads: comms.length\r\n        }));\r\n\r\n        console.log(`📋 Relatório de todos os funcionários:`);\r\n        reports.forEach(report => {\r\n          console.log(`   - ${report.employee}: ${report.totalLeads} vendas, R$ ${report.totalCommissionValue.toFixed(2)}`);\r\n        });\r\n\r\n        setPaymentReport(reports);\r\n      }\r\n\r\n      const totalFound = commissionsData.length;\r\n      toast.success(`Relatório gerado! ${totalFound} ${totalFound === 1 ? 'comissão encontrada' : 'comissões encontradas'}.`);\r\n    } catch (error: any) {\r\n      console.error('Error generating payment report:', error);\r\n      toast.error(`Erro ao gerar relatório: ${error.message}`);\r\n    } finally {\r\n      setGeneratingReport(false);\r\n    }\r\n  };\r\n\r\n  // Função para alterar status de uma comissão\r\n  const changeCommissionStatus = async (commissionId: string, newStatus: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commissions')\r\n        .update({ \r\n          status: newStatus,\r\n          ...(newStatus === 'paid' ? { payment_date: new Date().toISOString() } : {})\r\n        })\r\n        .eq('id', commissionId);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Status alterado para: ${newStatus}`);\r\n      fetchCommissions(); // Recarregar dados da tabela principal\r\n      \r\n      // Se estiver com relatório aberto, recarregar também\r\n      if (paymentReport) {\r\n        generatePaymentReport();\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error changing commission status:', error);\r\n      toast.error(`Erro ao alterar status: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  // Função para gerar mensagem do WhatsApp\r\n  const generateWhatsAppMessage = (report: any, config = whatsAppConfig): string => {\r\n    const periodText = `${format(new Date(reportDateFrom), 'dd/MM/yyyy')} a ${format(new Date(reportDateTo), 'dd/MM/yyyy')}`;\r\n    \r\n    let message = `*RELATÓRIO DE VENDAS*\\n\\n`;\r\n    \r\n    // Informações do funcionário\r\n    message += `*Funcionário:* ${report.employee}\\n`;\r\n    message += `*Período:* ${periodText}\\n\\n`;\r\n    \r\n    // Resumo executivo\r\n    message += `*RESUMO EXECUTIVO*\\n`;\r\n    message += `Total de Vendas: *${report.totalLeads}*\\n`;\r\n    message += `Valor Total Vendido: *R$ ${report.totalAmount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}*\\n`;\r\n    \r\n    if (config.includeTotal) {\r\n      message += `Total de Comissões: *R$ ${report.totalCommissionValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}*\\n`;\r\n    }\r\n    \r\n    message += `\\n`;\r\n    \r\n    // Detalhamento das vendas\r\n    if (config.includeIndividualCommissions) {\r\n      message += `*DETALHAMENTO DAS VENDAS*\\n\\n`;\r\n      \r\n      report.commissions.forEach((commission: any, index: number) => {\r\n        const leadDate = commission.lead?.date || commission.lead?.created_at;\r\n        const dateFormatted = leadDate ? format(new Date(leadDate), 'dd/MM/yyyy') : 'N/A';\r\n        \r\n        message += `*${index + 1}. ${commission.lead?.name || 'Cliente'}*\\n`;\r\n        message += `Data: ${dateFormatted}\\n`;\r\n        message += `Produto: ${commission.product}\\n`;\r\n        message += `Valor da Venda: R$ ${(commission.amount || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\\n`;\r\n        \r\n        if (config.includeCommissionValues || config.includePercentages) {\r\n          let commissionLine = 'Comissão: ';\r\n          if (config.includePercentages) {\r\n            commissionLine += `${(commission.percentage || 0).toFixed(1)}%`;\r\n          }\r\n          if (config.includeCommissionValues) {\r\n            if (config.includePercentages) {\r\n              commissionLine += ` = `;\r\n            }\r\n            commissionLine += `*R$ ${(commission.commission_value || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}*`;\r\n          }\r\n          message += `${commissionLine}\\n`;\r\n        }\r\n        \r\n        // Status sem emoji\r\n        let statusText = '';\r\n        switch (commission.status) {\r\n          case 'paid':\r\n            statusText = 'PAGO';\r\n            break;\r\n          case 'approved':\r\n            statusText = 'APROVADO';\r\n            break;\r\n          case 'completed':\r\n            statusText = 'CONCLUÍDO';\r\n            break;\r\n          case 'pending':\r\n            statusText = 'PENDENTE';\r\n            break;\r\n          case 'in_progress':\r\n            statusText = 'EM ANDAMENTO';\r\n            break;\r\n          default:\r\n            statusText = 'CANCELADO';\r\n        }\r\n        message += `Status: *${statusText}*\\n\\n`;\r\n      });\r\n    }\r\n    \r\n    // Status geral\r\n    const allPaid = report.commissions.every((c: any) => c.status === 'paid');\r\n    const someApproved = report.commissions.some((c: any) => c.status === 'approved' || c.status === 'completed');\r\n    \r\n    if (allPaid) {\r\n      message += `*STATUS GERAL: TOTALMENTE PAGO*\\n`;\r\n    } else if (someApproved) {\r\n      message += `*STATUS GERAL: PARCIALMENTE PROCESSADO*\\n`;\r\n    } else {\r\n      message += `*STATUS GERAL: PENDENTE DE PAGAMENTO*\\n`;\r\n    }\r\n    \r\n    message += `\\n*LeadConsig CRM*\\n`;\r\n    message += `Gerado em: ${format(new Date(), 'dd/MM/yyyy HH:mm')}`;\r\n    \r\n    return message;\r\n  };\r\n\r\n  // Função para abrir configuração do WhatsApp\r\n  const openWhatsAppConfig = (report: any) => {\r\n    setCurrentReportForWhatsApp(report);\r\n    setShowWhatsAppConfig(true);\r\n  };\r\n\r\n  // Função para enviar relatório via WhatsApp com configurações personalizadas\r\n  const sendWhatsAppReportWithConfig = () => {\r\n    if (!currentReportForWhatsApp) return;\r\n    \r\n    const message = generateWhatsAppMessage(currentReportForWhatsApp, whatsAppConfig);\r\n    const encodedMessage = encodeURIComponent(message);\r\n    const url = `https://wa.me/?text=${encodedMessage}`;\r\n    \r\n    window.open(url, '_blank');\r\n    toast.success(`Relatório preparado para envio via WhatsApp!`);\r\n    setShowWhatsAppConfig(false);\r\n    setCurrentReportForWhatsApp(null);\r\n  };\r\n\r\n  // Função para enviar relatório via WhatsApp (compatibilidade)\r\n  const sendWhatsAppReport = (report: any) => {\r\n    openWhatsAppConfig(report);\r\n  };\r\n\r\n  // Função para marcar comissões como pagas\r\n  const markCommissionsAsPaid = async (employeeName: string, commissionIds: string[]) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commissions')\r\n        .update({ \r\n          status: 'paid',\r\n          payment_date: new Date().toISOString()\r\n        })\r\n        .in('id', commissionIds);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(`Comissões de ${employeeName} marcadas como pagas!`);\r\n      fetchCommissions(); // Recarregar dados\r\n      generatePaymentReport(); // Atualizar relatório\r\n    } catch (error: any) {\r\n      console.error('Error marking commissions as paid:', error);\r\n      toast.error(`Erro ao marcar como pago: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const generateCommissionsForLeads = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        toast.error(\"Usuário não autenticado\");\r\n        return;\r\n      }\r\n\r\n      // Buscar todos os leads do usuário\r\n      const { data: leadsData, error: leadsError } = await supabase\r\n        .from(\"leads\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userData.user.id)\r\n        .in(\"status\", [\"convertido\"]); // Leads convertidos (vendidos)\r\n\r\n      if (leadsError) {\r\n        throw leadsError;\r\n      }\r\n\r\n      if (!leadsData || leadsData.length === 0) {\r\n        toast.info(\"Nenhum lead vendido encontrado para gerar comissões.\");\r\n        return;\r\n      }\r\n\r\n      // Buscar comissões existentes\r\n      const { data: existingCommissions, error: commissionsError } = await supabase\r\n        .from(\"commissions\")\r\n        .select(\"lead_id\")\r\n        .eq(\"user_id\", userData.user.id);\r\n\r\n      if (commissionsError) {\r\n        throw commissionsError;\r\n      }\r\n\r\n      const existingLeadIds = new Set(existingCommissions?.map(c => c.lead_id) || []);\r\n\r\n      // Filtrar leads que não possuem comissões\r\n      const leadsWithoutCommissions = leadsData.filter(lead => !existingLeadIds.has(lead.id));\r\n\r\n      if (leadsWithoutCommissions.length === 0) {\r\n        toast.info(\"Todos os leads vendidos já possuem comissões.\");\r\n        return;\r\n      }\r\n\r\n      // Buscar comissões padrão\r\n      const { data: commissionRates, error: ratesError } = await supabase\r\n        .from(\"commission_rates\")\r\n        .select(\"*\")\r\n        .eq(\"active\", true);\r\n\r\n      if (ratesError) {\r\n        throw ratesError;\r\n      }\r\n\r\n      // Criar comissões para os leads\r\n      const commissionsToCreate = [];\r\n\r\n      for (const lead of leadsWithoutCommissions) {\r\n        // Converter valor corretamente removendo caracteres não numéricos\r\n        const cleanAmount = String(lead.amount).replace(/[^\\d,]/g, '').replace(',', '.');\r\n        const leadAmount = parseFloat(cleanAmount) || 0;\r\n        \r\n        console.log(`🔍 Gerando comissão para: ${lead.name}`);\r\n        console.log(`   Produto: ${lead.product}`);\r\n        console.log(`   Valor: R$ ${leadAmount}`);\r\n        console.log(`   Prazo: ${(lead as any).payment_period || 'Não informado'}`);\r\n\r\n        // Buscar configuração de comissão específica para o produto\r\n        const paymentPeriod = (lead as any).payment_period ? parseInt((lead as any).payment_period.toString()) : undefined;\r\n        const calculatedValue = await calculateCommissionValue(lead.product, leadAmount, paymentPeriod);\r\n        \r\n        // Calcular percentual correto baseado no valor calculado\r\n        const calculatedPercentage = leadAmount > 0 ? (calculatedValue / leadAmount) * 100 : 0;\r\n        \r\n        console.log(`   Comissão calculada: R$ ${calculatedValue.toFixed(2)} (${calculatedPercentage.toFixed(2)}%)`);\r\n\r\n        commissionsToCreate.push({\r\n          user_id: userData.user.id,\r\n          lead_id: lead.id,\r\n          amount: leadAmount,\r\n          commission_value: calculatedValue,\r\n          percentage: calculatedPercentage, // Agora usa o percentual calculado correto\r\n          product: lead.product,\r\n          status: 'in_progress',\r\n          payment_period: 'monthly',\r\n          employee: lead.employee || 'Não informado'\r\n        });\r\n      }\r\n\r\n      console.log(`📊 Total de comissões a criar: ${commissionsToCreate.length}`);\r\n      commissionsToCreate.forEach((commission, i) => {\r\n        console.log(`   ${i + 1}. ${commission.product} - R$ ${commission.commission_value.toFixed(2)} (${commission.percentage.toFixed(2)}%)`);\r\n      });\r\n\r\n      if (commissionsToCreate.length > 0) {\r\n        const { data: createdCommissions, error: createError } = await supabase\r\n          .from(\"commissions\")\r\n          .insert(commissionsToCreate);\r\n\r\n        if (createError) {\r\n          throw createError;\r\n        }\r\n\r\n        toast.success(`${commissionsToCreate.length} comissões geradas com sucesso!`);\r\n        \r\n        // Recarregar dados\r\n        fetchCommissions();\r\n      }\r\n\r\n    } catch (error: any) {\r\n      console.error(\"Error generating commissions:\", error);\r\n      toast.error(`Erro ao gerar comissões: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const renderCommissionTable = () => {\r\n    if (loading) {\r\n      return <div className=\"text-center py-8\">Carregando comissões...</div>;\r\n    }\r\n\r\n    if (commissions.length === 0) {\r\n      return <div className=\"text-center py-8\">Nenhuma comissão encontrada.</div>;\r\n    }\r\n\r\n    return (\r\n      <Table>\r\n        <TableCaption>Suas comissões e informações detalhadas.</TableCaption>\r\n        <TableHeader>\r\n          <TableRow>\r\n            <TableHead>Lead</TableHead>\r\n            <TableHead>Data do Lead</TableHead>\r\n            <TableHead>Produto</TableHead>\r\n            <TableHead>Valor da Venda</TableHead>\r\n            <TableHead>% Comissão</TableHead>\r\n            <TableHead>Valor Comissão</TableHead>\r\n            <TableHead>Período</TableHead>\r\n            <TableHead>Status</TableHead>\r\n            <TableHead>Funcionário</TableHead>\r\n            <TableHead className=\"text-right\">Ações</TableHead>\r\n          </TableRow>\r\n        </TableHeader>\r\n        <TableBody>\r\n          {filteredCommissions.length === 0 ? (\r\n            <TableRow>\r\n              <TableCell colSpan={10} className=\"text-center py-8\">\r\n                Nenhuma comissão encontrada com os filtros aplicados.\r\n              </TableCell>\r\n            </TableRow>\r\n          ) : (\r\n            filteredCommissions.map((commission) => {\r\n              // Formatear a data do lead\r\n              const leadDateStr = commission.lead?.date || commission.lead?.created_at;\r\n              const leadDateFormatted = leadDateStr ? \r\n                new Date(leadDateStr).toLocaleDateString('pt-BR') : '-';\r\n              \r\n              return (\r\n                <TableRow key={commission.id}>\r\n                  <TableCell>{commission.lead?.name || 'Sem lead'}</TableCell>\r\n                  <TableCell>{leadDateFormatted}</TableCell>\r\n                  <TableCell>\r\n                    <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700\">\r\n                      {commission.product}\r\n                    </Badge>\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <span className=\"font-semibold text-slate-700\">\r\n                      R$ {commission.amount?.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                    </span>\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <span className=\"text-blue-700 font-semibold bg-blue-50 px-2 py-1 rounded\">\r\n                      {commission.percentage?.toFixed(1)}%\r\n                    </span>\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <span className=\"font-bold text-green-700 bg-green-50 px-2 py-1 rounded\">\r\n                      R$ {commission.commission_value?.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                    </span>\r\n                  </TableCell>\r\n                  <TableCell>\r\n                    <Badge variant=\"outline\">\r\n                      {commission.payment_period === 'monthly' ? 'Mensal' : commission.payment_period}\r\n                    </Badge>\r\n                  </TableCell>\r\n                  <TableCell>{getStatusBadge(commission.status!)}</TableCell>\r\n                  <TableCell>\r\n                    {(() => {\r\n                      const employeeId = commission.employee || commission.lead?.employee;\r\n                      if (!employeeId) return \"-\";\r\n                      // Se for UUID, buscar nome no mapa; se já for nome, usar direto\r\n                      return employeeMap[employeeId] || employeeId;\r\n                    })()}\r\n                  </TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    <AlertDialog>\r\n                      <AlertDialogTrigger asChild>\r\n                        <Button \r\n                          variant=\"outline\" \r\n                          size=\"sm\"\r\n                          className=\"text-red-500 hover:text-red-600 hover:bg-red-50\"\r\n                          disabled={deletingCommission === commission.id}\r\n                        >\r\n                          <Trash2 className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </AlertDialogTrigger>\r\n                      <AlertDialogContent>\r\n                        <AlertDialogHeader>\r\n                          <AlertDialogTitle>Confirmar Remoção</AlertDialogTitle>\r\n                          <AlertDialogDescription>\r\n                            Tem certeza que deseja remover esta comissão? Esta ação não pode ser desfeita.\r\n                            <br />\r\n                            <strong className=\"text-slate-700\">Produto:</strong> <span className=\"text-blue-700 font-semibold\">{commission.product}</span>\r\n                            <br />\r\n                            <strong className=\"text-slate-700\">Valor:</strong> <span className=\"text-green-700 font-bold\">R$ {commission.commission_value?.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>\r\n                          </AlertDialogDescription>\r\n                        </AlertDialogHeader>\r\n                        <AlertDialogFooter>\r\n                          <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                          <AlertDialogAction\r\n                            onClick={() => handleDeleteCommission(commission.id)}\r\n                            className=\"bg-red-500 hover:bg-red-600\"\r\n                          >\r\n                            Sim, Remover\r\n                          </AlertDialogAction>\r\n                        </AlertDialogFooter>\r\n                      </AlertDialogContent>\r\n                    </AlertDialog>\r\n                  </TableCell>\r\n                </TableRow>\r\n              );\r\n            })\r\n          )}\r\n        </TableBody>\r\n\r\n      </Table>\r\n    );\r\n  };\r\n\r\n  // Função para gerar PDF das comissões\r\n  const generatePDFReport = (report: any) => {\r\n    try {\r\n      console.log('📄 Iniciando geração de PDF...');\r\n      console.log('Dados do relatório:', report);\r\n      console.log('Comissões encontradas:', report.commissions?.length || 0);\r\n\r\n      const doc = new jsPDF();\r\n      const pageWidth = doc.internal.pageSize.width;\r\n      \r\n      // Configurar fonte para suportar caracteres especiais\r\n      doc.setFont('helvetica');\r\n      \r\n      // Título principal\r\n      doc.setFontSize(20);\r\n      doc.setTextColor(40, 116, 240); // Azul\r\n      const title = 'RELATORIO DE COMISSOES';\r\n      doc.text(title, pageWidth / 2, 20, { align: 'center' });\r\n      \r\n      // Linha divisória\r\n      doc.setDrawColor(40, 116, 240);\r\n      doc.setLineWidth(1);\r\n      doc.line(20, 25, pageWidth - 20, 25);\r\n      \r\n      // Informações do funcionário\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.text(`Funcionario: ${report.employee || 'N/A'}`, 20, 40);\r\n      \r\n      // Verificar se as datas existem\r\n      let periodText = 'Periodo nao informado';\r\n      try {\r\n        if (reportDateFrom && reportDateTo) {\r\n          periodText = `Periodo: ${format(new Date(reportDateFrom), 'dd/MM/yyyy')} a ${format(new Date(reportDateTo), 'dd/MM/yyyy')}`;\r\n        }\r\n      } catch (dateError) {\r\n        console.warn('Erro ao formatar datas:', dateError);\r\n      }\r\n      \r\n      doc.text(periodText, 20, 50);\r\n      \r\n      // Resumo geral\r\n      doc.setFontSize(12);\r\n      doc.setFillColor(240, 248, 255); // Azul claro\r\n      doc.rect(20, 60, pageWidth - 40, 35, 'F');\r\n      doc.setTextColor(0, 0, 0);\r\n      \r\n      const resumoY = 75;\r\n      const totalLeads = report.totalLeads || 0;\r\n      const totalAmount = report.totalAmount || 0;\r\n      const totalCommissionValue = report.totalCommissionValue || 0;\r\n      \r\n      doc.text(`Total de Vendas: ${totalLeads}`, 30, resumoY);\r\n      doc.text(`Valor Total Vendido: R$ ${totalAmount.toFixed(2).replace('.', ',')}`, 30, resumoY + 10);\r\n      doc.text(`Total de Comissoes: R$ ${totalCommissionValue.toFixed(2).replace('.', ',')}`, 30, resumoY + 20);\r\n      \r\n      // Detalhamento das vendas\r\n      let currentY = 110;\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(40, 116, 240);\r\n      doc.text('DETALHAMENTO DAS VENDAS', 20, currentY);\r\n      \r\n      // Verificar se há comissões\r\n      if (!report.commissions || !Array.isArray(report.commissions) || report.commissions.length === 0) {\r\n        doc.setFontSize(12);\r\n        doc.setTextColor(0, 0, 0);\r\n        doc.text('Nenhuma comissao encontrada para este periodo.', 20, currentY + 20);\r\n      } else {\r\n        console.log('📋 Processando comissões para a tabela...');\r\n        \r\n        // Preparar dados para a tabela com verificação detalhada\r\n        const tableData: string[][] = [];\r\n        \r\n        report.commissions.forEach((commission: any, index: number) => {\r\n          try {\r\n            console.log(`Processando comissão ${index + 1}:`, commission);\r\n            \r\n            // Data do lead\r\n            const leadDate = commission.lead?.date || commission.lead?.created_at;\r\n            let dateFormatted = 'N/A';\r\n            if (leadDate) {\r\n              try {\r\n                dateFormatted = format(new Date(leadDate), 'dd/MM/yyyy');\r\n              } catch (e) {\r\n                dateFormatted = leadDate.toString().substring(0, 10) || 'N/A';\r\n              }\r\n            }\r\n            \r\n            // Dados básicos\r\n            const clientName = commission.lead?.name || `Cliente ${index + 1}`;\r\n            const product = commission.product || 'N/A';\r\n            const amount = parseFloat(commission.amount?.toString() || '0') || 0;\r\n            const percentage = parseFloat(commission.percentage?.toString() || '0') || 0;\r\n            const commissionValue = parseFloat(commission.commission_value?.toString() || '0') || 0;\r\n            \r\n            // Status\r\n            let status = 'Em Andamento';\r\n            switch (commission.status) {\r\n              case 'paid': status = 'Pago'; break;\r\n              case 'approved': status = 'Aprovado'; break;\r\n              case 'completed': status = 'Concluido'; break;\r\n              case 'pending': status = 'Pendente'; break;\r\n              case 'cancelled': status = 'Cancelado'; break;\r\n            }\r\n            \r\n            console.log(`Cliente: ${clientName}, Produto: ${product}, Valor: ${amount}`);\r\n            \r\n            // Adicionar linha à tabela\r\n            tableData.push([\r\n              (index + 1).toString(),\r\n              clientName.substring(0, 20),\r\n              dateFormatted,\r\n              product.substring(0, 15),\r\n              `R$ ${amount.toFixed(2).replace('.', ',')}`,\r\n              `${percentage.toFixed(1)}%`,\r\n              `R$ ${commissionValue.toFixed(2).replace('.', ',')}`,\r\n              status\r\n            ]);\r\n            \r\n          } catch (itemError) {\r\n            console.error(`Erro ao processar comissão ${index + 1}:`, itemError);\r\n            tableData.push([\r\n              (index + 1).toString(),\r\n              'Erro nos dados',\r\n              'N/A',\r\n              'N/A',\r\n              'R$ 0,00',\r\n              '0%',\r\n              'R$ 0,00',\r\n              'Erro'\r\n            ]);\r\n          }\r\n        });\r\n\r\n        console.log('📊 Dados da tabela preparados:', tableData);\r\n\r\n        // Adicionar tabela usando autoTable\r\n        try {\r\n          console.log('📊 Dados da tabela preparados:', tableData);\r\n          \r\n          doc.autoTable({\r\n            startY: currentY + 10,\r\n            head: [['#', 'Cliente', 'Data', 'Produto', 'Valor Venda', '% Com.', 'Valor Com.', 'Status']],\r\n            body: tableData,\r\n            theme: 'striped',\r\n            styles: {\r\n              fontSize: 8,\r\n              cellPadding: 2,\r\n            },\r\n            headStyles: {\r\n              fillColor: [40, 116, 240],\r\n              textColor: 255,\r\n              fontStyle: 'bold',\r\n              fontSize: 9,\r\n            },\r\n            columnStyles: {\r\n              0: { halign: 'center', cellWidth: 8 },\r\n              1: { cellWidth: 30 },\r\n              2: { halign: 'center', cellWidth: 18 },\r\n              3: { cellWidth: 25 },\r\n              4: { halign: 'right', cellWidth: 22 },\r\n              5: { halign: 'center', cellWidth: 12 },\r\n              6: { halign: 'right', cellWidth: 22 },\r\n              7: { halign: 'center', cellWidth: 18 }\r\n            },\r\n            margin: { left: 20, right: 20 }\r\n          });\r\n          \r\n          console.log('✅ Tabela criada com sucesso');\r\n          \r\n        } catch (tableError) {\r\n          console.error('❌ Erro ao criar tabela:', tableError);\r\n          \r\n          // Fallback: criar tabela manualmente\r\n          doc.setFontSize(10);\r\n          doc.setTextColor(0, 0, 0);\r\n          let y = currentY + 20;\r\n          \r\n          // Cabeçalho manual\r\n          doc.setFontSize(9);\r\n          doc.setFont('helvetica', 'bold');\r\n          doc.text('#', 25, y);\r\n          doc.text('Cliente', 35, y);\r\n          doc.text('Data', 70, y);\r\n          doc.text('Produto', 90, y);\r\n          doc.text('Valor Venda', 120, y);\r\n          doc.text('%', 150, y);\r\n          doc.text('Comissão', 160, y);\r\n          doc.text('Status', 180, y);\r\n          \r\n          y += 10;\r\n          doc.setFont('helvetica', 'normal');\r\n          \r\n          // Linhas de dados\r\n          tableData.forEach((row, index) => {\r\n            if (y > 250) { // Nova página se necessário\r\n              doc.addPage();\r\n              y = 30;\r\n            }\r\n            \r\n            doc.text(row[0], 25, y);\r\n            doc.text(row[1], 35, y);\r\n            doc.text(row[2], 70, y);\r\n            doc.text(row[3], 90, y);\r\n            doc.text(row[4], 120, y);\r\n            doc.text(row[5], 150, y);\r\n            doc.text(row[6], 160, y);\r\n            doc.text(row[7], 180, y);\r\n            \r\n            y += 8;\r\n          });\r\n          \r\n          console.log('✅ Tabela manual criada como fallback');\r\n        }\r\n      }\r\n\r\n      // Rodapé com informações adicionais\r\n      const finalY = Math.max(doc.lastAutoTable?.finalY || currentY + 50, currentY + 100);\r\n      \r\n      // Status geral\r\n      doc.setFontSize(12);\r\n      doc.setTextColor(0, 100, 0); // Verde\r\n      const allPaid = report.commissions?.every((c: any) => c.status === 'paid') || false;\r\n      const statusText = allPaid ? 'STATUS: TOTALMENTE PAGO' : 'STATUS: PENDENTE DE PAGAMENTO';\r\n      doc.text(statusText, pageWidth / 2, finalY + 10, { align: 'center' });\r\n      \r\n      // Assinatura/Sistema\r\n      doc.setFontSize(10);\r\n      doc.setTextColor(128, 128, 128);\r\n      doc.text('Gerado pelo LeadConsig CRM', pageWidth / 2, finalY + 25, { align: 'center' });\r\n      \r\n      try {\r\n        const currentDate = format(new Date(), 'dd/MM/yyyy HH:mm');\r\n        doc.text(`Data de geracao: ${currentDate}`, pageWidth / 2, finalY + 35, { align: 'center' });\r\n      } catch (dateError) {\r\n        doc.text('Data de geracao: N/A', pageWidth / 2, finalY + 35, { align: 'center' });\r\n      }\r\n\r\n      // Salvar o PDF\r\n      const employeeName = (report.employee || 'funcionario').replace(/[^a-zA-Z0-9]/g, '_');\r\n      const timestamp = format(new Date(), 'yyyyMMdd_HHmm');\r\n      const fileName = `comissoes_${employeeName}_${timestamp}.pdf`;\r\n      \r\n      console.log('💾 Salvando PDF:', fileName);\r\n      doc.save(fileName);\r\n      \r\n      toast.success(`✅ PDF gerado com sucesso: ${fileName}`);\r\n      \r\n    } catch (error: any) {\r\n      console.error('❌ Erro completo ao gerar PDF:', error);\r\n      console.error('Stack trace:', error.stack);\r\n      toast.error(`Erro ao gerar PDF: ${error.message || 'Erro desconhecido'}`);\r\n    }\r\n  };\r\n\r\n  // Função melhorada para filtrar por funcionário\r\n  const filterCommissionsByEmployee = (commissions: any[], employeeName: string) => {\r\n    if (!employeeName || employeeName === \"all\") return commissions;\r\n    \r\n    console.log(`🔍 Filtrando comissões para: \"${employeeName}\"`);\r\n    console.log(`📊 Total de comissões antes do filtro: ${commissions.length}`);\r\n    \r\n    const filtered = commissions.filter(commission => {\r\n      // Verificar tanto commission.employee quanto lead.employee\r\n      const commissionEmployeeId = commission.employee || '';\r\n      const leadEmployeeId = commission.lead?.employee || '';\r\n      \r\n      // Buscar nomes no mapa\r\n      const commissionEmployeeName = employeeMap[commissionEmployeeId] || commissionEmployeeId;\r\n      const leadEmployeeName = employeeMap[leadEmployeeId] || leadEmployeeId;\r\n      \r\n      // Múltiplas verificações para maior precisão (por ID e por nome)\r\n      const matches = [\r\n        commissionEmployeeId === employeeName,\r\n        leadEmployeeId === employeeName,\r\n        commissionEmployeeName === employeeName,\r\n        leadEmployeeName === employeeName,\r\n        commissionEmployeeName.toLowerCase() === employeeName.toLowerCase(),\r\n        leadEmployeeName.toLowerCase() === employeeName.toLowerCase(),\r\n        commissionEmployeeName.includes(employeeName),\r\n        leadEmployeeName.includes(employeeName),\r\n        employeeName.includes(commissionEmployeeName) && commissionEmployeeName.length > 2,\r\n        employeeName.includes(leadEmployeeName) && leadEmployeeName.length > 2\r\n      ].some(Boolean);\r\n      \r\n      if (matches) {\r\n        console.log(`✅ Incluindo: ${commission.lead?.name} (emp: \"${commissionEmployeeName}\", lead: \"${leadEmployeeName}\")`);\r\n      }\r\n      \r\n      return matches;\r\n    });\r\n    \r\n    console.log(`🎯 Comissões após filtro: ${filtered.length}`);\r\n    return filtered;\r\n  };\r\n\r\n  // Função para abrir modal de personalização do PDF\r\n  const openPdfCustomization = (report: any) => {\r\n    setPdfReportData(report);\r\n    setShowPdfCustomization(true);\r\n  };\r\n\r\n  // Função para gerar PDF personalizado (versão simplificada)\r\n  const generateCustomizedPDFReport = () => {\r\n    try {\r\n      const report = pdfReportData;\r\n      console.log('📄 ======================');\r\n      console.log('📄 GERANDO PDF PERSONALIZADO');\r\n      console.log('📄 ======================');\r\n      console.log('Colunas selecionadas:', pdfColumns);\r\n      console.log('Total de comissões:', report.commissions?.length || 0);\r\n\r\n      const doc = new jsPDF();\r\n      const pageWidth = doc.internal.pageSize.width;\r\n      \r\n      // Configurar fonte para suportar caracteres especiais\r\n      doc.setFont('helvetica');\r\n      \r\n      // Título principal\r\n      doc.setFontSize(20);\r\n      doc.setTextColor(40, 116, 240); // Azul\r\n      const title = 'RELATORIO DE COMISSOES';\r\n      doc.text(title, pageWidth / 2, 20, { align: 'center' });\r\n      \r\n      // Linha divisória\r\n      doc.setDrawColor(40, 116, 240);\r\n      doc.setLineWidth(1);\r\n      doc.line(20, 25, pageWidth - 20, 25);\r\n      \r\n      // Informações do funcionário\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.text(`Funcionario: ${reportEmployee || 'Todos'}`, 20, 40);\r\n      \r\n      // Período\r\n      let periodText = 'Periodo nao informado';\r\n      try {\r\n        if (reportDateFrom && reportDateTo) {\r\n          periodText = `Periodo: ${format(new Date(reportDateFrom), 'dd/MM/yyyy')} a ${format(new Date(reportDateTo), 'dd/MM/yyyy')}`;\r\n        }\r\n      } catch (dateError) {\r\n        console.warn('Erro ao formatar datas:', dateError);\r\n      }\r\n      \r\n      doc.text(periodText, 20, 50);\r\n      \r\n      // Resumo geral\r\n      doc.setFontSize(12);\r\n      doc.setFillColor(240, 248, 255); // Azul claro\r\n      doc.rect(20, 60, pageWidth - 40, 35, 'F');\r\n      doc.setTextColor(0, 0, 0);\r\n      \r\n      const resumoY = 75;\r\n      const totalLeads = report.totalLeads || 0;\r\n      const totalAmount = report.totalAmount || 0;\r\n      const totalCommissionValue = report.totalCommissionValue || 0;\r\n      \r\n      doc.text(`Total de Vendas: ${totalLeads}`, 30, resumoY);\r\n      doc.text(`Valor Total Vendido: R$ ${totalAmount.toFixed(2).replace('.', ',')}`, 30, resumoY + 10);\r\n      doc.text(`Total de Comissoes: R$ ${totalCommissionValue.toFixed(2).replace('.', ',')}`, 30, resumoY + 20);\r\n      \r\n      // Detalhamento das vendas (versão simplificada sem autoTable)\r\n      let currentY = 110;\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(40, 116, 240);\r\n      doc.text('DETALHAMENTO DAS VENDAS', 20, currentY);\r\n      \r\n      // Verificar se há comissões\r\n      if (!report.commissions || !Array.isArray(report.commissions) || report.commissions.length === 0) {\r\n        doc.setFontSize(12);\r\n        doc.setTextColor(0, 0, 0);\r\n        doc.text('Nenhuma comissao encontrada para este periodo.', 20, currentY + 20);\r\n      } else {\r\n        console.log('📋 Gerando lista de comissões...');\r\n        \r\n        // Cabeçalho manual simples\r\n        currentY += 20;\r\n        doc.setFontSize(10);\r\n        doc.setTextColor(0, 0, 0);\r\n        doc.text('# | Cliente | Data | Produto | Valor | Comissao | CPF | Telefone', 20, currentY);\r\n        doc.line(20, currentY + 2, pageWidth - 20, currentY + 2);\r\n        \r\n        currentY += 10;\r\n        \r\n        // Processar cada comissão\r\n        report.commissions.forEach((commission: any, index: number) => {\r\n          try {\r\n            // Verificar se precisa de nova página\r\n            if (currentY > 250) {\r\n              doc.addPage();\r\n              currentY = 30;\r\n              // Repetir cabeçalho\r\n              doc.setFontSize(10);\r\n              doc.setTextColor(0, 0, 0);\r\n              doc.text('# | Cliente | Data | Produto | Valor | Comissao | CPF | Telefone', 20, currentY);\r\n              doc.line(20, currentY + 2, pageWidth - 20, currentY + 2);\r\n              currentY += 10;\r\n            }\r\n            \r\n            // Dados básicos\r\n            const clientName = commission.lead?.name || `Cliente ${index + 1}`;\r\n            const product = commission.product || 'N/A';\r\n            const amount = parseFloat(commission.amount?.toString() || '0') || 0;\r\n            const commissionValue = parseFloat(commission.commission_value?.toString() || '0') || 0;\r\n            \r\n            // Data do lead\r\n            const leadDate = commission.lead?.date || commission.lead?.created_at;\r\n            let dateFormatted = 'N/A';\r\n            if (leadDate) {\r\n              try {\r\n                dateFormatted = format(new Date(leadDate), 'dd/MM/yyyy');\r\n              } catch (e) {\r\n                dateFormatted = leadDate.toString().substring(0, 10) || 'N/A';\r\n              }\r\n            }\r\n            \r\n            // CPF e telefone\r\n            let cpf = 'N/A';\r\n            let telefone = 'N/A';\r\n            \r\n            if (commission.lead) {\r\n              cpf = commission.lead.cpf || commission.lead.document || commission.lead.doc || 'N/A';\r\n              telefone = commission.lead.phone || commission.lead.telefone || commission.lead.contact || 'N/A';\r\n              \r\n              // Log apenas para primeira comissão\r\n              if (index === 0) {\r\n                console.log('🔍 DEBUG CPF/TELEFONE:');\r\n                console.log('   lead.cpf:', commission.lead.cpf);\r\n                console.log('   lead.phone:', commission.lead.phone);\r\n                console.log('   CPF final:', cpf);\r\n                console.log('   Telefone final:', telefone);\r\n              }\r\n            }\r\n            \r\n            // Montar linha de texto baseada nas colunas selecionadas\r\n            let linha = '';\r\n            \r\n            if (pdfColumns.numero) linha += `${index + 1} | `;\r\n            if (pdfColumns.cliente) linha += `${clientName.substring(0, 15)} | `;\r\n            if (pdfColumns.data) linha += `${dateFormatted} | `;\r\n            if (pdfColumns.produto) linha += `${product.substring(0, 10)} | `;\r\n            if (pdfColumns.valorVenda) linha += `R$ ${amount.toFixed(2)} | `;\r\n            if (pdfColumns.valorComissao) linha += `R$ ${commissionValue.toFixed(2)} | `;\r\n            if (pdfColumns.cpf) {\r\n              linha += `${cpf.substring(0, 12)} | `;\r\n              console.log(`📋 CPF incluído na linha ${index + 1}: '${cpf}'`);\r\n            }\r\n            if (pdfColumns.telefone) {\r\n              linha += `${telefone.substring(0, 12)} | `;\r\n              console.log(`📞 Telefone incluído na linha ${index + 1}: '${telefone}'`);\r\n            }\r\n            \r\n            // Remover último separador\r\n            linha = linha.replace(/ \\| $/, '');\r\n            \r\n            doc.setFontSize(8);\r\n            doc.text(linha, 20, currentY);\r\n            currentY += 8;\r\n            \r\n            console.log(`📋 Linha ${index + 1} adicionada: ${linha}`);\r\n            \r\n          } catch (itemError) {\r\n            console.error(`❌ Erro ao processar comissão ${index + 1}:`, itemError);\r\n            doc.text(`Erro na linha ${index + 1}`, 20, currentY);\r\n            currentY += 8;\r\n          }\r\n        });\r\n      }\r\n\r\n      // Rodapé\r\n      const finalY = Math.max(currentY + 20, 200);\r\n      \r\n      // Status geral\r\n      doc.setFontSize(12);\r\n      doc.setTextColor(0, 100, 0);\r\n      const allPaid = report.commissions?.every((c: any) => c.status === 'paid') || false;\r\n      const statusText = allPaid ? 'STATUS: TOTALMENTE PAGO' : 'STATUS: PENDENTE DE PAGAMENTO';\r\n      doc.text(statusText, pageWidth / 2, finalY + 10, { align: 'center' });\r\n      \r\n      // Assinatura\r\n      doc.setFontSize(10);\r\n      doc.setTextColor(128, 128, 128);\r\n      doc.text('Gerado pelo LeadConsig CRM', pageWidth / 2, finalY + 25, { align: 'center' });\r\n      \r\n      try {\r\n        const currentDate = format(new Date(), 'dd/MM/yyyy HH:mm');\r\n        doc.text(`Data de geracao: ${currentDate}`, pageWidth / 2, finalY + 35, { align: 'center' });\r\n      } catch (dateError) {\r\n        doc.text('Data de geracao: N/A', pageWidth / 2, finalY + 35, { align: 'center' });\r\n      }\r\n\r\n      // Salvar o PDF\r\n      const employeeName = (reportEmployee || 'funcionario').replace(/[^a-zA-Z0-9]/g, '_');\r\n      const timestamp = format(new Date(), 'yyyyMMdd_HHmm');\r\n      const fileName = `comissoes_${employeeName}_${timestamp}.pdf`;\r\n      \r\n      console.log('💾 Salvando PDF:', fileName);\r\n      doc.save(fileName);\r\n      \r\n      toast.success(`✅ PDF personalizado gerado: ${fileName}`);\r\n      setShowPdfCustomization(false);\r\n      \r\n    } catch (error: any) {\r\n      console.error('❌ ERRO COMPLETO:', error);\r\n      toast.error(`Erro ao gerar PDF: ${error.message || 'Erro desconhecido'}`);\r\n    }\r\n  };\r\n\r\n\r\n\r\n\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"\"\r\n      subtitle=\"\"\r\n    >\r\n      {/* Header moderno customizado */}\r\n      <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n        <div className=\"p-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z\"/>\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold\">Gestão de Comissões</h1>\r\n                <p className=\"text-blue-100 text-lg mt-1\">Acompanhe e gerencie as comissões da sua equipe</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"hidden md:flex items-center space-x-4\">\r\n              <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                <div className=\"text-sm text-blue-100\">Total de Comissões</div>\r\n                <div className=\"text-2xl font-bold\">\r\n                  R$ {(totalCommissionsPending + totalCommissionsApproved + totalCommissionsPaid).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n\r\n      <div className=\"space-y-8\">\r\n        {/* Painel de controles com design moderno */}\r\n        <div className=\"bg-white rounded-xl shadow-lg border border-gray-100 p-6 mb-8\">\r\n          <h2 className=\"text-xl font-semibold text-gray-800 mb-4 flex items-center\">\r\n            <svg className=\"w-5 h-5 mr-2 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4\" />\r\n            </svg>\r\n            Filtros e Controles\r\n          </h2>\r\n          \r\n          <div className=\"space-y-4\">\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-6\">\r\n            <div className=\"relative\">\r\n              <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-blue-500\" />\r\n              <Input\r\n                type=\"text\"\r\n                placeholder=\"Buscar comissões...\"\r\n                value={search}\r\n                onChange={handleSearch}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <Select value={employeeFilter} onValueChange={setEmployeeFilter}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Funcionário\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos</SelectItem>\r\n                  {employees.map(employee => (\r\n                    <SelectItem key={employee} value={employee}>\r\n                      {employee}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div>\r\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Status\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos</SelectItem>\r\n                  <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\r\n                  <SelectItem value=\"pending\">Pendente</SelectItem>\r\n                  <SelectItem value=\"completed\">Concluído</SelectItem>\r\n                  <SelectItem value=\"approved\">Aprovado</SelectItem>\r\n                  <SelectItem value=\"paid\">Pago</SelectItem>\r\n                  <SelectItem value=\"cancelled\">Cancelado</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div>\r\n              <Select value={productFilter} onValueChange={setProductFilter}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Produto\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Todos</SelectItem>\r\n                  {products.map(product => (\r\n                    <SelectItem key={product} value={product}>\r\n                      {product}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div>\r\n              <Button onClick={handleSearchClick} variant=\"default\" className=\"w-full\">\r\n                <Search className=\"h-4 w-4 mr-2\" />\r\n                Buscar\r\n              </Button>\r\n            </div>\r\n            <div>\r\n              <Button onClick={clearFilters} variant=\"outline\" className=\"w-full\">\r\n                Limpar\r\n              </Button>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Botões de ação */}\r\n          <div className=\"flex flex-wrap gap-2\">\r\n            <Button \r\n              onClick={() => window.location.href = '/commission/settings'} \r\n              variant=\"outline\"\r\n              className=\"px-4 py-2 bg-white border-2 border-purple-300 text-purple-700 hover:bg-purple-50 hover:border-purple-400 font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200\"\r\n            >\r\n              <Settings className=\"h-4 w-4 mr-2\" />\r\n              Configurar Comissões\r\n            </Button>\r\n\r\n            <Button \r\n              onClick={() => {\r\n                // Definir data padrão (mês atual)\r\n                const now = new Date();\r\n                const firstDay = new Date(now.getFullYear(), now.getMonth(), 1);\r\n                const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);\r\n                \r\n                setReportDateFrom(format(firstDay, 'yyyy-MM-dd'));\r\n                setReportDateTo(format(lastDay, 'yyyy-MM-dd'));\r\n                setShowPaymentReport(true);\r\n              }}\r\n              className=\"relative px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 border-0\"\r\n            >\r\n              <div className=\"flex items-center\">\r\n                <div className=\"bg-white/20 rounded-full p-1 mr-3\">\r\n                  <FileText className=\"h-4 w-4\" />\r\n                </div>\r\n                <div className=\"flex flex-col items-start\">\r\n                  <span className=\"text-sm font-bold\">📊 Relatório de Pagamento</span>\r\n                  <span className=\"text-xs opacity-90\">Gerar relatórios detalhados</span>\r\n                </div>\r\n              </div>\r\n              <div className=\"absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20 rounded-lg blur-lg -z-10\"></div>\r\n            </Button>\r\n          </div>\r\n          \r\n          <div className=\"grid gap-4 md:grid-cols-2\">\r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2\">\r\n                Data Inicial do Lead\r\n                <span className=\"text-xs text-gray-500 block\">Filtra pela data do lead, não da comissão</span>\r\n              </label>\r\n              <Popover>\r\n                <PopoverTrigger asChild>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    className={cn(\r\n                      \"w-full justify-start text-left font-normal\",\r\n                      !dateFrom && \"text-muted-foreground\"\r\n                    )}\r\n                  >\r\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                    {dateFrom ? format(dateFrom, \"dd/MM/yyyy\", { locale: ptBR }) : \"Selecionar data inicial\"}\r\n                  </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                  <CustomCalendar\r\n                    selected={dateFrom}\r\n                    onSelect={setDateFrom}\r\n                    currentMonth={currentMonth}\r\n                    onMonthChange={setCurrentMonth}\r\n                    size=\"sm\"\r\n                    className=\"p-4\"\r\n                  />\r\n                </PopoverContent>\r\n              </Popover>\r\n            </div>\r\n            \r\n            <div>\r\n              <label className=\"block text-sm font-medium mb-2\">\r\n                Data Final do Lead\r\n                <span className=\"text-xs text-gray-500 block\">Filtra pela data do lead, não da comissão</span>\r\n              </label>\r\n              <Popover>\r\n                <PopoverTrigger asChild>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    className={cn(\r\n                      \"w-full justify-start text-left font-normal\",\r\n                      !dateTo && \"text-muted-foreground\"\r\n                    )}\r\n                  >\r\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                    {dateTo ? format(dateTo, \"dd/MM/yyyy\", { locale: ptBR }) : \"Selecionar data final\"}\r\n                  </Button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                  <CustomCalendar\r\n                    selected={dateTo}\r\n                    onSelect={setDateTo}\r\n                    currentMonth={currentMonth}\r\n                    onMonthChange={setCurrentMonth}\r\n                    size=\"sm\"\r\n                    className=\"p-4\"\r\n                  />\r\n                </PopoverContent>\r\n              </Popover>\r\n            </div>\r\n          </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Tabela de comissões em container moderno */}\r\n        <div className=\"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden\">\r\n          {renderCommissionTable()}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Modal de Relatório de Pagamento */}\r\n      <Dialog open={showPaymentReport} onOpenChange={setShowPaymentReport}>\r\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <FileText className=\"h-5 w-5 text-indigo-600\" />\r\n              Relatório de Pagamento\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Gere relatórios detalhados de comissões para pagamento dos funcionários\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            {/* Filtros */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-gray-50 rounded-lg\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium mb-1\">Funcionário</label>\r\n                <Select value={reportEmployee} onValueChange={setReportEmployee}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Todos os funcionários\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">Todos os funcionários</SelectItem>\r\n                    {employees.map(employee => (\r\n                      <SelectItem key={employee} value={employee}>\r\n                        {employee}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium mb-1\">Data Inicial</label>\r\n                <Input\r\n                  type=\"date\"\r\n                  value={reportDateFrom}\r\n                  onChange={(e) => setReportDateFrom(e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"block text-sm font-medium mb-1\">Data Final</label>\r\n                <Input\r\n                  type=\"date\"\r\n                  value={reportDateTo}\r\n                  onChange={(e) => setReportDateTo(e.target.value)}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={generatePaymentReport}\r\n                disabled={generatingReport}\r\n                className=\"px-6 py-2.5 bg-gradient-to-r from-indigo-600 to-blue-600 hover:from-indigo-700 hover:to-blue-700 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n              >\r\n                <FileText className=\"h-4 w-4 mr-2\" />\r\n                {generatingReport ? (\r\n                  <>\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                    Gerando...\r\n                  </>\r\n                ) : (\r\n                  \"📊 Gerar Relatório\"\r\n                )}\r\n              </Button>\r\n            </div>\r\n\r\n            {/* Relatório */}\r\n            {paymentReport && (\r\n              <div className=\"space-y-4\">\r\n                {Array.isArray(paymentReport) ? (\r\n                  // Múltiplos funcionários\r\n                  <div className=\"space-y-4\">\r\n                    <h3 className=\"text-lg font-semibold\">Relatório de Todos os Funcionários</h3>\r\n                    <div className=\"bg-blue-50 p-3 rounded-lg\">\r\n                      <div className=\"text-center\">\r\n                        <div className=\"text-2xl font-bold text-blue-700\">\r\n                          R$ {paymentReport.reduce((sum: number, emp: any) => sum + emp.totalCommissionValue, 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                        </div>\r\n                        <div className=\"text-sm text-blue-600\">Total Geral de Comissões</div>\r\n                      </div>\r\n                    </div>\r\n                    {paymentReport.map((report: any) => renderSingleEmployeeReport(report))}\r\n                  </div>\r\n                ) : (\r\n                  // Funcionário individual\r\n                  <div>\r\n                    <h3 className=\"text-lg font-semibold\">Relatório Individual</h3>\r\n                    {renderSingleEmployeeReport(paymentReport)}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Modal de Personalização do PDF */}\r\n      <Dialog open={showPdfCustomization} onOpenChange={setShowPdfCustomization}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Download className=\"h-5 w-5 text-red-600\" />\r\n              Personalizar PDF\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Escolha quais colunas incluir no relatório PDF\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"text-sm text-gray-600 bg-blue-50 p-3 rounded-lg\">\r\n              💡 <strong>Dica:</strong> Desmarque as colunas que não quer no PDF. Por exemplo, tire \"% Comissão\" se não quiser mostrar percentuais, ou adicione \"CPF\" se precisar dessa informação.\r\n            </div>\r\n\r\n            {/* Colunas Básicas */}\r\n            <div>\r\n              <h4 className=\"font-medium text-gray-800 mb-3\">📋 Colunas Básicas</h4>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"numero\"\r\n                    checked={pdfColumns.numero}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, numero: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"numero\" className=\"text-sm font-medium\">\r\n                    # (Número)\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"cliente\"\r\n                    checked={pdfColumns.cliente}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, cliente: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"cliente\" className=\"text-sm font-medium\">\r\n                    Cliente\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"data\"\r\n                    checked={pdfColumns.data}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, data: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"data\" className=\"text-sm font-medium\">\r\n                    Data\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"produto\"\r\n                    checked={pdfColumns.produto}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, produto: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"produto\" className=\"text-sm font-medium\">\r\n                    Produto\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"status\"\r\n                    checked={pdfColumns.status}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, status: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"status\" className=\"text-sm font-medium\">\r\n                    Status\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Colunas Financeiras */}\r\n            <div>\r\n              <h4 className=\"font-medium text-gray-800 mb-3\">💰 Colunas Financeiras</h4>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"valorVenda\"\r\n                    checked={pdfColumns.valorVenda}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, valorVenda: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"valorVenda\" className=\"text-sm font-medium\">\r\n                    Valor da Venda\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"percentagem\"\r\n                    checked={pdfColumns.percentagem}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, percentagem: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"percentagem\" className=\"text-sm font-medium\">\r\n                    % Comissão\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"valorComissao\"\r\n                    checked={pdfColumns.valorComissao}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, valorComissao: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"valorComissao\" className=\"text-sm font-medium\">\r\n                    Valor Comissão\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Colunas Extras */}\r\n            <div>\r\n              <h4 className=\"font-medium text-gray-800 mb-3\">📄 Colunas Extras</h4>\r\n              <div className=\"grid grid-cols-2 gap-3\">\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"cpf\"\r\n                    checked={pdfColumns.cpf}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, cpf: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"cpf\" className=\"text-sm font-medium\">\r\n                    CPF\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"telefone\"\r\n                    checked={pdfColumns.telefone}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, telefone: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"telefone\" className=\"text-sm font-medium\">\r\n                    Telefone\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"banco\"\r\n                    checked={pdfColumns.banco}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, banco: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"banco\" className=\"text-sm font-medium\">\r\n                    Banco\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"flex items-center space-x-2\">\r\n                  <Checkbox\r\n                    id=\"observacoes\"\r\n                    checked={pdfColumns.observacoes}\r\n                    onCheckedChange={(checked) => setPdfColumns(prev => ({...prev, observacoes: checked as boolean}))}\r\n                  />\r\n                  <label htmlFor=\"observacoes\" className=\"text-sm font-medium\">\r\n                    Observações\r\n                  </label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Contador de colunas selecionadas */}\r\n            <div className=\"bg-gray-50 p-3 rounded-lg\">\r\n              <div className=\"text-sm text-gray-600\">\r\n                📊 <strong>{Object.values(pdfColumns).filter(Boolean).length}</strong> colunas selecionadas\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowPdfCustomization(false)}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={generateCustomizedPDFReport}\r\n              className=\"bg-red-600 hover:bg-red-700\"\r\n              disabled={Object.values(pdfColumns).filter(Boolean).length === 0}\r\n            >\r\n              <Download className=\"h-4 w-4 mr-2\" />\r\n              Gerar PDF Personalizado\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Modal de Configuração do WhatsApp */}\r\n      <Dialog open={showWhatsAppConfig} onOpenChange={setShowWhatsAppConfig}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Send className=\"h-5 w-5 text-green-600\" />\r\n              Configurar WhatsApp\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Escolha quais informações incluir na mensagem do WhatsApp\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div className=\"text-sm text-gray-600 bg-green-50 p-3 rounded-lg\">\r\n              💬 <strong>Dica:</strong> Desmarque as opções que não quer incluir na mensagem. Por exemplo, retire os valores de comissão se quiser enviar apenas informações sobre vendas.\r\n            </div>\r\n\r\n            {/* Opções de configuração */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center space-x-2\">\r\n                <Checkbox\r\n                  id=\"includeTotal\"\r\n                  checked={whatsAppConfig.includeTotal}\r\n                  onCheckedChange={(checked) => setWhatsAppConfig(prev => ({...prev, includeTotal: checked as boolean}))}\r\n                />\r\n                <label htmlFor=\"includeTotal\" className=\"text-sm font-medium\">\r\n                  💰 Incluir total de comissões no resumo\r\n                </label>\r\n              </div>\r\n\r\n              <div className=\"flex items-center space-x-2\">\r\n                <Checkbox\r\n                  id=\"includeIndividualCommissions\"\r\n                  checked={whatsAppConfig.includeIndividualCommissions}\r\n                  onCheckedChange={(checked) => setWhatsAppConfig(prev => ({...prev, includeIndividualCommissions: checked as boolean}))}\r\n                />\r\n                <label htmlFor=\"includeIndividualCommissions\" className=\"text-sm font-medium\">\r\n                  📋 Incluir detalhamento individual das vendas\r\n                </label>\r\n              </div>\r\n\r\n              {whatsAppConfig.includeIndividualCommissions && (\r\n                <div className=\"ml-6 space-y-2 border-l-2 border-gray-200 pl-4\">\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Checkbox\r\n                      id=\"includePercentages\"\r\n                      checked={whatsAppConfig.includePercentages}\r\n                      onCheckedChange={(checked) => setWhatsAppConfig(prev => ({...prev, includePercentages: checked as boolean}))}\r\n                    />\r\n                    <label htmlFor=\"includePercentages\" className=\"text-sm\">\r\n                      📊 Incluir percentuais (ex: 5.0%)\r\n                    </label>\r\n                  </div>\r\n\r\n                  <div className=\"flex items-center space-x-2\">\r\n                    <Checkbox\r\n                      id=\"includeCommissionValues\"\r\n                      checked={whatsAppConfig.includeCommissionValues}\r\n                      onCheckedChange={(checked) => setWhatsAppConfig(prev => ({...prev, includeCommissionValues: checked as boolean}))}\r\n                    />\r\n                    <label htmlFor=\"includeCommissionValues\" className=\"text-sm\">\r\n                      💵 Incluir valores de comissão (ex: R$ 150,00)\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Preview da configuração */}\r\n            <div className=\"bg-gray-50 p-3 rounded-lg border\">\r\n              <div className=\"text-sm font-medium text-gray-700 mb-2\">📱 Preview da mensagem:</div>\r\n              <div className=\"text-xs text-gray-600 bg-white p-2 rounded border max-h-32 overflow-y-auto\">\r\n                {currentReportForWhatsApp && (\r\n                  <div className=\"whitespace-pre-line\">\r\n                    {generateWhatsAppMessage(currentReportForWhatsApp, whatsAppConfig).substring(0, 200)}...\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setShowWhatsAppConfig(false)}\r\n            >\r\n              Cancelar\r\n            </Button>\r\n            <Button\r\n              onClick={sendWhatsAppReportWithConfig}\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n            >\r\n              <Send className=\"h-4 w-4 mr-2\" />\r\n              Enviar WhatsApp\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Cards de métricas na parte inferior */}\r\n      <div className=\"mt-12 mb-8\">\r\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\r\n          <div className=\"bg-white rounded-xl shadow-lg border border-blue-100 p-6 transform hover:scale-105 transition-all duration-200\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Em Andamento</p>\r\n                <p className=\"text-2xl font-bold text-blue-600\">\r\n                  R$ {totalCommissionsPaid.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </p>\r\n              </div>\r\n              <div className=\"bg-blue-100 rounded-full p-3\">\r\n                <svg className=\"w-6 h-6 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1\" />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl shadow-lg border border-yellow-100 p-6 transform hover:scale-105 transition-all duration-200\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Pendente</p>\r\n                <p className=\"text-2xl font-bold text-yellow-600\">\r\n                  R$ {totalCommissionsPending.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </p>\r\n              </div>\r\n              <div className=\"bg-yellow-100 rounded-full p-3\">\r\n                <svg className=\"w-6 h-6 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl shadow-lg border border-green-100 p-6 transform hover:scale-105 transition-all duration-200\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Aprovado</p>\r\n                <p className=\"text-2xl font-bold text-green-600\">\r\n                  R$ {totalCommissionsApproved.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </p>\r\n              </div>\r\n              <div className=\"bg-green-100 rounded-full p-3\">\r\n                <svg className=\"w-6 h-6 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white rounded-xl shadow-lg border border-purple-100 p-6 transform hover:scale-105 transition-all duration-200\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Total Geral</p>\r\n                <p className=\"text-2xl font-bold text-purple-600\">\r\n                  R$ {(totalCommissionsPending + totalCommissionsApproved + totalCommissionsPaid).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                </p>\r\n              </div>\r\n              <div className=\"bg-purple-100 rounded-full p-3\">\r\n                <svg className=\"w-6 h-6 text-purple-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6\" />\r\n                </svg>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Dialog de confirmação com senha administrativa */}\r\n      <AdminPasswordDialog\r\n        open={showAdminPasswordDialog}\r\n        onOpenChange={setShowAdminPasswordDialog}\r\n        onConfirm={confirmDeleteCommission}\r\n        title=\"Confirmar Exclusão de Comissão\"\r\n        description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n        itemName={commissionToDelete ? commissions.find(c => c.id === commissionToDelete)?.product : undefined}\r\n      />\r\n    </PageLayout>\r\n  );\r\n\r\n  function renderSingleEmployeeReport(report: any) {\r\n    return (\r\n      <div key={report.employee} className=\"bg-white border rounded-lg p-4 space-y-4\">\r\n        <div className=\"flex items-center justify-between border-b pb-3\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <User className=\"h-5 w-5 text-blue-600\" />\r\n            <h4 className=\"text-lg font-semibold\">{report.employee}</h4>\r\n          </div>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700\">\r\n              {report.totalLeads} vendas\r\n            </Badge>\r\n            <Badge className=\"bg-green-100 text-green-800 text-lg px-3 py-1\">\r\n              R$ {report.totalCommissionValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n            </Badge>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Resumo */}\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-gray-50 rounded-lg\">\r\n          <div className=\"text-center\">\r\n            <div className=\"text-xl font-bold text-blue-600\">{report.totalLeads}</div>\r\n            <div className=\"text-sm text-gray-600\">Total de Vendas</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"text-xl font-bold text-green-600\">\r\n              R$ {report.totalAmount.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n            </div>\r\n            <div className=\"text-sm text-gray-600\">Valor Total Vendido</div>\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <div className=\"text-xl font-bold text-purple-600\">\r\n              R$ {report.totalCommissionValue.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n            </div>\r\n            <div className=\"text-sm text-gray-600\">Total Comissões</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Detalhamento (últimas 5 vendas para economizar espaço) */}\r\n        <div className=\"space-y-2\">\r\n          <h5 className=\"font-medium text-gray-800\">Últimas Vendas:</h5>\r\n          <div className=\"max-h-40 overflow-y-auto space-y-2\">\r\n            {report.commissions.slice(0, 5).map((commission: any, index: number) => {\r\n              const leadDate = commission.lead?.date || commission.lead?.created_at;\r\n              const dateFormatted = leadDate ? format(new Date(leadDate), 'dd/MM/yyyy') : 'N/A';\r\n              \r\n              return (\r\n                <div key={commission.id} className=\"bg-gray-50 border rounded p-2 text-sm\">\r\n                  <div className=\"flex justify-between items-start\">\r\n                    <div className=\"font-medium text-gray-800\">\r\n                      {commission.lead?.name || 'Cliente'}\r\n                    </div>\r\n                    <div className=\"text-xs text-gray-500\">{dateFormatted}</div>\r\n                  </div>\r\n                  <div className=\"text-xs text-gray-600 mt-1\">\r\n                    {commission.product} • R$ {(commission.amount || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })} • \r\n                    <span className=\"font-semibold text-green-600 ml-1\">\r\n                      R$ {(commission.commission_value || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n            {report.commissions.length > 5 && (\r\n              <div className=\"text-center text-sm text-gray-500 py-2\">\r\n                ... e mais {report.commissions.length - 5} vendas\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Ações */}\r\n        <div className=\"flex flex-wrap gap-2 pt-3 border-t\">\r\n          <Button\r\n            onClick={() => sendWhatsAppReport(report)}\r\n            className=\"bg-green-600 hover:bg-green-700\"\r\n            size=\"sm\"\r\n          >\r\n            <Send className=\"h-4 w-4 mr-2\" />\r\n            Enviar WhatsApp\r\n          </Button>\r\n\r\n          <Button\r\n            onClick={() => openPdfCustomization(report)}\r\n            className=\"bg-red-600 hover:bg-red-700\"\r\n            size=\"sm\"\r\n          >\r\n            <Download className=\"h-4 w-4 mr-2\" />\r\n            Gerar PDF\r\n          </Button>\r\n\r\n          {!report.commissions.every((c: any) => c.status === 'paid') && (\r\n            <>\r\n              <Button\r\n                onClick={() => markCommissionsAsPaid(report.employee, report.commissions.map((c: any) => c.id))}\r\n                className=\"bg-blue-600 hover:bg-blue-700\"\r\n                size=\"sm\"\r\n              >\r\n                <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                Marcar como Pago\r\n              </Button>\r\n\r\n              <Button\r\n                onClick={() => {\r\n                  // Marcar todas as comissões como aprovadas\r\n                  const commissionIds = report.commissions\r\n                    .filter((c: any) => c.status !== 'approved' && c.status !== 'paid')\r\n                    .map((c: any) => c.id);\r\n                  \r\n                  if (commissionIds.length > 0) {\r\n                    Promise.all(\r\n                      commissionIds.map((id: string) => changeCommissionStatus(id, 'approved'))\r\n                    ).then(() => {\r\n                      toast.success(`${commissionIds.length} comissões aprovadas!`);\r\n                    });\r\n                  } else {\r\n                    toast.info('Todas as comissões já estão aprovadas ou pagas');\r\n                  }\r\n                }}\r\n                className=\"bg-purple-600 hover:bg-purple-700\"\r\n                size=\"sm\"\r\n              >\r\n                <CheckCircle className=\"h-4 w-4 mr-2\" />\r\n                Aprovar Todas\r\n              </Button>\r\n            </>\r\n          )}\r\n\r\n\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n};\r\n\r\nexport default Commission;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\CommissionSettings.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2323,2326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2323,2326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2556,2559],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2556,2559],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2823,2826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2823,2826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3495,3498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3495,3498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4118,4121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4118,4121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4624,4627],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4624,4627],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":154,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":154,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5123,5126],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5123,5126],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCaption,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n  Tabs,\r\n  TabsContent,\r\n  TabsList,\r\n  TabsTrigger,\r\n} from \"@/components/ui/tabs\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { CommissionRate, CommissionTier } from \"@/types/models\";\r\nimport { PlusCircle, Pencil, Trash2 } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport FixedRateForm from \"@/components/commission/FixedRateForm\";\r\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport Header from \"@/components/Header\";\r\nimport VariableRateForm from \"@/components/commission/VariableRateForm\";\r\n\r\nconst CommissionSettings = () => {\r\n  const [rates, setRates] = useState<CommissionRate[]>([]);\r\n  const [tiers, setTiers] = useState<CommissionTier[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showNewRateForm, setShowNewRateForm] = useState(false);\r\n  const [showNewTierForm, setShowNewTierForm] = useState(false);\r\n  const [editingRate, setEditingRate] = useState<CommissionRate | null>(null);\r\n  const [editingTier, setEditingTier] = useState<CommissionTier | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchCommissionData();\r\n  }, []);\r\n\r\n  const fetchCommissionData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const { data: ratesData, error: ratesError } = await supabase\r\n        .from('commission_rates')\r\n        .select('*')\r\n        .order('product', { ascending: true });\r\n      \r\n      if (ratesError) throw ratesError;\r\n      \r\n      const { data: tiersData, error: tiersError } = await supabase\r\n        .from('commission_tiers')\r\n        .select('*')\r\n        .order('product', { ascending: true })\r\n        .order('min_amount', { ascending: true });\r\n      \r\n      if (tiersError) throw tiersError;\r\n      \r\n      // Add default values for backward compatibility\r\n      const processedRates = (ratesData || []).map((rate: any) => ({\r\n        ...rate,\r\n        commission_type: rate.commission_type || 'percentage',\r\n        fixed_value: rate.fixed_value || null\r\n      })) as CommissionRate[];\r\n\r\n      const processedTiers = (tiersData || []).map((tier: any) => ({\r\n        ...tier,\r\n        commission_type: tier.commission_type || 'percentage',\r\n        fixed_value: tier.fixed_value || null\r\n      })) as CommissionTier[];\r\n      \r\n      setRates(processedRates);\r\n      setTiers(processedTiers);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching commission data:\", error);\r\n      toast.error(\"Erro ao carregar dados de comissões\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRateActivation = async (id: string, active: boolean) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commission_rates')\r\n        .update({ active: !active })\r\n        .eq('id', id);\r\n      \r\n      if (error) throw error;\r\n      \r\n      setRates(rates.map(rate =>\r\n        rate.id === id ? { ...rate, active: !active } : rate\r\n      ));\r\n      \r\n      toast.success(`Taxa ${!active ? 'ativada' : 'desativada'} com sucesso`);\r\n    } catch (error: any) {\r\n      console.error(\"Error updating rate status:\", error);\r\n      toast.error(\"Erro ao atualizar status da taxa\");\r\n    }\r\n  };\r\n\r\n  const handleTierActivation = async (id: string, active: boolean) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commission_tiers')\r\n        .update({ active: !active })\r\n        .eq('id', id);\r\n      \r\n      if (error) throw error;\r\n      \r\n      setTiers(tiers.map(tier =>\r\n        tier.id === id ? { ...tier, active: !active } : tier\r\n      ));\r\n      \r\n      toast.success(`Nível ${!active ? 'ativado' : 'desativado'} com sucesso`);\r\n    } catch (error: any) {\r\n      console.error(\"Error updating tier status:\", error);\r\n      toast.error(\"Erro ao atualizar status do nível\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteRate = async (id: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commission_rates')\r\n        .delete()\r\n        .eq('id', id);\r\n      \r\n      if (error) throw error;\r\n      \r\n      setRates(rates.filter(rate => rate.id !== id));\r\n      toast.success(\"Taxa de comissão excluída com sucesso\");\r\n    } catch (error: any) {\r\n      console.error(\"Error deleting rate:\", error);\r\n      toast.error(\"Erro ao excluir taxa de comissão\");\r\n    }\r\n  };\r\n\r\n  const handleDeleteTier = async (id: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('commission_tiers')\r\n        .delete()\r\n        .eq('id', id);\r\n      \r\n      if (error) throw error;\r\n      \r\n      setTiers(tiers.filter(tier => tier.id !== id));\r\n      toast.success(\"Nível de comissão excluído com sucesso\");\r\n    } catch (error: any) {\r\n      console.error(\"Error deleting tier:\", error);\r\n      toast.error(\"Erro ao excluir nível de comissão\");\r\n    }\r\n  };\r\n\r\n  const onRateSave = () => {\r\n    fetchCommissionData();\r\n    setShowNewRateForm(false);\r\n    setEditingRate(null);\r\n  };\r\n\r\n  const onTierSave = () => {\r\n    fetchCommissionData();\r\n    setShowNewTierForm(false);\r\n    setEditingTier(null);\r\n  };\r\n\r\n  const renderRatesTable = () => (\r\n    <>\r\n      {showNewRateForm || editingRate ? (\r\n        <Card className=\"mb-4\">\r\n          <CardHeader>\r\n            <CardTitle>{editingRate ? \"Editar Taxa Fixa\" : \"Nova Taxa Fixa\"}</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <FixedRateForm \r\n              onCancel={() => {\r\n                setShowNewRateForm(false);\r\n                setEditingRate(null);\r\n              }}\r\n              onSave={onRateSave}\r\n              initialData={editingRate}\r\n            />\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"mb-4 flex justify-end\">\r\n          <Button onClick={() => setShowNewRateForm(true)} className=\"flex items-center gap-1\">\r\n            <PlusCircle className=\"h-5 w-5\" /> Adicionar Taxa Fixa\r\n          </Button>\r\n        </div>\r\n      )}\r\n\r\n      <Table>\r\n                        <TableCaption>Lista de comissões fixas por produto.</TableCaption>\r\n        <TableHeader>\r\n          <TableRow>\r\n            <TableHead className=\"w-[180px]\">Produto</TableHead>\r\n            <TableHead>Nome</TableHead>\r\n            <TableHead>Tipo</TableHead>\r\n            <TableHead>Valor</TableHead>\r\n            <TableHead>Ativo</TableHead>\r\n            <TableHead className=\"text-right\">Ações</TableHead>\r\n          </TableRow>\r\n        </TableHeader>\r\n        <TableBody>\r\n          {loading ? (\r\n            <TableRow>\r\n                                  <TableCell colSpan={6} className=\"text-center py-8\">Carregando comissões...</TableCell>\r\n            </TableRow>\r\n          ) : rates.length === 0 ? (\r\n            <TableRow>\r\n              <TableCell colSpan={6} className=\"text-center py-8\">Nenhuma taxa de comissão encontrada.</TableCell>\r\n            </TableRow>\r\n          ) : (\r\n            rates.map((rate) => (\r\n              <TableRow key={rate.id} className={!rate.active ? \"opacity-60\" : \"\"}>\r\n                <TableCell className=\"font-medium\">{rate.product}</TableCell>\r\n                <TableCell>{rate.name || \"-\"}</TableCell>\r\n                <TableCell>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {rate.commission_type === 'percentage' ? (\r\n                      <>\r\n                        <span className=\"text-lg\">📊</span>\r\n                        <span className=\"text-sm font-medium text-blue-600\">Percentual</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <span className=\"text-lg\">💰</span>\r\n                        <span className=\"text-sm font-medium text-green-600\">Valor Fixo</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </TableCell>\r\n                <TableCell>\r\n                  {rate.commission_type === 'percentage' \r\n                    ? <span className=\"font-semibold text-blue-700 bg-blue-50 px-2 py-1 rounded\">{rate.percentage}%</span>\r\n                    : <span className=\"font-semibold text-green-700 bg-green-50 px-2 py-1 rounded\">R$ {rate.fixed_value?.toLocaleString('pt-BR', { minimumFractionDigits: 2 }) || '0,00'}</span>\r\n                  }\r\n                </TableCell>\r\n                <TableCell>\r\n                  <Switch\r\n                    id={`rate-active-${rate.id}`}\r\n                    checked={rate.active}\r\n                    onCheckedChange={() => handleRateActivation(rate.id, rate.active)}\r\n                  />\r\n                  <Label\r\n                    htmlFor={`rate-active-${rate.id}`}\r\n                    className=\"sr-only\"\r\n                  >\r\n                    Ativo\r\n                  </Label>\r\n                </TableCell>\r\n                <TableCell className=\"text-right\">\r\n                  <div className=\"flex justify-end gap-2\">\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      onClick={() => setEditingRate(rate)}\r\n                    >\r\n                      <Pencil className=\"h-4 w-4\" />\r\n                      <span className=\"sr-only\">Editar</span>\r\n                    </Button>\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      className=\"text-red-500 hover:text-red-600\" \r\n                      onClick={() => handleDeleteRate(rate.id)}\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4\" />\r\n                      <span className=\"sr-only\">Excluir</span>\r\n                    </Button>\r\n                  </div>\r\n                </TableCell>\r\n              </TableRow>\r\n            ))\r\n          )}\r\n        </TableBody>\r\n      </Table>\r\n    </>\r\n  );\r\n\r\n  const renderTiersTable = () => (\r\n    <>\r\n      {showNewTierForm || editingTier ? (\r\n        <Card className=\"mb-4\">\r\n          <CardHeader>\r\n            <CardTitle>{editingTier ? \"Editar Taxa Variável\" : \"Nova Taxa Variável\"}</CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <VariableRateForm \r\n              onCancel={() => {\r\n                setShowNewTierForm(false);\r\n                setEditingTier(null);\r\n              }}\r\n              onSave={onTierSave}\r\n              initialData={editingTier}\r\n            />\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <div className=\"mb-4 flex justify-end\">\r\n          <Button onClick={() => setShowNewTierForm(true)} className=\"flex items-center gap-1\">\r\n            <PlusCircle className=\"h-5 w-5\" /> Adicionar Taxa Variável\r\n          </Button>\r\n        </div>\r\n      )}\r\n\r\n      <Table>\r\n                        <TableCaption>Lista de comissões variáveis por produto, valor ou prazo.</TableCaption>\r\n        <TableHeader>\r\n          <TableRow>\r\n            <TableHead className=\"w-[150px]\">Produto</TableHead>\r\n            <TableHead>Nome</TableHead>\r\n            <TableHead>Faixa</TableHead>\r\n            <TableHead>Mínimo</TableHead>\r\n            <TableHead>Máximo</TableHead>\r\n            <TableHead>Tipo</TableHead>\r\n            <TableHead>Valor</TableHead>\r\n            <TableHead>Ativo</TableHead>\r\n            <TableHead className=\"text-right\">Ações</TableHead>\r\n          </TableRow>\r\n        </TableHeader>\r\n        <TableBody>\r\n          {loading ? (\r\n            <TableRow>\r\n                                  <TableCell colSpan={8} className=\"text-center py-8\">Carregando comissões...</TableCell>\r\n            </TableRow>\r\n          ) : tiers.length === 0 ? (\r\n            <TableRow>\r\n              <TableCell colSpan={8} className=\"text-center py-8\">Nenhuma taxa de comissão encontrada.</TableCell>\r\n            </TableRow>\r\n          ) : (\r\n            tiers.map((tier) => (\r\n              <TableRow key={tier.id} className={!tier.active ? \"opacity-60\" : \"\"}>\r\n                <TableCell className=\"font-medium\">{tier.product}</TableCell>\r\n                <TableCell>{tier.name || \"-\"}</TableCell>\r\n                <TableCell>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {(tier.tier_type || 'value') === 'value' ? (\r\n                      <>\r\n                        <span className=\"text-lg\">💰</span>\r\n                        <span className=\"text-sm font-medium text-green-600\">Valor</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <span className=\"text-lg\">📅</span>\r\n                        <span className=\"text-sm font-medium text-purple-600\">Prazo</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </TableCell>\r\n                <TableCell>\r\n                  {(tier.tier_type || 'value') === 'value' \r\n                    ? <span className=\"font-medium text-slate-700\">R$ {tier.min_amount.toLocaleString('pt-BR')}</span>\r\n                    : <span className=\"font-medium text-purple-700 bg-purple-50 px-2 py-1 rounded\">{tier.min_period || 0}x</span>\r\n                  }\r\n                </TableCell>\r\n                <TableCell>\r\n                  {(tier.tier_type || 'value') === 'value' \r\n                    ? (tier.max_amount ? <span className=\"font-medium text-slate-700\">R$ {tier.max_amount.toLocaleString('pt-BR')}</span> : <span className=\"text-gray-500 italic\">Sem limite</span>)\r\n                    : (tier.max_period ? <span className=\"font-medium text-purple-700 bg-purple-50 px-2 py-1 rounded\">{tier.max_period}x</span> : <span className=\"text-gray-500 italic\">Sem limite</span>)\r\n                  }\r\n                </TableCell>\r\n                <TableCell>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    {tier.commission_type === 'percentage' ? (\r\n                      <>\r\n                        <span className=\"text-lg\">📊</span>\r\n                        <span className=\"text-sm font-medium text-blue-600\">Percentual</span>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <span className=\"text-lg\">💰</span>\r\n                        <span className=\"text-sm font-medium text-green-600\">Valor Fixo</span>\r\n                      </>\r\n                    )}\r\n                  </div>\r\n                </TableCell>\r\n                <TableCell>\r\n                  {tier.commission_type === 'percentage' \r\n                    ? <span className=\"font-semibold text-blue-700 bg-blue-50 px-2 py-1 rounded\">{tier.percentage}%</span>\r\n                    : <span className=\"font-semibold text-green-700 bg-green-50 px-2 py-1 rounded\">R$ {tier.fixed_value?.toLocaleString('pt-BR', { minimumFractionDigits: 2 }) || '0,00'}</span>\r\n                  }\r\n                </TableCell>\r\n                <TableCell>\r\n                  <Switch\r\n                    id={`tier-active-${tier.id}`}\r\n                    checked={tier.active}\r\n                    onCheckedChange={() => handleTierActivation(tier.id, tier.active)}\r\n                  />\r\n                  <Label\r\n                    htmlFor={`tier-active-${tier.id}`}\r\n                    className=\"sr-only\"\r\n                  >\r\n                    Ativo\r\n                  </Label>\r\n                </TableCell>\r\n                <TableCell className=\"text-right\">\r\n                  <div className=\"flex justify-end gap-2\">\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      onClick={() => setEditingTier(tier)}\r\n                    >\r\n                      <Pencil className=\"h-4 w-4\" />\r\n                      <span className=\"sr-only\">Editar</span>\r\n                    </Button>\r\n                    <Button \r\n                      variant=\"outline\" \r\n                      size=\"sm\" \r\n                      className=\"text-red-500 hover:text-red-600\" \r\n                      onClick={() => handleDeleteTier(tier.id)}\r\n                    >\r\n                      <Trash2 className=\"h-4 w-4\" />\r\n                      <span className=\"sr-only\">Excluir</span>\r\n                    </Button>\r\n                  </div>\r\n                </TableCell>\r\n              </TableRow>\r\n            ))\r\n          )}\r\n        </TableBody>\r\n      </Table>\r\n    </>\r\n  );\r\n\r\n  return (\r\n    <SidebarProvider>\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 w-full flex\">\r\n        <AppSidebar />\r\n        <div className=\"flex-1 w-full overflow-hidden min-w-0\">\r\n          <Header />\r\n          <main className=\"w-full h-full\">\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* Header moderno customizado */}\r\n              <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n        <div className=\"p-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z\"/>\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold\">Configurações de Comissões</h1>\r\n                <p className=\"text-blue-100 text-lg mt-1\">Gerencie as regras e faixas de comissão do sistema</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"hidden md:flex items-center space-x-4\">\r\n              <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                <div className=\"text-sm text-blue-100\">Total de Configurações</div>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {rates.length + tiers.length}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-8\">\r\n        <Tabs defaultValue=\"rates\" className=\"w-full\">\r\n          <TabsList className=\"mb-6\">\r\n            <TabsTrigger value=\"rates\">Comissões Fixas</TabsTrigger>\r\n            <TabsTrigger value=\"tiers\">Comissões Variáveis (Por Faixa de Valor ou Prazo)</TabsTrigger>\r\n          </TabsList>\r\n          <TabsContent value=\"rates\">\r\n            {renderRatesTable()}\r\n          </TabsContent>\r\n          <TabsContent value=\"tiers\">\r\n            {renderTiersTable()}\r\n          </TabsContent>\r\n        </Tabs>\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </SidebarProvider>\r\n  );\r\n};\r\n\r\nexport default CommissionSettings;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\CookiePolicy.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\CursoTrafegoPago.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAccess'. Either include it or remove the dependency array.","line":29,"column":6,"nodeType":"ArrayExpression","endLine":29,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkAccess, user]","fix":{"range":[1081,1087],"text":"[checkAccess, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1258,1261],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1258,1261],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2443,2446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2443,2446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2926,2929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2926,2929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3287,3290],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3287,3290],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { \r\n  Download, CheckCircle, Star, CreditCard, Shield, Clock, \r\n  ArrowRight, Sparkles, Rocket, Target, TrendingUp, Zap,\r\n  BookOpen, Gift, Users, BarChart3, Award\r\n} from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst CursoTrafegoPago = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [hasAccess, setHasAccess] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\r\n\r\n  const price = 197.00;\r\n  const originalPrice = 597.00;\r\n\r\n  useEffect(() => {\r\n    checkAccess();\r\n  }, [user]);\r\n\r\n  const checkAccess = async () => {\r\n    if (!user) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { data, error } = await (supabase as any)\r\n        .from('course_purchases')\r\n        .select('*')\r\n        .eq('user_id', user.id)\r\n        .eq('course_id', 'curso-trafego-pago')\r\n        .eq('status', 'paid')\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        console.error('Erro ao verificar acesso:', error);\r\n      }\r\n\r\n      setHasAccess(!!data);\r\n      \r\n      if (data) {\r\n        await loadPdf();\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao verificar acesso:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadPdf = async () => {\r\n    try {\r\n      const { data } = await supabase.storage\r\n        .from('courses')\r\n        .getPublicUrl('curso-trafego-pago/curso.pdf');\r\n      \r\n      if (data?.publicUrl) {\r\n        setPdfUrl(data.publicUrl);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao carregar PDF:', error);\r\n    }\r\n  };\r\n\r\n  const handlePurchase = async () => {\r\n    if (!user) {\r\n      toast.error(\"Você precisa estar logado para comprar o curso\");\r\n      navigate(\"/login\");\r\n      return;\r\n    }\r\n\r\n    setProcessing(true);\r\n    try {\r\n      const { data: purchase, error: purchaseError } = await (supabase as any)\r\n        .from('course_purchases')\r\n        .insert({\r\n          user_id: user.id,\r\n          course_id: 'curso-trafego-pago',\r\n          amount: price,\r\n          status: 'pending',\r\n          payment_method: 'manual'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (purchaseError) throw purchaseError;\r\n\r\n      toast.success(\"Redirecionando para pagamento...\");\r\n      \r\n      setTimeout(async () => {\r\n        const { error: updateError } = await (supabase as any)\r\n          .from('course_purchases')\r\n          .update({ status: 'paid', paid_at: new Date().toISOString() })\r\n          .eq('id', purchase.id);\r\n\r\n        if (updateError) throw updateError;\r\n\r\n        toast.success(\"Pagamento confirmado! Acesso liberado!\");\r\n        setHasAccess(true);\r\n        await loadPdf();\r\n      }, 2000);\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao processar compra:', error);\r\n      toast.error(`Erro ao processar compra: ${error.message}`);\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleDownload = () => {\r\n    if (pdfUrl) {\r\n      window.open(pdfUrl, '_blank');\r\n    } else {\r\n      toast.error(\"PDF não encontrado. Entre em contato com o suporte.\");\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <PageLayout title=\"Curso de Tráfego Pago\" subtitle=\"Carregando...\">\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </PageLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PageLayout title=\"\" subtitle=\"\">\r\n      {hasAccess ? (\r\n        <div className=\"max-w-2xl mx-auto py-8 px-4\">\r\n          <Card className=\"border-2 border-green-500 shadow-2xl\">\r\n            <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-lg\">\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <CheckCircle className=\"h-8 w-8\" />\r\n                <h1 className=\"text-2xl font-bold\">Acesso Liberado!</h1>\r\n              </div>\r\n              <p className=\"text-green-50\">\r\n                Você tem acesso completo ao Curso de Tráfego Pago para Corbans\r\n              </p>\r\n            </div>\r\n            <CardContent className=\"p-8\">\r\n              <Button \r\n                onClick={handleDownload} \r\n                className=\"w-full bg-green-600 hover:bg-green-700 text-white text-lg py-6\"\r\n                size=\"lg\"\r\n              >\r\n                <Download className=\"h-5 w-5 mr-2\" />\r\n                Baixar Curso em PDF\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      ) : (\r\n        <div className=\"max-w-4xl mx-auto px-4 py-6\">\r\n          {/* Hero Section */}\r\n          <div className=\"relative bg-gradient-to-br from-slate-900 via-blue-900 to-indigo-900 rounded-2xl overflow-hidden mb-6 shadow-2xl\">\r\n            <div className=\"relative z-10 p-6 md:p-8\">\r\n              <div className=\"max-w-2xl mx-auto text-center\">\r\n                <Badge className=\"mb-4 bg-yellow-400 text-slate-900 px-3 py-1.5 text-xs font-black\">\r\n                  67% OFF\r\n                </Badge>\r\n\r\n                <h1 className=\"text-3xl md:text-5xl font-black text-white mb-2 leading-tight\">\r\n                  Curso Completo de\r\n                  <span className=\"block text-yellow-300\">TRÁFEGO PAGO</span>\r\n                  <span className=\"block text-blue-300\">PARA CORBANS</span>\r\n                </h1>\r\n                <p className=\"text-lg text-white mb-6\">\r\n                  Aprenda a captar leads qualificados e aumentar suas vendas com estratégias profissionais no Google, Facebook e Instagram\r\n                </p>\r\n\r\n                {/* Preço */}\r\n                <Card className=\"bg-white border-4 border-yellow-500 shadow-2xl max-w-sm mx-auto\">\r\n                  <CardContent className=\"p-5\">\r\n                    <div className=\"text-center mb-4\">\r\n                      <p className=\"text-xs text-gray-500 mb-1\">De <span className=\"line-through\">R$ {originalPrice.toFixed(2).replace('.', ',')}</span></p>\r\n                      <div className=\"flex items-baseline justify-center gap-1 mb-2\">\r\n                        <span className=\"text-5xl font-black text-slate-900\">R$ {price.toFixed(0)}</span>\r\n                        <span className=\"text-2xl text-slate-700 font-black\">,00</span>\r\n                      </div>\r\n                      <Badge className=\"bg-red-600 text-white text-xs px-2 py-0.5 font-bold\">\r\n                        Economize R$ {(originalPrice - price).toFixed(2).replace('.', ',')}\r\n                      </Badge>\r\n                    </div>\r\n\r\n                    <Button \r\n                      onClick={handlePurchase}\r\n                      disabled={processing}\r\n                      className=\"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-black text-base py-6 rounded-lg shadow-xl mb-3\"\r\n                      size=\"lg\"\r\n                    >\r\n                      {processing ? (\r\n                        <>\r\n                          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                          Processando...\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <CreditCard className=\"h-4 w-4 mr-2\" />\r\n                          COMPRAR AGORA\r\n                          <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                        </>\r\n                      )}\r\n                    </Button>\r\n\r\n                    <div className=\"flex items-center justify-center gap-3 text-xs text-gray-600\">\r\n                      <Shield className=\"h-3 w-3\" />\r\n                      <Clock className=\"h-3 w-3\" />\r\n                      <CheckCircle className=\"h-3 w-3\" />\r\n                      <span>Seguro • Imediato • Garantia 7d</span>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Bônus CRM */}\r\n          <Card className=\"mb-6 border-2 border-blue-500 bg-gradient-to-r from-blue-50 to-indigo-50\">\r\n            <CardContent className=\"p-5\">\r\n              <div className=\"flex items-center gap-3 mb-3\">\r\n                <Gift className=\"h-6 w-6 text-blue-600\" />\r\n                <h2 className=\"text-xl font-bold text-blue-900\">BÔNUS EXCLUSIVO</h2>\r\n              </div>\r\n              <p className=\"text-gray-700 mb-2\">\r\n                <strong>1 Mês Grátis do CRM LeadConsig</strong> - Sistema completo de gestão de leads, comissões e vendas para correspondentes bancários.\r\n              </p>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Badge variant=\"outline\" className=\"border-blue-300 text-blue-700\">Dashboard Completo</Badge>\r\n                <Badge variant=\"outline\" className=\"border-blue-300 text-blue-700\">Gestão de Leads</Badge>\r\n                <Badge variant=\"outline\" className=\"border-blue-300 text-blue-700\">Controle de Comissões</Badge>\r\n                <Badge variant=\"outline\" className=\"border-blue-300 text-blue-700\">Relatórios</Badge>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* O Que Você Vai Aprender */}\r\n          <Card className=\"mb-6 border-2\">\r\n            <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b\">\r\n              <h3 className=\"text-lg font-bold text-gray-900 flex items-center gap-2\">\r\n                <BookOpen className=\"h-5 w-5 text-blue-600\" />\r\n                O Que Você Vai Aprender\r\n              </h3>\r\n            </div>\r\n            <CardContent className=\"p-4\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                {[\r\n                  \"Estratégias avançadas de segmentação\",\r\n                  \"Como criar campanhas no Google Ads\",\r\n                  \"Otimização de campanhas no Facebook\",\r\n                  \"Anúncios no Instagram que convertem\",\r\n                  \"Criação de funis de vendas eficazes\",\r\n                  \"Segmentação por região e perfil\",\r\n                  \"Leads qualificados para INSS, FGTS e Bolsa Família\",\r\n                  \"Como aumentar taxa de aprovação\",\r\n                  \"ROI e otimização de investimento\",\r\n                  \"Gestão profissional de campanhas\",\r\n                  \"Métricas e relatórios de performance\",\r\n                  \"Escalabilidade e crescimento\"\r\n                ].map((item, idx) => (\r\n                  <div key={idx} className=\"flex items-center gap-2\">\r\n                    <CheckCircle className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\r\n                    <span className=\"text-sm text-gray-700\">{item}</span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Benefícios */}\r\n          <div className=\"grid md:grid-cols-3 gap-4 mb-6\">\r\n            <Card className=\"text-center border-2 border-blue-200\">\r\n              <CardContent className=\"p-4\">\r\n                <Target className=\"h-8 w-8 text-blue-600 mx-auto mb-2\" />\r\n                <h4 className=\"font-bold text-gray-900 mb-1\">Leads Qualificados</h4>\r\n                <p className=\"text-xs text-gray-600\">Capture clientes que realmente querem crédito consignado</p>\r\n              </CardContent>\r\n            </Card>\r\n            <Card className=\"text-center border-2 border-purple-200\">\r\n              <CardContent className=\"p-4\">\r\n                <TrendingUp className=\"h-8 w-8 text-purple-600 mx-auto mb-2\" />\r\n                <h4 className=\"font-bold text-gray-900 mb-1\">Aumento de Vendas</h4>\r\n                <p className=\"text-xs text-gray-600\">Multiplique suas aprovações e faturamento</p>\r\n              </CardContent>\r\n            </Card>\r\n            <Card className=\"text-center border-2 border-green-200\">\r\n              <CardContent className=\"p-4\">\r\n                <Award className=\"h-8 w-8 text-green-600 mx-auto mb-2\" />\r\n                <h4 className=\"font-bold text-gray-900 mb-1\">ROI Garantido</h4>\r\n                <p className=\"text-xs text-gray-600\">Estratégias testadas e comprovadas</p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Garantia */}\r\n          <Card className=\"bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg mb-6\">\r\n            <CardContent className=\"p-5 text-center\">\r\n              <Shield className=\"h-8 w-8 mx-auto mb-2\" />\r\n              <h3 className=\"text-lg font-bold mb-1\">Garantia 7 Dias</h3>\r\n              <p className=\"text-sm text-green-50\">\r\n                100% do dinheiro de volta se não estiver satisfeito\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* CTA Final */}\r\n          <Card className=\"bg-gradient-to-r from-slate-900 to-blue-900 text-white border-0 shadow-2xl\">\r\n            <CardContent className=\"p-6 text-center\">\r\n              <Rocket className=\"h-10 w-10 mx-auto mb-3 text-yellow-400\" />\r\n              <h2 className=\"text-2xl font-bold mb-2\">SÓ DEPENDE DE VOCÊ!</h2>\r\n              <p className=\"text-sm text-white mb-4\">\r\n                Acorde com mensagens de clientes. Não dependa mais de sorte.\r\n              </p>\r\n              <div className=\"max-w-xs mx-auto\">\r\n                <div className=\"mb-3\">\r\n                  <p className=\"text-xs text-blue-200 mb-0.5\">De <span className=\"line-through\">R$ {originalPrice.toFixed(2).replace('.', ',')}</span></p>\r\n                  <p className=\"text-3xl font-black text-yellow-400 mb-1\">R$ {price.toFixed(0)},00</p>\r\n                  <Badge className=\"bg-red-500 text-white text-xs\">67% OFF</Badge>\r\n                </div>\r\n                <Button \r\n                  onClick={handlePurchase}\r\n                  disabled={processing}\r\n                  className=\"w-full bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-slate-900 font-bold py-5 rounded-lg shadow-xl transform hover:scale-105 transition-all\"\r\n                  size=\"lg\"\r\n                >\r\n                  {processing ? (\r\n                    <>\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-slate-900 mr-2\"></div>\r\n                      Processando...\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <CreditCard className=\"h-4 w-4 mr-2\" />\r\n                      QUERO MEU ACESSO AGORA!\r\n                      <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      )}\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default CursoTrafegoPago;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Employees.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2657,2660],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2657,2660],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":111,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":111,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4102,4105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4102,4105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5890,5893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5890,5893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":205,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":205,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7051,7054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7051,7054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCaption,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Edit } from \"lucide-react\";\r\nimport { getEmployees, createEmployee, updateEmployee, deleteEmployee, Employee } from \"@/utils/employees\";\r\nimport { getBankName } from \"@/utils/bankUtils\";\r\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport Header from \"@/components/Header\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\n\r\nconst Employees = () => {\r\n  const [employees, setEmployees] = useState<Employee[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [newEmployeeName, setNewEmployeeName] = useState(\"\");\r\n  const [newEmployeeBank, setNewEmployeeBank] = useState(\"\");\r\n  const [newEmployeePixKeyMain, setNewEmployeePixKeyMain] = useState(\"\");\r\n  const [newEmployeePixKey2, setNewEmployeePixKey2] = useState(\"\");\r\n  const [newEmployeePixKey3, setNewEmployeePixKey3] = useState(\"\");\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  const [editDialogOpen, setEditDialogOpen] = useState(false);\r\n  const [employeeToDelete, setEmployeeToDelete] = useState<Employee | null>(null);\r\n  const [employeeToEdit, setEmployeeToEdit] = useState<Employee | null>(null);\r\n  const [editEmployeeName, setEditEmployeeName] = useState(\"\");\r\n  const [editEmployeeBank, setEditEmployeeBank] = useState(\"\");\r\n  const [editEmployeePixKeyMain, setEditEmployeePixKeyMain] = useState(\"\");\r\n  const [editEmployeePixKey2, setEditEmployeePixKey2] = useState(\"\");\r\n  const [editEmployeePixKey3, setEditEmployeePixKey3] = useState(\"\");\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n  const { user } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      fetchEmployees();\r\n    }\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, [user]);\r\n\r\n  const fetchEmployees = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const data = await getEmployees();\r\n      setEmployees(data);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching employees:\", error);\r\n      toast.error(`Erro ao carregar funcionários: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddEmployee = async () => {\r\n    if (!newEmployeeName.trim()) {\r\n      toast.error(\"O nome do funcionário não pode estar vazio\");\r\n      return;\r\n    }\r\n\r\n    // Verificar se já existe funcionário com o mesmo nome (case insensitive)\r\n    const nomeExiste = employees.some(emp => emp.name.trim().toLowerCase() === newEmployeeName.trim().toLowerCase() && emp.active);\r\n    if (nomeExiste) {\r\n      toast.error(\"Já existe um funcionário com esse nome. Escolha um nome diferente.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const success = await createEmployee(\r\n        newEmployeeName,\r\n        newEmployeeName, // Using name as full_name since we removed the separate field\r\n        newEmployeeBank,\r\n        newEmployeePixKeyMain,\r\n        newEmployeePixKey2,\r\n        newEmployeePixKey3\r\n      );\r\n\r\n      if (success) {\r\n        toast.success(`Funcionário ${newEmployeeName} adicionado com sucesso`);\r\n        setNewEmployeeName(\"\");\r\n        setNewEmployeeBank(\"\");\r\n        setNewEmployeePixKeyMain(\"\");\r\n        setNewEmployeePixKey2(\"\");\r\n        setNewEmployeePixKey3(\"\");\r\n        fetchEmployees();\r\n      } else {\r\n        toast.error(\"Erro ao adicionar funcionário\");\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error adding employee:\", error);\r\n      toast.error(`Erro ao adicionar funcionário: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const openEditDialog = (employee: Employee) => {\r\n    setEmployeeToEdit(employee);\r\n    setEditEmployeeName(employee.name);\r\n    setEditEmployeeBank(employee.bank || \"\");\r\n    setEditEmployeePixKeyMain(employee.pix_key_main || \"\");\r\n    setEditEmployeePixKey2(employee.pix_key_2 || \"\");\r\n    setEditEmployeePixKey3(employee.pix_key_3 || \"\");\r\n    setEditDialogOpen(true);\r\n  };\r\n\r\n  const handleEditEmployee = async () => {\r\n    if (!employeeToEdit || !editEmployeeName.trim()) {\r\n      toast.error(\"O nome do funcionário não pode estar vazio\");\r\n      return;\r\n    }\r\n\r\n    // Verificar se já existe funcionário com o mesmo nome (case insensitive), exceto o próprio\r\n    const nomeExiste = employees.some(emp => emp.name.trim().toLowerCase() === editEmployeeName.trim().toLowerCase() && emp.id !== employeeToEdit.id && emp.active);\r\n    if (nomeExiste) {\r\n      toast.error(\"Já existe um funcionário com esse nome. Escolha um nome diferente.\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const success = await updateEmployee(\r\n        employeeToEdit.id,\r\n        editEmployeeName,\r\n        editEmployeeName, // Using name as full_name\r\n        editEmployeeBank,\r\n        editEmployeePixKeyMain,\r\n        editEmployeePixKey2,\r\n        editEmployeePixKey3\r\n      );\r\n\r\n      if (success) {\r\n        toast.success(`Funcionário ${editEmployeeName} atualizado com sucesso`);\r\n        setEditDialogOpen(false);\r\n        setEmployeeToEdit(null);\r\n        fetchEmployees();\r\n      } else {\r\n        toast.error(\"Erro ao atualizar funcionário\");\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error updating employee:\", error);\r\n      toast.error(`Erro ao atualizar funcionário: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const confirmDeleteEmployee = (employee: Employee) => {\r\n    setEmployeeToDelete(employee);\r\n    setDialogOpen(true);\r\n  };\r\n\r\n  const handleDeleteEmployee = async () => {\r\n    if (!employeeToDelete) return;\r\n    \r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    executeDeleteEmployee();\r\n  };\r\n\r\n  const executeDeleteEmployee = async () => {\r\n    if (!employeeToDelete) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n\r\n      const success = await deleteEmployee(employeeToDelete.id);\r\n\r\n      if (success) {\r\n        toast.success(`Funcionário ${employeeToDelete.name} removido com sucesso`);\r\n        setDialogOpen(false);\r\n        setEmployeeToDelete(null);\r\n        fetchEmployees();\r\n      } else {\r\n        toast.error(\"Erro ao remover funcionário\");\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Error removing employee:\", error);\r\n      toast.error(`Erro ao remover funcionário: ${error.message}`);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <SidebarProvider>\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 w-full flex\">\r\n        <AppSidebar />\r\n        <div className=\"flex-1 w-full overflow-hidden min-w-0\">\r\n          <Header />\r\n          <main className=\"w-full h-full\">\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* Header moderno customizado */}\r\n              <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n        <div className=\"p-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z\" />\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold\">Gerenciamento de Funcionários</h1>\r\n                <p className=\"text-blue-100 text-lg mt-1\">Cadastre e gerencie sua equipe de vendas</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"hidden md:flex items-center space-x-4\">\r\n              <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                <div className=\"text-sm text-blue-100\">Total de Funcionários</div>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {employees.length}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-8\">\r\n        <div className=\"bg-card p-6 rounded-lg border shadow-sm\">\r\n          <h2 className=\"text-lg font-semibold mb-4\">Adicionar Novo Funcionário</h2>\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n            <div>\r\n              <Label htmlFor=\"name\">Nome *</Label>\r\n              <Input\r\n                id=\"name\"\r\n                type=\"text\"\r\n                placeholder=\"Nome do funcionário\"\r\n                value={newEmployeeName}\r\n                onChange={(e) => setNewEmployeeName(e.target.value)}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"bank\">Banco</Label>\r\n              <Input\r\n                id=\"bank\"\r\n                type=\"text\"\r\n                placeholder=\"Nome do banco\"\r\n                value={newEmployeeBank}\r\n                onChange={(e) => setNewEmployeeBank(e.target.value)}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"pixMain\">Chave PIX Principal</Label>\r\n              <Input\r\n                id=\"pixMain\"\r\n                type=\"text\"\r\n                placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                value={newEmployeePixKeyMain}\r\n                onChange={(e) => setNewEmployeePixKeyMain(e.target.value)}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"pix2\">Chave PIX 2 (opcional)</Label>\r\n              <Input\r\n                id=\"pix2\"\r\n                type=\"text\"\r\n                placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                value={newEmployeePixKey2}\r\n                onChange={(e) => setNewEmployeePixKey2(e.target.value)}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n            <div>\r\n              <Label htmlFor=\"pix3\">Chave PIX 3 (opcional)</Label>\r\n              <Input\r\n                id=\"pix3\"\r\n                type=\"text\"\r\n                placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                value={newEmployeePixKey3}\r\n                onChange={(e) => setNewEmployeePixKey3(e.target.value)}\r\n                disabled={loading}\r\n              />\r\n            </div>\r\n            <div className=\"md:col-span-2\">\r\n              <Button \r\n                onClick={handleAddEmployee} \r\n                disabled={loading || !newEmployeeName.trim()}\r\n                className=\"w-full\"\r\n              >\r\n                {loading ? \"Adicionando...\" : \"Adicionar Funcionário\"}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {loading && <div className=\"text-center py-4\">Carregando...</div>}\r\n\r\n        {!loading && employees.length === 0 ? (\r\n          <div className=\"bg-muted/50 p-8 text-center rounded-md\">\r\n            <h3 className=\"font-medium text-lg mb-2\">Nenhum funcionário cadastrado</h3>\r\n            <p className=\"text-muted-foreground\">\r\n              Adicione funcionários para atribuí-los a leads e comissões\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <Table>\r\n            <TableCaption>Lista de funcionários cadastrados</TableCaption>\r\n            <TableHeader>\r\n              <TableRow>\r\n                <TableHead>Nome</TableHead>\r\n                <TableHead>Banco</TableHead>\r\n                <TableHead>Chave PIX Principal</TableHead>\r\n                <TableHead>Chave PIX 2</TableHead>\r\n                <TableHead>Chave PIX 3</TableHead>\r\n                <TableHead>Data de Criação</TableHead>\r\n                <TableHead className=\"w-[150px] text-right\">Ações</TableHead>\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {employees.map((employee) => (\r\n                <TableRow key={employee.id}>\r\n                  <TableCell className=\"font-medium\">{employee.name}</TableCell>\r\n                  <TableCell>{getBankName(employee.bank) || \"-\"}</TableCell>\r\n                  <TableCell>{employee.pix_key_main || \"-\"}</TableCell>\r\n                  <TableCell>{employee.pix_key_2 || \"-\"}</TableCell>\r\n                  <TableCell>{employee.pix_key_3 || \"-\"}</TableCell>\r\n                  <TableCell>{new Date(employee.created_at).toLocaleDateString()}</TableCell>\r\n                  <TableCell className=\"text-right\">\r\n                    <div className=\"flex gap-2 justify-end\">\r\n                      <Button \r\n                        variant=\"outline\" \r\n                        size=\"sm\" \r\n                        onClick={() => openEditDialog(employee)}\r\n                        disabled={loading}\r\n                      >\r\n                        <Edit className=\"h-4 w-4\" />\r\n                      </Button>\r\n                      <Button \r\n                        variant=\"destructive\" \r\n                        size=\"sm\" \r\n                        onClick={() => confirmDeleteEmployee(employee)}\r\n                        disabled={loading}\r\n                      >\r\n                        Remover\r\n                      </Button>\r\n                    </div>\r\n                  </TableCell>\r\n                </TableRow>\r\n              ))}\r\n            </TableBody>\r\n          </Table>\r\n        )}\r\n\r\n        {/* Delete Dialog */}\r\n        <Dialog open={dialogOpen} onOpenChange={setDialogOpen}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle>Confirmar exclusão</DialogTitle>\r\n              <DialogDescription>\r\n                Tem certeza que deseja remover o funcionário \"{employeeToDelete?.name}\"? Esta ação não pode ser desfeita.\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter className=\"flex flex-col sm:flex-row sm:justify-end gap-2\">\r\n              <DialogClose asChild>\r\n                <Button variant=\"outline\">Cancelar</Button>\r\n              </DialogClose>\r\n              <Button \r\n                variant=\"destructive\" \r\n                onClick={handleDeleteEmployee}\r\n                disabled={loading}\r\n              >\r\n                {loading ? \"Removendo...\" : \"Confirmar exclusão\"}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n\r\n        {/* Edit Dialog */}\r\n        <Dialog open={editDialogOpen} onOpenChange={setEditDialogOpen}>\r\n          <DialogContent className=\"max-w-2xl\">\r\n            <DialogHeader>\r\n              <DialogTitle>Editar Funcionário</DialogTitle>\r\n              <DialogDescription>\r\n                Atualize os dados do funcionário \"{employeeToEdit?.name}\".\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 py-4\">\r\n              <div>\r\n                <Label htmlFor=\"editName\">Nome *</Label>\r\n                <Input\r\n                  id=\"editName\"\r\n                  type=\"text\"\r\n                  placeholder=\"Nome do funcionário\"\r\n                  value={editEmployeeName}\r\n                  onChange={(e) => setEditEmployeeName(e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label htmlFor=\"editBank\">Banco</Label>\r\n                <Input\r\n                  id=\"editBank\"\r\n                  type=\"text\"\r\n                  placeholder=\"Nome do banco\"\r\n                  value={editEmployeeBank}\r\n                  onChange={(e) => setEditEmployeeBank(e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label htmlFor=\"editPixMain\">Chave PIX Principal</Label>\r\n                <Input\r\n                  id=\"editPixMain\"\r\n                  type=\"text\"\r\n                  placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                  value={editEmployeePixKeyMain}\r\n                  onChange={(e) => setEditEmployeePixKeyMain(e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              <div>\r\n                <Label htmlFor=\"editPix2\">Chave PIX 2 (opcional)</Label>\r\n                <Input\r\n                  id=\"editPix2\"\r\n                  type=\"text\"\r\n                  placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                  value={editEmployeePixKey2}\r\n                  onChange={(e) => setEditEmployeePixKey2(e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              <div className=\"md:col-span-2\">\r\n                <Label htmlFor=\"editPix3\">Chave PIX 3 (opcional)</Label>\r\n                <Input\r\n                  id=\"editPix3\"\r\n                  type=\"text\"\r\n                  placeholder=\"CPF, e-mail, telefone ou chave aleatória\"\r\n                  value={editEmployeePixKey3}\r\n                  onChange={(e) => setEditEmployeePixKey3(e.target.value)}\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n            </div>\r\n            <DialogFooter className=\"flex flex-col sm:flex-row sm:justify-end gap-2\">\r\n              <DialogClose asChild>\r\n                <Button variant=\"outline\">Cancelar</Button>\r\n              </DialogClose>\r\n              <Button \r\n                onClick={handleEditEmployee}\r\n                disabled={loading || !editEmployeeName.trim()}\r\n              >\r\n                {loading ? \"Atualizando...\" : \"Salvar alterações\"}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Dialog de confirmação com senha administrativa */}\r\n      <AdminPasswordDialog\r\n        open={showAdminPasswordDialog}\r\n        onOpenChange={setShowAdminPasswordDialog}\r\n        onConfirm={executeDeleteEmployee}\r\n        title=\"Confirmar Exclusão de Funcionário\"\r\n        description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n        itemName={employeeToDelete?.name}\r\n      />\r\n    </SidebarProvider>\r\n  );\r\n};\r\n\r\nexport default Employees;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Index.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadImport.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadNew.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[580,583],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[580,583],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1691,1694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1691,1694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2068,2071],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2068,2071],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from \"react\";\r\nimport Header from \"@/components/Header\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport LeadForm from \"@/components/LeadForm\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nconst LeadNew = () => {\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const handleFormSubmit = async (values: any) => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { selectedTags, ...leadData } = values;\r\n\r\n      // Log para debug\r\n      console.log(\"Inserting lead data:\", leadData);\r\n      console.log(\"Payment period value:\", leadData.payment_period, typeof leadData.payment_period);\r\n\r\n      const { data: leadInsertData, error: leadError } = await supabase\r\n        .from(\"leads\")\r\n        .insert({\r\n          ...leadData,\r\n          user_id: userData.user.id,\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (leadError) {\r\n        console.error(\"Database error:\", leadError);\r\n        throw leadError;\r\n      }\r\n\r\n      // Save tag assignments if any tags were selected\r\n      if (selectedTags && selectedTags.length > 0) {\r\n        const tagAssignments = selectedTags.map((tagId: string) => ({\r\n          lead_id: leadInsertData.id,\r\n          tag_id: tagId,\r\n          user_id: userData.user.id,\r\n        }));\r\n\r\n        const { error: tagError } = await (supabase as any)\r\n          .from('lead_tag_assignments')\r\n          .insert(tagAssignments);\r\n\r\n        if (tagError) {\r\n          console.error('Error saving tag assignments:', tagError);\r\n          toast.error('Lead salvo, mas erro ao aplicar etiquetas');\r\n        }\r\n      }\r\n      \r\n      toast.success(\"Lead cadastrado com sucesso!\");\r\n      navigate(\"/leads\");\r\n    } catch (error: any) {\r\n      console.error(\"Error creating lead:\", error);\r\n      toast.error(`Erro ao cadastrar lead: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <AppSidebar />\r\n      <div className=\"md:ml-64 transition-all duration-300\">\r\n        <Header />\r\n        <main className=\"container mx-auto space-y-6 p-4 py-8\">\r\n          <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between mb-6\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-gray-800 dark:text-gray-100\">Novo Lead</h1>\r\n              <p className=\"text-muted-foreground mt-1\">Cadastre um novo lead no sistema</p>\r\n            </div>\r\n          </div>\r\n\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Formulário de Cadastro</CardTitle>\r\n              <CardDescription>\r\n                Preencha os dados do novo lead abaixo. Campos marcados com * são obrigatórios.\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <LeadForm \r\n                onSubmit={handleFormSubmit} \r\n                onCancel={() => navigate(-1)}\r\n                isLoading={isLoading}\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LeadNew;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadScheduling.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3969,3972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3969,3972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterAppointments'. Either include it or remove the dependency array.","line":113,"column":6,"nodeType":"ArrayExpression","endLine":113,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [appointments, currentStatus, filterAppointments]","fix":{"range":[4274,4303],"text":"[appointments, currentStatus, filterAppointments]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":225,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":225,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7649,7652],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7649,7652],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":255,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":255,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8627,8630],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8627,8630],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":283,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":283,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9602,9605],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9602,9605],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":729,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":729,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27760,27763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27760,27763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format, parseISO } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { Calendar as CalendarIcon, Loader2, Plus, Trash2, Edit, Check, X, Clock, MapPin, AlertCircle, ChevronDown } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Lead, Appointment } from \"@/types/models\";\r\nimport {\r\n  Tabs,\r\n  TabsContent,\r\n  TabsList,\r\n  TabsTrigger,\r\n} from \"@/components/ui/tabs\";\r\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport Header from \"@/components/Header\";\r\nimport { CustomCalendar } from \"@/components/ui/custom-calendar\";\r\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\r\n\r\ntype AppointmentStatus = \"all\" | \"completed\" | \"overdue\" | \"pending\";\r\n\r\nconst LeadScheduling = () => {\r\n  const [appointments, setAppointments] = useState<Appointment[]>([]);\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [filteredAppointments, setFilteredAppointments] = useState<Appointment[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [editingAppointment, setEditingAppointment] = useState<Appointment | null>(null);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [currentStatus, setCurrentStatus] = useState<AppointmentStatus>(\"all\");\r\n\r\n  // Form state\r\n  const [title, setTitle] = useState(\"\");\r\n  const [leadId, setLeadId] = useState(\"\");\r\n  const [date, setDate] = useState<Date>();\r\n  const [currentMonth, setCurrentMonth] = useState(new Date());\r\n  const [time, setTime] = useState(\"\");\r\n  const [notes, setNotes] = useState(\"\");\r\n  const [status, setStatus] = useState<\"scheduled\" | \"completed\" | \"cancelled\">(\"scheduled\");\r\n\r\n  // Client search state\r\n  const [clientSearch, setClientSearch] = useState(\"\");\r\n  const [filteredLeads, setFilteredLeads] = useState<Lead[]>([]);\r\n\r\n  const fetchData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      // Fetch leads with cpf for the dropdown\r\n      const { data: leadsData, error: leadsError } = await supabase\r\n        .from(\"leads\")\r\n        .select(\"id, name, cpf\")\r\n        .order(\"name\");\r\n      \r\n      if (leadsError) throw leadsError;\r\n      \r\n      const leadsWithCpf = leadsData as Lead[];\r\n      setLeads(leadsWithCpf);\r\n      setFilteredLeads(leadsWithCpf);\r\n      \r\n      // Fetch appointments\r\n      const { data: appointmentsData, error: appointmentsError } = await supabase\r\n        .from(\"appointments\")\r\n        .select(\"*\")\r\n        .order(\"date\");\r\n        \r\n      if (appointmentsError) throw appointmentsError;\r\n      setAppointments(appointmentsData as Appointment[]);\r\n      setFilteredAppointments(appointmentsData as Appointment[]);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching data:\", error);\r\n      toast.error(`Erro ao carregar dados: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n  \r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    filterAppointments(currentStatus);\r\n  }, [appointments, currentStatus]);\r\n\r\n  // Update filtered leads when leads change\r\n  useEffect(() => {\r\n    setFilteredLeads(leads);\r\n  }, [leads]);\r\n\r\n  // Filter clients based on search\r\n  const handleClientSearch = (searchValue: string) => {\r\n    setClientSearch(searchValue);\r\n    if (!searchValue.trim()) {\r\n      setFilteredLeads(leads);\r\n      return;\r\n    }\r\n    \r\n    const filtered = leads.filter(lead => \r\n      lead.name.toLowerCase().includes(searchValue.toLowerCase()) ||\r\n      (lead.cpf && lead.cpf.includes(searchValue.replace(/\\D/g, '')))\r\n    );\r\n    setFilteredLeads(filtered);\r\n  };\r\n\r\n  // Format client display with name and CPF\r\n  const formatClientDisplay = (lead: Lead) => {\r\n    if (lead.cpf) {\r\n      const formattedCpf = lead.cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\r\n      return `${lead.name} - ${formattedCpf}`;\r\n    }\r\n    return lead.name;\r\n  };\r\n\r\n  const filterAppointments = (status: AppointmentStatus) => {\r\n    setCurrentStatus(status);\r\n    \r\n    if (status === \"all\") {\r\n      setFilteredAppointments(appointments);\r\n      return;\r\n    }\r\n    \r\n    const now = new Date();\r\n    // Remover os segundos e milissegundos para comparação mais precisa\r\n    now.setSeconds(0, 0);\r\n    \r\n    const filtered = appointments.filter(appointment => {\r\n      const appointmentDate = new Date(`${appointment.date} ${appointment.time}`);\r\n      appointmentDate.setSeconds(0, 0);\r\n      \r\n      if (status === \"completed\") {\r\n        return appointment.status === \"completed\";\r\n      } else if (status === \"overdue\") {\r\n        return appointment.status === \"scheduled\" && appointmentDate < now;\r\n      } else if (status === \"pending\") {\r\n        return appointment.status === \"scheduled\" && appointmentDate >= now;\r\n      }\r\n      \r\n      return false;\r\n    });\r\n    \r\n    setFilteredAppointments(filtered);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!title || !leadId || !date || !time) {\r\n      toast.error(\"Preencha todos os campos obrigatórios\");\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) throw new Error(\"Usuário não autenticado\");\r\n      \r\n      const formattedDate = format(date, \"yyyy-MM-dd\");\r\n      \r\n      if (editingAppointment) {\r\n        // Update existing appointment\r\n        const { error } = await supabase\r\n          .from(\"appointments\")\r\n          .update({\r\n            title,\r\n            lead_id: leadId,\r\n            date: formattedDate,\r\n            time,\r\n            notes,\r\n            status,\r\n            updated_at: new Date().toISOString()\r\n          })\r\n          .eq(\"id\", editingAppointment.id);\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Agendamento atualizado com sucesso!\");\r\n      } else {\r\n        // Create new appointment\r\n        const { error } = await supabase\r\n          .from(\"appointments\")\r\n          .insert({\r\n            title,\r\n            lead_id: leadId,\r\n            date: formattedDate,\r\n            time,\r\n            notes,\r\n            status,\r\n            user_id: userData.user.id\r\n          });\r\n          \r\n        if (error) throw error;\r\n        toast.success(\"Agendamento criado com sucesso!\");\r\n      }\r\n      \r\n      setIsDialogOpen(false);\r\n      resetForm();\r\n      await fetchData();\r\n    } catch (error: any) {\r\n      console.error(\"Error submitting appointment:\", error);\r\n      toast.error(`Erro ao ${editingAppointment ? \"atualizar\" : \"criar\"} agendamento: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleEditAppointment = (appointment: Appointment) => {\r\n    setEditingAppointment(appointment);\r\n    setTitle(appointment.title);\r\n    setLeadId(appointment.lead_id);\r\n    setDate(new Date(appointment.date));\r\n    setTime(appointment.time);\r\n    setNotes(appointment.notes || \"\");\r\n    setStatus(appointment.status);\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const handleDeleteAppointment = async (id: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"appointments\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n        \r\n      if (error) throw error;\r\n      \r\n      setAppointments(appointments.filter(a => a.id !== id));\r\n      toast.success(\"Agendamento excluído com sucesso!\");\r\n    } catch (error: any) {\r\n      console.error(\"Error deleting appointment:\", error);\r\n      toast.error(`Erro ao excluir agendamento: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleStatusChange = async (appointment: Appointment, newStatus: \"scheduled\" | \"completed\" | \"cancelled\") => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"appointments\")\r\n        .update({ \r\n          status: newStatus,\r\n          updated_at: new Date().toISOString()\r\n        })\r\n        .eq(\"id\", appointment.id);\r\n        \r\n      if (error) throw error;\r\n      \r\n      // Atualizar o estado local\r\n      const updatedAppointments = appointments.map(a => \r\n        a.id === appointment.id ? { ...a, status: newStatus } : a\r\n      );\r\n      setAppointments(updatedAppointments);\r\n      \r\n      // Recarregar os dados para garantir que tudo esteja sincronizado\r\n      await fetchData();\r\n      \r\n      toast.success(`Status atualizado para ${getStatusText(newStatus)}`);\r\n    } catch (error: any) {\r\n      console.error(\"Error updating status:\", error);\r\n      toast.error(`Erro ao atualizar status: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setTitle(\"\");\r\n    setLeadId(\"\");\r\n    setDate(new Date());\r\n    setTime(\"09:00\");\r\n    setNotes(\"\");\r\n    setStatus(\"scheduled\");\r\n    setEditingAppointment(null);\r\n  };\r\n\r\n  const getLeadName = (id: string) => {\r\n    const lead = leads.find(l => l.id === id);\r\n    return lead ? lead.name : \"Cliente não encontrado\";\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return format(new Date(dateString), \"PPP\", { locale: ptBR });\r\n  };\r\n\r\n  const getStatusText = (status: string) => {\r\n    switch (status) {\r\n      case \"scheduled\": return \"Agendado\";\r\n      case \"completed\": return \"Concluído\";\r\n      case \"cancelled\": return \"Cancelado\";\r\n      default: return status;\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"scheduled\": return \"bg-blue-100 text-blue-800\";\r\n      case \"completed\": return \"bg-green-100 text-green-800\";\r\n      case \"cancelled\": return \"bg-red-100 text-red-800\";\r\n      default: return \"bg-gray-100 text-gray-800\";\r\n    }\r\n  };\r\n\r\n  const openNewAppointmentDialog = () => {\r\n    resetForm();\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const closeDialog = () => {\r\n    setIsDialogOpen(false);\r\n    resetForm();\r\n  };\r\n\r\n  const isPastDue = (dateString: string, timeString: string, appointmentStatus: string) => {\r\n    if (appointmentStatus !== \"scheduled\") return false;\r\n    const appointmentDate = new Date(`${dateString} ${timeString}`);\r\n    const now = new Date();\r\n    // Remover os segundos e milissegundos para comparação mais precisa\r\n    appointmentDate.setSeconds(0, 0);\r\n    now.setSeconds(0, 0);\r\n    return appointmentDate < now;\r\n  };\r\n\r\n  const getAppointmentStatusBadge = (appointment: Appointment) => {\r\n    if (appointment.status === \"completed\") {\r\n      return <Badge className=\"bg-green-100 text-green-800 hover:bg-green-200 px-3 py-1 text-sm\">Concluído</Badge>;\r\n    } else if (appointment.status === \"cancelled\") {\r\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-200 px-3 py-1 text-sm\">Cancelado</Badge>;\r\n    } else if (isPastDue(appointment.date, appointment.time, appointment.status)) {\r\n      return <Badge className=\"bg-red-100 text-red-800 hover:bg-red-200 px-3 py-1 text-sm\">Atrasado</Badge>;\r\n    } else {\r\n      return <Badge className=\"bg-blue-100 text-blue-800 hover:bg-blue-200 px-3 py-1 text-sm\">Pendente</Badge>;\r\n    }\r\n  };\r\n\r\n  const renderAppointmentCard = (appointment: Appointment) => (\r\n    <Card key={appointment.id}>\r\n      <CardHeader className=\"relative\">\r\n        <div className=\"absolute right-6 top-6\">\r\n          {getAppointmentStatusBadge(appointment)}\r\n        </div>\r\n        <CardTitle className=\"text-lg font-semibold mb-3\">{appointment.title}</CardTitle>\r\n        <div className=\"space-y-2\">\r\n          <div className=\"flex items-center gap-2 text-base\">\r\n            <span className=\"font-medium text-gray-700\">Cliente:</span>\r\n            <span className=\"text-xl font-bold text-gray-900\">{getLeadName(appointment.lead_id)}</span>\r\n          </div>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        <div className=\"space-y-4\">\r\n          <div className=\"flex items-center space-x-2 text-sm\">\r\n            <CalendarIcon className=\"h-4 w-4\" />\r\n            <span>{formatDate(appointment.date)}</span>\r\n            <Clock className=\"h-4 w-4 ml-2\" />\r\n            <span>{appointment.time}</span>\r\n          </div>\r\n          \r\n          {appointment.notes && (\r\n            <div className=\"text-sm text-muted-foreground\">\r\n              {appointment.notes}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex items-center space-x-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => handleEditAppointment(appointment)}\r\n            >\r\n              <Edit className=\"h-4 w-4 mr-1\" />\r\n              Editar\r\n            </Button>\r\n            \r\n            {appointment.status !== \"completed\" && (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => handleStatusChange(appointment, \"completed\")}\r\n              >\r\n                <Check className=\"h-4 w-4 mr-1\" />\r\n                Concluir\r\n              </Button>\r\n            )}\r\n            \r\n            <AlertDialog>\r\n              <AlertDialogTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  className=\"text-destructive\"\r\n                >\r\n                  <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                  Excluir\r\n                </Button>\r\n              </AlertDialogTrigger>\r\n              <AlertDialogContent>\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle>Tem certeza?</AlertDialogTitle>\r\n                  <AlertDialogDescription>\r\n                    Esta ação não pode ser desfeita. Isso excluirá permanentemente o agendamento \"{appointment.title}\".\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                  <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                  <AlertDialogAction \r\n                    onClick={() => handleDeleteAppointment(appointment.id)}\r\n                    className=\"bg-red-600 hover:bg-red-700\"\r\n                  >\r\n                    Sim, excluir\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n\r\n  return (\r\n    <SidebarProvider>\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 w-full flex\">\r\n        <AppSidebar />\r\n        <div className=\"flex-1 w-full overflow-hidden min-w-0\">\r\n          <Header />\r\n          <main className=\"w-full h-full\">\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* Header moderno customizado */}\r\n              <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n        <div className=\"p-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold\">Agendamentos</h1>\r\n                <p className=\"text-blue-100 text-lg mt-1\">Gerencie seus agendamentos com clientes</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"hidden md:flex items-center space-x-4\">\r\n              <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                <div className=\"text-sm text-blue-100\">Total de Agendamentos</div>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {appointments.length}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n        </div>\r\n      </div>\r\n\r\n      {/* Botões fora do header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          <Button onClick={openNewAppointmentDialog} className=\"bg-blue-600 hover:bg-blue-700 text-white\">\r\n            <Plus className=\"mr-2 h-4 w-4\" />\r\n            Novo Agendamento\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex flex-col gap-8\">\r\n\r\n        <Tabs defaultValue=\"all\" className=\"w-full\" onValueChange={(value) => filterAppointments(value as AppointmentStatus)}>\r\n          <TabsList className=\"grid w-full grid-cols-4 md:w-auto\">\r\n            <TabsTrigger value=\"all\">Todos</TabsTrigger>\r\n            <TabsTrigger value=\"pending\">Pendentes</TabsTrigger>\r\n            <TabsTrigger value=\"completed\">Concluídos</TabsTrigger>\r\n            <TabsTrigger value=\"overdue\">Atrasados</TabsTrigger>\r\n          </TabsList>\r\n\r\n          <TabsContent value=\"all\" className=\"mt-4\">\r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2\">\r\n              {isLoading ? (\r\n                <div className=\"col-span-full flex justify-center\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : filteredAppointments.length === 0 ? (\r\n                <div className=\"col-span-full\">\r\n                  <Card>\r\n                    <CardHeader>\r\n                      <CardTitle>Nenhum agendamento encontrado</CardTitle>\r\n                      <CardDescription>\r\n                        Clique no botão \"Novo Agendamento\" para criar um agendamento\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                  </Card>\r\n                </div>\r\n              ) : (\r\n                                filteredAppointments.map(renderAppointmentCard)\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"pending\" className=\"mt-4\">\r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2\">\r\n              {isLoading ? (\r\n                <div className=\"col-span-full flex justify-center\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : filteredAppointments.length === 0 ? (\r\n                <div className=\"col-span-full\">\r\n                  <Card>\r\n                    <CardHeader>\r\n                      <CardTitle>Nenhum agendamento pendente</CardTitle>\r\n                      <CardDescription>\r\n                        Todos os agendamentos estão em dia\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                  </Card>\r\n                </div>\r\n              ) : (\r\n                filteredAppointments.map(renderAppointmentCard)\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"completed\" className=\"mt-4\">\r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2\">\r\n              {isLoading ? (\r\n                <div className=\"col-span-full flex justify-center\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : filteredAppointments.length === 0 ? (\r\n                <div className=\"col-span-full\">\r\n                  <Card>\r\n                    <CardHeader>\r\n                      <CardTitle>Nenhum agendamento concluído</CardTitle>\r\n                      <CardDescription>\r\n                        Não há agendamentos concluídos\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                  </Card>\r\n                </div>\r\n              ) : (\r\n                filteredAppointments.map(renderAppointmentCard)\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"overdue\" className=\"mt-4\">\r\n            <div className=\"grid gap-4 grid-cols-1 md:grid-cols-2\">\r\n              {isLoading ? (\r\n                <div className=\"col-span-full flex justify-center\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : filteredAppointments.length === 0 ? (\r\n                <div className=\"col-span-full\">\r\n                  <Card>\r\n                    <CardHeader>\r\n                      <CardTitle>Nenhum agendamento atrasado</CardTitle>\r\n                      <CardDescription>\r\n                        Todos os agendamentos estão em dia\r\n                      </CardDescription>\r\n                    </CardHeader>\r\n                  </Card>\r\n                </div>\r\n              ) : (\r\n                filteredAppointments.map(renderAppointmentCard)\r\n              )}\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n\r\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n          <DialogContent className=\"sm:max-w-[425px]\">\r\n            <DialogHeader>\r\n              <DialogTitle>\r\n                {editingAppointment ? \"Editar Agendamento\" : \"Novo Agendamento\"}\r\n              </DialogTitle>\r\n              <DialogDescription>\r\n                Preencha os dados do agendamento abaixo\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n\r\n            <div className=\"grid gap-4 py-4\">\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"title\">Título</Label>\r\n                <Input\r\n                  id=\"title\"\r\n                  value={title}\r\n                  onChange={(e) => setTitle(e.target.value)}\r\n                  placeholder=\"Ex: Visita ao cliente\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"lead\">Cliente</Label>\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      role=\"combobox\"\r\n                      className={cn(\r\n                        \"w-full justify-between text-left font-normal\",\r\n                        !leadId ? \"text-muted-foreground\" : \"\"\r\n                      )}\r\n                    >\r\n                      {leadId \r\n                        ? (() => {\r\n                            const selectedLead = leads.find(lead => lead.id === leadId);\r\n                            return selectedLead ? formatClientDisplay(selectedLead) : \"Cliente não encontrado\";\r\n                          })()\r\n                        : \"Selecione um cliente\"\r\n                      }\r\n                      <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-full p-0\" align=\"start\">\r\n                    <Command>\r\n                      <CommandInput \r\n                        placeholder=\"Buscar por nome ou CPF...\" \r\n                        value={clientSearch}\r\n                        onValueChange={handleClientSearch}\r\n                      />\r\n                      <CommandList>\r\n                        <CommandEmpty>Nenhum cliente encontrado.</CommandEmpty>\r\n                        <CommandGroup>\r\n                          {filteredLeads.map((lead) => (\r\n                            <CommandItem\r\n                              key={lead.id}\r\n                              value={formatClientDisplay(lead)}\r\n                              onSelect={() => {\r\n                                setLeadId(lead.id);\r\n                                setClientSearch(\"\");\r\n                              }}\r\n                            >\r\n                              <Check\r\n                                className={cn(\r\n                                  \"mr-2 h-4 w-4\",\r\n                                  leadId === lead.id ? \"opacity-100\" : \"opacity-0\"\r\n                                )}\r\n                              />\r\n                              <div className=\"flex flex-col\">\r\n                                <span className=\"font-medium\">{lead.name}</span>\r\n                                {lead.cpf && (\r\n                                  <span className=\"text-sm text-gray-500\">\r\n                                    CPF: {lead.cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4')}\r\n                                  </span>\r\n                                )}\r\n                              </div>\r\n                            </CommandItem>\r\n                          ))}\r\n                        </CommandGroup>\r\n                      </CommandList>\r\n                    </Command>\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n\r\n              <div className=\"grid gap-2\">\r\n                <Label>Data</Label>\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className={cn(\r\n                        \"justify-start text-left font-normal\",\r\n                        !date && \"text-muted-foreground\"\r\n                      )}\r\n                    >\r\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                      {date ? format(date, \"PPP\", { locale: ptBR }) : \"Selecione uma data\"}\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-auto p-0\">\r\n                    <CustomCalendar\r\n                      selected={date}\r\n                      onSelect={setDate}\r\n                      currentMonth={currentMonth}\r\n                      onMonthChange={setCurrentMonth}\r\n                      size=\"sm\"\r\n                      className=\"p-4\"\r\n                    />\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"time\">Horário</Label>\r\n                <Input\r\n                  id=\"time\"\r\n                  type=\"time\"\r\n                  value={time}\r\n                  onChange={(e) => setTime(e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid gap-2\">\r\n                <Label htmlFor=\"notes\">Observações</Label>\r\n                <Textarea\r\n                  id=\"notes\"\r\n                  value={notes}\r\n                  onChange={(e) => setNotes(e.target.value)}\r\n                  placeholder=\"Adicione observações sobre o agendamento\"\r\n                />\r\n              </div>\r\n\r\n              {editingAppointment && (\r\n                <div className=\"grid gap-2\">\r\n                  <Label htmlFor=\"status\">Status</Label>\r\n                  <Select value={status} onValueChange={(value: any) => setStatus(value)}>\r\n                    <SelectTrigger>\r\n                      <SelectValue />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"scheduled\">Agendado</SelectItem>\r\n                      <SelectItem value=\"completed\">Concluído</SelectItem>\r\n                      <SelectItem value=\"cancelled\">Cancelado</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <DialogFooter>\r\n              <Button variant=\"outline\" onClick={closeDialog}>\r\n                Cancelar\r\n              </Button>\r\n              <Button onClick={handleSubmit} disabled={isSubmitting}>\r\n                {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                {editingAppointment ? \"Salvar\" : \"Criar\"}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </SidebarProvider>\r\n  );\r\n};\r\n\r\nexport default LeadScheduling;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Leads.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadsConfig.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8855,8858],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8855,8858],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":206,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":206,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10066,10069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10066,10069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10208,10211],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10208,10211],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14460,14463],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14460,14463],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":360,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":360,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15590,15593],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15590,15593],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":523,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":523,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21770,21773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21770,21773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Plus, Trash2, Edit, Save, X } from \"lucide-react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\n\r\n// Default data from other components\r\nconst DEFAULT_BANKS = [\r\n  { code: \"001\", name: \"Banco do Brasil\" },\r\n  { code: \"003\", name: \"Banco da Amazônia\" },\r\n  { code: \"004\", name: \"Banco do Nordeste\" },\r\n  { code: \"021\", name: \"Banestes (Banco do Estado do Espírito Santo)\" },\r\n  { code: \"025\", name: \"Banco Alfa\" },\r\n  { code: \"033\", name: \"Santander\" },\r\n  { code: \"041\", name: \"Banrisul\" },\r\n  { code: \"070\", name: \"BRB (Banco de Brasília)\" },\r\n  { code: \"077\", name: \"Banco Inter\" },\r\n  { code: \"104\", name: \"Caixa Econômica Federal\" },\r\n  { code: \"121\", name: \"Agibank\" },\r\n  { code: \"212\", name: \"Banco Original\" },\r\n  { code: \"237\", name: \"Bradesco\" },\r\n  { code: \"318\", name: \"Banco BMG\" },\r\n  { code: \"320\", name: \"CCB Brasil (China Construction Bank)\" },\r\n  { code: \"336\", name: \"C6 Bank\" },\r\n  { code: \"341\", name: \"Itaú Unibanco\" },\r\n  { code: \"371\", name: \"Banco Bari\" },\r\n  { code: \"389\", name: \"Banco Mercantil do Brasil\" },\r\n  { code: \"422\", name: \"Banco Safra\" },\r\n  { code: \"604\", name: \"Banco Industrial\" },\r\n  { code: \"623\", name: \"Banco PAN\" },\r\n  { code: \"640\", name: \"Banco Inbursa\" },\r\n  { code: \"654\", name: \"Banco A.J. Renner (Parati Financeira)\" },\r\n  { code: \"655\", name: \"Banco Votorantim (BV Financeira)\" },\r\n  { code: \"707\", name: \"Banco Daycoval\" },\r\n  { code: \"739\", name: \"Cetelem (BNP Paribas)\" },\r\n  { code: \"743\", name: \"Banco Semear\" },\r\n  { code: \"777\", name: \"Banco JP Morgan (atua em nichos)\" }\r\n];\r\n\r\n// DEFAULT_PRODUCTS removidos - funcionalidade de produtos desabilitada\r\n\r\nconst DEFAULT_BENEFIT_TYPES = [\r\n  { code: \"01\", description: \"Pensão por morte – trabalhador rural\" },\r\n  { code: \"02\", description: \"Pensão por morte acidentária\" },\r\n  { code: \"03\", description: \"Pensão por morte – empregador rural\" },\r\n  { code: \"04\", description: \"Aposentadoria por invalidez – trabalhador rural\" },\r\n  { code: \"05\", description: \"Aposentadoria por invalidez acidentária – trabalhador rural\" },\r\n  { code: \"06\", description: \"Aposentadoria por invalidez – empregador rural\" },\r\n  { code: \"07\", description: \"Aposentadoria por velhice – trabalhador rural\" },\r\n  { code: \"08\", description: \"Aposentadoria por idade – empregador rural\" },\r\n  { code: \"11\", description: \"Amparo previdenciário por invalidez – trabalhador rural\" },\r\n  { code: \"12\", description: \"Amparo previdenciário por idade – trabalhador rural\" },\r\n  { code: \"18\", description: \"Auxílio-inclusão\" },\r\n  { code: \"19\", description: \"Pensão de estudante\" },\r\n  { code: \"20\", description: \"Pensão por morte de ex-diplomata\" },\r\n  { code: \"21\", description: \"Pensão por morte previdenciária\" },\r\n  { code: \"22\", description: \"Pensão por morte estatutária\" },\r\n  { code: \"23\", description: \"Pensão por morte de ex-combatente\" },\r\n  { code: \"24\", description: \"Pensão especial – ato institucional\" },\r\n  { code: \"26\", description: \"Pensão por morte especial\" },\r\n  { code: \"27\", description: \"Pensão por morte de servidor público federal\" },\r\n  { code: \"28\", description: \"Pensão por morte – Regime Geral\" },\r\n  { code: \"29\", description: \"Pensão por morte de ex-combatente marítimo\" },\r\n  { code: \"30\", description: \"Renda mensal vitalícia por incapacidade\" },\r\n  { code: \"32\", description: \"Aposentadoria por invalidez previdenciária\" },\r\n  { code: \"33\", description: \"Aposentadoria por invalidez de aeronauta\" },\r\n  { code: \"34\", description: \"Aposentadoria por invalidez de ex-combatente marítimo\" },\r\n  { code: \"37\", description: \"Aposentadoria de extranumerário da CAPIN\" },\r\n  { code: \"38\", description: \"Aposentadoria de extranumerário – funcionários públicos\" },\r\n  { code: \"40\", description: \"Renda mensal vitalícia por idade\" },\r\n  { code: \"41\", description: \"Aposentadoria por idade\" },\r\n  { code: \"42\", description: \"Aposentadoria por tempo de contribuição\" },\r\n  { code: \"43\", description: \"Aposentadoria por tempo de contribuição de ex-combatente\" },\r\n  { code: \"44\", description: \"Aposentadoria especial de aeronauta\" },\r\n  { code: \"45\", description: \"Aposentadoria por tempo de serviço – jornalista\" },\r\n  { code: \"46\", description: \"Aposentadoria especial\" },\r\n  { code: \"49\", description: \"Aposentadoria ordinária\" },\r\n  { code: \"51\", description: \"Aposentadoria por invalidez – extinto plano básico\" },\r\n  { code: \"52\", description: \"Aposentadoria por idade – extinto plano básico\" },\r\n  { code: \"54\", description: \"Pensão indenizatória a cargo da União\" },\r\n  { code: \"55\", description: \"Pensão por morte – extinto plano básico\" },\r\n  { code: \"56\", description: \"Pensão mensal vitalícia – síndrome da talidomida\" },\r\n  { code: \"57\", description: \"Aposentadoria por tempo de serviço de professores\" },\r\n  { code: \"58\", description: \"Aposentadoria de anistiados\" },\r\n  { code: \"59\", description: \"Pensão por morte de anistiados\" },\r\n  { code: \"60\", description: \"Benefício indenizatório a cargo da União\" },\r\n  { code: \"72\", description: \"Aposentadoria por tempo de serviço\" },\r\n  { code: \"78\", description: \"Aposentadoria por idade (ex-combatente marítimo)\" },\r\n  { code: \"81\", description: \"Aposentadoria compulsória (ex‑SASSE)\" },\r\n  { code: \"82\", description: \"Aposentadoria por tempo de serviço (ex‑SASSE)\" },\r\n  { code: \"83\", description: \"Aposentadoria por invalidez (ex‑SASSE)\" },\r\n  { code: \"84\", description: \"Pensão por morte (ex‑SASSE)\" },\r\n  { code: \"87\", description: \"Amparo assistencial à pessoa com deficiência\" },\r\n  { code: \"88\", description: \"Amparo assistencial à pessoa idosa\" },\r\n  { code: \"89\", description: \"Pensão especial – vítimas de hemodiálise\" },\r\n  { code: \"92\", description: \"Aposentadoria por invalidez por acidente de trabalho\" },\r\n  { code: \"93\", description: \"Pensão por morte por acidente de trabalho\" },\r\n  { code: \"96\", description: \"Pensão especial – hanseníase\" }\r\n];\r\n\r\ninterface Bank {\r\n  id: string;\r\n  name: string;\r\n  code: string;\r\n}\r\n\r\ninterface Product {\r\n  id: string;\r\n  name: string;\r\n  code: string;\r\n}\r\n\r\ninterface BenefitType {\r\n  id: number;\r\n  description: string;\r\n  code: string;\r\n}\r\n\r\n// 1. Funções utilitárias para persistência\r\nfunction getRemovedIds(key: string): string[] {\r\n  return JSON.parse(localStorage.getItem(key) || '[]');\r\n}\r\nfunction setRemovedIds(key: string, ids: string[]) {\r\n  localStorage.setItem(key, JSON.stringify(ids));\r\n}\r\nfunction getEditedItems<T>(key: string): T[] {\r\n  return JSON.parse(localStorage.getItem(key) || '[]');\r\n}\r\nfunction setEditedItems<T>(key: string, items: T[]) {\r\n  localStorage.setItem(key, JSON.stringify(items));\r\n}\r\n\r\nconst LeadsConfig = () => {\r\n  const [banks, setBanks] = useState<Bank[]>([]);\r\n  const [benefitTypes, setBenefitTypes] = useState<BenefitType[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  // Form states\r\n  const [newBankName, setNewBankName] = useState(\"\");\r\n  const [newBankCode, setNewBankCode] = useState(\"\");\r\n  const [newBenefitName, setNewBenefitName] = useState(\"\");\r\n  const [newBenefitCode, setNewBenefitCode] = useState(\"\");\r\n  \r\n  // Edit states\r\n  const [editingBank, setEditingBank] = useState<string | null>(null);\r\n  const [editingBenefit, setEditingBenefit] = useState<number | null>(null);\r\n\r\n  // Persistência em Supabase (fallback se tabela não existir)\r\n  const persistBanksSupabase = async (banksToPersist: Bank[]) => {\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) return;\r\n      // limpa bancos existentes do usuário e insere os novos\r\n      const { error: delErr } = await supabase.from('banks').delete().eq('user_id', userData.user.id);\r\n      if (delErr) throw delErr;\r\n      if (banksToPersist.length > 0) {\r\n        const payload = banksToPersist.map((b) => ({\r\n          id: b.id.startsWith('user-') ? b.id : undefined,\r\n          name: b.name,\r\n          code: b.code || \"\",\r\n          user_id: userData.user.id,\r\n        }));\r\n        const { error: insErr } = await supabase.from('banks').insert(payload);\r\n        if (insErr) throw insErr;\r\n      }\r\n    } catch (err: any) {\r\n      // se tabela não existir ou der erro, não quebra fluxo\r\n      console.warn(\"Persistência de bancos no Supabase falhou (usando apenas localStorage):\", err?.message || err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // --- BANCOS ---\r\n      const savedBanks = localStorage.getItem('configBanks');\r\n      const configuredBanks = savedBanks ? JSON.parse(savedBanks) : [];\r\n      console.log('Bancos carregados do localStorage:', configuredBanks);\r\n      const removedBankIds = getRemovedIds('removedBanks');\r\n      const editedBanks = getEditedItems<Bank>('editedBanks');\r\n      const allBanks: Bank[] = [];\r\n\r\n      // Buscar bancos do Supabase (se tabela existir)\r\n      let supabaseBanks: Bank[] = [];\r\n      try {\r\n        const { data: userData } = await supabase.auth.getUser();\r\n        if (userData.user) {\r\n          const { data, error } = await supabase\r\n            .from('banks')\r\n            .select('id, name, code')\r\n            .eq('user_id', userData.user.id)\r\n            .order('name');\r\n          if (error) throw error;\r\n          supabaseBanks = (data || []).map((b: any) => ({\r\n            id: b.id,\r\n            name: b.name,\r\n            code: b.code || \"\",\r\n          }));\r\n        }\r\n      } catch (err: any) {\r\n        console.warn(\"Falha ao carregar bancos do Supabase (usando localStorage):\", err?.message || err);\r\n      }\r\n      \r\n      // Add default banks with generated IDs\r\n      DEFAULT_BANKS.forEach(bank => {\r\n        const id = `default-${bank.code}`;\r\n        // Se foi removido, não adiciona\r\n        if (removedBankIds.includes(id)) return;\r\n        // Se foi editado, adiciona editado\r\n        const edited = editedBanks.find(b => b.id === id);\r\n        if (edited) {\r\n          allBanks.push(edited);\r\n        } else {\r\n          allBanks.push({ id, name: bank.name, code: bank.code });\r\n        }\r\n      });\r\n      \r\n      // Add configured banks (user-added banks)\r\n      configuredBanks.forEach((configBank: Bank) => {\r\n        // Verificar se não existe duplicado\r\n        // Se ambos têm código, compara código; se não, compara apenas nome\r\n        const exists = allBanks.find(bank => {\r\n          // Se ambos têm código, verifica código OU nome\r\n          if (configBank.code && bank.code) {\r\n            return bank.code.toLowerCase() === configBank.code.toLowerCase() || \r\n                   bank.name.toLowerCase() === configBank.name.toLowerCase();\r\n          }\r\n          // Se algum não tem código, compara apenas nome\r\n          return bank.name.toLowerCase() === configBank.name.toLowerCase();\r\n        });\r\n        \r\n        if (!exists) {\r\n          allBanks.push(configBank);\r\n        }\r\n      });\r\n\r\n      // Add bancos do Supabase (se existirem e não duplicados)\r\n      supabaseBanks.forEach(sb => {\r\n        const exists = allBanks.find(bank => {\r\n          if (sb.code && bank.code) {\r\n            return bank.code.toLowerCase() === sb.code.toLowerCase() ||\r\n                   bank.name.toLowerCase() === sb.name.toLowerCase();\r\n          }\r\n          return bank.name.toLowerCase() === sb.name.toLowerCase();\r\n        });\r\n        if (!exists) {\r\n          allBanks.push(sb);\r\n        }\r\n      });\r\n      \r\n      // Ordenar bancos por nome\r\n      allBanks.sort((a, b) => a.name.localeCompare(b.name));\r\n      \r\n      setBanks(allBanks);\r\n\r\n      // --- PRODUTOS REMOVIDOS ---\r\n      // Funcionalidade de produtos foi desabilitada\r\n\r\n      // --- BENEFÍCIOS ---\r\n      const removedBenefitIds = getRemovedIds('removedBenefits');\r\n      const editedBenefits = getEditedItems<BenefitType>('editedBenefits');\r\n      const { data: benefitData, error: benefitError } = await supabase\r\n        .from('benefit_types')\r\n        .select('*')\r\n        .order('description');\r\n      if (benefitError) throw benefitError;\r\n      const dbBenefits = benefitData || [];\r\n      const allBenefits: BenefitType[] = [];\r\n      DEFAULT_BENEFIT_TYPES.forEach((benefit, index) => {\r\n        const id = 1000 + index;\r\n        if (removedBenefitIds.includes(id.toString())) return;\r\n        const edited = editedBenefits.find(b => b.id === id);\r\n        if (edited) {\r\n          allBenefits.push(edited);\r\n        } else {\r\n          allBenefits.push({ id, description: benefit.description, code: benefit.code });\r\n        }\r\n      });\r\n      dbBenefits.forEach((dbBenefit: BenefitType) => {\r\n        if (removedBenefitIds.includes(dbBenefit.id.toString())) return;\r\n        const exists = allBenefits.find(benefit => benefit.code === dbBenefit.code || benefit.description === dbBenefit.description);\r\n        if (!exists) {\r\n          allBenefits.push(dbBenefit);\r\n        }\r\n      });\r\n      setBenefitTypes(allBenefits);\r\n\r\n    } catch (error) {\r\n      console.error('Error fetching data:', error);\r\n      toast.error(\"Erro ao carregar configurações\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const addBenefit = async () => {\r\n    if (!newBenefitName.trim()) {\r\n      toast.error(\"Descrição é obrigatória\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('benefit_types')\r\n        .insert({\r\n          description: newBenefitName.trim(),\r\n          code: newBenefitCode.trim() || \"\"\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      setBenefitTypes([...benefitTypes, data]);\r\n      setNewBenefitName(\"\");\r\n      setNewBenefitCode(\"\");\r\n      toast.success(\"Tipo de benefício adicionado com sucesso!\");\r\n    } catch (error: any) {\r\n      console.error('Error adding benefit:', error);\r\n      toast.error(`Erro ao adicionar tipo de benefício: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const deleteBenefit = async (id: number) => {\r\n    try {\r\n      if (id >= 1000) {\r\n        setBenefitTypes(benefitTypes.filter(b => b.id !== id));\r\n        const removed = getRemovedIds('removedBenefits');\r\n        if (!removed.includes(id.toString())) {\r\n          removed.push(id.toString());\r\n          setRemovedIds('removedBenefits', removed);\r\n        }\r\n        toast.success(\"Tipo de benefício removido com sucesso!\");\r\n      } else {\r\n        const { error } = await supabase\r\n          .from('benefit_types')\r\n          .delete()\r\n          .eq('id', id);\r\n        if (error) throw error;\r\n        setBenefitTypes(benefitTypes.filter(b => b.id !== id));\r\n        const removed = getRemovedIds('removedBenefits');\r\n        if (!removed.includes(id.toString())) {\r\n          removed.push(id.toString());\r\n          setRemovedIds('removedBenefits', removed);\r\n        }\r\n        toast.success(\"Tipo de benefício removido com sucesso!\");\r\n      }\r\n    } catch (error: any) {\r\n      console.error('Error deleting benefit:', error);\r\n      toast.error(`Erro ao remover tipo de benefício: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const addBank = async () => {\r\n    if (!newBankName.trim()) {\r\n      toast.error(\"Nome do banco é obrigatório\");\r\n      return;\r\n    }\r\n\r\n    const bankCode = newBankCode.trim();\r\n    const bankName = newBankName.trim();\r\n\r\n    // Verificar se já existe banco com mesmo código (se informado) ou nome\r\n    const exists = banks.some(bank => {\r\n      // Se tem código, verifica código E nome\r\n      if (bankCode) {\r\n        return (bank.code.toLowerCase() === bankCode.toLowerCase()) || \r\n               (bank.name.toLowerCase() === bankName.toLowerCase());\r\n      }\r\n      // Se não tem código, verifica apenas nome\r\n      return bank.name.toLowerCase() === bankName.toLowerCase();\r\n    });\r\n    \r\n    if (exists) {\r\n      toast.error(\"Já existe um banco com este código ou nome\");\r\n      return;\r\n    }\r\n\r\n    const newBank: Bank = {\r\n      id: `user-${Date.now()}`,\r\n      name: bankName,\r\n      code: bankCode || \"\" // Permite código vazio\r\n    };\r\n\r\n    const updatedBanks = [...banks, newBank];\r\n    setBanks(updatedBanks);\r\n    \r\n    // Save only user-added banks to localStorage (todos os que começam com 'user-')\r\n    const userBanks = updatedBanks.filter(bank => bank.id.startsWith('user-'));\r\n    \r\n    // Garantir que está salvando corretamente\r\n    try {\r\n      localStorage.setItem('configBanks', JSON.stringify(userBanks));\r\n      console.log('Bancos salvos no localStorage:', userBanks);\r\n      await persistBanksSupabase(userBanks);\r\n    } catch (error) {\r\n      console.error('Erro ao salvar no localStorage/Supabase:', error);\r\n      toast.error('Erro ao salvar banco. Tente novamente.');\r\n      return;\r\n    }\r\n    \r\n    // Disparar evento para notificar outros componentes\r\n    window.dispatchEvent(new CustomEvent('configDataChanged'));\r\n    \r\n    setNewBankName(\"\");\r\n    setNewBankCode(\"\");\r\n    toast.success(\"Banco adicionado com sucesso!\");\r\n  };\r\n\r\n  const deleteBank = async (id: string) => {\r\n    const updatedBanks = banks.filter(b => b.id !== id);\r\n    setBanks(updatedBanks);\r\n    \r\n    // Se for padrão, salva id em removedBanks\r\n    if (id.startsWith('default-')) {\r\n      const removed = getRemovedIds('removedBanks');\r\n      if (!removed.includes(id)) {\r\n        removed.push(id);\r\n        setRemovedIds('removedBanks', removed);\r\n      }\r\n    } else {\r\n      // Save only user-added banks to localStorage (todos os que começam com 'user-')\r\n      const userBanks = updatedBanks.filter(bank => bank.id.startsWith('user-'));\r\n      try {\r\n        localStorage.setItem('configBanks', JSON.stringify(userBanks));\r\n        console.log('Bancos salvos após deletar:', userBanks);\r\n        await persistBanksSupabase(userBanks);\r\n      } catch (error) {\r\n        console.error('Erro ao salvar no localStorage/Supabase:', error);\r\n        toast.error('Erro ao remover banco. Tente novamente.');\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Disparar evento para notificar outros componentes\r\n    window.dispatchEvent(new CustomEvent('configDataChanged'));\r\n    \r\n    toast.success(\"Banco removido com sucesso!\");\r\n  };\r\n\r\n  // Funções de produtos removidas - funcionalidade desabilitada\r\n\r\n  const editBank = async (id: string, newName: string, newCode: string) => {\r\n    const updatedBanks = banks.map(bank =>\r\n      bank.id === id ? { ...bank, name: newName, code: newCode } : bank\r\n    );\r\n    setBanks(updatedBanks);\r\n    if (id.startsWith('default-')) {\r\n      // Salva edição no localStorage\r\n      const edited = getEditedItems<Bank>('editedBanks');\r\n      const idx = edited.findIndex(b => b.id === id);\r\n      if (idx !== -1) {\r\n        edited[idx] = { id, name: newName, code: newCode };\r\n      } else {\r\n        edited.push({ id, name: newName, code: newCode });\r\n      }\r\n      setEditedItems('editedBanks', edited);\r\n    } else {\r\n      // Save only user-added banks (todos os que começam com 'user-')\r\n      const userBanks = updatedBanks.filter(bank => bank.id.startsWith('user-'));\r\n      try {\r\n        localStorage.setItem('configBanks', JSON.stringify(userBanks));\r\n        console.log('Bancos salvos após editar:', userBanks);\r\n        await persistBanksSupabase(userBanks);\r\n      } catch (error) {\r\n        console.error('Erro ao salvar no localStorage/Supabase:', error);\r\n        toast.error('Erro ao editar banco. Tente novamente.');\r\n        return;\r\n      }\r\n    }\r\n    \r\n    // Disparar evento para notificar outros componentes\r\n    window.dispatchEvent(new CustomEvent('configDataChanged'));\r\n    \r\n    toast.success('Banco editado com sucesso!');\r\n  };\r\n\r\n  // editProduct removido - funcionalidade desabilitada\r\n\r\n  const editBenefit = async (id: number, newDescription: string, newCode: string) => {\r\n    const updatedBenefits = benefitTypes.map(benefit =>\r\n      benefit.id === id ? { ...benefit, description: newDescription, code: newCode } : benefit\r\n    );\r\n    setBenefitTypes(updatedBenefits);\r\n    if (id >= 1000) {\r\n      const edited = getEditedItems<BenefitType>('editedBenefits');\r\n      const idx = edited.findIndex(b => b.id === id);\r\n      if (idx !== -1) {\r\n        edited[idx] = { id, description: newDescription, code: newCode };\r\n      } else {\r\n        edited.push({ id, description: newDescription, code: newCode });\r\n      }\r\n      setEditedItems('editedBenefits', edited);\r\n      toast.success('Tipo de benefício editado com sucesso!');\r\n    } else {\r\n      try {\r\n        const { error } = await supabase\r\n          .from('benefit_types')\r\n          .update({ description: newDescription, code: newCode })\r\n          .eq('id', id);\r\n        if (error) throw error;\r\n        const edited = getEditedItems<BenefitType>('editedBenefits');\r\n        const idx = edited.findIndex(b => b.id === id);\r\n        if (idx !== -1) {\r\n          edited[idx] = { id, description: newDescription, code: newCode };\r\n        } else {\r\n          edited.push({ id, description: newDescription, code: newCode });\r\n        }\r\n        setEditedItems('editedBenefits', edited);\r\n        toast.success('Tipo de benefício editado com sucesso!');\r\n      } catch (error: any) {\r\n        toast.error('Erro ao editar tipo de benefício: ' + error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <PageLayout title=\"Configurações de Leads\" subtitle=\"Gerencie bancos e tipos de benefícios\">\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"text-lg\">Carregando...</div>\r\n        </div>\r\n      </PageLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PageLayout \r\n      title=\"Configurações de Leads\" \r\n      subtitle=\"Gerencie bancos e tipos de benefícios para seus leads\"\r\n    >\r\n      <Tabs defaultValue=\"banks\" className=\"space-y-6\">\r\n        <TabsList className=\"grid w-full grid-cols-2\">\r\n          <TabsTrigger value=\"banks\">Bancos</TabsTrigger>\r\n          <TabsTrigger value=\"benefits\">Tipos de Benefícios</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"banks\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Gerenciar Bancos</CardTitle>\r\n              <CardDescription>\r\n                Adicione ou remova bancos disponíveis para seleção nos leads\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <Label htmlFor=\"bankName\">Nome do Banco *</Label>\r\n                  <Input\r\n                    id=\"bankName\"\r\n                    value={newBankName}\r\n                    onChange={(e) => setNewBankName(e.target.value)}\r\n                    placeholder=\"Ex: Banco Central\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Label htmlFor=\"bankCode\">Código (opcional)</Label>\r\n                  <Input\r\n                    id=\"bankCode\"\r\n                    value={newBankCode}\r\n                    onChange={(e) => setNewBankCode(e.target.value)}\r\n                    placeholder=\"Ex: 001\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                  <Button onClick={addBank}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Adicionar\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                {banks.map((bank) => (\r\n                  <div key={bank.id} className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-blue-50 hover:shadow-sm transition-colors duration-200 cursor-pointer\">\r\n                    {editingBank === bank.id ? (\r\n                      <div className=\"flex-1 flex gap-2 items-center\">\r\n                        <Input\r\n                          value={newBankName}\r\n                          onChange={e => setNewBankName(e.target.value)}\r\n                          className=\"w-1/2\"\r\n                        />\r\n                        <Input\r\n                          value={newBankCode}\r\n                          onChange={e => setNewBankCode(e.target.value)}\r\n                          className=\"w-1/3\"\r\n                        />\r\n                        <Button size=\"sm\" onClick={() => { editBank(bank.id, newBankName, newBankCode); setEditingBank(null); setNewBankName(\"\"); setNewBankCode(\"\"); }}>Salvar</Button>\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => { setEditingBank(null); setNewBankName(\"\"); setNewBankCode(\"\"); }}>Cancelar</Button>\r\n                      </div>\r\n                    ) : (\r\n                      <div>\r\n                        <div className=\"font-medium\">{bank.name}</div>\r\n                        <div className=\"text-sm text-muted-foreground\">\r\n                          Código: {bank.code || \"Não informado\"}\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {editingBank !== bank.id && (\r\n                        <Button size=\"sm\" variant=\"outline\" onClick={() => { setEditingBank(bank.id); setNewBankName(bank.name); setNewBankCode(bank.code); }}>\r\n                          <Edit className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      )}\r\n                      <AlertDialog>\r\n                        <AlertDialogTrigger asChild>\r\n                          <Button variant=\"destructive\" size=\"sm\">\r\n                            <Trash2 className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </AlertDialogTrigger>\r\n                        <AlertDialogContent>\r\n                          <AlertDialogHeader>\r\n                            <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\r\n                            <AlertDialogDescription>\r\n                              Tem certeza que deseja remover o banco \"{bank.name}\"? Esta ação não pode ser desfeita.\r\n                            </AlertDialogDescription>\r\n                          </AlertDialogHeader>\r\n                          <AlertDialogFooter>\r\n                            <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                            <AlertDialogAction onClick={() => deleteBank(bank.id)}>\r\n                              Remover\r\n                            </AlertDialogAction>\r\n                          </AlertDialogFooter>\r\n                        </AlertDialogContent>\r\n                      </AlertDialog>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* Seção de produtos removida - funcionalidade desabilitada */}\r\n\r\n        <TabsContent value=\"benefits\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Gerenciar Tipos de Benefícios</CardTitle>\r\n              <CardDescription>\r\n                Adicione ou remova tipos de benefícios disponíveis para seleção nos leads\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <Label htmlFor=\"benefitName\">Descrição do Benefício *</Label>\r\n                  <Input\r\n                    id=\"benefitName\"\r\n                    value={newBenefitName}\r\n                    onChange={(e) => setNewBenefitName(e.target.value)}\r\n                    placeholder=\"Ex: Aposentadoria por Invalidez\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex-1\">\r\n                  <Label htmlFor=\"benefitCode\">Código (opcional)</Label>\r\n                  <Input\r\n                    id=\"benefitCode\"\r\n                    value={newBenefitCode}\r\n                    onChange={(e) => setNewBenefitCode(e.target.value)}\r\n                    placeholder=\"Ex: 32\"\r\n                  />\r\n                </div>\r\n                <div className=\"flex items-end\">\r\n                  <Button onClick={addBenefit}>\r\n                    <Plus className=\"h-4 w-4 mr-2\" />\r\n                    Adicionar\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                {benefitTypes.map((benefit) => (\r\n                  <div key={benefit.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\r\n                    <div>\r\n                      <div className=\"font-medium\">{benefit.description}</div>\r\n                      <div className=\"text-sm text-muted-foreground\">\r\n                        Código: {benefit.code || \"Não informado\"}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <AlertDialog>\r\n                        <AlertDialogTrigger asChild>\r\n                          <Button variant=\"destructive\" size=\"sm\">\r\n                            <Trash2 className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </AlertDialogTrigger>\r\n                        <AlertDialogContent>\r\n                          <AlertDialogHeader>\r\n                            <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>\r\n                            <AlertDialogDescription>\r\n                              Tem certeza que deseja remover o tipo de benefício \"{benefit.description}\"? Esta ação não pode ser desfeita.\r\n                            </AlertDialogDescription>\r\n                          </AlertDialogHeader>\r\n                          <AlertDialogFooter>\r\n                            <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                            <AlertDialogAction onClick={() => deleteBenefit(benefit.id)}>\r\n                              Remover\r\n                            </AlertDialogAction>\r\n                          </AlertDialogFooter>\r\n                        </AlertDialogContent>\r\n                      </AlertDialog>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default LeadsConfig;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadsPremium.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\LeadsTrash.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1128,1131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1128,1131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2591,2594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2591,2594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5239,5242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5239,5242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6330,6333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6330,6333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":212,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":212,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9166,9169],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9166,9169],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":245,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":245,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10176,10179],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10176,10179],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Search, Trash2, RotateCcw, AlertTriangle, User, Phone, Mail, Calendar, Clock, CheckSquare, Square } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\n\r\ninterface DeletedLead {\r\n  id: string;\r\n  original_lead_id: string;\r\n  original_lead_data: any;\r\n  deleted_at: string;\r\n  expires_at: string;\r\n  user_id: string;\r\n}\r\n\r\nconst LeadsTrash = () => {\r\n  const [deletedLeads, setDeletedLeads] = useState<DeletedLead[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedLead, setSelectedLead] = useState<DeletedLead | null>(null);\r\n  const [actionType, setActionType] = useState<'restore' | 'delete' | null>(null);\r\n  const [selectedLeads, setSelectedLeads] = useState<Set<string>>(new Set());\r\n  const [bulkActionType, setBulkActionType] = useState<'bulk_restore' | 'bulk_delete' | null>(null);\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [pendingDeleteAction, setPendingDeleteAction] = useState<'single' | 'bulk' | null>(null);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchDeletedLeads();\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, []);\r\n\r\n  const fetchDeletedLeads = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userData.user.id)\r\n        .order(\"deleted_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      setDeletedLeads(data || []);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching deleted leads:\", error);\r\n      toast.error(`Erro ao carregar lixeira: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRestore = async (deletedLead: DeletedLead) => {\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Prepare lead data with only valid columns for the leads table\r\n      const leadDataToRestore = {\r\n        id: deletedLead.original_lead_id,\r\n        user_id: userData.user.id,\r\n        name: deletedLead.original_lead_data.name || '',\r\n        email: deletedLead.original_lead_data.email || null,\r\n        phone: deletedLead.original_lead_data.phone || null,\r\n        phone2: deletedLead.original_lead_data.phone2 || null,\r\n        phone3: deletedLead.original_lead_data.phone3 || null,\r\n        cpf: deletedLead.original_lead_data.cpf || null,\r\n        status: deletedLead.original_lead_data.status || 'novo',\r\n        source: deletedLead.original_lead_data.source || null,\r\n        notes: deletedLead.original_lead_data.notes || null,\r\n        amount: deletedLead.original_lead_data.amount || null,\r\n        product: deletedLead.original_lead_data.product || null,\r\n        employee: deletedLead.original_lead_data.employee || null,\r\n        bank: deletedLead.original_lead_data.bank || null,\r\n        benefit_type: deletedLead.original_lead_data.benefit_type || null,\r\n        representative_name: deletedLead.original_lead_data.representative_name || null,\r\n        representative_cpf: deletedLead.original_lead_data.representative_cpf || null,\r\n        representative_mode: deletedLead.original_lead_data.representative_mode || null,\r\n        payment_period: deletedLead.original_lead_data.payment_period || null,\r\n        // Preservar datas originais\r\n        created_at: deletedLead.original_lead_data.created_at || null,\r\n        date: deletedLead.original_lead_data.date || null\r\n      };\r\n\r\n      // Restore lead to active leads table\r\n      const { error: restoreError } = await supabase\r\n        .from(\"leads\")\r\n        .insert(leadDataToRestore);\r\n\r\n      if (restoreError) throw restoreError;\r\n\r\n      // Remove from deleted leads\r\n      const { error: removeError } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .delete()\r\n        .eq(\"id\", deletedLead.id);\r\n\r\n      if (removeError) throw removeError;\r\n\r\n      setDeletedLeads(deletedLeads.filter(lead => lead.id !== deletedLead.id));\r\n      toast.success(\"Lead restaurado com sucesso!\");\r\n      setSelectedLead(null);\r\n      setActionType(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error restoring lead:\", error);\r\n      toast.error(`Erro ao restaurar lead: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handlePermanentDelete = async (deletedLead: DeletedLead) => {\r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setSelectedLead(deletedLead);\r\n      setActionType('delete');\r\n      setPendingDeleteAction('single');\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    confirmPermanentDelete(deletedLead);\r\n  };\r\n\r\n  const confirmPermanentDelete = async (deletedLead: DeletedLead) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .delete()\r\n        .eq(\"id\", deletedLead.id);\r\n\r\n      if (error) throw error;\r\n\r\n      setDeletedLeads(deletedLeads.filter(lead => lead.id !== deletedLead.id));\r\n      toast.success(\"Lead excluído permanentemente!\");\r\n      setSelectedLead(null);\r\n      setActionType(null);\r\n      setPendingDeleteAction(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error permanently deleting lead:\", error);\r\n      toast.error(`Erro ao excluir lead permanentemente: ${error.message}`);\r\n      setPendingDeleteAction(null);\r\n    }\r\n  };\r\n\r\n  const handleBulkRestore = async () => {\r\n    try {\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      const leadsToRestore = deletedLeads.filter(lead => selectedLeads.has(lead.id));\r\n      \r\n      for (const deletedLead of leadsToRestore) {\r\n        // Prepare lead data\r\n        const leadDataToRestore = {\r\n          id: deletedLead.original_lead_id,\r\n          user_id: userData.user.id,\r\n          name: deletedLead.original_lead_data.name || '',\r\n          email: deletedLead.original_lead_data.email || null,\r\n          phone: deletedLead.original_lead_data.phone || null,\r\n          phone2: deletedLead.original_lead_data.phone2 || null,\r\n          phone3: deletedLead.original_lead_data.phone3 || null,\r\n          cpf: deletedLead.original_lead_data.cpf || null,\r\n          status: deletedLead.original_lead_data.status || 'novo',\r\n          source: deletedLead.original_lead_data.source || null,\r\n          notes: deletedLead.original_lead_data.notes || null,\r\n          amount: deletedLead.original_lead_data.amount || null,\r\n          product: deletedLead.original_lead_data.product || null,\r\n          employee: deletedLead.original_lead_data.employee || null,\r\n          bank: deletedLead.original_lead_data.bank || null,\r\n          benefit_type: deletedLead.original_lead_data.benefit_type || null,\r\n          representative_name: deletedLead.original_lead_data.representative_name || null,\r\n          representative_cpf: deletedLead.original_lead_data.representative_cpf || null,\r\n          representative_mode: deletedLead.original_lead_data.representative_mode || null,\r\n          payment_period: deletedLead.original_lead_data.payment_period || null,\r\n          // Preservar datas originais\r\n          created_at: deletedLead.original_lead_data.created_at || null,\r\n          date: deletedLead.original_lead_data.date || null\r\n        };\r\n\r\n        // Restore lead\r\n        const { error: restoreError } = await supabase\r\n          .from(\"leads\")\r\n          .insert(leadDataToRestore);\r\n\r\n        if (restoreError) throw restoreError;\r\n\r\n        // Remove from deleted leads\r\n        const { error: removeError } = await supabase\r\n          .from(\"deleted_leads\")\r\n          .delete()\r\n          .eq(\"id\", deletedLead.id);\r\n\r\n        if (removeError) throw removeError;\r\n      }\r\n\r\n      setDeletedLeads(deletedLeads.filter(lead => !selectedLeads.has(lead.id)));\r\n      setSelectedLeads(new Set());\r\n      toast.success(`${leadsToRestore.length} leads restaurados com sucesso!`);\r\n      setBulkActionType(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error bulk restoring leads:\", error);\r\n      toast.error(`Erro ao restaurar leads: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleBulkDelete = async () => {\r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setPendingDeleteAction('bulk');\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    confirmBulkDelete();\r\n  };\r\n\r\n  const confirmBulkDelete = async () => {\r\n    try {\r\n      const selectedIds = Array.from(selectedLeads);\r\n      \r\n      const { error } = await supabase\r\n        .from(\"deleted_leads\")\r\n        .delete()\r\n        .in(\"id\", selectedIds);\r\n\r\n      if (error) throw error;\r\n\r\n      setDeletedLeads(deletedLeads.filter(lead => !selectedLeads.has(lead.id)));\r\n      setSelectedLeads(new Set());\r\n      toast.success(`${selectedIds.length} leads excluídos permanentemente!`);\r\n      setBulkActionType(null);\r\n    } catch (error: any) {\r\n      console.error(\"Error bulk deleting leads:\", error);\r\n      toast.error(`Erro ao excluir leads: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleSelectAll = () => {\r\n    if (selectedLeads.size === filteredLeads.length) {\r\n      setSelectedLeads(new Set());\r\n    } else {\r\n      setSelectedLeads(new Set(filteredLeads.map(lead => lead.id)));\r\n    }\r\n  };\r\n\r\n  const handleSelectLead = (leadId: string) => {\r\n    const newSelected = new Set(selectedLeads);\r\n    if (newSelected.has(leadId)) {\r\n      newSelected.delete(leadId);\r\n    } else {\r\n      newSelected.add(leadId);\r\n    }\r\n    setSelectedLeads(newSelected);\r\n  };\r\n\r\n  const filteredLeads = deletedLeads.filter(deletedLead => {\r\n    const leadData = deletedLead.original_lead_data;\r\n    const searchLower = searchQuery.toLowerCase();\r\n    return (\r\n      leadData.name?.toLowerCase().includes(searchLower) ||\r\n      leadData.phone?.includes(searchQuery) ||\r\n      leadData.email?.toLowerCase().includes(searchLower) ||\r\n      leadData.cpf?.includes(searchQuery)\r\n    );\r\n  });\r\n\r\n  const getDaysUntilExpiry = (expiresAt: string) => {\r\n    const now = new Date();\r\n    const expiry = new Date(expiresAt);\r\n    const diffTime = expiry.getTime() - now.getTime();\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n    return diffDays;\r\n  };\r\n\r\n  const headerActions = (\r\n    <div className=\"flex items-center gap-3\">\r\n      <div className=\"relative\">\r\n        <Search className=\"absolute left-3 top-2.5 h-4 w-4 text-blue-500\" />\r\n        <Input \r\n          placeholder=\"Buscar por nome, telefone ou CPF...\" \r\n          className=\"pl-10 py-2 border-blue-100 bg-blue-50/50 hover:bg-blue-50 focus:border-blue-200 focus:ring-1 focus:ring-blue-200 transition-all rounded-full w-full md:w-[280px]\" \r\n          value={searchQuery} \r\n          onChange={e => setSearchQuery(e.target.value)} \r\n        />\r\n      </div>\r\n      \r\n      {filteredLeads.length > 0 && (\r\n        <div className=\"flex items-center gap-2\">\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            onClick={handleSelectAll}\r\n            className=\"flex items-center gap-2\"\r\n          >\r\n            {selectedLeads.size === filteredLeads.length ? \r\n              <CheckSquare className=\"h-4 w-4\" /> : \r\n              <Square className=\"h-4 w-4\" />\r\n            }\r\n            {selectedLeads.size === filteredLeads.length ? 'Desmarcar Todos' : 'Selecionar Todos'}\r\n          </Button>\r\n          \r\n          {selectedLeads.size > 0 && (\r\n            <>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setBulkActionType('bulk_restore')}\r\n                className=\"text-green-600 border-green-200 hover:bg-green-50\"\r\n              >\r\n                <RotateCcw className=\"h-4 w-4 mr-1\" />\r\n                Restaurar ({selectedLeads.size})\r\n              </Button>\r\n              <Button\r\n                variant=\"destructive\"\r\n                size=\"sm\"\r\n                onClick={() => setBulkActionType('bulk_delete')}\r\n              >\r\n                <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                Excluir ({selectedLeads.size})\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <PageLayout \r\n      title=\"Lixeira de Leads\" \r\n      subtitle=\"Leads excluídos ficam disponíveis por 30 dias para restauração\"\r\n      headerActions={headerActions}\r\n    >\r\n      <div className=\"space-y-6\">\r\n        {isLoading ? (\r\n          <div className=\"space-y-4\">\r\n            {[1, 2, 3].map(i => (\r\n              <Card key={i} className=\"animate-pulse\">\r\n                <CardHeader>\r\n                  <div className=\"h-6 bg-gray-200 rounded w-1/3 mb-2\"></div>\r\n                  <div className=\"h-4 bg-gray-200 rounded w-1/2\"></div>\r\n                </CardHeader>\r\n                <CardContent>\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"h-4 bg-gray-200 rounded w-1/4\"></div>\r\n                    <div className=\"h-4 bg-gray-200 rounded w-1/3\"></div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        ) : filteredLeads.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4\">\r\n            {filteredLeads.map((deletedLead) => {\r\n              const leadData = deletedLead.original_lead_data;\r\n              const daysLeft = getDaysUntilExpiry(deletedLead.expires_at);\r\n              const isExpiringSoon = daysLeft <= 3;\r\n              const isSelected = selectedLeads.has(deletedLead.id);\r\n\r\n              return (\r\n                <Card key={deletedLead.id} className={`transition-all hover:shadow-md h-fit ${isSelected ? 'ring-2 ring-blue-500 bg-blue-50/30' : ''}`}>\r\n                  <CardHeader className=\"pb-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <div className=\"flex items-start justify-between\">\r\n                        <div className=\"flex items-start gap-2 flex-1\">\r\n                          <Checkbox\r\n                            checked={isSelected}\r\n                            onCheckedChange={() => handleSelectLead(deletedLead.id)}\r\n                            className=\"mt-1\"\r\n                          />\r\n                          <CardTitle className=\"text-lg leading-tight line-clamp-2 flex-1\">{leadData.name}</CardTitle>\r\n                        </div>\r\n                        <div className=\"flex flex-col items-end gap-1 ml-2\">\r\n                          {isExpiringSoon && (\r\n                            <Badge variant=\"destructive\" className=\"text-xs\">\r\n                              <AlertTriangle className=\"h-3 w-3 mr-1\" />\r\n                              {daysLeft}d\r\n                            </Badge>\r\n                          )}\r\n                          {!isExpiringSoon && (\r\n                            <Badge variant=\"secondary\" className=\"text-xs\">\r\n                              {daysLeft}d\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <CardDescription className=\"text-xs ml-6\">\r\n                        Excluído em {format(new Date(deletedLead.deleted_at), \"dd/MM/yyyy\", { locale: ptBR })}\r\n                      </CardDescription>\r\n                    </div>\r\n                  </CardHeader>\r\n                  \r\n                  <CardContent className=\"pt-0\">\r\n                    <div className=\"space-y-2 mb-4 ml-6\">\r\n                      {leadData.phone && (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Phone className=\"h-3 w-3 text-blue-500 flex-shrink-0\" />\r\n                          <span className=\"text-xs truncate\">{leadData.phone}</span>\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {leadData.email && (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Mail className=\"h-3 w-3 text-green-500 flex-shrink-0\" />\r\n                          <span className=\"text-xs truncate\">{leadData.email}</span>\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {leadData.amount && (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <span className=\"text-xs font-medium\">Valor:</span>\r\n                          <span className=\"font-semibold text-green-600 text-xs\">\r\n                            {leadData.amount}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n\r\n                      {leadData.status && (\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Badge variant=\"outline\" className=\"text-xs\">\r\n                            {leadData.status}\r\n                          </Badge>\r\n                        </div>\r\n                      )}\r\n\r\n                      {leadData.notes && (\r\n                        <div className=\"text-xs text-gray-600 line-clamp-2\">\r\n                          {leadData.notes}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n\r\n                    <div className=\"flex gap-2 pt-3 border-t\">\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"flex-1 text-xs h-8\"\r\n                        onClick={() => {\r\n                          setSelectedLead(deletedLead);\r\n                          setActionType('restore');\r\n                        }}\r\n                      >\r\n                        <RotateCcw className=\"h-3 w-3 mr-1\" />\r\n                        Restaurar\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"destructive\"\r\n                        size=\"sm\"\r\n                        className=\"flex-1 text-xs h-8\"\r\n                        onClick={() => {\r\n                          setSelectedLead(deletedLead);\r\n                          setActionType('delete');\r\n                        }}\r\n                      >\r\n                        <Trash2 className=\"h-3 w-3 mr-1\" />\r\n                        Excluir\r\n                      </Button>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <Card className=\"text-center py-12 max-w-2xl mx-auto\">\r\n            <CardContent>\r\n              <Trash2 className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhum lead na lixeira</h3>\r\n              <p className=\"text-gray-500\">\r\n                {searchQuery ? \"Nenhum lead encontrado com os termos de busca.\" : \"A lixeira está vazia.\"}\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Dialog para ação individual */}\r\n        <AlertDialog open={!!selectedLead} onOpenChange={() => {\r\n          setSelectedLead(null);\r\n          setActionType(null);\r\n        }}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>\r\n                {actionType === 'restore' ? 'Restaurar Lead' : 'Excluir Permanentemente'}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {actionType === 'restore' \r\n                  ? `Tem certeza que deseja restaurar o lead \"${selectedLead?.original_lead_data?.name}\"? Ele voltará para a lista ativa de leads.`\r\n                  : `Tem certeza que deseja excluir permanentemente o lead \"${selectedLead?.original_lead_data?.name}\"? Esta ação não pode ser desfeita.`\r\n                }\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={() => {\r\n                  if (selectedLead) {\r\n                    if (actionType === 'restore') {\r\n                      handleRestore(selectedLead);\r\n                    } else {\r\n                      handlePermanentDelete(selectedLead);\r\n                    }\r\n                  }\r\n                }}\r\n                className={actionType === 'restore' ? \"bg-green-600 hover:bg-green-700\" : \"bg-red-600 hover:bg-red-700\"}\r\n              >\r\n                {actionType === 'restore' ? 'Restaurar' : 'Excluir Permanentemente'}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Dialog para ações em massa */}\r\n        <AlertDialog open={!!bulkActionType} onOpenChange={() => setBulkActionType(null)}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>\r\n                {bulkActionType === 'bulk_restore' ? 'Restaurar Leads Selecionados' : 'Excluir Leads Selecionados'}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {bulkActionType === 'bulk_restore' \r\n                  ? `Tem certeza que deseja restaurar ${selectedLeads.size} leads selecionados? Eles voltarão para a lista ativa de leads.`\r\n                  : `Tem certeza que deseja excluir permanentemente ${selectedLeads.size} leads selecionados? Esta ação não pode ser desfeita.`\r\n                }\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={() => {\r\n                  if (bulkActionType === 'bulk_restore') {\r\n                    handleBulkRestore();\r\n                  } else {\r\n                    handleBulkDelete();\r\n                  }\r\n                }}\r\n                className={bulkActionType === 'bulk_restore' ? \"bg-green-600 hover:bg-green-700\" : \"bg-red-600 hover:bg-red-700\"}\r\n              >\r\n                {bulkActionType === 'bulk_restore' ? 'Restaurar Todos' : 'Excluir Todos'}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Dialog de confirmação com senha administrativa */}\r\n        <AdminPasswordDialog\r\n          open={showAdminPasswordDialog}\r\n          onOpenChange={(open) => {\r\n            setShowAdminPasswordDialog(open);\r\n            if (!open) {\r\n              setPendingDeleteAction(null);\r\n            }\r\n          }}\r\n          onConfirm={() => {\r\n            if (pendingDeleteAction === 'single' && selectedLead) {\r\n              confirmPermanentDelete(selectedLead);\r\n            } else if (pendingDeleteAction === 'bulk') {\r\n              confirmBulkDelete();\r\n            }\r\n          }}\r\n          title=\"Confirmar Exclusão Permanente\"\r\n          description={\r\n            pendingDeleteAction === 'single'\r\n              ? `Esta ação é irreversível. Digite sua senha administrativa para excluir permanentemente o lead \"${selectedLead?.original_lead_data?.name}\".`\r\n              : `Esta ação é irreversível. Digite sua senha administrativa para excluir permanentemente ${selectedLeads.size} leads selecionados.`\r\n          }\r\n          itemName={pendingDeleteAction === 'single' ? selectedLead?.original_lead_data?.name : `${selectedLeads.size} leads`}\r\n        />\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default LeadsTrash; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Login.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6293,6296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6293,6296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":228,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":228,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7991,7994],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7991,7994],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Eye, EyeOff, Mail, Lock, User, Phone } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useSubscription } from \"@/contexts/SubscriptionContext\";\r\nimport { z } from \"zod\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ForgotPassword } from \"@/components/ForgotPassword\";\r\n\r\nconst phoneRegex = /^\\(\\d{2}\\) \\d{5}-\\d{4}$/;\r\nconst LoginSchema = z.object({\r\n  email: z.string().email(\"Email inválido\"),\r\n  password: z.string().min(6, \"A senha deve ter pelo menos 6 caracteres\")\r\n});\r\nconst SignupSchema = z.object({\r\n  fullName: z.string().min(3, \"Nome completo é obrigatório\"),\r\n  email: z.string().email(\"Email inválido\"),\r\n  whatsapp: z.string().regex(phoneRegex, \"WhatsApp inválido - use o formato (99) 99999-9999\"),\r\n  password: z.string().min(6, \"A senha deve ter pelo menos 6 caracteres\")\r\n});\r\n\r\nconst Login = () => {\r\n  const navigate = useNavigate();\r\n  const { signIn, signUp } = useAuth();\r\n  const { startTrial } = useSubscription();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [fullName, setFullName] = useState(\"\");\r\n  const [whatsapp, setWhatsapp] = useState(\"\");\r\n  const [isLogin, setIsLogin] = useState(true);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [errors, setErrors] = useState<Record<string, string>>({});\r\n  const [showForgotPassword, setShowForgotPassword] = useState(false);\r\n\r\n  const maskPhone = (value: string) => {\r\n    const digits = value.replace(/\\D/g, '');\r\n    if (digits.length <= 2) {\r\n      return `(${digits}`;\r\n    }\r\n    if (digits.length <= 7) {\r\n      return `(${digits.slice(0, 2)}) ${digits.slice(2)}`;\r\n    }\r\n    return `(${digits.slice(0, 2)}) ${digits.slice(2, 7)}-${digits.slice(7, 11)}`;\r\n  };\r\n\r\n  const handlePhoneChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    setWhatsapp(maskPhone(e.target.value));\r\n  };\r\n\r\n  const validateForm = () => {\r\n    try {\r\n      if (isLogin) {\r\n        LoginSchema.parse({ email, password });\r\n      } else {\r\n        SignupSchema.parse({ fullName, email, whatsapp, password });\r\n      }\r\n      setErrors({});\r\n      return true;\r\n    } catch (error) {\r\n      if (error instanceof z.ZodError) {\r\n        const newErrors: Record<string, string> = {};\r\n        error.errors.forEach(err => {\r\n          if (err.path) {\r\n            newErrors[err.path[0]] = err.message;\r\n          }\r\n        });\r\n        setErrors(newErrors);\r\n      }\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const handleGoogleSignIn = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n\r\n      console.log('[Google OAuth] Iniciando processo de login...');\r\n\r\n      const { data, error } = await supabase.auth.signInWithOAuth({\r\n        provider: 'google',\r\n        options: {\r\n          redirectTo: `${window.location.origin}/dashboard`,\r\n          queryParams: {\r\n            access_type: 'offline',\r\n            prompt: 'consent',\r\n          }\r\n        }\r\n      });\r\n\r\n      if (error) {\r\n        console.error('[Google OAuth] Erro retornado:', {\r\n          message: error.message,\r\n          status: error.status,\r\n          name: error.name,\r\n        });\r\n\r\n        // Erros específicos com mensagens claras\r\n        if (error.message.includes('provider is not enabled') ||\r\n          error.message.includes('provider_disabled')) {\r\n          toast.error(\r\n            \"Login com Google não está ativado\",\r\n            {\r\n              description: \"Entre em contato com o suporte para ativar esta funcionalidade.\",\r\n              duration: 6000,\r\n            }\r\n          );\r\n          console.error('[Google OAuth] Provider não habilitado no Supabase');\r\n        }\r\n        else if (error.message.includes('validation_failed') ||\r\n          error.message.includes('invalid_request')) {\r\n          toast.error(\r\n            \"Configuração do Google OAuth incompleta\",\r\n            {\r\n              description: \"O administrador precisa configurar as credenciais do Google no Supabase.\",\r\n              duration: 6000,\r\n            }\r\n          );\r\n          console.error('[Google OAuth] Credenciais OAuth inválidas ou não configuradas');\r\n        }\r\n        else if (error.message.includes('redirect_uri_mismatch')) {\r\n          toast.error(\r\n            \"URL de redirecionamento não autorizada\",\r\n            {\r\n              description: `A URL ${window.location.origin} precisa ser adicionada nas URLs autorizadas do Google Cloud Console.`,\r\n              duration: 8000,\r\n            }\r\n          );\r\n          console.error('[Google OAuth] Redirect URI não autorizada:', window.location.origin);\r\n        }\r\n        else if (error.message.includes('popup_closed_by_user')) {\r\n          toast.info(\"Login cancelado\", {\r\n            description: \"Você fechou a janela de login do Google.\",\r\n            duration: 3000,\r\n          });\r\n          console.log('[Google OAuth] Usuário cancelou o login');\r\n        }\r\n        else if (error.message.includes('network') || error.message.includes('fetch')) {\r\n          toast.error(\r\n            \"Erro de conexão\",\r\n            {\r\n              description: \"Verifique sua conexão com a internet e tente novamente.\",\r\n              duration: 5000,\r\n            }\r\n          );\r\n          console.error('[Google OAuth] Erro de rede');\r\n        }\r\n        else {\r\n          toast.error(\r\n            \"Erro ao fazer login com Google\",\r\n            {\r\n              description: error.message || \"Tente novamente ou use login com email.\",\r\n              duration: 6000,\r\n            }\r\n          );\r\n          console.error('[Google OAuth] Erro não tratado:', error);\r\n        }\r\n        return;\r\n      }\r\n\r\n      // Sucesso - usuário será redirecionado\r\n      console.log('[Google OAuth] Redirecionando para autenticação...');\r\n      toast.success(\"Redirecionando para o Google...\", {\r\n        description: \"Aguarde enquanto abrimos a página de login.\",\r\n        duration: 2000,\r\n      });\r\n\r\n    } catch (error: any) {\r\n      console.error('[Google OAuth] Exceção capturada:', error);\r\n\r\n      toast.error(\r\n        \"Erro inesperado no login com Google\",\r\n        {\r\n          description: \"Por favor, tente fazer login com email e senha ou entre em contato com o suporte.\",\r\n          duration: 6000,\r\n        }\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      if (isLogin) {\r\n        await signIn(email, password);\r\n        toast.success(\"Login realizado com sucesso\");\r\n      } else {\r\n        const { data: authData, error } = await supabase.auth.signUp({\r\n          email,\r\n          password,\r\n          options: {\r\n            data: {\r\n              full_name: fullName,\r\n              whatsapp: whatsapp\r\n            }\r\n          }\r\n        });\r\n        if (error) throw error;\r\n        await new Promise(resolve => setTimeout(resolve, 1000));\r\n        if (authData.user) {\r\n          const { error: profileError } = await supabase\r\n            .from('profiles')\r\n            .update({\r\n              first_name: fullName.split(' ')[0],\r\n              last_name: fullName.split(' ').slice(1).join(' '),\r\n              whatsapp: whatsapp\r\n            })\r\n            .eq('id', authData.user.id);\r\n          if (profileError) {\r\n            console.error(\"Error updating profile:\", profileError);\r\n          }\r\n        }\r\n        startTrial();\r\n        toast.success(\"Conta criada com sucesso! Seu período de teste de 7 dias começou.\");\r\n        await signIn(email, password);\r\n      }\r\n    } catch (error: any) {\r\n      console.error(\"Erro na autenticação:\", error);\r\n      toast.error(error.message || \"Ocorreu um erro ao processar sua solicitação\");\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 relative overflow-hidden\">\r\n      {/* Background decorativo */}\r\n      <div className=\"absolute inset-0 overflow-hidden\">\r\n        <div className=\"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-indigo-400/20 rounded-full blur-3xl animate-pulse\"></div>\r\n        <div className=\"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-purple-400/20 to-pink-400/20 rounded-full blur-3xl animate-pulse delay-1000\"></div>\r\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-to-r from-cyan-400/10 to-blue-400/10 rounded-full blur-3xl animate-pulse delay-500\"></div>\r\n      </div>\r\n\r\n      <div className=\"relative z-10 flex items-center justify-center min-h-screen p-4\">\r\n        {/* Container principal com animação de entrada */}\r\n        <div className=\"w-full max-w-6xl grid lg:grid-cols-2 gap-12 items-center animate-in fade-in duration-1000\">\r\n\r\n          {/* Lado esquerdo - Conteúdo promocional */}\r\n          <div className=\"hidden lg:flex flex-col justify-center space-y-10 px-8 overflow-visible\">\r\n            <div className=\"space-y-8 overflow-visible\">\r\n              {/* Badge de novidade com animação */}\r\n              <div className=\"inline-flex items-center px-6 py-3 rounded-full bg-gradient-to-r from-blue-500/15 to-indigo-500/15 border border-blue-200/60 backdrop-blur-sm shadow-lg animate-in slide-in-from-left duration-700 delay-200\">\r\n                <div className=\"w-2 h-2 bg-blue-500 rounded-full animate-pulse mr-3\"></div>\r\n                <span className=\"text-blue-700 text-sm font-semibold\">✨ Sistema Completo de CRM</span>\r\n              </div>\r\n\r\n              {/* Título principal com gradiente */}\r\n              <div className=\"space-y-6 overflow-visible\">\r\n                <div className=\"overflow-visible p-2 -m-2 animate-in slide-in-from-left duration-700 delay-300\">\r\n                  <h1 className=\"text-5xl lg:text-6xl font-bold leading-[1.2] tracking-tight text-gray-900 overflow-visible\"\r\n                    style={{ letterSpacing: '-0.02em' }}>\r\n                    Gerencie seus leads com\r\n                    <span className=\"block bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 bg-clip-text text-transparent mt-2 animate-in slide-in-from-left duration-700 delay-500\">\r\n                      inteligência\r\n                    </span>\r\n                  </h1>\r\n                </div>\r\n                <p className=\"text-xl lg:text-2xl text-gray-600 leading-relaxed animate-in slide-in-from-left duration-700 delay-700\">\r\n                  Transforme leads em resultados com nossa plataforma completa de gestão e automação.\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Features com ícones melhorados */}\r\n            <div className=\"space-y-6 animate-in slide-in-from-left duration-700 delay-900\">\r\n              <div className=\"flex items-center space-x-4 text-gray-700 group hover:text-gray-900 transition-colors duration-300\">\r\n                <div className=\"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                  <span className=\"text-white text-sm font-bold\">✓</span>\r\n                </div>\r\n                <span className=\"text-lg font-medium\">Dashboard com métricas em tempo real</span>\r\n              </div>\r\n              <div className=\"flex items-center space-x-4 text-gray-700 group hover:text-gray-900 transition-colors duration-300\">\r\n                <div className=\"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                  <span className=\"text-white text-sm font-bold\">✓</span>\r\n                </div>\r\n                <span className=\"text-lg font-medium\">Relatórios de comissão automáticos</span>\r\n              </div>\r\n              <div className=\"flex items-center space-x-4 text-gray-700 group hover:text-gray-900 transition-colors duration-300\">\r\n                <div className=\"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center shadow-lg group-hover:scale-110 transition-transform duration-300\">\r\n                  <span className=\"text-white text-sm font-bold\">✓</span>\r\n                </div>\r\n                <span className=\"text-lg font-medium\">Filtros personalizados</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Estatísticas impressionantes */}\r\n            <div className=\"grid grid-cols-3 gap-6 pt-6 animate-in slide-in-from-left duration-700 delay-1100\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl font-bold text-blue-600\">500+</div>\r\n                <div className=\"text-sm text-gray-600\">Leads/mês</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl font-bold text-green-600\">99%</div>\r\n                <div className=\"text-sm text-gray-600\">Satisfação</div>\r\n              </div>\r\n              <div className=\"text-center\">\r\n                <div className=\"text-3xl font-bold text-purple-600\">Rápido</div>\r\n                <div className=\"text-sm text-gray-600\">Suporte</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Lado direito - Formulário */}\r\n          <div className=\"w-full max-w-lg mx-auto\">\r\n            {showForgotPassword ? (\r\n              <ForgotPassword onBack={() => setShowForgotPassword(false)} />\r\n            ) : (\r\n              <div className=\"bg-white/90 backdrop-blur-2xl rounded-3xl shadow-2xl border border-white/30 p-10 transition-all duration-500 hover:shadow-3xl hover:scale-[1.02] animate-in slide-in-from-right duration-700 delay-200\">\r\n\r\n                {/* Header do formulário */}\r\n                <div className=\"text-center mb-10\">\r\n                  <div className=\"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl mb-6 shadow-lg\">\r\n                    <span className=\"text-2xl\">🚀</span>\r\n                  </div>\r\n                  <h2 className=\"text-3xl font-bold text-gray-900 mb-3\">\r\n                    {isLogin ? \"Bem-vindo de volta\" : \"Criar sua conta\"}\r\n                  </h2>\r\n                  <p className=\"text-gray-600 text-lg\">\r\n                    {isLogin ? \"Entre na sua conta para continuar\" : \"Comece seu período de teste gratuito\"}\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Formulário */}\r\n                <form onSubmit={handleSubmit} className=\"space-y-7\">\r\n\r\n                  {/* Campos do cadastro */}\r\n                  {!isLogin && (\r\n                    <div className=\"space-y-6 animate-in slide-in-from-top duration-500 delay-300\">\r\n                      <div className=\"space-y-3\">\r\n                        <Label htmlFor=\"fullName\" className=\"text-sm font-semibold text-gray-700 flex items-center gap-2\">\r\n                          <div className=\"w-5 h-5 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-md flex items-center justify-center\">\r\n                            <User className=\"w-3 h-3 text-white\" />\r\n                          </div>\r\n                          Nome Completo\r\n                        </Label>\r\n                        <Input\r\n                          id=\"fullName\"\r\n                          placeholder=\"Seu nome completo\"\r\n                          type=\"text\"\r\n                          required\r\n                          className={`h-14 rounded-2xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all duration-300 text-lg px-4 ${errors.fullName ? \"border-red-500 focus:border-red-500 focus:ring-red-500/10\" : \"hover:border-gray-300\"}`}\r\n                          value={fullName}\r\n                          onChange={e => setFullName(e.target.value)}\r\n                          disabled={isLoading}\r\n                        />\r\n                        {errors.fullName && <p className=\"text-sm text-red-500 flex items-center gap-2 animate-in slide-in-from-top duration-200\"><span className=\"text-red-500\">⚠</span>{errors.fullName}</p>}\r\n                      </div>\r\n\r\n                      <div className=\"space-y-3\">\r\n                        <Label htmlFor=\"whatsapp\" className=\"text-sm font-semibold text-gray-700 flex items-center gap-2\">\r\n                          <div className=\"w-5 h-5 bg-gradient-to-r from-green-500 to-emerald-500 rounded-md flex items-center justify-center\">\r\n                            <Phone className=\"w-3 h-3 text-white\" />\r\n                          </div>\r\n                          WhatsApp\r\n                        </Label>\r\n                        <Input\r\n                          id=\"whatsapp\"\r\n                          type=\"text\"\r\n                          required\r\n                          placeholder=\"(99) 99999-9999\"\r\n                          className={`h-14 rounded-2xl border-2 border-gray-200 focus:border-green-500 focus:ring-4 focus:ring-green-500/10 transition-all duration-300 text-lg px-4 ${errors.whatsapp ? \"border-red-500 focus:border-red-500 focus:ring-red-500/10\" : \"hover:border-gray-300\"}`}\r\n                          value={whatsapp}\r\n                          onChange={handlePhoneChange}\r\n                          maxLength={15}\r\n                          disabled={isLoading}\r\n                        />\r\n                        {errors.whatsapp && <p className=\"text-sm text-red-500 flex items-center gap-2 animate-in slide-in-from-top duration-200\"><span className=\"text-red-500\">⚠</span>{errors.whatsapp}</p>}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Email */}\r\n                  <div className=\"space-y-3\">\r\n                    <Label htmlFor=\"email\" className=\"text-sm font-semibold text-gray-700 flex items-center gap-2\">\r\n                      <div className=\"w-5 h-5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-md flex items-center justify-center\">\r\n                        <Mail className=\"w-3 h-3 text-white\" />\r\n                      </div>\r\n                      E-mail\r\n                    </Label>\r\n                    <Input\r\n                      id=\"email\"\r\n                      placeholder=\"seu.email@gmail.com\"\r\n                      type=\"email\"\r\n                      required\r\n                      autoComplete=\"email\"\r\n                      className={`h-14 rounded-2xl border-2 border-gray-200 focus:border-purple-500 focus:ring-4 focus:ring-purple-500/10 transition-all duration-300 text-lg px-4 ${errors.email ? \"border-red-500 focus:border-red-500 focus:ring-red-500/10\" : \"hover:border-gray-300\"}`}\r\n                      value={email}\r\n                      onChange={e => setEmail(e.target.value)}\r\n                      disabled={isLoading}\r\n                    />\r\n                    {errors.email && <p className=\"text-sm text-red-500 flex items-center gap-2 animate-in slide-in-from-top duration-200\"><span className=\"text-red-500\">⚠</span>{errors.email}</p>}\r\n                  </div>\r\n\r\n                  {/* Senha */}\r\n                  <div className=\"space-y-3\">\r\n                    <Label htmlFor=\"password\" className=\"text-sm font-semibold text-gray-700 flex items-center gap-2\">\r\n                      <div className=\"w-5 h-5 bg-gradient-to-r from-orange-500 to-red-500 rounded-md flex items-center justify-center\">\r\n                        <Lock className=\"w-3 h-3 text-white\" />\r\n                      </div>\r\n                      Senha\r\n                    </Label>\r\n                    <div className=\"relative\">\r\n                      <Input\r\n                        id=\"password\"\r\n                        type={showPassword ? \"text\" : \"password\"}\r\n                        required\r\n                        placeholder=\"••••••••\"\r\n                        autoComplete={isLogin ? \"current-password\" : \"new-password\"}\r\n                        className={`h-14 rounded-2xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-500/10 pr-14 transition-all duration-300 text-lg px-4 ${errors.password ? \"border-red-500 focus:border-red-500 focus:ring-red-500/10\" : \"hover:border-gray-300\"}`}\r\n                        value={password}\r\n                        onChange={e => setPassword(e.target.value)}\r\n                        disabled={isLoading}\r\n                      />\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-all duration-300 hover:scale-110\"\r\n                        onClick={() => setShowPassword(!showPassword)}\r\n                      >\r\n                        {showPassword ? <EyeOff className=\"h-6 w-6\" /> : <Eye className=\"h-6 w-6\" />}\r\n                      </button>\r\n                    </div>\r\n                    {errors.password && <p className=\"text-sm text-red-500 flex items-center gap-2 animate-in slide-in-from-top duration-200\"><span className=\"text-red-500\">⚠</span>{errors.password}</p>}\r\n\r\n                    {/* Link Esqueci minha senha - só no login */}\r\n                    {isLogin && (\r\n                      <div className=\"flex justify-end\">\r\n                        <button\r\n                          type=\"button\"\r\n                          onClick={() => setShowForgotPassword(true)}\r\n                          className=\"text-sm font-medium text-blue-600 hover:text-blue-500 transition-all duration-300 hover:underline hover:scale-105\"\r\n                          disabled={isLoading}\r\n                        >\r\n                          Esqueci minha senha\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Botão principal */}\r\n                  <Button\r\n                    type=\"submit\"\r\n                    className=\"w-full h-16 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 hover:from-blue-700 hover:via-indigo-700 hover:to-purple-700 text-white font-bold rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-3xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none text-lg\"\r\n                    disabled={isLoading}\r\n                  >\r\n                    {isLoading ? (\r\n                      <div className=\"flex items-center justify-center gap-3\">\r\n                        <div className=\"h-6 w-6 animate-spin rounded-full border-3 border-white/30 border-t-white\"></div>\r\n                        <span>{isLogin ? \"Entrando...\" : \"Criando conta...\"}</span>\r\n                      </div>\r\n                    ) : (\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        <span>{isLogin ? \"Entrar na conta\" : \"Criar conta grátis\"}</span>\r\n                        <span className=\"text-xl\">🚀</span>\r\n                      </div>\r\n                    )}\r\n                  </Button>\r\n\r\n                  {/* Divisor */}\r\n                  <div className=\"relative my-8\">\r\n                    <div className=\"absolute inset-0 flex items-center\">\r\n                      <span className=\"w-full border-t-2 border-gradient-to-r from-gray-200 via-gray-300 to-gray-200\" />\r\n                    </div>\r\n                    <div className=\"relative flex justify-center text-sm\">\r\n                      <span className=\"bg-white px-6 text-gray-500 font-medium\">ou continue com</span>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Google Sign In */}\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    className=\"w-full h-14 border-2 border-gray-200 rounded-2xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 transform hover:scale-[1.02] hover:shadow-lg text-lg font-semibold\"\r\n                    onClick={handleGoogleSignIn}\r\n                    disabled={isLoading}\r\n                    type=\"button\"\r\n                  >\r\n                    <svg className=\"mr-4 h-6 w-6\" viewBox=\"0 0 24 24\">\r\n                      <path d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" fill=\"#4285F4\" />\r\n                      <path d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" fill=\"#34A853\" />\r\n                      <path d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" fill=\"#FBBC05\" />\r\n                      <path d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" fill=\"#EA4335\" />\r\n                    </svg>\r\n                    Continuar com Google\r\n                  </Button>\r\n                </form>\r\n\r\n                {/* Toggle Login/Cadastro */}\r\n                <div className=\"mt-10 text-center\">\r\n                  <div className=\"bg-gradient-to-r from-gray-50 to-blue-50 rounded-2xl p-6 border border-gray-100\">\r\n                    <p className=\"text-gray-600 text-lg mb-3\">\r\n                      {isLogin ? \"Não tem uma conta? \" : \"Já tem uma conta? \"}\r\n                    </p>\r\n                    <button\r\n                      onClick={() => setIsLogin(!isLogin)}\r\n                      className=\"font-bold text-blue-600 hover:text-blue-500 transition-all duration-300 hover:underline hover:scale-105 text-lg\"\r\n                      disabled={isLoading}\r\n                    >\r\n                      {isLogin ? \"Criar conta grátis\" : \"Fazer login\"}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"mt-8 text-center\">\r\n                  <div className=\"flex items-center justify-center space-x-8 text-sm text-gray-500\">\r\n                    <a href=\"#\" className=\"hover:text-gray-700 transition-all duration-300 hover:scale-105 font-medium\">Termos de Uso</a>\r\n                    <div className=\"w-1 h-1 bg-gray-300 rounded-full\"></div>\r\n                    <a href=\"#\" className=\"hover:text-gray-700 transition-all duration-300 hover:scale-105 font-medium\">Privacidade</a>\r\n                    <div className=\"w-1 h-1 bg-gray-300 rounded-full\"></div>\r\n                    <a href=\"#\" className=\"hover:text-gray-700 transition-all duration-300 hover:scale-105 font-medium\">Suporte</a>\r\n                  </div>\r\n                  <div className=\"mt-4 text-xs text-gray-400\">\r\n                    &copy; 2024 LeadConsig. Todos os direitos reservados.\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\MaquinaDeLeads.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkAccess'. Either include it or remove the dependency array.","line":25,"column":6,"nodeType":"ArrayExpression","endLine":25,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [checkAccess, user]","fix":{"range":[934,940],"text":"[checkAccess, user]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1111,1114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1111,1114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2269,2272],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2269,2272],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2752,2755],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2752,2755],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3113,3116],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3113,3116],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { Card, CardContent, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { \r\n  Download, CheckCircle, CreditCard, Gift, BookOpen, ArrowRight\r\n} from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nconst MaquinaDeLeads = () => {\r\n  const { user } = useAuth();\r\n  const [hasAccess, setHasAccess] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [processing, setProcessing] = useState(false);\r\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\r\n\r\n  const price = 197.00;\r\n  const originalPrice = 597.00;\r\n\r\n  useEffect(() => {\r\n    checkAccess();\r\n  }, [user]);\r\n\r\n  const checkAccess = async () => {\r\n    if (!user) {\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const { data, error } = await (supabase as any)\r\n        .from('course_purchases')\r\n        .select('*')\r\n        .eq('user_id', user.id)\r\n        .eq('course_id', 'curso-trafego-pago')\r\n        .eq('status', 'paid')\r\n        .single();\r\n\r\n      if (error && error.code !== 'PGRST116') {\r\n        console.error('Erro ao verificar acesso:', error);\r\n      }\r\n\r\n      setHasAccess(!!data);\r\n      \r\n      if (data) {\r\n        await loadPdf();\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao verificar acesso:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const loadPdf = async () => {\r\n    try {\r\n      const { data } = await supabase.storage\r\n        .from('courses')\r\n        .getPublicUrl('curso-trafego-pago/curso.pdf');\r\n      \r\n      if (data?.publicUrl) {\r\n        setPdfUrl(data.publicUrl);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erro ao carregar PDF:', error);\r\n    }\r\n  };\r\n\r\n  const handlePurchase = async () => {\r\n    if (!user) {\r\n      toast.error(\"Você precisa estar logado para comprar o curso\");\r\n      return;\r\n    }\r\n\r\n    setProcessing(true);\r\n    try {\r\n      const { data: purchase, error: purchaseError } = await (supabase as any)\r\n        .from('course_purchases')\r\n        .insert({\r\n          user_id: user.id,\r\n          course_id: 'curso-trafego-pago',\r\n          amount: price,\r\n          status: 'pending',\r\n          payment_method: 'manual'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (purchaseError) throw purchaseError;\r\n\r\n      toast.success(\"Redirecionando para pagamento...\");\r\n      \r\n      setTimeout(async () => {\r\n        const { error: updateError } = await (supabase as any)\r\n          .from('course_purchases')\r\n          .update({ status: 'paid', paid_at: new Date().toISOString() })\r\n          .eq('id', purchase.id);\r\n\r\n        if (updateError) throw updateError;\r\n\r\n        toast.success(\"Pagamento confirmado! Acesso liberado!\");\r\n        setHasAccess(true);\r\n        await loadPdf();\r\n      }, 2000);\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao processar compra:', error);\r\n      toast.error(`Erro ao processar compra: ${error.message}`);\r\n    } finally {\r\n      setProcessing(false);\r\n    }\r\n  };\r\n\r\n  const handleDownload = () => {\r\n    if (pdfUrl) {\r\n      window.open(pdfUrl, '_blank');\r\n    } else {\r\n      toast.error(\"PDF não encontrado. Entre em contato com o suporte.\");\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <PageLayout title=\"Curso de Tráfego Pago para Corbans\" subtitle=\"Carregando...\">\r\n        <div className=\"flex items-center justify-center h-64\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\r\n        </div>\r\n      </PageLayout>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <PageLayout title=\"Curso de Tráfego Pago para Corbans\" subtitle=\"\">\r\n      {hasAccess ? (\r\n        <div className=\"max-w-2xl mx-auto py-8 px-4\">\r\n          <Card className=\"border-2 border-green-500 shadow-2xl\">\r\n            <div className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white p-6 rounded-t-lg\">\r\n              <div className=\"flex items-center gap-3 mb-4\">\r\n                <CheckCircle className=\"h-8 w-8\" />\r\n                <h1 className=\"text-2xl font-bold\">Acesso Liberado!</h1>\r\n              </div>\r\n              <p className=\"text-green-50\">\r\n                Você tem acesso completo ao Curso de Tráfego Pago para Corbans\r\n              </p>\r\n            </div>\r\n            <CardContent className=\"p-8\">\r\n              <Button \r\n                onClick={handleDownload} \r\n                className=\"w-full bg-green-600 hover:bg-green-700 text-white text-lg py-6\"\r\n                size=\"lg\"\r\n              >\r\n                <Download className=\"h-5 w-5 mr-2\" />\r\n                Baixar Curso em PDF\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      ) : (\r\n        <div className=\"max-w-3xl mx-auto px-4 py-6\">\r\n          <Card className=\"border-3 border-yellow-400 bg-gradient-to-br from-white via-yellow-50/30 to-orange-50/50 shadow-2xl relative overflow-hidden\">\r\n            {/* Decorative Elements */}\r\n            <div className=\"absolute top-0 right-0 w-32 h-32 bg-orange-200/20 rounded-full blur-3xl\"></div>\r\n            <div className=\"absolute bottom-0 left-0 w-24 h-24 bg-yellow-200/20 rounded-full blur-2xl\"></div>\r\n            \r\n            <CardHeader className=\"text-center p-5 sm:p-7 relative z-10\">\r\n              <Badge className=\"w-fit mx-auto bg-gradient-to-r from-yellow-500 to-orange-500 text-white mb-3 text-xs sm:text-sm px-3 sm:px-4 py-1 font-bold shadow-lg\">\r\n                <BookOpen className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1.5 inline\" />\r\n                Curso em PDF\r\n              </Badge>\r\n              \r\n              <CardTitle className=\"text-2xl sm:text-3xl md:text-4xl font-black text-gray-900 mb-6 leading-tight\">\r\n                Curso de Tráfego Pago<br />\r\n                <span className=\"text-blue-600\">para Corbans</span>\r\n              </CardTitle>\r\n              \r\n              {/* Preço Destacado */}\r\n              <div className=\"my-6 bg-white/80 backdrop-blur-sm rounded-xl p-5 border-2 border-orange-200 shadow-lg\">\r\n                <div className=\"flex items-baseline justify-center gap-2 mb-2\">\r\n                  <span className=\"text-4xl sm:text-5xl font-black text-orange-600\">R$ 197</span>\r\n                  <span className=\"text-xl sm:text-2xl font-bold text-gray-600\">,00</span>\r\n                </div>\r\n                <div className=\"flex items-center justify-center gap-2 mb-3\">\r\n                  <p className=\"text-sm text-gray-500 line-through\">De R$597,00</p>\r\n                  <Badge className=\"bg-gradient-to-r from-red-600 to-red-700 text-white text-xs px-3 py-1 font-bold shadow-md\">\r\n                    67% OFF\r\n                  </Badge>\r\n                </div>\r\n                <p className=\"text-xs text-gray-600 font-medium\">Economize R$400,00</p>\r\n              </div>\r\n              \r\n              {/* Bônus - SUPER DESTACADO */}\r\n              <div className=\"bg-gradient-to-r from-green-500 via-emerald-500 to-green-600 border-3 border-green-700 rounded-xl p-5 mb-5 shadow-2xl transform hover:scale-[1.02] transition-all relative overflow-hidden\">\r\n                <div className=\"absolute top-0 right-0 w-20 h-20 bg-white/10 rounded-full blur-xl\"></div>\r\n                <div className=\"relative z-10\">\r\n                  <div className=\"flex items-center justify-center gap-2 mb-3\">\r\n                    <Gift className=\"w-7 h-7 text-white animate-pulse\" />\r\n                    <h3 className=\"font-black text-white text-lg sm:text-xl drop-shadow-lg\">\r\n                      BÔNUS EXCLUSIVO AO COMPRAR!\r\n                    </h3>\r\n                  </div>\r\n                  <div className=\"bg-white/25 backdrop-blur-md rounded-lg p-4 border border-white/30\">\r\n                    <p className=\"text-white font-black text-lg sm:text-xl text-center mb-2 drop-shadow-md\">\r\n                      🎁 TEMPLATES PRONTOS + PLANILHAS BÔNUS\r\n                    </p>\r\n                    <p className=\"text-white/95 text-sm text-center font-medium\">\r\n                      Receba templates prontos de campanhas para Google Ads, Facebook e Instagram + planilhas de gestão e acompanhamento de ROI\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Conteúdo do Curso */}\r\n              <div className=\"text-left mb-5 bg-white/60 backdrop-blur-sm rounded-lg p-4 border border-gray-200\">\r\n                <p className=\"text-sm sm:text-base font-bold text-gray-900 mb-4 text-center\">📚 O que você vai aprender:</p>\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Como criar campanhas no Google Ads</span>\r\n                  </div>\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Anúncios no Facebook e Instagram</span>\r\n                  </div>\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Segmentação de público para Corbans</span>\r\n                  </div>\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Leads para INSS, FGTS e Bolsa Família</span>\r\n                  </div>\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Otimização de campanhas e ROI</span>\r\n                  </div>\r\n                  <div className=\"flex items-start\">\r\n                    <CheckCircle className=\"w-4 h-4 text-green-600 mr-2 flex-shrink-0 mt-0.5\" />\r\n                    <span className=\"text-sm text-gray-700 font-medium\">Funil de vendas que converte</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardHeader>\r\n            <CardFooter className=\"p-5 sm:p-7 relative z-10\">\r\n              <Button \r\n                onClick={handlePurchase}\r\n                disabled={processing}\r\n                className=\"w-full bg-gradient-to-r from-orange-600 via-orange-500 to-orange-600 hover:from-orange-700 hover:via-orange-600 hover:to-orange-700 text-white text-base sm:text-lg py-4 sm:py-5 font-black shadow-2xl hover:shadow-3xl transform hover:scale-105 transition-all rounded-xl\" \r\n              >\r\n                {processing ? (\r\n                  <>\r\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2 inline\"></div>\r\n                    Processando...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <CreditCard className=\"w-5 h-5 mr-2 inline\" />\r\n                    COMPRAR CURSO AGORA\r\n                    <ArrowRight className=\"w-5 h-5 ml-2 inline\" />\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </CardFooter>\r\n          </Card>\r\n        </div>\r\n      )}\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default MaquinaDeLeads;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Notes.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Plans.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Portability.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3923,3926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3923,3926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":109,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":109,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4522,4525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4522,4525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6631,6634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6631,6634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":203,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":203,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7424,7427],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7424,7427],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":233,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":233,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8343,8346],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8343,8346],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { Calendar as CalendarIcon, Loader2, Plus, Trash2, MoreVertical, AlertCircle, Edit, Check, X, Ban, RotateCcw } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Dialog, DialogContent, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { CustomCalendar } from \"@/components/ui/custom-calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger, DropdownMenuSeparator } from \"@/components/ui/dropdown-menu\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport Header from \"@/components/Header\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { BankSelect } from \"@/components/forms/BankSelect\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { getBankName } from \"@/utils/bankUtils\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\nimport { hasAdminPassword } from \"@/utils/adminPassword\";\r\n\r\ninterface Portability {\r\n  id: string;\r\n  title: string;\r\n  lead_id: string | null;\r\n  notes: string | null;\r\n  due_date: string;\r\n  is_completed: boolean;\r\n  created_at: string;\r\n  bank: string | null;\r\n  status: 'pendente' | 'concluido' | 'cancelado' | 'redigitado';\r\n  employee: string | null;\r\n  lead?: { name: string };\r\n}\r\n\r\ninterface Lead {\r\n  id: string;\r\n  name: string;\r\n  bank: string | null;\r\n}\r\n\r\nconst Portability = () => {\r\n  const [portabilities, setPortabilities] = useState<Portability[]>([]);\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [editingPortability, setEditingPortability] = useState<Portability | null>(null);\r\n  const [activeTab, setActiveTab] = useState(\"all\");\r\n  const [currentMonth, setCurrentMonth] = useState(new Date());\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [portabilityToDelete, setPortabilityToDelete] = useState<string | null>(null);\r\n  const [hasAdminPwd, setHasAdminPwd] = useState(false);\r\n\r\n  const initialFormState = {\r\n    title: \"\",\r\n    lead_id: \"\",\r\n    due_date: new Date(),\r\n    notes: \"\",\r\n    bank: \"\",\r\n    status: 'pendente' as Portability['status'],\r\n    employee: \"\",\r\n  };\r\n\r\n  const [formData, setFormData] = useState(initialFormState);\r\n\r\n  const fetchData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const { data: leadsData, error: leadsError } = await supabase\r\n        .from(\"leads\")\r\n        .select(\"id, name, bank\");\r\n      if (leadsError) throw leadsError;\r\n      setLeads(leadsData || []);\r\n\r\n      const { data: portabilitiesData, error: portabilitiesError } = await supabase\r\n        .from(\"portabilities\")\r\n        .select(\"*, lead:leads(name)\");\r\n      if (portabilitiesError) throw portabilitiesError;\r\n      setPortabilities((portabilitiesData as unknown as Portability[]) || []);\r\n\r\n    } catch (error: any) {\r\n      toast.error(\"Erro ao carregar dados\", { description: error.message });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    hasAdminPassword().then(setHasAdminPwd);\r\n  }, []);\r\n  \r\n  useEffect(() => {\r\n    if (formData.lead_id) {\r\n      const selectedLead = leads.find(l => l.id === formData.lead_id);\r\n      if (selectedLead?.bank) {\r\n        setFormData(prev => ({ ...prev, bank: selectedLead.bank as string }));\r\n      }\r\n    }\r\n  }, [formData.lead_id, leads]);\r\n\r\n  const handleInputChange = (field: keyof typeof formData, value: any) => {\r\n    setFormData(prev => ({ ...prev, [field]: value }));\r\n  };\r\n\r\n  const handleOpenDialog = (portability: Portability | null = null) => {\r\n    setEditingPortability(portability);\r\n    if (portability) {\r\n      setFormData({\r\n        title: portability.title,\r\n        lead_id: portability.lead_id || \"\",\r\n        due_date: new Date(portability.due_date),\r\n        notes: portability.notes || \"\",\r\n        bank: portability.bank || \"\",\r\n        status: portability.status,\r\n      });\r\n    } else {\r\n      setFormData(initialFormState);\r\n    }\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const handleCloseDialog = () => {\r\n    setIsDialogOpen(false);\r\n    setEditingPortability(null);\r\n    setFormData(initialFormState);\r\n  };\r\n\r\n  const handleSavePortability = async () => {\r\n    if (!formData.title || !formData.due_date) {\r\n      return toast.error(\"Título e Data são obrigatórios.\");\r\n    }\r\n    \r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Usuário não autenticado.\");\r\n\r\n      const portabilityData = {\r\n        title: formData.title,\r\n        lead_id: formData.lead_id || null,\r\n        due_date: formData.due_date.toISOString(),\r\n        notes: formData.notes,\r\n        bank: formData.bank,\r\n        status: formData.status,\r\n        employee: formData.employee || null,\r\n        user_id: user.id,\r\n        is_completed: formData.status === 'concluido',\r\n      };\r\n\r\n      let response;\r\n      if (editingPortability) {\r\n        response = await supabase\r\n          .from(\"portabilities\")\r\n          .update(portabilityData)\r\n          .eq(\"id\", editingPortability.id)\r\n          .select()\r\n          .single();\r\n      } else {\r\n        response = await supabase\r\n          .from(\"portabilities\")\r\n          .insert(portabilityData)\r\n          .select()\r\n          .single();\r\n      }\r\n\r\n      if (response.error) throw response.error;\r\n\r\n      toast.success(editingPortability ? 'Portabilidade atualizada com sucesso!' : 'Portabilidade criada com sucesso!');\r\n      handleCloseDialog();\r\n      fetchData();\r\n\r\n    } catch (error: any) {\r\n      toast.error('Erro ao salvar portabilidade', { description: error.message });\r\n    }\r\n  };\r\n  \r\n  const handleDeletePortability = async (id: string) => {\r\n    // Se tiver senha administrativa configurada, pedir confirmação\r\n    if (hasAdminPwd) {\r\n      setPortabilityToDelete(id);\r\n      setShowAdminPasswordDialog(true);\r\n      return;\r\n    }\r\n    \r\n    // Se não tiver senha configurada, deletar diretamente\r\n    confirmDeletePortability(id);\r\n  };\r\n\r\n  const confirmDeletePortability = async (id: string) => {\r\n    try {\r\n      const { error } = await supabase.from(\"portabilities\").delete().eq(\"id\", id);\r\n      if (error) throw error;\r\n      toast.success(\"Portabilidade removida com sucesso!\");\r\n      fetchData();\r\n      setPortabilityToDelete(null);\r\n    } catch (error: any) {\r\n       toast.error('Erro ao remover portabilidade', { description: error.message });\r\n       setPortabilityToDelete(null);\r\n    }\r\n  };\r\n\r\n  const handleUpdateStatus = async (portability: Portability, newStatus: Portability['status']) => {\r\n    try {\r\n      const is_completed = newStatus === 'concluido';\r\n      \r\n      const { error } = await supabase\r\n        .from(\"portabilities\")\r\n        .update({ \r\n          status: newStatus, \r\n          is_completed,\r\n          updated_at: new Date().toISOString() \r\n        })\r\n        .eq(\"id\", portability.id);\r\n        \r\n      if (error) throw error;\r\n      \r\n      const statusText = {\r\n        'cancelado': 'Cancelado',\r\n        'redigitado': 'Redigitado',\r\n        'concluido': 'Concluído',\r\n        'pendente': 'Pendente'\r\n      }[newStatus];\r\n      \r\n      toast.success('Portabilidade marcada como ' + statusText);\r\n      fetchData();\r\n    } catch (error: any) {\r\n      toast.error('Erro ao atualizar status da portabilidade', { description: error.message });\r\n    }\r\n  };\r\n  \r\n  const filteredPortabilities = useMemo(() => {\r\n    if (activeTab === \"all\") return portabilities;\r\n    if (activeTab === \"concluido\") return portabilities.filter(p => p.is_completed);\r\n    return portabilities.filter(p => p.status === activeTab && !p.is_completed);\r\n  }, [portabilities, activeTab]);\r\n\r\n  const getStatusBadge = (status: Portability['status'], is_completed: boolean) => {\r\n    let text = \"Pendente\";\r\n    let className = \"bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium\";\r\n\r\n    switch(status) {\r\n      case 'concluido':\r\n        text = \"Concluído\";\r\n        className = \"bg-green-50 text-green-700 border border-green-200 text-xs font-medium\";\r\n        break;\r\n      case 'cancelado':\r\n        text = \"Cancelado\";\r\n        className = \"bg-red-50 text-red-700 border border-red-200 text-xs font-medium\";\r\n        break;\r\n      case 'redigitado':\r\n        text = \"Redigitado\";\r\n        className = \"bg-orange-50 text-orange-700 border border-orange-200 text-xs font-medium\";\r\n        break;\r\n      case 'pendente':\r\n      default:\r\n        text = \"Pendente\";\r\n        className = \"bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium\";\r\n        break;\r\n    }\r\n\r\n    return <Badge className={className}>{text}</Badge>;\r\n  };\r\n\r\n  const headerActions = (\r\n    <Button onClick={() => handleOpenDialog()}>\r\n      <Plus className=\"mr-2 h-4 w-4\" /> Novo Lembrete\r\n    </Button>\r\n  );\r\n\r\n  return (\r\n    <SidebarProvider>\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 w-full flex\">\r\n        <AppSidebar />\r\n        <div className=\"flex-1 w-full overflow-hidden min-w-0\">\r\n          <Header />\r\n          <main className=\"w-full h-full\">\r\n            <div className=\"p-6 space-y-6\">\r\n              <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n                <div className=\"p-8\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center space-x-4\">\r\n                      <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                        <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 9l4-4 4 4m0 6l-4 4-4-4\" />\r\n                        </svg>\r\n                      </div>\r\n                      <div>\r\n                        <h1 className=\"text-3xl font-bold\">Portabilidade</h1>\r\n                        <p className=\"text-blue-100 text-lg mt-1\">Gerencie e acompanhe suas portabilidades</p>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"hidden md:flex items-center space-x-4\">\r\n                      <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                        <div className=\"text-sm text-blue-100\">Total de Portabilidades</div>\r\n                        <div className=\"text-2xl font-bold\">\r\n                          {filteredPortabilities.length}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  {headerActions}\r\n                </div>\r\n              </div>\r\n\r\n              <Tabs defaultValue=\"all\" onValueChange={setActiveTab}>\r\n                <TabsList className=\"grid w-full grid-cols-5 md:w-auto mb-6\">\r\n                  <TabsTrigger value=\"all\">Todos</TabsTrigger>\r\n                  <TabsTrigger value=\"pendente\">Pendentes</TabsTrigger>\r\n                  <TabsTrigger value=\"concluido\">Concluídos</TabsTrigger>\r\n                  <TabsTrigger value=\"cancelado\">Cancelados</TabsTrigger>\r\n                  <TabsTrigger value=\"redigitado\">Redigitados</TabsTrigger>\r\n                </TabsList>\r\n              </Tabs>\r\n      \r\n              {isLoading ? (\r\n                <div className=\"flex justify-center items-center h-64\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n                </div>\r\n              ) : (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                  {filteredPortabilities.map(portability => (\r\n                    <Card key={portability.id} className=\"flex flex-col transition-all duration-200 hover:shadow-lg border-0 shadow-sm hover:shadow-xl hover:-translate-y-1\">\r\n                      <CardHeader>\r\n                        <div className=\"flex justify-between items-start\">\r\n                          <CardTitle className=\"text-lg\">{portability.title}</CardTitle>\r\n                          <DropdownMenu>\r\n                            <DropdownMenuTrigger asChild>\r\n                              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                                <MoreVertical className=\"h-4 w-4\" />\r\n                              </Button>\r\n                            </DropdownMenuTrigger>\r\n                            <DropdownMenuContent align=\"end\" className=\"w-56\">\r\n                              <DropdownMenuItem onClick={() => handleOpenDialog(portability)} className=\"flex items-center gap-2\">\r\n                                <Edit className=\"h-4 w-4\" />\r\n                                Editar\r\n                              </DropdownMenuItem>\r\n                      \r\n                              <DropdownMenuSeparator />\r\n                      \r\n                              {!portability.is_completed ? (\r\n                                <DropdownMenuItem onClick={() => handleUpdateStatus(portability, 'concluido')} className=\"flex items-center gap-2 text-green-600\">\r\n                                  <Check className=\"h-4 w-4\" />\r\n                                  Marcar como Concluído\r\n                                </DropdownMenuItem>\r\n                              ) : (\r\n                                <DropdownMenuItem onClick={() => handleUpdateStatus(portability, 'pendente')} className=\"flex items-center gap-2 text-blue-600\">\r\n                                  <RotateCcw className=\"h-4 w-4\" />\r\n                                  Marcar como Pendente\r\n                                </DropdownMenuItem>\r\n                              )}\r\n                      \r\n                              <DropdownMenuItem onClick={() => handleUpdateStatus(portability, 'cancelado')} className=\"flex items-center gap-2 text-red-600\">\r\n                                <Ban className=\"h-4 w-4\" />\r\n                                Marcar como Cancelado\r\n                              </DropdownMenuItem>\r\n                      \r\n                              <DropdownMenuItem onClick={() => handleUpdateStatus(portability, 'redigitado')} className=\"flex items-center gap-2 text-orange-600\">\r\n                                <RotateCcw className=\"h-4 w-4\" />\r\n                                Marcar como Redigitado\r\n                              </DropdownMenuItem>\r\n                      \r\n                              <DropdownMenuSeparator />\r\n                      \r\n                              <AlertDialog>\r\n                                <AlertDialogTrigger asChild>\r\n                                  <DropdownMenuItem onSelect={(e) => e.preventDefault()} className=\"flex items-center gap-2 text-red-600 focus:text-red-600\">\r\n                                    <Trash2 className=\"h-4 w-4\" />\r\n                                    Excluir\r\n                                  </DropdownMenuItem>\r\n                                </AlertDialogTrigger>\r\n                                <AlertDialogContent>\r\n                                  <AlertDialogHeader>\r\n                                    <AlertDialogTitle>Tem certeza?</AlertDialogTitle>\r\n                                    <AlertDialogDescription>\r\n                                      Esta ação não pode ser desfeita. Isso excluirá permanentemente o lembrete \"{portability.title}\".\r\n                                    </AlertDialogDescription>\r\n                                  </AlertDialogHeader>\r\n                                  <AlertDialogFooter>\r\n                                    <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                                    <AlertDialogAction \r\n                                      onClick={() => handleDeletePortability(portability.id)}\r\n                                      className=\"bg-red-600 hover:bg-red-700\"\r\n                                    >\r\n                                      Sim, excluir\r\n                                    </AlertDialogAction>\r\n                                  </AlertDialogFooter>\r\n                                </AlertDialogContent>\r\n                              </AlertDialog>\r\n                            </DropdownMenuContent>\r\n                          </DropdownMenu>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                          <CalendarIcon className=\"h-4 w-4\" />\r\n                          <span>{format(new Date(portability.due_date), \"dd/MM/yyyy\")}</span>\r\n                          {new Date(portability.due_date) < new Date() && !portability.is_completed && (\r\n                            <Badge variant=\"destructive\" className=\"flex items-center gap-1\">\r\n                              <AlertCircle className=\"h-3 w-3\" /> Atrasado\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                      </CardHeader>\r\n                      <CardContent className=\"flex-grow space-y-2\">\r\n                        {portability.lead_id && <Badge variant=\"secondary\">{portability.lead?.name || 'Cliente...'}</Badge>}\r\n                        {portability.bank && <Badge variant=\"outline\">{getBankName(portability.bank)}</Badge>}\r\n                        {portability.notes && (\r\n                          <div className=\"pt-2\">\r\n                            <p className=\"text-sm text-muted-foreground break-words overflow-wrap-anywhere hyphens-auto max-h-20 overflow-y-auto\">\r\n                              {portability.notes}\r\n                            </p>\r\n                          </div>\r\n                        )}\r\n                      </CardContent>\r\n                      <CardFooter className=\"flex justify-center\">\r\n                        {getStatusBadge(portability.status, portability.is_completed)}\r\n                      </CardFooter>\r\n                    </Card>\r\n                  ))}\r\n                </div>\r\n              )}\r\n      \r\n              {!isLoading && filteredPortabilities.length === 0 && (\r\n                <div className=\"text-center py-16\">\r\n                  <p className=\"text-lg font-semibold\">Nenhuma portabilidade encontrada</p>\r\n                  <p className=\"text-muted-foreground\">Tente criar uma nova portabilidade ou mudar de aba.</p>\r\n                </div>\r\n              )}\r\n\r\n              <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n                <DialogContent className=\"sm:max-w-[425px]\" onInteractOutside={(e) => e.preventDefault()} onCloseAutoFocus={handleCloseDialog}>\r\n                  <DialogHeader>\r\n                    <DialogTitle>{editingPortability ? 'Editar Lembrete' : 'Novo Lembrete'}</DialogTitle>\r\n                  </DialogHeader>\r\n                  <div className=\"grid gap-4 py-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"title\">Título</Label>\r\n                      <Input id=\"title\" value={formData.title} onChange={(e) => handleInputChange('title', e.target.value)} />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"lead_id\">Cliente (Opcional)</Label>\r\n                      <Select value={formData.lead_id} onValueChange={(value) => handleInputChange('lead_id', value)}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Selecione um cliente\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          {leads.map((lead) => (\r\n                            <SelectItem key={lead.id} value={lead.id}>\r\n                              {lead.name}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"due_date\">Data</Label>\r\n                      <Popover>\r\n                        <PopoverTrigger asChild>\r\n                          <Button variant={\"outline\"} className={cn(\"w-full justify-start text-left font-normal\", !formData.due_date && \"text-muted-foreground\")}>\r\n                            <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                            {formData.due_date ? format(formData.due_date, \"PPP\", { locale: ptBR }) : <span>Escolha uma data</span>}\r\n                          </Button>\r\n                        </PopoverTrigger>\r\n                        <PopoverContent className=\"w-auto p-0\">\r\n                          <CustomCalendar \r\n                            selected={formData.due_date} \r\n                            onSelect={(date) => handleInputChange('due_date', date)} \r\n                            currentMonth={currentMonth}\r\n                            onMonthChange={setCurrentMonth}\r\n                            size=\"sm\"\r\n                            className=\"p-4\"\r\n                          />\r\n                        </PopoverContent>\r\n                      </Popover>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"notes\">Notas (Opcional)</Label>\r\n                      <Textarea id=\"notes\" value={formData.notes} onChange={(e) => handleInputChange('notes', e.target.value)} />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"bank\">Banco</Label>\r\n                      <BankSelect \r\n                        value={formData.bank || \"none\"} \r\n                        onValueChange={(value) => handleInputChange('bank', value)}\r\n                        placeholder=\"Selecione um banco (opcional)\"\r\n                        showNoneOption={true}\r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"status\">Status</Label>\r\n                      <Select value={formData.status} onValueChange={(value) => handleInputChange('status', value)}>\r\n                        <SelectTrigger>\r\n                          <SelectValue placeholder=\"Selecione o status\" />\r\n                        </SelectTrigger>\r\n                        <SelectContent>\r\n                          <SelectItem value=\"pendente\">Pendente</SelectItem>\r\n                          <SelectItem value=\"concluido\">Concluído</SelectItem>\r\n                          <SelectItem value=\"cancelado\">Cancelado</SelectItem>\r\n                          <SelectItem value=\"redigitado\">Redigitado</SelectItem>\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                  <DialogFooter>\r\n                    <Button variant=\"ghost\" onClick={handleCloseDialog}>Cancelar</Button>\r\n                    <Button onClick={handleSavePortability}>Salvar</Button>\r\n                  </DialogFooter>\r\n                </DialogContent>\r\n              </Dialog>\r\n\r\n              {/* Dialog de confirmação com senha administrativa */}\r\n              <AdminPasswordDialog\r\n                open={showAdminPasswordDialog}\r\n                onOpenChange={(open) => {\r\n                  setShowAdminPasswordDialog(open);\r\n                  if (!open) {\r\n                    setPortabilityToDelete(null);\r\n                  }\r\n                }}\r\n                onConfirm={() => {\r\n                  if (portabilityToDelete) {\r\n                    confirmDeletePortability(portabilityToDelete);\r\n                  }\r\n                }}\r\n                title=\"Confirmar Exclusão de Portabilidade\"\r\n                description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n                itemName={portabilityToDelete ? portabilities.find(p => p.id === portabilityToDelete)?.title : undefined}\r\n              />\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n    </SidebarProvider>\r\n  );\r\n};\r\n\r\nexport default Portability;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Reminders.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6880,6883],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6880,6883],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'filterReminders'. Either include it or remove the dependency array.","line":189,"column":6,"nodeType":"ArrayExpression","endLine":189,"endColumn":32,"suggestions":[{"desc":"Update the dependencies array to be: [reminders, currentStatus, filterReminders]","fix":{"range":[7227,7253],"text":"[reminders, currentStatus, filterReminders]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":243,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":243,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8867,8870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8867,8870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":244,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":244,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8926,8929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8926,8929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":294,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":294,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10763,10766],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10763,10766],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":326,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":326,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11867,11870],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11867,11870],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":356,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":356,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12816,12819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12816,12819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":390,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":390,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13845,13848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13845,13848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":442,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":442,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15717,15720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15717,15720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":473,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16619,16622],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16619,16622],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":889,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":889,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32340,32343],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32340,32343],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":895,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":895,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[32497,32500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[32497,32500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchReminders'. Either include it or remove the dependency array.","line":911,"column":6,"nodeType":"ArrayExpression","endLine":911,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchReminders]","fix":{"range":[32905,32907],"text":"[fetchReminders]"}}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { format, setHours, setMinutes, isPast, startOfDay } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Plus, Check, Trash2, Clock, User, FileText, CalendarIcon, AlertCircle, Loader2, Edit3, ChevronDown } from \"lucide-react\";\r\nimport { BankSelect } from \"@/components/forms/BankSelect\";\r\nimport { SidebarProvider } from \"@/components/ui/sidebar\";\r\nimport { AppSidebar } from \"@/components/AppSidebar\";\r\nimport Header from \"@/components/Header\";\r\nimport { Pagination, PaginationContent, PaginationItem, PaginationLink, PaginationNext, PaginationPrevious } from \"@/components/ui/pagination\";\r\nimport { CustomCalendar } from \"@/components/ui/custom-calendar\";\r\nimport { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from \"@/components/ui/command\";\r\nimport { getEmployees, Employee } from \"@/utils/employees\";\r\nimport { AdminPasswordDialog } from \"@/components/AdminPasswordDialog\";\r\n\r\nconst getBankName = (bankCode: string | null | undefined) => {\r\n  if (!bankCode) return \"Não informado\";\r\n  \r\n  const banks: { [key: string]: string } = {\r\n    \"caixa\": \"Caixa Econômica Federal\",\r\n    \"bb\": \"Banco do Brasil\",\r\n    \"itau\": \"Itaú Unibanco\",\r\n    \"bradesco\": \"Bradesco\",\r\n    \"santander\": \"Santander\",\r\n    \"c6\": \"C6 Bank\",\r\n    \"brb\": \"BRB - Banco de Brasília\",\r\n    \"bmg\": \"Banco BMG\",\r\n    \"pan\": \"Banco Pan\",\r\n    \"ole\": \"Banco Olé\",\r\n    \"daycoval\": \"Banco Daycoval\",\r\n    \"mercantil\": \"Banco Mercantil do Brasil\",\r\n    \"cetelem\": \"Cetelem\",\r\n    \"safra\": \"Banco Safra\",\r\n    \"inter\": \"Banco Inter\",\r\n    \"original\": \"Banco Original\",\r\n    \"facta\": \"Facta\",\r\n    \"bonsucesso\": \"Bonsucesso\",\r\n    \"banrisul\": \"Banrisul\",\r\n    \"sicoob\": \"Sicoob\",\r\n    \"outro\": \"Outro banco\"\r\n  };\r\n  \r\n  return banks[bankCode] || bankCode;\r\n};\r\n\r\ninterface Reminder {\r\n  id: string;\r\n  title: string;\r\n  lead_id: string | null;\r\n  notes: string | null;\r\n  due_date: string;\r\n  is_completed: boolean;\r\n  created_at: string;\r\n  bank?: string | null;\r\n  priority: string;\r\n  employee?: string | null;\r\n}\r\n\r\ninterface Lead {\r\n  id: string;\r\n  name: string;\r\n  bank?: string;\r\n  cpf?: string;\r\n}\r\n\r\ntype ReminderStatus = \"all\" | \"completed\" | \"overdue\" | \"pending\";\r\n\r\nconst REMINDERS_PER_PAGE = 10;\r\n\r\nconst Reminders = () => {\r\n  console.log(\"🚀 === LEMBRETES COMPLETO ===\");\r\n  \r\n  const [reminders, setReminders] = useState<Reminder[]>([]);\r\n  const [filteredReminders, setFilteredReminders] = useState<Reminder[]>([]);\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [employees, setEmployees] = useState<Employee[]>([]);\r\n  const [employeeMap, setEmployeeMap] = useState<Record<string, string>>({});\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [currentStatus, setCurrentStatus] = useState<ReminderStatus>(\"all\");\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [editingReminder, setEditingReminder] = useState<Reminder | null>(null);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [showAdminPasswordDialog, setShowAdminPasswordDialog] = useState(false);\r\n  const [reminderToDelete, setReminderToDelete] = useState<string | null>(null);\r\n  const [totalPages, setTotalPages] = useState(0);\r\n  const [totalReminders, setTotalReminders] = useState(0);\r\n  const [currentMonth, setCurrentMonth] = useState(new Date());\r\n\r\n  // Form state\r\n  const [title, setTitle] = useState(\"\");\r\n  const [leadId, setLeadId] = useState(\"none\");\r\n  const [employeeId, setEmployeeId] = useState(\"none\");\r\n  const [date, setDate] = useState<Date>(new Date());\r\n  const [time, setTime] = useState(\"09:00\");\r\n  const [notes, setNotes] = useState(\"\");\r\n  const [bank, setBank] = useState(\"none\");\r\n  const [priority, setPriority] = useState<string>(\"media\");\r\n  const [category, setCategory] = useState(\"\");\r\n\r\n  // Client search state\r\n  const [clientSearch, setClientSearch] = useState(\"\");\r\n  const [filteredLeads, setFilteredLeads] = useState<Lead[]>([]);\r\n\r\n  // Filter clients based on search\r\n  const handleClientSearch = (searchValue: string) => {\r\n    setClientSearch(searchValue);\r\n    if (!searchValue.trim()) {\r\n      setFilteredLeads(leads);\r\n        return;\r\n      }\r\n\r\n    const filtered = leads.filter(lead => \r\n      lead.name.toLowerCase().includes(searchValue.toLowerCase()) ||\r\n      (lead.cpf && lead.cpf.includes(searchValue.replace(/\\D/g, '')))\r\n    );\r\n    setFilteredLeads(filtered);\r\n  };\r\n\r\n  // Format client display with name and CPF\r\n  const formatClientDisplay = (lead: Lead) => {\r\n    if (lead.cpf) {\r\n      const formattedCpf = lead.cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4');\r\n      return `${lead.name} - ${formattedCpf}`;\r\n    }\r\n    return lead.name;\r\n  };\r\n\r\n  const fetchData = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Fetch leads with cpf\r\n      const { data: leadsData, error: leadsError } = await supabase\r\n        .from(\"leads\")\r\n        .select(\"id, name, bank, cpf\")\r\n        .eq(\"user_id\", userData.user.id)\r\n        .order(\"name\");\r\n\r\n      if (leadsError) throw leadsError;\r\n      \r\n      const leadsWithCpf = (leadsData || []) as Lead[];\r\n      setLeads(leadsWithCpf);\r\n      setFilteredLeads(leadsWithCpf);\r\n\r\n      // Fetch employees\r\n      const employeeList = await getEmployees();\r\n      setEmployees(employeeList);\r\n      \r\n      // Criar mapa de ID -> Nome\r\n      const map: Record<string, string> = {};\r\n      employeeList.forEach(emp => {\r\n        map[emp.id] = emp.name;\r\n      });\r\n      setEmployeeMap(map);\r\n      \r\n    } catch (error: any) {\r\n      console.error(\"Erro ao buscar dados:\", error);\r\n      toast.error(`Erro ao carregar dados: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (Array.isArray(reminders)) {\r\n      filterReminders(currentStatus);\r\n    }\r\n  }, [reminders, currentStatus]);\r\n\r\n  useEffect(() => {\r\n    if (leadId && leadId !== \"none\") {\r\n      const selectedLead = Array.isArray(leads) ? leads.find(l => l.id === leadId) : null;\r\n      if (selectedLead?.bank) {\r\n        setBank(selectedLead.bank);\r\n      }\r\n    }\r\n  }, [leadId, leads]);\r\n\r\n  // Update filtered leads when leads change\r\n  useEffect(() => {\r\n    setFilteredLeads(leads);\r\n  }, [leads]);\r\n\r\n  const filterReminders = (status: ReminderStatus, remindersToFilter = reminders) => {\r\n    setCurrentStatus(status);\r\n    \r\n    if (!Array.isArray(remindersToFilter)) {\r\n      setFilteredReminders([]);\r\n      return;\r\n    }\r\n    \r\n    let filtered = [];\r\n    \r\n    if (status === \"all\") {\r\n      filtered = [...remindersToFilter];\r\n    } else {\r\n      const now = new Date();\r\n      \r\n      filtered = remindersToFilter.filter(reminder => {\r\n        const dueDate = new Date(reminder.due_date);\r\n        \r\n        if (status === \"completed\") {\r\n          return reminder.is_completed;\r\n        } else if (status === \"overdue\") {\r\n          return !reminder.is_completed && dueDate < now;\r\n        } else if (status === \"pending\") {\r\n          return !reminder.is_completed && dueDate >= now;\r\n        }\r\n        \r\n        return true;\r\n      });\r\n    }\r\n    \r\n    // Ordenar por prioridade: Alta -> Média -> Baixa (se a coluna existir)\r\n    const priorityOrder = { 'alta': 1, 'media': 2, 'baixa': 3 };\r\n    \r\n    filtered.sort((a, b) => {\r\n      // Verificar se a coluna priority existe nos dados\r\n      const hasPriority = 'priority' in a && 'priority' in b;\r\n      \r\n      if (hasPriority) {\r\n        const priorityA = (a as any).priority || 'media';\r\n        const priorityB = (b as any).priority || 'media';\r\n        \r\n        const orderA = priorityOrder[priorityA as keyof typeof priorityOrder] || 2;\r\n        const orderB = priorityOrder[priorityB as keyof typeof priorityOrder] || 2;\r\n        \r\n        // Se as prioridades são diferentes, ordena por prioridade\r\n        if (orderA !== orderB) {\r\n          return orderA - orderB;\r\n        }\r\n      }\r\n      \r\n      // Se as prioridades são iguais ou não existem, ordena por data (mais próximas primeiro)\r\n      const dateA = new Date(a.due_date).getTime();\r\n      const dateB = new Date(b.due_date).getTime();\r\n      return dateA - dateB;\r\n    });\r\n    \r\n    setFilteredReminders(filtered);\r\n  };\r\n\r\n  const handleOpenEditDialog = (reminder: Reminder) => {\r\n    setEditingReminder(reminder);\r\n    setTitle(reminder.title);\r\n    setLeadId(reminder.lead_id || \"none\");\r\n    setEmployeeId(reminder.employee || \"none\");\r\n    setDate(new Date(reminder.due_date));\r\n    const reminderDate = new Date(reminder.due_date);\r\n    const hours = String(reminderDate.getHours()).padStart(2, '0');\r\n    const minutes = String(reminderDate.getMinutes()).padStart(2, '0');\r\n    setTime(`${hours}:${minutes}`);\r\n    setNotes(reminder.notes || \"\");\r\n    setBank(reminder.bank || \"none\");\r\n    setPriority(reminder.priority || \"media\");\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const handleCreateReminder = async () => {\r\n    if (!title || !date) {\r\n      toast.error(\"Preencha todos os campos obrigatórios\");\r\n      return;\r\n    }\r\n    \r\n    setIsSubmitting(true);\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) throw new Error(\"Usuário não autenticado\");\r\n      \r\n      const [hours, minutes] = time.split(':').map(Number);\r\n      const finalDate = setMinutes(setHours(date, hours), minutes);\r\n      \r\n      const reminderData: any = {\r\n        title,\r\n        lead_id: leadId && leadId !== \"none\" ? leadId : null,\r\n        notes: notes || null,\r\n        due_date: finalDate.toISOString(),\r\n        user_id: userData.user.id,\r\n        bank: bank && bank !== \"none\" ? bank : null,\r\n        employee: employeeId && employeeId !== \"none\" ? employeeId : null,\r\n        priority: priority || \"media\"\r\n      };\r\n\r\n      if (editingReminder) {\r\n        // Atualizar lembrete existente\r\n        const { error } = await supabase\r\n          .from(\"reminders\")\r\n          .update(reminderData)\r\n          .eq(\"id\", editingReminder.id);\r\n        \r\n        if (error) throw error;\r\n        toast.success(\"Lembrete atualizado com sucesso!\");\r\n      } else {\r\n        // Criar novo lembrete\r\n        reminderData.is_completed = false;\r\n        const { error } = await supabase.from(\"reminders\").insert(reminderData);\r\n        \r\n        if (error) throw error;\r\n        toast.success(\"Lembrete criado com sucesso!\");\r\n      }\r\n      \r\n      setIsDialogOpen(false);\r\n      resetForm();\r\n      await fetchReminders(currentPage);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao salvar lembrete:\", error);\r\n      toast.error(`Erro ao salvar lembrete: ${error.message}`);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleComplete = async (reminder: Reminder) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"reminders\")\r\n        .update({ is_completed: !reminder.is_completed })\r\n        .eq(\"id\", reminder.id);\r\n        \r\n      if (error) throw error;\r\n      \r\n      if (!Array.isArray(reminders)) {\r\n        await fetchData();\r\n        return;\r\n      }\r\n      \r\n      const updatedReminders = reminders.map(r => \r\n        r.id === reminder.id ? { ...r, is_completed: !r.is_completed } : r\r\n      );\r\n      \r\n      setReminders(updatedReminders);\r\n      filterReminders(currentStatus, updatedReminders);\r\n      \r\n      toast.success(`Lembrete marcado como ${!reminder.is_completed ? \"concluído\" : \"pendente\"}`);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao atualizar lembrete:\", error);\r\n      toast.error(`Erro ao atualizar lembrete: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const handleDeleteReminder = async (id: string) => {\r\n    // Abrir dialog de confirmação com senha administrativa\r\n    setReminderToDelete(id);\r\n    setShowAdminPasswordDialog(true);\r\n  };\r\n\r\n  const confirmDeleteReminder = async () => {\r\n    if (!reminderToDelete) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"reminders\")\r\n        .delete()\r\n        .eq(\"id\", reminderToDelete);\r\n        \r\n      if (error) throw error;\r\n      \r\n      if (!Array.isArray(reminders)) {\r\n        await fetchReminders(currentPage);\r\n        return;\r\n      }\r\n      \r\n      const updatedReminders = reminders.filter(r => r.id !== reminderToDelete);\r\n      setReminders(updatedReminders);\r\n      filterReminders(currentStatus, updatedReminders);\r\n      \r\n      toast.success(\"Lembrete excluído com sucesso!\");\r\n      setReminderToDelete(null);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao excluir lembrete:\", error);\r\n      toast.error(`Erro ao excluir lembrete: ${error.message}`);\r\n      setReminderToDelete(null);\r\n    }\r\n  };\r\n\r\n  const getLeadName = (id: string | null) => {\r\n    if (!id) return \"Nenhum cliente\";\r\n    if (!Array.isArray(leads)) return \"Cliente não encontrado\";\r\n    const lead = leads.find(l => l.id === id);\r\n    return lead ? lead.name : \"Cliente não encontrado\";\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    try {\r\n      return format(new Date(dateString), \"dd/MM/yyyy 'às' HH:mm\", { locale: ptBR });\r\n    } catch (error) {\r\n      return \"Data inválida\";\r\n    }\r\n  };\r\n\r\n  const isPastDue = (dateString: string, isCompleted: boolean) => {\r\n    if (isCompleted) return false;\r\n    try {\r\n      const dueDate = new Date(dateString);\r\n      const today = new Date();\r\n      return dueDate < today;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const getReminderStatusBadge = (reminder: Reminder) => {\r\n    if (reminder.is_completed) {\r\n      return <Badge className=\"bg-green-50 text-green-700 border border-green-200 text-xs font-medium\">Concluído</Badge>;\r\n    } else if (isPastDue(reminder.due_date, reminder.is_completed)) {\r\n      return <Badge className=\"bg-red-50 text-red-700 border border-red-200 text-xs font-medium\">Atrasado</Badge>;\r\n    } else {\r\n      return <Badge className=\"bg-blue-50 text-blue-700 border border-blue-200 text-xs font-medium\">Pendente</Badge>;\r\n    }\r\n  };\r\n\r\n  // Função para obter prioridade do lembrete\r\n  const getPriorityFromReminder = (reminder: Reminder): string => {\r\n    return reminder.priority || 'media';\r\n  };\r\n\r\n  const handleChangePriority = async (reminderId: string, newPriority: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"reminders\")\r\n        .update({ priority: newPriority } as any)\r\n        .eq(\"id\", reminderId);\r\n        \r\n      if (error) throw error;\r\n      \r\n      // Atualizar estado local\r\n      if (!Array.isArray(reminders)) {\r\n        await fetchData();\r\n        return;\r\n      }\r\n      \r\n      const updatedReminders = reminders.map(r => \r\n        r.id === reminderId ? { ...r, priority: newPriority } : r\r\n      );\r\n      \r\n      setReminders(updatedReminders);\r\n      filterReminders(currentStatus, updatedReminders);\r\n      \r\n      const priorityNames = {\r\n        'baixa': 'Baixa',\r\n        'media': 'Média',\r\n        'alta': 'Alta'\r\n      };\r\n      \r\n      const priorityEmojis = {\r\n        'baixa': '🟢',\r\n        'media': '🟡',\r\n        'alta': '🔴'\r\n      };\r\n      \r\n      toast.success(`Prioridade alterada para ${priorityEmojis[newPriority as keyof typeof priorityEmojis]} ${priorityNames[newPriority as keyof typeof priorityNames]}`);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao alterar prioridade:\", error);\r\n      toast.error(`Erro ao alterar prioridade: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const getPriorityBadge = (priority: string | undefined, reminderId?: string, isClickable: boolean = false) => {\r\n    const priorityLevel = priority || \"media\";\r\n    \r\n    const baseClasses = \"text-sm px-4 py-2 font-bold shadow-lg border-2 transition-all duration-200\";\r\n    \r\n    if (!isClickable || !reminderId) {\r\n      // Versão não clicável (apenas visual)\r\n    switch (priorityLevel) {\r\n      case \"alta\":\r\n        return (\r\n            <Badge className={`bg-red-600 text-white border-red-700 ${baseClasses}`}>\r\n              🔴 PRIORIDADE ALTA\r\n          </Badge>\r\n        );\r\n      case \"baixa\":\r\n        return (\r\n            <Badge className={`bg-green-600 text-white border-green-700 ${baseClasses}`}>\r\n              🟢 PRIORIDADE BAIXA\r\n          </Badge>\r\n        );\r\n      case \"media\":\r\n      default:\r\n        return (\r\n            <Badge className={`bg-yellow-600 text-white border-yellow-700 ${baseClasses}`}>\r\n              🟡 PRIORIDADE MÉDIA\r\n          </Badge>\r\n        );\r\n    }\r\n    }\r\n\r\n    // Versão clicável com dropdown\r\n    return (\r\n      <Select value={priorityLevel} onValueChange={(newPriority) => handleChangePriority(reminderId, newPriority)}>\r\n        <SelectTrigger className={cn(\r\n          \"w-auto h-auto p-0 border-0 bg-transparent hover:bg-transparent focus:ring-0\",\r\n          baseClasses,\r\n          priorityLevel === \"alta\" && \"bg-red-600 hover:bg-red-700 text-white\",\r\n          priorityLevel === \"media\" && \"bg-yellow-600 hover:bg-yellow-700 text-white\",\r\n          priorityLevel === \"baixa\" && \"bg-green-600 hover:bg-green-700 text-white\"\r\n        )}>\r\n          <SelectValue className=\"flex items-center gap-2\">\r\n            {priorityLevel === \"alta\" && \"🔴 PRIORIDADE ALTA\"}\r\n            {priorityLevel === \"media\" && \"🟡 PRIORIDADE MÉDIA\"}\r\n            {priorityLevel === \"baixa\" && \"🟢 PRIORIDADE BAIXA\"}\r\n            <span className=\"ml-2\">▼</span>\r\n          </SelectValue>\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"alta\" className=\"text-red-700 font-semibold\">\r\n            🔴 PRIORIDADE ALTA\r\n          </SelectItem>\r\n          <SelectItem value=\"media\" className=\"text-yellow-700 font-semibold\">\r\n            🟡 PRIORIDADE MÉDIA\r\n          </SelectItem>\r\n          <SelectItem value=\"baixa\" className=\"text-green-700 font-semibold\">\r\n            🟢 PRIORIDADE BAIXA\r\n          </SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n    );\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setTitle(\"\");\r\n    setLeadId(\"none\");\r\n    setEmployeeId(\"none\");\r\n    setDate(new Date());\r\n    setTime(\"09:00\");\r\n    setNotes(\"\");\r\n    setBank(\"none\");\r\n    setPriority(\"media\");\r\n    setCategory(\"\");\r\n    setEditingReminder(null);\r\n  };\r\n\r\n  const headerActions = (\r\n        <Dialog open={isDialogOpen} onOpenChange={(open) => {\r\n          setIsDialogOpen(open);\r\n          if (!open) {\r\n            resetForm();\r\n          }\r\n        }}>\r\n      <DialogTrigger asChild>\r\n        <Button size=\"lg\" className=\"bg-blue-600 hover:bg-blue-700\" onClick={() => {\r\n          resetForm();\r\n          setIsDialogOpen(true);\r\n        }}>\r\n          <Plus className=\"mr-2 h-5 w-5\" />\r\n          Novo Lembrete\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"sm:max-w-2xl max-h-[90vh] overflow-y-auto\" aria-describedby=\"dialog-description\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-xl\">\r\n            {editingReminder ? \"Editar Lembrete\" : \"Criar Novo Lembrete\"}\r\n          </DialogTitle>\r\n          <DialogDescription id=\"dialog-description\" className=\"text-base\">\r\n            {editingReminder \r\n              ? \"Edite os detalhes do lembrete.\"\r\n              : \"Adicione um novo lembrete para acompanhamento de clientes e tarefas.\"}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-6 py-6\">\r\n          <div className=\"space-y-3\">\r\n            <Label htmlFor=\"title\" className=\"text-sm font-medium\">Título*</Label>\r\n            <Input\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n              placeholder=\"Ex: Ligar para cliente, Enviar documentos...\"\r\n              className=\"h-11\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Cliente</Label>\r\n            <Popover>\r\n              <PopoverTrigger asChild>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  role=\"combobox\"\r\n                  className={cn(\r\n                    \"w-full h-11 justify-between text-left font-normal\",\r\n                    !leadId || leadId === \"none\" ? \"text-muted-foreground\" : \"\"\r\n                  )}\r\n                >\r\n                  {leadId && leadId !== \"none\" \r\n                    ? (() => {\r\n                        const selectedLead = leads.find(lead => lead.id === leadId);\r\n                        return selectedLead ? formatClientDisplay(selectedLead) : \"Cliente não encontrado\";\r\n                      })()\r\n                    : \"Selecione um cliente (opcional)\"\r\n                  }\r\n                  <ChevronDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n                </Button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-full p-0\" align=\"start\">\r\n                <Command>\r\n                  <CommandInput \r\n                    placeholder=\"Buscar por nome ou CPF...\" \r\n                    value={clientSearch}\r\n                    onValueChange={handleClientSearch}\r\n                  />\r\n                  <CommandList>\r\n                    <CommandEmpty>Nenhum cliente encontrado.</CommandEmpty>\r\n                    <CommandGroup>\r\n                      <CommandItem\r\n                        value=\"none\"\r\n                        onSelect={() => {\r\n                          setLeadId(\"none\");\r\n                          setClientSearch(\"\");\r\n                        }}\r\n                      >\r\n                        <Check\r\n                          className={cn(\r\n                            \"mr-2 h-4 w-4\",\r\n                            leadId === \"none\" ? \"opacity-100\" : \"opacity-0\"\r\n                          )}\r\n                        />\r\n                        Nenhum cliente\r\n                      </CommandItem>\r\n                      {filteredLeads.map((lead) => (\r\n                        <CommandItem\r\n                          key={lead.id}\r\n                          value={formatClientDisplay(lead)}\r\n                          onSelect={() => {\r\n                            setLeadId(lead.id);\r\n                            setClientSearch(\"\");\r\n                          }}\r\n                        >\r\n                          <Check\r\n                            className={cn(\r\n                              \"mr-2 h-4 w-4\",\r\n                              leadId === lead.id ? \"opacity-100\" : \"opacity-0\"\r\n                            )}\r\n                          />\r\n                          <div className=\"flex flex-col\">\r\n                            <span className=\"font-medium\">{lead.name}</span>\r\n                            {lead.cpf && (\r\n                              <span className=\"text-sm text-gray-500\">\r\n                                CPF: {lead.cpf.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{2})/, '$1.$2.$3-$4')}\r\n                              </span>\r\n                            )}\r\n                          </div>\r\n                        </CommandItem>\r\n                      ))}\r\n                    </CommandGroup>\r\n                  </CommandList>\r\n                </Command>\r\n              </PopoverContent>\r\n            </Popover>\r\n          </div>\r\n\r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Funcionário Responsável</Label>\r\n            <Select value={employeeId} onValueChange={setEmployeeId}>\r\n              <SelectTrigger className=\"h-11\">\r\n                <SelectValue placeholder=\"Selecione um funcionário (opcional)\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">Nenhum funcionário</SelectItem>\r\n                {employees.map((employee) => (\r\n                  <SelectItem key={employee.id} value={employee.id}>\r\n                    {employee.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n          \r\n          <BankSelect\r\n            value={bank}\r\n            onValueChange={setBank}\r\n            label=\"Banco\"\r\n            placeholder=\"Selecione um banco (opcional)\"\r\n            className=\"space-y-3\"\r\n            showNoneOption={true}\r\n          />\r\n          \r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Data e Horário*</Label>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <Label className=\"text-xs text-gray-500 mb-2 block\">Data</Label>\r\n                <Popover>\r\n                  <PopoverTrigger asChild>\r\n                    <Button\r\n                      variant={\"outline\"}\r\n                      className={cn(\r\n                        \"w-full justify-start text-left font-normal h-11\",\r\n                        !date && \"text-muted-foreground\"\r\n                      )}\r\n                    >\r\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                      {date ? format(date, \"dd/MM/yyyy\") : <span>Escolha uma data</span>}\r\n                    </Button>\r\n                  </PopoverTrigger>\r\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\r\n                    <CustomCalendar\r\n                      selected={date}\r\n                      onSelect={setDate}\r\n                      currentMonth={currentMonth}\r\n                      onMonthChange={setCurrentMonth}\r\n                      size=\"sm\"\r\n                      className=\"p-4\"\r\n                    />\r\n                  </PopoverContent>\r\n                </Popover>\r\n              </div>\r\n              \r\n              <div>\r\n                <Label className=\"text-xs text-gray-500 mb-2 block\">Horário</Label>\r\n                <Input\r\n                  type=\"time\"\r\n                  value={time}\r\n                  onChange={(e) => setTime(e.target.value)}\r\n                  className=\"h-11\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Prioridade</Label>\r\n            <div className=\"grid grid-cols-3 gap-3\">\r\n              <Button\r\n                type=\"button\"\r\n                variant={priority === \"baixa\" ? \"default\" : \"outline\"}\r\n                className={cn(\r\n                  \"h-10 text-sm font-medium transition-all\",\r\n                  priority === \"baixa\" \r\n                    ? \"bg-green-600 text-white hover:bg-green-700\" \r\n                    : \"border-green-200 text-green-700 hover:bg-green-50\"\r\n                )}\r\n                onClick={() => setPriority(\"baixa\")}\r\n              >\r\n                Baixa\r\n              </Button>\r\n              \r\n              <Button\r\n                type=\"button\"\r\n                variant={priority === \"media\" ? \"default\" : \"outline\"}\r\n                className={cn(\r\n                  \"h-10 text-sm font-medium transition-all\",\r\n                  priority === \"media\" \r\n                    ? \"bg-yellow-600 text-white hover:bg-yellow-700\" \r\n                    : \"border-yellow-200 text-yellow-700 hover:bg-yellow-50\"\r\n                )}\r\n                onClick={() => setPriority(\"media\")}\r\n              >\r\n                Média\r\n              </Button>\r\n              \r\n              <Button\r\n                type=\"button\"\r\n                variant={priority === \"alta\" ? \"default\" : \"outline\"}\r\n                className={cn(\r\n                  \"h-10 text-sm font-medium transition-all\",\r\n                  priority === \"alta\" \r\n                    ? \"bg-red-600 text-white hover:bg-red-700\" \r\n                    : \"border-red-200 text-red-700 hover:bg-red-50\"\r\n                )}\r\n                onClick={() => setPriority(\"alta\")}\r\n              >\r\n                Alta\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Categoria</Label>\r\n            <Input\r\n              value={category}\r\n              onChange={(e) => setCategory(e.target.value)}\r\n              placeholder=\"Ex: Ligação, Reunião, Documento...\"\r\n              className=\"h-11\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"space-y-3\">\r\n            <Label className=\"text-sm font-medium\">Observações</Label>\r\n            <Textarea\r\n              value={notes}\r\n              onChange={(e) => setNotes(e.target.value)}\r\n              placeholder=\"Detalhes adicionais, informações importantes...\"\r\n              rows={4}\r\n              className=\"resize-none\"\r\n            />\r\n          </div>\r\n        </div>\r\n        \r\n        <DialogFooter className=\"gap-3\">\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => {\r\n              setIsDialogOpen(false);\r\n              resetForm();\r\n            }}\r\n            disabled={isSubmitting}\r\n          >\r\n            Cancelar\r\n          </Button>\r\n          <Button\r\n            onClick={handleCreateReminder}\r\n            disabled={isSubmitting || !title || !date}\r\n            className=\"bg-blue-600 hover:bg-blue-700\"\r\n          >\r\n            {isSubmitting ? (\r\n              <>\r\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                Salvando...\r\n              </>\r\n            ) : (\r\n              <>\r\n                {editingReminder ? (\r\n                  <>\r\n                    <Edit3 className=\"mr-2 h-4 w-4\" />\r\n                    Atualizar Lembrete\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Plus className=\"mr-2 h-4 w-4\" />\r\n                    Criar Lembrete\r\n                  </>\r\n                )}\r\n              </>\r\n            )}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n\r\n  const fetchReminders = async (page = 1) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const { data: userData, error: userError } = await supabase.auth.getUser();\r\n      if (userError) throw userError;\r\n\r\n      // Get total count\r\n      const { count, error: countError } = await supabase\r\n        .from(\"reminders\")\r\n        .select(\"*\", { count: 'exact', head: true })\r\n        .eq(\"user_id\", userData.user.id);\r\n      \r\n      if (countError) throw countError;\r\n      \r\n      setTotalReminders(count || 0);\r\n      setTotalPages(Math.ceil((count || 0) / REMINDERS_PER_PAGE));\r\n\r\n      // Get paginated reminders\r\n      const from = (page - 1) * REMINDERS_PER_PAGE;\r\n      const to = from + REMINDERS_PER_PAGE - 1;\r\n\r\n      let query = supabase\r\n        .from(\"reminders\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", userData.user.id)\r\n        .range(from, to);\r\n\r\n      // Apply ordering with priority\r\n      if (reminders.length > 0 && reminders[0].priority !== undefined) {\r\n        query = query.order(\"priority\", { ascending: true }).order(\"due_date\", { ascending: true });\r\n      } else {\r\n        query = query.order(\"due_date\", { ascending: true });\r\n      }\r\n\r\n      const { data, error } = await query;\r\n      if (error) throw error;\r\n\r\n      const processedReminders = (data || []).map((reminder: any) => ({\r\n        ...reminder,\r\n        priority: reminder.priority || 'media'\r\n      }));\r\n\r\n      setReminders(processedReminders);\r\n    } catch (error: any) {\r\n      console.error(\"Erro ao buscar lembretes:\", error);\r\n      toast.error(`Erro ao carregar lembretes: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handlePageChange = (page: number) => {\r\n    setCurrentPage(page);\r\n    window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    fetchReminders(page);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchReminders(1);\r\n  }, []);\r\n\r\n\r\n\r\n  return (\r\n    <SidebarProvider>\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 w-full flex\">\r\n        <AppSidebar />\r\n        <div className=\"flex-1 w-full overflow-hidden min-w-0\">\r\n          <Header />\r\n          <main className=\"w-full h-full\">\r\n            <div className=\"p-6 space-y-6\">\r\n              {/* Header moderno customizado */}\r\n              <div className=\"bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-700 text-white rounded-xl mb-8 shadow-xl\">\r\n        <div className=\"p-8\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center space-x-4\">\r\n              <div className=\"bg-white/20 backdrop-blur-sm rounded-full p-3\">\r\n                <svg className=\"w-8 h-8 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n                </svg>\r\n              </div>\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold\">Lembretes</h1>\r\n                <p className=\"text-blue-100 text-lg mt-1\">Gerencie seus lembretes e nunca perca uma tarefa importante</p>\r\n              </div>\r\n            </div>\r\n            <div className=\"hidden md:flex items-center space-x-4\">\r\n              <div className=\"bg-white/10 backdrop-blur-sm rounded-lg px-4 py-2\">\r\n                <div className=\"text-sm text-blue-100\">Total de Lembretes</div>\r\n                <div className=\"text-2xl font-bold\">\r\n                  {totalReminders}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n        </div>\r\n      </div>\r\n\r\n      {/* Botões fora do header */}\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-3\">\r\n          {headerActions}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-6\">\r\n        <Tabs \r\n          defaultValue=\"all\" \r\n          value={currentStatus}\r\n          className=\"mb-6\" \r\n          onValueChange={(value) => filterReminders(value as ReminderStatus)}\r\n        >\r\n          <TabsList className=\"grid w-full grid-cols-4 md:w-auto\">\r\n            <TabsTrigger value=\"all\">Todos</TabsTrigger>\r\n            <TabsTrigger value=\"completed\">Concluídos</TabsTrigger>\r\n            <TabsTrigger value=\"overdue\">Atrasados</TabsTrigger>\r\n            <TabsTrigger value=\"pending\">Pendentes</TabsTrigger>\r\n          </TabsList>\r\n        </Tabs>\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          <h3 className=\"text-lg font-semibold text-gray-900\">\r\n            {filteredReminders.length} {filteredReminders.length === 1 ? 'lembrete' : 'lembretes'}\r\n          </h3>\r\n          <p className=\"text-sm text-gray-500\">\r\n            Página {currentPage} de {totalPages} ({totalReminders} total)\r\n          </p>\r\n        </div>\r\n\r\n        {isLoading ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            {[1, 2, 3, 4].map(i => (\r\n              <Card key={i} className=\"animate-pulse\">\r\n                <div className=\"h-32 bg-gray-100 rounded-md\" />\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        ) : Array.isArray(filteredReminders) && filteredReminders.length > 0 ? (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n            {filteredReminders.map((reminder) => (\r\n              <Card\r\n                key={reminder.id}\r\n                className={cn(\r\n                  \"transition-all duration-200 hover:shadow-lg border-0 shadow-sm\",\r\n                  reminder.is_completed ? \"bg-gray-50/50 opacity-70\" : \"bg-white\",\r\n                  \"hover:shadow-xl hover:-translate-y-1\"\r\n                )}\r\n              >\r\n                <CardHeader className=\"pb-4\">\r\n                  <div className=\"space-y-4\">\r\n                    {/* Linha 1: Título e Status */}\r\n                    <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3\">\r\n                      <div className=\"flex items-start gap-3 flex-1\">\r\n                        {/* Indicador visual minimalista da prioridade */}\r\n                        <div className={cn(\r\n                          \"w-1 h-16 rounded-full flex-shrink-0 mt-1\",\r\n                          getPriorityFromReminder(reminder) === 'alta' && \"bg-red-500\",\r\n                          getPriorityFromReminder(reminder) === 'media' && \"bg-yellow-500\", \r\n                          getPriorityFromReminder(reminder) === 'baixa' && \"bg-green-500\"\r\n                        )} />\r\n                        <div className=\"flex-1\">\r\n                          <CardTitle className=\"text-lg font-medium text-slate-900 leading-tight mb-1\">\r\n                            {reminder.title}\r\n                          </CardTitle>\r\n                          <div className=\"flex items-center gap-2 text-sm text-slate-500\">\r\n                            <span className={cn(\r\n                              \"px-2 py-1 rounded-full text-xs font-medium\",\r\n                              getPriorityFromReminder(reminder) === 'alta' && \"bg-red-50 text-red-700\",\r\n                              getPriorityFromReminder(reminder) === 'media' && \"bg-yellow-50 text-yellow-700\", \r\n                              getPriorityFromReminder(reminder) === 'baixa' && \"bg-green-50 text-green-700\"\r\n                            )}>\r\n                              {getPriorityFromReminder(reminder) === 'alta' && \"Alta prioridade\"}\r\n                              {getPriorityFromReminder(reminder) === 'media' && \"Prioridade média\"}\r\n                              {getPriorityFromReminder(reminder) === 'baixa' && \"Baixa prioridade\"}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"flex flex-wrap gap-2\">\r\n                        {getReminderStatusBadge(reminder)}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Linha 2: Informações do Cliente e Data */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 pl-4\">\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                          <User className=\"h-4 w-4 text-slate-400\" />\r\n                          <span className=\"font-medium\">Cliente:</span>\r\n                          <span className=\"text-slate-900 font-medium\">{getLeadName(reminder.lead_id)}</span>\r\n                        </div>\r\n                        {reminder.bank && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                            <FileText className=\"h-4 w-4 text-slate-400\" />\r\n                            <span className=\"font-medium\">Banco:</span>\r\n                            <span className=\"text-slate-900 font-medium\">{getBankName(reminder.bank)}</span>\r\n                          </div>\r\n                        )}\r\n                        {reminder.employee && (\r\n                          <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                            <User className=\"h-4 w-4 text-slate-400\" />\r\n                            <span className=\"font-medium\">Responsável:</span>\r\n                            <span className=\"text-slate-900 font-medium\">\r\n                              {employeeMap[reminder.employee] || reminder.employee}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"flex items-center gap-2 text-sm text-slate-600\">\r\n                          <Clock className=\"h-4 w-4 text-slate-400\" />\r\n                          <span className=\"font-medium\">Data:</span>\r\n                          <span className=\"text-slate-900 font-medium\">{formatDate(reminder.due_date)}</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Linha 3: Ações */}\r\n                    <div className=\"flex justify-end space-x-2 pt-3 border-t border-slate-100 pl-4\">\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className=\"h-8 text-xs font-medium text-slate-600 hover:text-blue-700 hover:bg-blue-50\"\r\n                        onClick={() => handleOpenEditDialog(reminder)}\r\n                      >\r\n                        <Edit3 className=\"h-3 w-3 mr-1\" />\r\n                        Editar\r\n                      </Button>\r\n                      <Button\r\n                        variant=\"ghost\"\r\n                        size=\"sm\"\r\n                        className={cn(\r\n                          \"h-8 text-xs font-medium\",\r\n                          reminder.is_completed \r\n                            ? \"text-green-700 hover:bg-green-50\" \r\n                            : \"text-slate-600 hover:text-green-700 hover:bg-green-50\"\r\n                        )}\r\n                        onClick={() => handleToggleComplete(reminder)}\r\n                      >\r\n                        <Check className=\"h-3 w-3 mr-1\" />\r\n                        {reminder.is_completed ? \"Concluído\" : \"Concluir\"}\r\n                      </Button>\r\n                      <AlertDialog>\r\n                        <AlertDialogTrigger asChild>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"sm\"\r\n                            className=\"h-8 text-xs font-medium text-slate-600 hover:text-red-700 hover:bg-red-50\"\r\n                          >\r\n                            <Trash2 className=\"h-3 w-3 mr-1\" />\r\n                            Excluir\r\n                          </Button>\r\n                        </AlertDialogTrigger>\r\n                        <AlertDialogContent>\r\n                          <AlertDialogHeader>\r\n                            <AlertDialogTitle>Tem certeza?</AlertDialogTitle>\r\n                            <AlertDialogDescription>\r\n                              Esta ação não pode ser desfeita. Isso excluirá permanentemente o lembrete \"{reminder.title}\".\r\n                            </AlertDialogDescription>\r\n                          </AlertDialogHeader>\r\n                          <AlertDialogFooter>\r\n                            <AlertDialogCancel>Cancelar</AlertDialogCancel>\r\n                            <AlertDialogAction \r\n                              onClick={() => {\r\n                                // Fechar o AlertDialog primeiro\r\n                                const event = new Event('close');\r\n                                window.dispatchEvent(event);\r\n                                // Abrir dialog de senha administrativa\r\n                                handleDeleteReminder(reminder.id);\r\n                              }}\r\n                              className=\"bg-red-600 hover:bg-red-700\"\r\n                            >\r\n                              Sim, excluir\r\n                            </AlertDialogAction>\r\n                          </AlertDialogFooter>\r\n                        </AlertDialogContent>\r\n                      </AlertDialog>\r\n                    </div>\r\n                  </div>\r\n                </CardHeader>\r\n                \r\n                {reminder.notes && (\r\n                  <CardContent className=\"pt-0 pb-4 pl-7\">\r\n                    <div className=\"p-3 rounded-lg bg-slate-50 border border-slate-200\">\r\n                      <div className=\"flex items-center gap-2 mb-2\">\r\n                        <FileText className=\"h-4 w-4 text-slate-500\" />\r\n                        <span className=\"text-sm font-medium text-slate-700\">Observações</span>\r\n                      </div>\r\n                      <p className=\"text-sm text-slate-600 leading-relaxed break-words\">\r\n                        {reminder.notes}\r\n                      </p>\r\n                    </div>\r\n                  </CardContent>\r\n                )}\r\n              </Card>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <Card className=\"text-center py-16\">\r\n            <CardContent>\r\n              <AlertCircle className=\"h-16 w-16 mx-auto text-gray-400 mb-4\" />\r\n              <h3 className=\"text-xl font-medium text-gray-900 mb-2\">Nenhum lembrete</h3>\r\n              <p className=\"text-gray-500 text-lg\">\r\n                Não há lembretes disponíveis no momento.\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Pagination Controls */}\r\n        {totalPages > 1 && (\r\n          <div className=\"flex items-center justify-center space-x-6 py-4\">\r\n            <Pagination>\r\n              <PaginationContent>\r\n                <PaginationItem>\r\n                  <PaginationPrevious \r\n                    onClick={() => currentPage > 1 && handlePageChange(currentPage - 1)}\r\n                    className={currentPage <= 1 ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\r\n                  />\r\n                </PaginationItem>\r\n                \r\n                {[...Array(Math.min(5, totalPages))].map((_, index) => {\r\n                  const pageNumber = Math.max(1, currentPage - 2) + index;\r\n                  if (pageNumber > totalPages) return null;\r\n                  \r\n                  return (\r\n                    <PaginationItem key={pageNumber}>\r\n                      <PaginationLink\r\n                        onClick={() => handlePageChange(pageNumber)}\r\n                        isActive={pageNumber === currentPage}\r\n                        className=\"cursor-pointer\"\r\n                      >\r\n                        {pageNumber}\r\n                      </PaginationLink>\r\n                    </PaginationItem>\r\n                  );\r\n                })}\r\n                \r\n                <PaginationItem>\r\n                  <PaginationNext \r\n                    onClick={() => currentPage < totalPages && handlePageChange(currentPage + 1)}\r\n                    className={currentPage >= totalPages ? \"pointer-events-none opacity-50\" : \"cursor-pointer\"}\r\n                  />\r\n                </PaginationItem>\r\n              </PaginationContent>\r\n            </Pagination>\r\n          </div>\r\n        )}\r\n              </div>\r\n            </div>\r\n          </main>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Dialog de confirmação com senha administrativa */}\r\n      <AdminPasswordDialog\r\n        open={showAdminPasswordDialog}\r\n        onOpenChange={setShowAdminPasswordDialog}\r\n        onConfirm={confirmDeleteReminder}\r\n        title=\"Confirmar Exclusão de Lembrete\"\r\n        description=\"Esta ação é irreversível. Digite sua senha administrativa para confirmar a exclusão.\"\r\n        itemName={reminderToDelete ? reminders.find(r => r.id === reminderToDelete)?.title : undefined}\r\n      />\r\n    </SidebarProvider>\r\n  );\r\n};\r\n\r\nexport default Reminders; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\RemindersCalendar.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2282,2285],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2282,2285],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":95,"column":6,"nodeType":"ArrayExpression","endLine":95,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData]","fix":{"range":[2961,2963],"text":"[fetchData]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3534,3537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3534,3537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format, parseISO, isSameDay, startOfDay, getDaysInMonth, startOfMonth, getDay } from \"date-fns\";\r\nimport { ptBR } from \"date-fns/locale\";\r\nimport { CalendarIcon, Loader2, Check, ChevronLeft, ChevronRight } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { toast } from \"sonner\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  CardTitle,\r\n} from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { CustomCalendar } from \"@/components/ui/custom-calendar\";\r\n\r\ninterface Reminder {\r\n  id: string;\r\n  title: string;\r\n  lead_id: string | null;\r\n  notes: string | null;\r\n  due_date: string;\r\n  is_completed: boolean;\r\n  created_at: string;\r\n  bank?: string | null;\r\n}\r\n\r\ninterface Lead {\r\n  id: string;\r\n  name: string;\r\n  bank?: string;\r\n}\r\n\r\nconst RemindersCalendar = () => {\r\n  const [reminders, setReminders] = useState<Reminder[]>([]);\r\n  const [leads, setLeads] = useState<Lead[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [selectedDay, setSelectedDay] = useState<Date | undefined>(new Date());\r\n  const [currentMonth, setCurrentMonth] = useState<Date>(new Date());\r\n  const [daysWithReminders, setDaysWithReminders] = useState<Date[]>([]);\r\n\r\n  const fetchData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      // Fetch leads for the mapping\r\n      const { data: leadsData, error: leadsError } = await supabase\r\n        .from(\"leads\")\r\n        .select(\"id, name, bank\")\r\n        .order(\"name\");\r\n        \r\n      if (leadsError) throw leadsError;\r\n      setLeads(leadsData || []);\r\n      \r\n      // Fetch reminders\r\n      const { data: remindersData, error: remindersError } = await supabase\r\n        .from(\"reminders\")\r\n        .select(\"*\")\r\n        .order(\"due_date\");\r\n        \r\n      if (remindersError) throw remindersError;\r\n      setReminders(remindersData || []);\r\n\r\n      // Process days with reminders\r\n      processReminders(remindersData || []);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching data:\", error);\r\n      toast.error(`Erro ao carregar dados: ${error.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const processReminders = (remindersList: Reminder[]) => {\r\n    const uniqueDates = new Set<string>();\r\n    \r\n    remindersList.forEach(reminder => {\r\n      const dueDate = startOfDay(parseISO(reminder.due_date));\r\n      const dateKey = format(dueDate, 'yyyy-MM-dd');\r\n      uniqueDates.add(dateKey);\r\n    });\r\n    \r\n    const dates = Array.from(uniqueDates).map(dateKey => startOfDay(parseISO(dateKey)));\r\n    setDaysWithReminders(dates);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleToggleComplete = async (reminder: Reminder) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"reminders\")\r\n        .update({ is_completed: !reminder.is_completed })\r\n        .eq(\"id\", reminder.id);\r\n        \r\n      if (error) throw error;\r\n      \r\n      setReminders(reminders.map(r => \r\n        r.id === reminder.id ? { ...r, is_completed: !r.is_completed } : r\r\n      ));\r\n      \r\n      toast.success(`Lembrete marcado como ${!reminder.is_completed ? \"concluído\" : \"pendente\"}`);\r\n      await fetchData();\r\n    } catch (error: any) {\r\n      console.error(\"Error updating reminder:\", error);\r\n      toast.error(`Erro ao atualizar lembrete: ${error.message}`);\r\n    }\r\n  };\r\n\r\n  const getLeadName = (id: string | null) => {\r\n    if (!id) return \"Nenhum cliente\";\r\n    const lead = leads.find(l => l.id === id);\r\n    return lead ? lead.name : \"Cliente não encontrado\";\r\n  };\r\n\r\n  const getBankName = (bankCode: string | undefined) => {\r\n    switch (bankCode) {\r\n      case \"caixa\": return \"Caixa Econômica Federal\";\r\n      case \"bb\": return \"Banco do Brasil\";\r\n      case \"itau\": return \"Itaú\";\r\n      case \"bradesco\": return \"Bradesco\";\r\n      case \"santander\": return \"Santander\";\r\n      case \"c6\": return \"C6 Bank\";\r\n      case \"brb\": return \"BRB - Banco de Brasília\";\r\n      case \"bmg\": return \"BMG\";\r\n      case \"pan\": return \"Banco Pan\";\r\n      case \"ole\": return \"Banco Olé\";\r\n      case \"daycoval\": return \"Daycoval\";\r\n      case \"mercantil\": return \"Mercantil\";\r\n      case \"cetelem\": return \"Cetelem\";\r\n      case \"safra\": return \"Safra\";\r\n      case \"inter\": return \"Inter\";\r\n      case \"original\": return \"Original\";\r\n      case \"facta\": return \"Facta\";\r\n      case \"bonsucesso\": return \"Bonsucesso\";\r\n      case \"banrisul\": return \"Banrisul\";\r\n      case \"sicoob\": return \"Sicoob\";\r\n      case \"outro\": return \"Outro\";\r\n      default: return \"Banco não especificado\";\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    return format(new Date(dateString), \"PPP\", { locale: ptBR });\r\n  };\r\n\r\n  const formatTime = (dateString: string) => {\r\n    return format(new Date(dateString), \"HH:mm\", { locale: ptBR });\r\n  };\r\n\r\n  const isPastDue = (dateString: string, isCompleted: boolean) => {\r\n    if (isCompleted) return false;\r\n    const dueDate = new Date(dateString);\r\n    const today = new Date();\r\n    return dueDate < today;\r\n  };\r\n\r\n  const getReminderStatusBadge = (reminder: Reminder) => {\r\n    if (reminder.is_completed) {\r\n      return <Badge className=\"bg-green-500 hover:bg-green-600\">Concluído</Badge>;\r\n    } else if (isPastDue(reminder.due_date, reminder.is_completed)) {\r\n      return <Badge className=\"bg-red-500 hover:bg-red-600\">Atrasado</Badge>;\r\n    } else {\r\n      return <Badge className=\"bg-blue-500 hover:bg-blue-600\">Pendente</Badge>;\r\n    }\r\n  };\r\n\r\n  // Find reminders for the selected day\r\n  const selectedDayReminders = selectedDay \r\n    ? reminders.filter(reminder => \r\n        isSameDay(startOfDay(new Date(reminder.due_date)), startOfDay(selectedDay))\r\n      )\r\n    : [];\r\n\r\n  return (\r\n    <PageLayout\r\n      title=\"Calendário de Lembretes\"\r\n      subtitle=\"Visualize e gerencie seus lembretes por data\"\r\n    >\r\n      <div className=\"space-y-6\">\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n          <Card className=\"lg:col-span-1\">\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg\">Selecione uma data</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex justify-center\">\r\n                {isLoading ? (\r\n                  <div className=\"flex items-center justify-center p-8\">\r\n                    <Loader2 className=\"h-8 w-8 animate-spin text-blue-500\" />\r\n                  </div>\r\n                ) : (\r\n                  <CustomCalendar\r\n                    selected={selectedDay}\r\n                    onSelect={setSelectedDay}\r\n                    currentMonth={currentMonth}\r\n                    onMonthChange={setCurrentMonth}\r\n                    highlightedDates={daysWithReminders}\r\n                    size=\"md\"\r\n                  />\r\n                )}\r\n              </div>\r\n              <div className=\"mt-6 space-y-3\">\r\n                <h4 className=\"text-sm font-semibold text-gray-700 mb-3\">Legenda do Calendário:</h4>\r\n                <div className=\"grid grid-cols-1 gap-3\">\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"w-6 h-6 rounded-full bg-blue-600 shadow-md\"></div>\r\n                    <span className=\"text-sm font-medium\">Data Selecionada</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"w-6 h-6 rounded-full bg-orange-500 shadow-md\"></div>\r\n                    <span className=\"text-sm font-medium\">Hoje</span>\r\n                  </div>\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"w-6 h-6 rounded-full bg-purple-500 shadow-md\"></div>\r\n                    <span className=\"text-sm font-medium\">Com Lembretes</span>\r\n                </div>\r\n                  <div className=\"flex items-center space-x-3\">\r\n                    <div className=\"w-6 h-6 rounded-full bg-white border border-gray-200 shadow-sm\"></div>\r\n                    <span className=\"text-sm font-medium\">Dias Normais</span>\r\n                </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card className=\"lg:col-span-2\">\r\n            <CardHeader>\r\n              <CardTitle>\r\n                {selectedDay \r\n                  ? `Lembretes para ${format(selectedDay, 'dd/MM/yyyy', { locale: ptBR })}`\r\n                  : \"Selecione uma data para ver os lembretes\"\r\n                }\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {isLoading ? (\r\n                <div className=\"flex items-center justify-center p-8\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin text-blue-500\" />\r\n                </div>\r\n              ) : selectedDayReminders.length > 0 ? (\r\n                <div className=\"space-y-4\">\r\n                  {selectedDayReminders.map((reminder) => (\r\n                    <div\r\n                      key={reminder.id}\r\n                      className={cn(\r\n                        \"flex items-center justify-between p-4 rounded-md border\",\r\n                        reminder.is_completed ? \"bg-gray-50 opacity-70\" : \"bg-white\",\r\n                        isPastDue(reminder.due_date, reminder.is_completed) ? \"border-red-300\" : \"border-gray-200\"\r\n                      )}\r\n                    >\r\n                      <div className=\"flex-1\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <h3 className={cn(\r\n                            \"font-medium\",\r\n                            reminder.is_completed && \"line-through text-gray-500\"\r\n                          )}>\r\n                            {reminder.title}\r\n                          </h3>\r\n                          {getReminderStatusBadge(reminder)}\r\n                        </div>\r\n                        <p className=\"text-sm text-gray-500 mt-1\">\r\n                          Cliente: {getLeadName(reminder.lead_id)}\r\n                        </p>\r\n                        {reminder.bank && (\r\n                          <p className=\"text-sm text-gray-500\">\r\n                            Banco: {getBankName(reminder.bank)}\r\n                          </p>\r\n                        )}\r\n                        <div className=\"flex items-center mt-1 text-sm text-gray-500\">\r\n                          <CalendarIcon className=\"h-4 w-4 mr-1\" />\r\n                          <span>{formatDate(reminder.due_date)} às {formatTime(reminder.due_date)}</span>\r\n                        </div>\r\n                        {reminder.notes && (\r\n                          <Popover>\r\n                            <PopoverTrigger asChild>\r\n                              <Button variant=\"link\" className=\"p-0 h-auto text-sm text-blue-600\">\r\n                                Ver detalhes\r\n                              </Button>\r\n                            </PopoverTrigger>\r\n                            <PopoverContent className=\"w-80\">\r\n                              <div className=\"space-y-2\">\r\n                                <h4 className=\"font-medium\">Observações:</h4>\r\n                                <p className=\"text-sm\">{reminder.notes}</p>\r\n                              </div>\r\n                            </PopoverContent>\r\n                          </Popover>\r\n                        )}\r\n                      </div>\r\n                      \r\n                      <div className=\"flex space-x-2\">\r\n                        <Button\r\n                          variant=\"outline\"\r\n                          size=\"icon\"\r\n                          className={cn(\r\n                            \"h-8 w-8\",\r\n                            reminder.is_completed ? \"text-green-600\" : \"\"\r\n                          )}\r\n                          onClick={() => handleToggleComplete(reminder)}\r\n                        >\r\n                          <Check className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              ) : (\r\n                <div className=\"text-center py-10 border rounded-md\">\r\n                  <h3 className=\"text-lg font-medium text-gray-900\">Nenhum lembrete para esta data</h3>\r\n                  <p className=\"mt-1 text-sm text-gray-500\">\r\n                    Selecione outra data ou crie um novo lembrete.\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    </PageLayout>\r\n  );\r\n};\r\n\r\nexport default RemindersCalendar;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\RemindersManagement.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\ResetAdminPassword.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2668,2671],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2668,2671],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":160,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":160,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5167,5170],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5167,5170],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useSearchParams, useNavigate } from 'react-router-dom';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Loader2, Eye, EyeOff, Shield, CheckCircle, AlertTriangle, Key } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from 'sonner';\r\n\r\nconst ResetAdminPassword = () => {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const token = searchParams.get('token');\r\n  \r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    new: false,\r\n    confirm: false\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [isValidating, setIsValidating] = useState(true);\r\n  const [isValidToken, setIsValidToken] = useState(false);\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n\r\n  // Validar token\r\n  useEffect(() => {\r\n    const validateToken = async () => {\r\n      if (!token) {\r\n        setIsValidating(false);\r\n        setIsValidToken(false);\r\n        setMessage({ type: 'error', text: 'Token não fornecido.' });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const { data: userData } = await supabase.auth.getUser();\r\n        if (!userData.user) {\r\n          setIsValidating(false);\r\n          setIsValidToken(false);\r\n          setMessage({ type: 'error', text: 'Usuário não autenticado.' });\r\n          return;\r\n        }\r\n\r\n        const { data, error } = await supabase\r\n          .from('admin_password_resets')\r\n          .select('*')\r\n          .eq('token', token)\r\n          .eq('user_id', userData.user.id)\r\n          .eq('used', false)\r\n          .single();\r\n\r\n        if (error || !data) {\r\n          setIsValidating(false);\r\n          setIsValidToken(false);\r\n          setMessage({ type: 'error', text: 'Token inválido ou expirado.' });\r\n          return;\r\n        }\r\n\r\n        // Verificar se o token não expirou\r\n        const expiresAt = new Date(data.expires_at);\r\n        if (expiresAt < new Date()) {\r\n          setIsValidating(false);\r\n          setIsValidToken(false);\r\n          setMessage({ type: 'error', text: 'Token expirado. Solicite um novo.' });\r\n          return;\r\n        }\r\n\r\n        setIsValidToken(true);\r\n      } catch (error: any) {\r\n        console.error('Erro ao validar token:', error);\r\n        setIsValidating(false);\r\n        setIsValidToken(false);\r\n        setMessage({ type: 'error', text: 'Erro ao validar token.' });\r\n      } finally {\r\n        setIsValidating(false);\r\n      }\r\n    };\r\n\r\n    validateToken();\r\n  }, [token]);\r\n\r\n  // Hash da senha\r\n  const hashPassword = async (password: string): Promise<string> => {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(password);\r\n    const hash = await crypto.subtle.digest('SHA-256', data);\r\n    return Array.from(new Uint8Array(hash))\r\n      .map(b => b.toString(16).padStart(2, '0'))\r\n      .join('');\r\n  };\r\n\r\n  // Validar formulário\r\n  const validateForm = () => {\r\n    if (newPassword.length < 6) {\r\n      setMessage({ type: 'error', text: 'A senha deve ter pelo menos 6 caracteres.' });\r\n      return false;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setMessage({ type: 'error', text: 'As senhas não coincidem.' });\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Redefinir senha\r\n  const handleResetPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm() || !token) {\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const { data: userData } = await supabase.auth.getUser();\r\n      if (!userData.user) {\r\n        throw new Error('Usuário não encontrado.');\r\n      }\r\n\r\n      const hashedPassword = await hashPassword(newPassword);\r\n\r\n      // Atualizar senha administrativa\r\n      const { error: updateError } = await supabase\r\n        .from('profiles')\r\n        .update({ admin_password_hash: hashedPassword })\r\n        .eq('id', userData.user.id);\r\n\r\n      if (updateError) throw updateError;\r\n\r\n      // Marcar token como usado\r\n      const { error: tokenError } = await supabase\r\n        .from('admin_password_resets')\r\n        .update({ used: true })\r\n        .eq('token', token);\r\n\r\n      if (tokenError) {\r\n        console.warn('Erro ao marcar token como usado:', tokenError);\r\n        // Não bloquear se falhar, a senha já foi atualizada\r\n      }\r\n\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha administrativa redefinida com sucesso!' \r\n      });\r\n      \r\n      toast.success('Senha administrativa redefinida com sucesso!');\r\n      \r\n      // Redirecionar após 2 segundos\r\n      setTimeout(() => {\r\n        navigate('/settings?tab=security');\r\n      }, 2000);\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao redefinir senha:', error);\r\n      setMessage({ type: 'error', text: 'Erro ao redefinir senha administrativa. Tente novamente.' });\r\n      toast.error('Erro ao redefinir senha administrativa.');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (isValidating) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <Card className=\"w-full max-w-md\">\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex flex-col items-center justify-center space-y-4\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\r\n              <p className=\"text-sm text-gray-600\">Validando token...</p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!isValidToken) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <Card className=\"w-full max-w-md\">\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2 text-red-600\">\r\n              <AlertTriangle className=\"w-5 h-5\" />\r\n              Token Inválido\r\n            </CardTitle>\r\n            <CardDescription>\r\n              O token de redefinição é inválido ou expirou.\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {message && (\r\n              <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n                <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n                  {message.text}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n            <Button\r\n              onClick={() => navigate('/settings?tab=security')}\r\n              className=\"w-full mt-4\"\r\n            >\r\n              Voltar para Configurações\r\n            </Button>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 p-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Key className=\"w-5 h-5 text-purple-600\" />\r\n            Redefinir Senha Administrativa\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Digite sua nova senha administrativa\r\n          </CardDescription>\r\n        </CardHeader>\r\n        \r\n        <CardContent>\r\n          <form onSubmit={handleResetPassword} className=\"space-y-4\">\r\n            {/* Nova Senha */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"newPassword\" className=\"text-sm font-medium\">\r\n                Nova Senha Administrativa\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"newPassword\"\r\n                  type={showPasswords.new ? \"text\" : \"password\"}\r\n                  value={newPassword}\r\n                  onChange={(e) => setNewPassword(e.target.value)}\r\n                  placeholder=\"Digite sua nova senha\"\r\n                  disabled={isLoading}\r\n                  className=\"pr-12\"\r\n                  autoComplete=\"new-password\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                  onClick={() => setShowPasswords(prev => ({ ...prev, new: !prev.new }))}\r\n                >\r\n                  {showPasswords.new ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Confirmar Nova Senha */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium\">\r\n                Confirmar Nova Senha\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPassword\"\r\n                  type={showPasswords.confirm ? \"text\" : \"password\"}\r\n                  value={confirmPassword}\r\n                  onChange={(e) => setConfirmPassword(e.target.value)}\r\n                  placeholder=\"Confirme sua nova senha\"\r\n                  disabled={isLoading}\r\n                  className=\"pr-12\"\r\n                  autoComplete=\"new-password\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                  onClick={() => setShowPasswords(prev => ({ ...prev, confirm: !prev.confirm }))}\r\n                >\r\n                  {showPasswords.confirm ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Indicador de confirmação */}\r\n              {confirmPassword && (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  {newPassword === confirmPassword ? (\r\n                    <>\r\n                      <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                      <span className=\"text-green-600\">Senhas coincidem</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <AlertTriangle className=\"w-4 h-4 text-red-500\" />\r\n                      <span className=\"text-red-500\">Senhas não coincidem</span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Mensagem de feedback */}\r\n            {message && (\r\n              <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n                <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n                  {message.text}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n\r\n            {/* Botões */}\r\n            <div className=\"flex gap-3 pt-4\">\r\n              <Button\r\n                type=\"submit\"\r\n                disabled={isLoading || !newPassword || !confirmPassword || newPassword !== confirmPassword}\r\n                className=\"flex-1\"\r\n              >\r\n                {isLoading ? (\r\n                  <>\r\n                    <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    Redefinindo...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Shield className=\"w-4 h-4 mr-2\" />\r\n                    Redefinir Senha\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetAdminPassword;\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\ResetPassword.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3037,3040],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3037,3040],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":200,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":200,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7129,7132],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7129,7132],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription } from '@/components/ui/alert';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Loader2, Eye, EyeOff, Lock, CheckCircle, AlertTriangle, ArrowLeft } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { toast } from 'sonner';\r\n\r\nconst ResetPassword: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showPasswords, setShowPasswords] = useState({\r\n    new: false,\r\n    confirm: false\r\n  });\r\n  const [message, setMessage] = useState<{ type: 'success' | 'error'; text: string } | null>(null);\r\n  const [isValidSession, setIsValidSession] = useState<boolean | null>(null);\r\n\r\n  // Verificar se há uma sessão válida de reset\r\n  useEffect(() => {\r\n    const checkSession = async () => {\r\n      // Debug: mostrar parâmetros da URL\r\n      console.log('🔍 Verificando parâmetros da URL:', {\r\n        access_token: searchParams.get('access_token') ? 'presente' : 'ausente',\r\n        refresh_token: searchParams.get('refresh_token') ? 'presente' : 'ausente',\r\n        type: searchParams.get('type'),\r\n        fullURL: window.location.href\r\n      });\r\n      \r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      \r\n      // Verificar se há um token de recuperação nos parâmetros da URL\r\n      const accessToken = searchParams.get('access_token');\r\n      const refreshToken = searchParams.get('refresh_token');\r\n      const type = searchParams.get('type');\r\n      \r\n      console.log('🔐 Tokens encontrados:', {\r\n        hasAccessToken: !!accessToken,\r\n        hasRefreshToken: !!refreshToken,\r\n        type,\r\n        hasExistingSession: !!session\r\n      });\r\n\r\n      if (type === 'recovery' && accessToken) {\r\n        // Definir a sessão com os tokens da URL\r\n        try {\r\n          console.log('🔄 Tentando configurar sessão com tokens...');\r\n          const { data, error } = await supabase.auth.setSession({\r\n            access_token: accessToken,\r\n            refresh_token: refreshToken || ''\r\n          });\r\n          \r\n          if (error) {\r\n            console.error('❌ Erro ao configurar sessão:', error);\r\n            setIsValidSession(false);\r\n            setMessage({ \r\n              type: 'error', \r\n              text: `Link de recuperação inválido ou expirado: ${error.message}. Solicite um novo link.` \r\n            });\r\n          } else {\r\n            console.log('✅ Sessão configurada com sucesso!');\r\n            setIsValidSession(true);\r\n          }\r\n        } catch (error: any) {\r\n          console.error('❌ Erro ao processar link:', error);\r\n          setIsValidSession(false);\r\n          setMessage({ \r\n            type: 'error', \r\n            text: `Erro ao processar link de recuperação: ${error?.message || 'Erro desconhecido'}.` \r\n          });\r\n        }\r\n      } else if (session) {\r\n        console.log('✅ Sessão válida encontrada');\r\n        setIsValidSession(true);\r\n      } else {\r\n        console.warn('⚠️ Nenhuma sessão válida encontrada');\r\n        setIsValidSession(false);\r\n        \r\n        // Verificar se veio algum hash na URL (alternativa do Supabase)\r\n        const hash = window.location.hash;\r\n        if (hash && hash.includes('access_token')) {\r\n          console.log('🔍 Token encontrado no hash, tentando processar...');\r\n          // Tentar processar hash\r\n          const hashParams = new URLSearchParams(hash.substring(1));\r\n          const hashAccessToken = hashParams.get('access_token');\r\n          const hashRefreshToken = hashParams.get('refresh_token');\r\n          \r\n          if (hashAccessToken) {\r\n            try {\r\n              const { error } = await supabase.auth.setSession({\r\n                access_token: hashAccessToken,\r\n                refresh_token: hashRefreshToken || ''\r\n              });\r\n              \r\n              if (!error) {\r\n                console.log('✅ Sessão configurada via hash!');\r\n                setIsValidSession(true);\r\n                return;\r\n              }\r\n            } catch (err) {\r\n              console.error('❌ Erro ao processar hash:', err);\r\n            }\r\n          }\r\n        }\r\n        \r\n        setMessage({ \r\n          type: 'error', \r\n          text: 'Acesso não autorizado. Solicite um novo link de recuperação ou verifique se a URL está completa.' \r\n        });\r\n      }\r\n    };\r\n\r\n    checkSession();\r\n  }, [searchParams]);\r\n\r\n  // Função para alternar visibilidade da senha\r\n  const togglePasswordVisibility = (field: 'new' | 'confirm') => {\r\n    setShowPasswords(prev => ({\r\n      ...prev,\r\n      [field]: !prev[field]\r\n    }));\r\n  };\r\n\r\n  // Verificar força da senha\r\n  const getPasswordStrength = (password: string) => {\r\n    let strength = 0;\r\n    const checks = {\r\n      length: password.length >= 8,\r\n      lowercase: /[a-z]/.test(password),\r\n      uppercase: /[A-Z]/.test(password),\r\n      numbers: /\\d/.test(password),\r\n      symbols: /[!@#$%^&*(),.?\":{}|<>]/.test(password)\r\n    };\r\n\r\n    strength = Object.values(checks).filter(Boolean).length;\r\n\r\n    if (strength <= 2) return { level: 'weak', color: 'red', text: 'Fraca' };\r\n    if (strength <= 3) return { level: 'medium', color: 'yellow', text: 'Média' };\r\n    if (strength <= 4) return { level: 'good', color: 'blue', text: 'Boa' };\r\n    return { level: 'strong', color: 'green', text: 'Forte' };\r\n  };\r\n\r\n  const passwordStrength = newPassword ? getPasswordStrength(newPassword) : null;\r\n\r\n  // Validações\r\n  const validateForm = () => {\r\n    if (newPassword.length < 6) {\r\n      setMessage({ type: 'error', text: 'A nova senha deve ter pelo menos 6 caracteres.' });\r\n      return false;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      setMessage({ type: 'error', text: 'As senhas não coincidem.' });\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Redefinir senha\r\n  const handleResetPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!validateForm()) {\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setMessage(null);\r\n\r\n    try {\r\n      const { error } = await supabase.auth.updateUser({\r\n        password: newPassword\r\n      });\r\n\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      // Sucesso\r\n      setMessage({ \r\n        type: 'success', \r\n        text: 'Senha redefinida com sucesso! Redirecionando para o login...' \r\n      });\r\n      \r\n      toast.success('Senha redefinida com sucesso!');\r\n\r\n      // Fazer logout e redirecionar para login após 3 segundos\r\n      setTimeout(async () => {\r\n        await supabase.auth.signOut();\r\n        navigate('/login', { replace: true });\r\n      }, 3000);\r\n\r\n    } catch (error: any) {\r\n      console.error('Erro ao redefinir senha:', error);\r\n      \r\n      let errorMessage = 'Erro ao redefinir senha. Tente novamente.';\r\n      \r\n      if (error.message?.includes('weak password') || error.message?.includes('password is too weak')) {\r\n        errorMessage = 'A senha é muito fraca. Use uma senha mais forte.';\r\n      } else if (error.message?.includes('session_not_found')) {\r\n        errorMessage = 'Sessão expirada. Solicite um novo link de recuperação.';\r\n      }\r\n      \r\n      setMessage({ type: 'error', text: errorMessage });\r\n      toast.error(errorMessage);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Ir para login\r\n  const goToLogin = () => {\r\n    navigate('/login');\r\n  };\r\n\r\n  // Loading inicial\r\n  if (isValidSession === null) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4\">\r\n        <Card className=\"w-full max-w-md mx-auto\">\r\n          <CardContent className=\"flex items-center justify-center p-8\">\r\n            <div className=\"text-center\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-blue-600 mx-auto mb-4\" />\r\n              <p className=\"text-gray-600\">Verificando link de recuperação...</p>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Sessão inválida\r\n  if (!isValidSession) {\r\n    return (\r\n      <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4\">\r\n        <Card className=\"w-full max-w-md mx-auto\">\r\n          <CardHeader className=\"text-center\">\r\n            <CardTitle className=\"flex items-center justify-center gap-2 text-red-600\">\r\n              <AlertTriangle className=\"w-5 h-5\" />\r\n              Link Inválido\r\n            </CardTitle>\r\n            <CardDescription>\r\n              O link de recuperação é inválido ou expirou\r\n            </CardDescription>\r\n          </CardHeader>\r\n          \r\n          <CardContent className=\"space-y-4\">\r\n            {message && (\r\n              <Alert className=\"border-red-500\">\r\n                <AlertDescription className=\"text-red-700\">\r\n                  {message.text}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n\r\n            <div className=\"text-center space-y-4\">\r\n              <p className=\"text-sm text-gray-600\">\r\n                Para redefinir sua senha, você precisa solicitar um novo link de recuperação.\r\n              </p>\r\n              \r\n              <Button onClick={goToLogin} className=\"w-full\">\r\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n                Ir para o Login\r\n              </Button>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Formulário de redefinição\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center p-4\">\r\n      <Card className=\"w-full max-w-md mx-auto\">\r\n        <CardHeader className=\"text-center\">\r\n          <CardTitle className=\"flex items-center justify-center gap-2\">\r\n            <Lock className=\"w-5 h-5 text-blue-600\" />\r\n            Redefinir Senha\r\n          </CardTitle>\r\n          <CardDescription>\r\n            Digite sua nova senha para finalizar a recuperação\r\n          </CardDescription>\r\n        </CardHeader>\r\n        \r\n        <CardContent className=\"space-y-4\">\r\n          <form onSubmit={handleResetPassword} className=\"space-y-4\">\r\n            \r\n            {/* Nova Senha */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"newPassword\" className=\"text-sm font-medium\">\r\n                Nova Senha\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"newPassword\"\r\n                  type={showPasswords.new ? \"text\" : \"password\"}\r\n                  value={newPassword}\r\n                  onChange={(e) => setNewPassword(e.target.value)}\r\n                  placeholder=\"Digite sua nova senha\"\r\n                  disabled={isLoading}\r\n                  className=\"pr-12\"\r\n                  autoComplete=\"new-password\"\r\n                  autoFocus\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                  onClick={() => togglePasswordVisibility('new')}\r\n                >\r\n                  {showPasswords.new ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Indicador de força da senha */}\r\n              {newPassword && passwordStrength && (\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-center gap-2 text-sm\">\r\n                    <span>Força da senha:</span>\r\n                    <span className={`font-medium text-${passwordStrength.color}-600`}>\r\n                      {passwordStrength.text}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"w-full bg-gray-200 rounded-full h-2\">\r\n                    <div\r\n                      className={`h-2 rounded-full bg-${passwordStrength.color}-500 transition-all duration-300`}\r\n                      style={{ width: `${(Object.values(getPasswordStrength(newPassword)).filter(Boolean).length - 1) * 25}%` }}\r\n                    ></div>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Dicas de senha */}\r\n              <div className=\"text-xs text-gray-500 space-y-1\">\r\n                <p>A senha deve conter:</p>\r\n                <div className=\"grid grid-cols-2 gap-1\">\r\n                  <span className={newPassword.length >= 8 ? 'text-green-600' : 'text-gray-400'}>\r\n                    ✓ 8+ caracteres\r\n                  </span>\r\n                  <span className={/[A-Z]/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                    ✓ Maiúscula\r\n                  </span>\r\n                  <span className={/[a-z]/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                    ✓ Minúscula\r\n                  </span>\r\n                  <span className={/\\d/.test(newPassword) ? 'text-green-600' : 'text-gray-400'}>\r\n                    ✓ Número\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Confirmar Nova Senha */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"confirmPassword\" className=\"text-sm font-medium\">\r\n                Confirmar Nova Senha\r\n              </Label>\r\n              <div className=\"relative\">\r\n                <Input\r\n                  id=\"confirmPassword\"\r\n                  type={showPasswords.confirm ? \"text\" : \"password\"}\r\n                  value={confirmPassword}\r\n                  onChange={(e) => setConfirmPassword(e.target.value)}\r\n                  placeholder=\"Confirme sua nova senha\"\r\n                  disabled={isLoading}\r\n                  className=\"pr-12\"\r\n                  autoComplete=\"new-password\"\r\n                />\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\r\n                  onClick={() => togglePasswordVisibility('confirm')}\r\n                >\r\n                  {showPasswords.confirm ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </button>\r\n              </div>\r\n              \r\n              {/* Indicador de confirmação */}\r\n              {confirmPassword && (\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  {newPassword === confirmPassword ? (\r\n                    <>\r\n                      <CheckCircle className=\"w-4 h-4 text-green-600\" />\r\n                      <span className=\"text-green-600\">Senhas coincidem</span>\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <AlertTriangle className=\"w-4 h-4 text-red-500\" />\r\n                      <span className=\"text-red-500\">Senhas não coincidem</span>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Mensagem de feedback */}\r\n            {message && (\r\n              <Alert className={message.type === 'error' ? 'border-red-500' : 'border-green-500'}>\r\n                <AlertDescription className={message.type === 'error' ? 'text-red-700' : 'text-green-700'}>\r\n                  {message.text}\r\n                </AlertDescription>\r\n              </Alert>\r\n            )}\r\n\r\n            {/* Botão */}\r\n            <Button\r\n              type=\"submit\"\r\n              className=\"w-full\"\r\n              disabled={isLoading || !newPassword || !confirmPassword || newPassword !== confirmPassword}\r\n            >\r\n              {isLoading ? (\r\n                <>\r\n                  <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                  Redefinindo...\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Lock className=\"w-4 h-4 mr-2\" />\r\n                  Redefinir Senha\r\n                </>\r\n              )}\r\n            </Button>\r\n          </form>\r\n\r\n          <div className=\"text-center pt-4\">\r\n            <Button \r\n              variant=\"ghost\" \r\n              onClick={goToLogin}\r\n              disabled={isLoading}\r\n            >\r\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n              Voltar ao login\r\n            </Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetPassword; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Roteiros.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\RoteirosAdmin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\RoteirosDetalhes.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[582,585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[582,585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":242,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":242,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9064,9067],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9064,9067],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":289,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":289,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11091,11094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11091,11094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":295,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11515,11518],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11515,11518],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport PageLayout from \"@/components/PageLayout\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { ArrowLeft, FileText, Video, ExternalLink } from \"lucide-react\";\r\nimport DocumentViewer from \"@/components/roteiros/DocumentViewer\";\r\nimport VideoPlayer from \"@/components/roteiros/VideoPlayer\";\r\n\r\n// Dados mockados (em produção viriam do banco de dados)\r\nconst bancosData: Record<string, any> = {\r\n    amigoz: {\r\n        nome: \"Amigoz\",\r\n        logo: \"/logos/amigoz.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"Governos\",\r\n                documentos: [\r\n                    { id: 1, nome: \"Manual Operacional - Governos\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" },\r\n                    { id: 2, nome: \"Tutorial Completo\", tipo: \"video\", url: \"https://www.w3schools.com/html/mov_bbb.mp4\" }\r\n                ]\r\n            },\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 3, nome: \"Roteiro INSS 2024\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" },\r\n                    { id: 4, nome: \"Passo a Passo INSS\", tipo: \"video\", url: \"https://www.w3schools.com/html/mov_bbb.mp4\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    banrisul: {\r\n        nome: \"Banrisul\",\r\n        logo: \"/logos/banrisul.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"FGTS\",\r\n                documentos: [\r\n                    { id: 6, nome: \"Manual FGTS Banrisul\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" },\r\n                    { id: 7, nome: \"Como operar FGTS\", tipo: \"video\", url: \"https://www.w3schools.com/html/mov_bbb.mp4\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    bmg: {\r\n        nome: \"BMG\",\r\n        logo: \"/logos/bmg.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"CLT\",\r\n                documentos: [\r\n                    { id: 8, nome: \"Roteiro CLT BMG\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    brb: {\r\n        nome: \"Financeira BRB\",\r\n        logo: \"/logos/brb.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"FGTS\",\r\n                documentos: [\r\n                    { id: 9, nome: \"Manual BRB FGTS\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    c6: {\r\n        nome: \"C6 Consig\",\r\n        logo: \"/logos/c6.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"CLT\",\r\n                documentos: [\r\n                    { id: 10, nome: \"Roteiro CLT C6\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    bradesco: {\r\n        nome: \"Bradesco\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2014/05/bradesco-logo-1.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 11, nome: \"Manual INSS Bradesco\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    itau: {\r\n        nome: \"Itaú\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2015/02/itau-logo-0.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 12, nome: \"Manual INSS Itaú\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    santander: {\r\n        nome: \"Santander\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2014/05/santander-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 13, nome: \"Manual INSS Santander\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    caixa: {\r\n        nome: \"Caixa Econômica\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2014/05/caixa-economica-federal-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"FGTS\",\r\n                documentos: [\r\n                    { id: 14, nome: \"Manual FGTS Caixa\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    \"banco-do-brasil\": {\r\n        nome: \"Banco do Brasil\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2014/05/banco-do-brasil-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 15, nome: \"Manual INSS BB\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    safra: {\r\n        nome: \"Safra\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2020/04/banco-safra-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 16, nome: \"Manual INSS Safra\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    pan: {\r\n        nome: \"Banco Pan\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2019/11/banco-pan-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 17, nome: \"Manual INSS Pan\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    mercantil: {\r\n        nome: \"Mercantil do Brasil\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2020/04/banco-mercantil-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 18, nome: \"Manual INSS Mercantil\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    daycoval: {\r\n        nome: \"Daycoval\",\r\n        logo: \"https://logodownload.org/wp-content/uploads/2020/04/banco-daycoval-logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 19, nome: \"Manual INSS Daycoval\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    ole: {\r\n        nome: \"Olé Consignado\",\r\n        logo: \"https://www.oleconsignado.com.br/wp-content/uploads/2021/03/logo-ole.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 20, nome: \"Manual INSS Olé\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    facta: {\r\n        nome: \"Facta\",\r\n        logo: \"https://www.factafinanceira.com.br/wp-content/themes/facta/assets/img/logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 21, nome: \"Manual INSS Facta\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    master: {\r\n        nome: \"Master\",\r\n        logo: \"https://www.bancomaster.com.br/Content/img/logo.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"INSS\",\r\n                documentos: [\r\n                    { id: 22, nome: \"Manual INSS Master\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    },\r\n    cetelem: {\r\n        nome: \"Cetelem\",\r\n        logo: \"https://www.cetelem.com.br/content/dam/bnpparibas/br/cetelem/logo-cetelem.png\",\r\n        categorias: [\r\n            {\r\n                nome: \"CLT\",\r\n                documentos: [\r\n                    { id: 23, nome: \"Manual CLT Cetelem\", tipo: \"pdf\", url: \"https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf\" }\r\n                ]\r\n            }\r\n        ]\r\n    }\r\n};\r\n\r\nexport default function RoteirosDetalhes() {\r\n    const { banco } = useParams<{ banco: string }>();\r\n    const navigate = useNavigate();\r\n    const [selectedDoc, setSelectedDoc] = useState<any>(null);\r\n\r\n    const bancoData = banco ? bancosData[banco] : null;\r\n\r\n    if (!bancoData) {\r\n        return (\r\n            <PageLayout title=\"Banco não encontrado\">\r\n                <div className=\"text-center py-12\">\r\n                    <p className=\"text-gray-500 text-lg mb-4\">Banco não encontrado</p>\r\n                    <Button onClick={() => navigate(\"/roteiros\")}>\r\n                        <ArrowLeft className=\"mr-2 h-4 w-4\" />\r\n                        Voltar\r\n                    </Button>\r\n                </div>\r\n            </PageLayout>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <PageLayout title={`Roteiros - ${bancoData.nome}`}>\r\n            <div className=\"space-y-6\">\r\n                {/* Header */}\r\n                <div className=\"flex items-center gap-4\">\r\n                    <Button\r\n                        variant=\"outline\"\r\n                        onClick={() => navigate(\"/roteiros\")}\r\n                        className=\"flex items-center gap-2\"\r\n                    >\r\n                        <ArrowLeft className=\"h-4 w-4\" />\r\n                        Voltar\r\n                    </Button>\r\n                    <div className=\"flex items-center gap-4\">\r\n                        <img\r\n                            src={bancoData.logo}\r\n                            alt={bancoData.nome}\r\n                            className=\"h-12 object-contain\"\r\n                            onError={(e) => {\r\n                                e.currentTarget.src = `https://via.placeholder.com/200x80/E5E7EB/6B7280?text=${bancoData.nome}`;\r\n                            }}\r\n                        />\r\n                        <h2 className=\"text-2xl font-bold text-gray-900\">{bancoData.nome}</h2>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                    {/* Lista de categorias e documentos */}\r\n                    <div className=\"lg:col-span-1 space-y-4\">\r\n                        {bancoData.categorias.map((categoria: any, catIndex: number) => (\r\n                            <Card key={catIndex}>\r\n                                <CardHeader className=\"pb-3\">\r\n                                    <CardTitle className=\"text-lg\">{categoria.nome}</CardTitle>\r\n                                </CardHeader>\r\n                                <CardContent className=\"space-y-2\">\r\n                                    {categoria.documentos.map((doc: any) => (\r\n                                        <Button\r\n                                            key={doc.id}\r\n                                            variant={selectedDoc?.id === doc.id ? \"default\" : \"outline\"}\r\n                                            className=\"w-full justify-start gap-2\"\r\n                                            onClick={() => setSelectedDoc(doc)}\r\n                                        >\r\n                                            {doc.tipo === \"pdf\" ? (\r\n                                                <FileText className=\"h-4 w-4\" />\r\n                                            ) : (\r\n                                                <Video className=\"h-4 w-4\" />\r\n                                            )}\r\n                                            <span className=\"truncate\">{doc.nome}</span>\r\n                                        </Button>\r\n                                    ))}\r\n                                </CardContent>\r\n                            </Card>\r\n                        ))}\r\n                    </div>\r\n\r\n                    {/* Visualizador */}\r\n                    <div className=\"lg:col-span-2\">\r\n                        {selectedDoc ? (\r\n                            <Card className=\"h-full\">\r\n                                <CardHeader>\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                        <CardTitle className=\"flex items-center gap-2\">\r\n                                            {selectedDoc.tipo === \"pdf\" ? (\r\n                                                <FileText className=\"h-5 w-5\" />\r\n                                            ) : (\r\n                                                <Video className=\"h-5 w-5\" />\r\n                                            )}\r\n                                            {selectedDoc.nome}\r\n                                        </CardTitle>\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => window.open(selectedDoc.url, \"_blank\")}\r\n                                        >\r\n                                            <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                                            Abrir em nova aba\r\n                                        </Button>\r\n                                    </div>\r\n                                </CardHeader>\r\n                                <CardContent>\r\n                                    {selectedDoc.tipo === \"pdf\" ? (\r\n                                        <DocumentViewer url={selectedDoc.url} />\r\n                                    ) : (\r\n                                        <VideoPlayer url={selectedDoc.url} />\r\n                                    )}\r\n                                </CardContent>\r\n                            </Card>\r\n                        ) : (\r\n                            <Card className=\"h-full flex items-center justify-center\">\r\n                                <CardContent className=\"text-center py-12\">\r\n                                    <FileText className=\"h-16 w-16 text-gray-300 mx-auto mb-4\" />\r\n                                    <p className=\"text-gray-500 text-lg\">\r\n                                        Selecione um documento ou vídeo para visualizar\r\n                                    </p>\r\n                                </CardContent>\r\n                            </Card>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </PageLayout>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Sales.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\Settings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\SubscriptionCancelled.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\SubscriptionSuccess.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\pages\\TrafficPremium.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\services\\subscriptionService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\types\\models.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1745,1748],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1745,1748],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Add the missing 'name' property to CommissionRate and CommissionTier interfaces\r\n\r\nexport interface CommissionRate {\r\n  id: string;\r\n  user_id: string;\r\n  product: string;\r\n  name: string | null; // Ensure this property exists\r\n  percentage: number;\r\n  fixed_value?: number; // Valor fixo da comissão\r\n  commission_type: 'percentage' | 'fixed'; // Tipo de comissão: percentual ou fixa\r\n  active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport interface CommissionTier {\r\n  id: string;\r\n  user_id: string;\r\n  product: string;\r\n  name: string | null; // Ensure this property exists\r\n  min_amount: number;\r\n  max_amount: number;\r\n  min_period?: number; // Período mínimo em parcelas\r\n  max_period?: number; // Período máximo em parcelas\r\n  tier_type?: 'value' | 'period'; // Tipo da faixa: por valor ou por prazo\r\n  percentage: number;\r\n  fixed_value?: number; // Valor fixo da comissão\r\n  commission_type: 'percentage' | 'fixed'; // Tipo de comissão: percentual ou fixa\r\n  active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n// Update Lead interface to ensure status is properly typed\r\nexport interface Lead {\r\n  id: string;\r\n  user_id?: string;\r\n  name: string;\r\n  email?: string;\r\n  phone?: string;\r\n  phone2?: string;\r\n  phone3?: string;\r\n  cpf?: string;\r\n  status: 'novo' | 'contatado' | 'qualificado' | 'negociando' | 'convertido' | 'perdido';\r\n  source?: string;\r\n  notes?: string;\r\n  amount?: string;\r\n  payment_period?: number; // Número de parcelas (6 a 96)\r\n  date?: string; // Data personalizada do lead\r\n  createdAt: string;\r\n  updatedAt?: string;\r\n  scheduledAt?: string;\r\n  product?: string;\r\n  employee?: string;\r\n  created_at?: string; // Add alias for compatibility\r\n  commission_config?: any; // Configuração de comissão selecionada\r\n}\r\n\r\n// Add Appointment interface\r\nexport interface Appointment {\r\n  id: string;\r\n  lead_id: string;\r\n  user_id: string;\r\n  title: string;\r\n  date: string;\r\n  time: string;\r\n  notes?: string;\r\n  status: 'scheduled' | 'completed' | 'cancelled';\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n// Update Commission interface to include all required fields\r\nexport interface Commission {\r\n  id: string;\r\n  user_id: string;\r\n  lead_id: string;\r\n  amount: number;\r\n  percentage?: number;\r\n  commission_value: number;\r\n  product: string;\r\n  payment_period?: string;\r\n  status: 'in_progress' | 'pending' | 'completed' | 'cancelled' | 'approved' | 'paid';\r\n  payment_date?: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n  employee?: string;\r\n  lead?: Partial<Lead>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\adminPassword.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\bankUtils.ts","messages":[{"ruleId":"prefer-const","severity":2,"message":"'onlyDigits' is never reassigned. Use 'const' instead.","line":105,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":105,"endColumn":17,"fix":{"range":[3488,3533],"text":"const onlyDigits = bankCode.replace(/\\D/g, \"\");"}}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"export const getBankName = (bankCode: string | null | undefined) => {\r\n  if (!bankCode) return \"Banco não especificado\";\r\n  \r\n  // Códigos de texto usados no sistema\r\n  const textBanks: Record<string, string> = {\r\n    \"caixa\": \"Caixa Econômica Federal\",\r\n    \"bb\": \"Banco do Brasil\",\r\n    \"itau\": \"Itaú Unibanco\",\r\n    \"bradesco\": \"Bradesco\",\r\n    \"santander\": \"Santander\",\r\n    \"c6\": \"C6 Bank\",\r\n    \"brb\": \"BRB - Banco de Brasília\",\r\n    \"bmg\": \"Banco BMG\",\r\n    \"pan\": \"Banco Pan\",\r\n    \"ole\": \"Banco Olé\",\r\n    \"daycoval\": \"Banco Daycoval\",\r\n    \"mercantil\": \"Banco Mercantil do Brasil\",\r\n    \"cetelem\": \"Cetelem\",\r\n    \"safra\": \"Banco Safra\",\r\n    \"inter\": \"Banco Inter\",\r\n    \"original\": \"Banco Original\",\r\n    \"facta\": \"Facta\",\r\n    \"bonsucesso\": \"Bonsucesso\",\r\n    \"banrisul\": \"Banrisul\",\r\n    \"sicoob\": \"Sicoob\",\r\n    \"outro\": \"Outro banco\"\r\n  };\r\n\r\n  // Primeiro tenta buscar pelos códigos de texto\r\n  if (textBanks[bankCode.toLowerCase()]) {\r\n    return textBanks[bankCode.toLowerCase()];\r\n  }\r\n\r\n  // Códigos numéricos (para compatibilidade)\r\n  const numericBanks: Record<string, string> = {\r\n    \"001\": \"Banco do Brasil\",\r\n    \"003\": \"Banco da Amazônia\",\r\n    \"004\": \"Banco do Nordeste\",\r\n    \"021\": \"Banestes (Banco do Estado do Espírito Santo)\",\r\n    \"025\": \"Banco Alfa\",\r\n    \"033\": \"Santander\",\r\n    \"041\": \"Banrisul\",\r\n    \"070\": \"BRB (Banco de Brasília)\",\r\n    \"077\": \"Banco Inter\",\r\n    \"104\": \"Caixa Econômica Federal\",\r\n    \"118\": \"Banco Itaú BBA\",\r\n    \"121\": \"Agibank\",\r\n    \"212\": \"Banco Original\",\r\n    \"237\": \"Bradesco\",\r\n    \"260\": \"Nu Pagamentos (Nubank)\",\r\n    \"318\": \"Banco BMG\",\r\n    \"320\": \"CCB Brasil (China Construction Bank)\",\r\n    \"336\": \"C6 Bank\",\r\n    \"341\": \"Itaú Unibanco\",\r\n    \"371\": \"Banco Bari\",\r\n    \"389\": \"Banco Mercantil do Brasil\",\r\n    \"422\": \"Banco Safra\",\r\n    \"604\": \"Banco Industrial\",\r\n    \"623\": \"Banco PAN\",\r\n    \"640\": \"Banco Inbursa\",\r\n    \"654\": \"Banco A.J. Renner (Parati Financeira)\",\r\n    \"655\": \"Banco Votorantim (BV Financeira)\",\r\n    \"707\": \"Banco Daycoval\",\r\n    \"739\": \"Cetelem (BNP Paribas)\",\r\n    \"743\": \"Banco Semear\",\r\n    \"748\": \"Sicredi\",\r\n    \"756\": \"Sicoob\",\r\n    \"777\": \"Banco JP Morgan (atua em nichos)\"\r\n  };\r\n\r\n  // Busca pelos códigos numéricos\r\n  if (numericBanks[bankCode]) {\r\n    return numericBanks[bankCode];\r\n  }\r\n\r\n  // Mapeamentos específicos fora do padrão Febraban\r\n  const customBanks: Record<string, string> = {\r\n    \"8788\": \"Presença Bank\"\r\n  };\r\n  if (customBanks[bankCode]) {\r\n    return customBanks[bankCode];\r\n  }\r\n\r\n  // Buscar bancos customizados salvos localmente (configBanks / editedBanks)\r\n  try {\r\n    const configBanks = JSON.parse(localStorage.getItem(\"configBanks\") || \"[]\") as { code?: string; name?: string }[];\r\n    const editedBanks = JSON.parse(localStorage.getItem(\"editedBanks\") || \"[]\") as { code?: string; name?: string }[];\r\n    const allCustomBanks = [...configBanks, ...editedBanks];\r\n\r\n    const byCode = allCustomBanks.find(\r\n      (b) => b.code && b.code.toLowerCase() === bankCode.toLowerCase()\r\n    );\r\n    if (byCode?.name) return byCode.name;\r\n\r\n    const byName = allCustomBanks.find(\r\n      (b) => b.name && b.name.toLowerCase() === bankCode.toLowerCase()\r\n    );\r\n    if (byName?.name) return byName.name;\r\n  } catch (err) {\r\n    console.warn(\"Falha ao ler bancos customizados do localStorage:\", err);\r\n  }\r\n\r\n  // Heurística para códigos atípicos numéricos com mais de 3 dígitos (ex.: \"8887\"): \r\n  // tenta casar pelos 3 primeiros ou 3 últimos dígitos.\r\n  let onlyDigits = bankCode.replace(/\\D/g, \"\");\r\n  if (onlyDigits.length < 3 && onlyDigits.length > 0) {\r\n    const padded = onlyDigits.padStart(3, \"0\");\r\n    if (numericBanks[padded]) return numericBanks[padded];\r\n  }\r\n  if (onlyDigits.length >= 3) {\r\n    const first3 = onlyDigits.slice(0, 3);\r\n    if (numericBanks[first3]) return numericBanks[first3];\r\n    const last3 = onlyDigits.slice(-3);\r\n    if (numericBanks[last3]) return numericBanks[last3];\r\n  }\r\n\r\n  // Se não encontrou, retorna de forma amigável sem exibir só o número cru\r\n  return `Banco (código ${bankCode})`;\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\csvTemplate.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\dateUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\defaultCommissions.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\domainConfig.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\employees.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\productMapping.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\sentry.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":75,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2403,2406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2403,2406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2806,2809],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2806,2809],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":88,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":91,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3186,3189],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3186,3189],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":201,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":201,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5950,5953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5950,5953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":256,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":256,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7875,7878],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7875,7878],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as Sentry from \"@sentry/react\";\r\nimport React from 'react';\r\n\r\n// Configuração do Sentry\r\nexport const initSentry = () => {\r\n  // Só inicializar se SENTRY_DSN estiver explicitamente configurado\r\n  const dsn = import.meta.env.VITE_SENTRY_DSN;\r\n  const environment = import.meta.env.MODE;\r\n  \r\n  if (dsn && dsn !== \"https://your-sentry-dsn@sentry.io/project-id\") {\r\n    Sentry.init({\r\n      dsn,\r\n      environment,\r\n      \r\n      // Performance monitoring\r\n      tracesSampleRate: environment === 'production' ? 0.1 : 1.0, // 10% em produção, 100% em dev\r\n      \r\n      // Release tracking\r\n      release: `leadconsig@${import.meta.env.VITE_APP_VERSION || '1.0.0'}`,\r\n      \r\n      // Configurações avançadas\r\n      beforeSend(event, hint) {\r\n        // Filtrar erros conhecidos ou irrelevantes\r\n        if (event.exception) {\r\n          const error = hint.originalException;\r\n          \r\n          // Ignorar erros de rede comuns\r\n          if (error && typeof error === 'object' && 'message' in error) {\r\n            const message = error.message as string;\r\n            if (\r\n              message.includes('Network Error') ||\r\n              message.includes('Failed to fetch') ||\r\n              message.includes('ERR_INTERNET_DISCONNECTED') ||\r\n              message.includes('ERR_NETWORK_CHANGED') ||\r\n              message.includes('ChunkLoadError') ||\r\n              message.includes('Loading chunk')\r\n            ) {\r\n              return null; // Não enviar estes erros\r\n            }\r\n          }\r\n        }\r\n        \r\n        // Em desenvolvimento, também logar no console\r\n        if (environment === 'development') {\r\n          console.error('Sentry Event:', event);\r\n        }\r\n        \r\n        return event;\r\n      },\r\n      \r\n      // Configurar contexto inicial\r\n      initialScope: {\r\n        tags: {\r\n          component: \"leadconsig-crm\",\r\n          feature: \"main-app\",\r\n          version: import.meta.env.VITE_APP_VERSION || '1.0.0'\r\n        },\r\n        level: \"info\"\r\n      }\r\n    });\r\n\r\n    // Configurar tags globais\r\n    Sentry.setTags({\r\n      app: 'leadconsig',\r\n      environment\r\n    });\r\n\r\n    console.log(`[Sentry] Inicializado para ${environment}`);\r\n  } else {\r\n    console.log('[Sentry] Não inicializado - ambiente de desenvolvimento');\r\n  }\r\n};\r\n\r\n// Função para capturar erro manualmente\r\nexport const captureError = (error: Error, context?: Record<string, any>) => {\r\n  Sentry.withScope((scope) => {\r\n    if (context) {\r\n      Object.keys(context).forEach(key => {\r\n        scope.setTag(key, String(context[key]));\r\n      });\r\n    }\r\n    scope.setLevel('error');\r\n    Sentry.captureException(error);\r\n  });\r\n};\r\n\r\n// Função para capturar mensagem\r\nexport const captureMessage = (message: string, level: Sentry.SeverityLevel = 'info', context?: Record<string, any>) => {\r\n  Sentry.withScope((scope) => {\r\n    if (context) {\r\n      Object.keys(context).forEach(key => {\r\n        scope.setTag(key, String(context[key]));\r\n      });\r\n    }\r\n    scope.setLevel(level);\r\n    Sentry.captureMessage(message);\r\n  });\r\n};\r\n\r\n// Função para adicionar breadcrumb\r\nexport const addBreadcrumb = (message: string, category: string, data?: Record<string, any>) => {\r\n  Sentry.addBreadcrumb({\r\n    message,\r\n    category,\r\n    level: 'info',\r\n    data\r\n  });\r\n};\r\n\r\n// Configurar contexto do usuário\r\nexport const setUserContext = (user: {\r\n  id?: string;\r\n  email?: string;\r\n  username?: string;\r\n  subscription?: string;\r\n}) => {\r\n  Sentry.setUser(user);\r\n  \r\n  // Adicionar breadcrumb para rastreamento\r\n  addBreadcrumb(`Usuário configurado: ${user.email || user.id}`, 'auth', {\r\n    userId: user.id,\r\n    subscription: user.subscription\r\n  });\r\n};\r\n\r\n// Limpar contexto do usuário (logout)\r\nexport const clearUserContext = () => {\r\n  addBreadcrumb('Usuário deslogado', 'auth');\r\n  Sentry.setUser(null);\r\n};\r\n\r\n// Configurar tags personalizadas\r\nexport const setCustomTags = (tags: Record<string, string>) => {\r\n  Sentry.setTags(tags);\r\n};\r\n\r\n// Performance monitoring para operações críticas\r\nexport const withSentryProfiling = async <T>(\r\n  operationName: string,\r\n  operation: () => Promise<T>,\r\n  tags?: Record<string, string>\r\n): Promise<T> => {\r\n  const startTime = Date.now();\r\n  \r\n  try {\r\n    addBreadcrumb(`Iniciando operação: ${operationName}`, 'performance', tags);\r\n    const result = await operation();\r\n    \r\n    const duration = Date.now() - startTime;\r\n    addBreadcrumb(`Operação concluída: ${operationName}`, 'performance', {\r\n      ...tags,\r\n      duration: `${duration}ms`,\r\n      status: 'success'\r\n    });\r\n    \r\n    return result;\r\n  } catch (error) {\r\n    const duration = Date.now() - startTime;\r\n    addBreadcrumb(`Operação falhou: ${operationName}`, 'performance', {\r\n      ...tags,\r\n      duration: `${duration}ms`,\r\n      status: 'error'\r\n    });\r\n    \r\n    captureError(error as Error, { operation: operationName, ...tags });\r\n    throw error;\r\n  }\r\n};\r\n\r\n// Monitoramento de métricas customizadas\r\nexport const recordMetric = (name: string, value: number, unit: string = 'none', tags?: Record<string, string>) => {\r\n  addBreadcrumb(`Métrica: ${name}`, 'metric', {\r\n    name,\r\n    value: value.toString(),\r\n    unit,\r\n    ...tags\r\n  });\r\n};\r\n\r\n// Configurações específicas para diferentes partes da aplicação\r\nexport const configureSentryForPage = (pageName: string, additionalTags?: Record<string, string>) => {\r\n  Sentry.withScope((scope) => {\r\n    scope.setTag(\"page\", pageName);\r\n    scope.setContext(\"page_info\", {\r\n      name: pageName,\r\n      timestamp: new Date().toISOString(),\r\n      url: window.location.href\r\n    });\r\n    \r\n    if (additionalTags) {\r\n      Object.keys(additionalTags).forEach(key => {\r\n        scope.setTag(key, additionalTags[key]);\r\n      });\r\n    }\r\n  });\r\n  \r\n  addBreadcrumb(`Navegou para ${pageName}`, 'navigation', { page: pageName });\r\n};\r\n\r\n// Rastreamento de ações do usuário\r\nexport const trackUserAction = (action: string, data?: Record<string, any>) => {\r\n  addBreadcrumb(`Usuário: ${action}`, 'user_action', data);\r\n  \r\n  // Para ações críticas, também registrar como evento\r\n  const criticalActions = ['login', 'logout', 'purchase', 'delete_data', 'export_data'];\r\n  if (criticalActions.includes(action.toLowerCase())) {\r\n    captureMessage(`Ação crítica: ${action}`, 'info', data);\r\n  }\r\n};\r\n\r\n// HOC para capturar erros em componentes React\r\nexport const withSentryErrorBoundary = <P extends object>(\r\n  WrappedComponent: React.ComponentType<P>,\r\n  componentName: string\r\n) => {\r\n  const SentryWrappedComponent = (props: P) => {\r\n    return React.createElement(Sentry.ErrorBoundary, {\r\n      fallback: () => React.createElement('div', {\r\n        style: { \r\n          minHeight: '100vh', \r\n          display: 'flex', \r\n          alignItems: 'center', \r\n          justifyContent: 'center' \r\n        }\r\n      }, React.createElement('div', {\r\n        style: { \r\n          padding: '2rem', \r\n          textAlign: 'center',\r\n          backgroundColor: 'white',\r\n          borderRadius: '8px',\r\n          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',\r\n          maxWidth: '400px'\r\n        }\r\n      }, [\r\n        React.createElement('h3', { \r\n          key: 'title',\r\n          style: { color: '#ef4444', marginBottom: '1rem' }\r\n        }, 'Algo deu errado'),\r\n        React.createElement('p', { \r\n          key: 'message',\r\n          style: { marginBottom: '1.5rem', color: '#6b7280' }\r\n        }, 'Nossa equipe foi notificada automaticamente.'),\r\n        React.createElement('button', {\r\n          key: 'reload',\r\n          onClick: () => window.location.reload(),\r\n          style: {\r\n            backgroundColor: '#3b82f6',\r\n            color: 'white',\r\n            padding: '0.5rem 1rem',\r\n            border: 'none',\r\n            borderRadius: '4px',\r\n            cursor: 'pointer'\r\n          }\r\n        }, 'Recarregar página')\r\n      ])),\r\n      beforeCapture: (scope: any) => {\r\n        scope.setTag('component', componentName);\r\n        addBreadcrumb(`Erro no componente: ${componentName}`, 'error', {\r\n          component: componentName\r\n        });\r\n      }\r\n    }, React.createElement(WrappedComponent, props));\r\n  };\r\n\r\n  SentryWrappedComponent.displayName = `withSentryErrorBoundary(${componentName})`;\r\n  return SentryWrappedComponent;\r\n};\r\n\r\n// Monitoramento de performance de API calls\r\nexport const trackApiCall = async <T>(\r\n  url: string,\r\n  method: string,\r\n  apiCall: () => Promise<T>\r\n): Promise<T> => {\r\n  const startTime = Date.now();\r\n  \r\n  try {\r\n    addBreadcrumb(`API Request: ${method} ${url}`, 'http', {\r\n      method,\r\n      url\r\n    });\r\n    \r\n    const result = await apiCall();\r\n    \r\n    const duration = Date.now() - startTime;\r\n    addBreadcrumb(`API Success: ${method} ${url}`, 'http', {\r\n      method,\r\n      url,\r\n      duration: `${duration}ms`,\r\n      status: 'success'\r\n    });\r\n    \r\n    // Alertar se API está lenta (> 2s)\r\n    if (duration > 2000) {\r\n      captureMessage(`API lenta detectada: ${method} ${url}`, 'warning', {\r\n        method,\r\n        url,\r\n        duration: `${duration}ms`\r\n      });\r\n    }\r\n    \r\n    return result;\r\n  } catch (error) {\r\n    const duration = Date.now() - startTime;\r\n    addBreadcrumb(`API Error: ${method} ${url}`, 'http', {\r\n      method,\r\n      url,\r\n      duration: `${duration}ms`,\r\n      status: 'error'\r\n    });\r\n    \r\n    captureError(error as Error, {\r\n      api_url: url,\r\n      api_method: method,\r\n      api_duration: `${duration}ms`\r\n    });\r\n    \r\n    throw error;\r\n  }\r\n};\r\n\r\nexport default Sentry; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\seoOptimization.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3764,3767],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3764,3767],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// SEO and Conversion Optimization Utilities for Paid Traffic\r\n\r\nexport interface SEOMetadata {\r\n  title: string;\r\n  description: string;\r\n  keywords: string[];\r\n  ogTitle?: string;\r\n  ogDescription?: string;\r\n  ogImage?: string;\r\n  canonicalUrl?: string;\r\n}\r\n\r\n// Otimização de títulos para conversão\r\nexport const generateConversionTitle = (basePage: string, userCount?: number): string => {\r\n  const conversionTitles = {\r\n    'leads': `Gerencie ${userCount ? `${userCount}+` : 'Todos'} seus Leads - CRM Profissional`,\r\n    'dashboard': `Dashboard Completo - Acompanhe suas Vendas em Tempo Real`,\r\n    'reminders': `Nunca Perca um Follow-up - Sistema de Lembretes Inteligente`,\r\n    'commission': `Controle Total de Comissões - Maximize seus Ganhos`,\r\n    'employees': `Gerencie sua Equipe - Performance e Produtividade`,\r\n    'default': `CRM Completo para Vendas - Aumente sua Conversão em ${new Date().getFullYear()}`\r\n  };\r\n\r\n  return conversionTitles[basePage as keyof typeof conversionTitles] || conversionTitles.default;\r\n};\r\n\r\n// Meta descriptions otimizadas para conversão\r\nexport const generateMetaDescription = (page: string, features?: string[]): string => {\r\n  const descriptions = {\r\n    'leads': `Gerencie leads de forma profissional. Acompanhe conversões, organize contatos e aumente suas vendas. ${features?.join(', ') || 'Paginação, filtros avançados, etiquetas personalizadas'}.`,\r\n    'dashboard': `Dashboard completo com métricas em tempo real. Visualize performance, rankings de vendedores e indicadores de conversão. Tome decisões baseadas em dados.`,\r\n    'reminders': `Sistema de lembretes inteligente com prioridades. Nunca perca um follow-up importante. Organize tarefas por cores e categorias.`,\r\n    'commission': `Controle completo de comissões e pagamentos. Acompanhe ganhos por vendedor, aprove comissões e gere relatórios detalhados.`,\r\n    'employees': `Gerencie sua equipe de vendas. Acompanhe performance individual, defina metas e otimize resultados da sua equipe.`,\r\n    'default': `CRM completo para empresas que querem vender mais. Gerencie leads, acompanhe vendas, organize equipe e maximize conversões.`\r\n  };\r\n\r\n  return descriptions[page as keyof typeof descriptions] || descriptions.default;\r\n};\r\n\r\n// Keywords otimizadas para tráfego pago\r\nexport const getOptimizedKeywords = (page: string): string[] => {\r\n  const keywords = {\r\n    'leads': [\r\n      'gerenciamento de leads',\r\n      'crm leads',\r\n      'organizar contatos',\r\n      'sistema de vendas',\r\n      'conversão de leads',\r\n      'funil de vendas',\r\n      'gestão comercial',\r\n      'acompanhar clientes'\r\n    ],\r\n    'dashboard': [\r\n      'dashboard vendas',\r\n      'métricas comerciais',\r\n      'relatórios vendas',\r\n      'indicadores performance',\r\n      'análise vendas',\r\n      'kpi vendas',\r\n      'gestão resultados'\r\n    ],\r\n    'reminders': [\r\n      'lembretes vendas',\r\n      'follow up clientes',\r\n      'agenda comercial',\r\n      'organizar tarefas',\r\n      'sistema lembretes',\r\n      'gestão tempo vendas'\r\n    ],\r\n    'commission': [\r\n      'controle comissões',\r\n      'pagamento vendedores',\r\n      'gestão comissões',\r\n      'relatório comissões',\r\n      'cálculo comissões'\r\n    ],\r\n    'employees': [\r\n      'gestão equipe vendas',\r\n      'performance vendedores',\r\n      'ranking vendas',\r\n      'produtividade vendas',\r\n      'gestão comercial'\r\n    ],\r\n    'default': [\r\n      'crm completo',\r\n      'sistema vendas',\r\n      'gestão comercial',\r\n      'gerenciar leads',\r\n      'crm profissional',\r\n      'software vendas',\r\n      'sistema crm'\r\n    ]\r\n  };\r\n\r\n  return keywords[page as keyof typeof keywords] || keywords.default;\r\n};\r\n\r\n// Gerar structured data para SEO\r\nexport const generateStructuredData = (page: string, data?: any) => {\r\n  const baseStructuredData = {\r\n    \"@context\": \"https://schema.org\",\r\n    \"@type\": \"SoftwareApplication\",\r\n    \"name\": \"CRM Profissional\",\r\n    \"applicationCategory\": \"BusinessApplication\",\r\n    \"operatingSystem\": \"Web\",\r\n    \"offers\": {\r\n      \"@type\": \"Offer\",\r\n      \"price\": \"0\",\r\n      \"priceCurrency\": \"BRL\"\r\n    },\r\n    \"aggregateRating\": {\r\n      \"@type\": \"AggregateRating\",\r\n      \"ratingValue\": \"4.8\",\r\n      \"ratingCount\": \"150\"\r\n    }\r\n  };\r\n\r\n  if (page === 'leads' && data?.totalLeads) {\r\n    return {\r\n      ...baseStructuredData,\r\n      \"description\": `Gerencie ${data.totalLeads}+ leads de forma profissional`,\r\n      \"featureList\": [\r\n        \"Paginação otimizada para grandes volumes\",\r\n        \"Filtros avançados por status e etiquetas\",\r\n        \"Busca inteligente por nome, telefone e CPF\",\r\n        \"Organização por etiquetas coloridas\"\r\n      ]\r\n    };\r\n  }\r\n\r\n  return baseStructuredData;\r\n};\r\n\r\n// Otimização de URLs para SEO\r\nexport const generateSEOFriendlyURL = (page: string, params?: Record<string, string>): string => {\r\n  const baseUrls = {\r\n    'leads': '/leads',\r\n    'dashboard': '/dashboard',\r\n    'reminders': '/lembretes',\r\n    'commission': '/comissoes',\r\n    'employees': '/equipe'\r\n  };\r\n\r\n  let url = baseUrls[page as keyof typeof baseUrls] || '/';\r\n\r\n  if (params) {\r\n    const searchParams = new URLSearchParams();\r\n    Object.entries(params).forEach(([key, value]) => {\r\n      if (value) searchParams.append(key, value);\r\n    });\r\n    \r\n    const queryString = searchParams.toString();\r\n    if (queryString) {\r\n      url += `?${queryString}`;\r\n    }\r\n  }\r\n\r\n  return url;\r\n};\r\n\r\n// Tracking de conversão para tráfego pago\r\nexport const trackConversion = (action: string, value?: number, leadId?: string) => {\r\n  // Google Analytics 4\r\n  if (typeof gtag !== 'undefined') {\r\n    gtag('event', action, {\r\n      event_category: 'CRM_Action',\r\n      event_label: leadId || 'unknown',\r\n      value: value || 0\r\n    });\r\n  }\r\n\r\n  // Facebook Pixel\r\n  if (typeof fbq !== 'undefined') {\r\n    fbq('track', action, {\r\n      value: value || 0,\r\n      currency: 'BRL',\r\n      content_ids: leadId ? [leadId] : []\r\n    });\r\n  }\r\n\r\n  // Google Ads Conversion\r\n  if (typeof gtag !== 'undefined' && action === 'lead_created') {\r\n    gtag('event', 'conversion', {\r\n      send_to: 'AW-CONVERSION_ID/CONVERSION_LABEL',\r\n      value: value || 0,\r\n      currency: 'BRL'\r\n    });\r\n  }\r\n};\r\n\r\n// Otimização de Core Web Vitals\r\nexport const optimizeWebVitals = () => {\r\n  // Preload critical resources\r\n  const preloadCritical = () => {\r\n    const criticalResources = [\r\n      '/src/index.css',\r\n      '/src/components/ui/button.tsx',\r\n      '/src/components/ui/card.tsx'\r\n    ];\r\n\r\n    criticalResources.forEach(resource => {\r\n      const link = document.createElement('link');\r\n      link.rel = 'preload';\r\n      link.href = resource;\r\n      link.as = resource.endsWith('.css') ? 'style' : 'script';\r\n      document.head.appendChild(link);\r\n    });\r\n  };\r\n\r\n  // Lazy load non-critical components\r\n  const lazyLoadNonCritical = () => {\r\n    const nonCriticalComponents = document.querySelectorAll('[data-lazy]');\r\n    \r\n    const observer = new IntersectionObserver((entries) => {\r\n      entries.forEach(entry => {\r\n        if (entry.isIntersecting) {\r\n          const element = entry.target as HTMLElement;\r\n          element.style.opacity = '1';\r\n          observer.unobserve(element);\r\n        }\r\n      });\r\n    });\r\n\r\n    nonCriticalComponents.forEach(component => {\r\n      observer.observe(component);\r\n    });\r\n  };\r\n\r\n  preloadCritical();\r\n  lazyLoadNonCritical();\r\n};\r\n\r\n// Landing page optimization para tráfego pago\r\nexport const generateLandingPageData = (source: string, campaign?: string) => {\r\n  const landingPages = {\r\n    'google-ads': {\r\n      headline: 'CRM Profissional que Aumenta suas Vendas em 300%',\r\n      subheadline: 'Gerencie leads, acompanhe conversões e nunca perca uma oportunidade',\r\n      cta: 'Comece Grátis Agora',\r\n      benefits: [\r\n        'Paginação otimizada para 1500+ leads',\r\n        'Dashboard com métricas em tempo real',\r\n        'Sistema de lembretes inteligente',\r\n        'Controle completo de comissões'\r\n      ]\r\n    },\r\n    'facebook-ads': {\r\n      headline: 'Pare de Perder Vendas por Desorganização',\r\n      subheadline: 'CRM completo que organiza seus leads e multiplica suas conversões',\r\n      cta: 'Quero Organizar Minhas Vendas',\r\n      benefits: [\r\n        'Nunca mais perca um follow-up',\r\n        'Organize milhares de leads facilmente',\r\n        'Acompanhe performance da equipe',\r\n        'Calcule comissões automaticamente'\r\n      ]\r\n    },\r\n    'default': {\r\n      headline: 'CRM Completo para Vendedores Profissionais',\r\n      subheadline: 'Gerencie leads, equipe e comissões em um só lugar',\r\n      cta: 'Experimente Grátis',\r\n      benefits: [\r\n        'Interface otimizada para alta performance',\r\n        'Suporte para grandes volumes de dados',\r\n        'Relatórios e métricas avançadas',\r\n        'Sistema completo de gestão comercial'\r\n      ]\r\n    }\r\n  };\r\n\r\n  const pageData = landingPages[source as keyof typeof landingPages] || landingPages.default;\r\n  \r\n  return {\r\n    ...pageData,\r\n    campaign: campaign || 'organic',\r\n    source,\r\n    timestamp: new Date().toISOString()\r\n  };\r\n};\r\n\r\n// Configurações de performance para produção\r\nexport const getProductionOptimizations = () => {\r\n  return {\r\n    // Configurações de cache\r\n    cacheSettings: {\r\n      staticAssets: '1y',\r\n      apiResponses: '5m',\r\n      images: '30d'\r\n    },\r\n    \r\n    // Configurações de compressão\r\n    compression: {\r\n      enabled: true,\r\n      level: 6,\r\n      threshold: 1024\r\n    },\r\n    \r\n    // Configurações de CDN\r\n    cdn: {\r\n      enabled: true,\r\n      domains: ['cdn.example.com'],\r\n      regions: ['us-east-1', 'sa-east-1']\r\n    },\r\n    \r\n    // Configurações de monitoramento\r\n    monitoring: {\r\n      errorTracking: true,\r\n      performanceMetrics: true,\r\n      userBehavior: true\r\n    }\r\n  };\r\n}; ","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\utils\\serviceWorkerUtils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\supabase\\functions\\create-checkout\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\supabase\\functions\\receive-lead\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\tailwind.config.ts","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":107,"column":3,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":107,"endColumn":33}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport type { Config } from \"tailwindcss\";\r\n\r\nexport default {\r\n\tcontent: [\r\n\t\t\"./pages/**/*.{ts,tsx}\",\r\n\t\t\"./components/**/*.{ts,tsx}\",\r\n\t\t\"./app/**/*.{ts,tsx}\",\r\n\t\t\"./src/**/*.{ts,tsx}\",\r\n\t],\r\n\tprefix: \"\",\r\n\ttheme: {\r\n\t\tcontainer: {\r\n\t\t\tcenter: true,\r\n\t\t\tpadding: '2rem',\r\n\t\t\tscreens: {\r\n\t\t\t\t'2xl': '1400px'\r\n\t\t\t}\r\n\t\t},\r\n\t\tscreens: {\r\n\t\t\t'xs': '475px',\r\n\t\t\t'sm': '640px',\r\n\t\t\t'md': '768px',\r\n\t\t\t'lg': '1024px',\r\n\t\t\t'xl': '1280px',\r\n\t\t\t'2xl': '1536px',\r\n\t\t\t// Breakpoints customizados para notebooks\r\n\t\t\t'notebook': {'min': '768px', 'max': '1024px'},\r\n\t\t\t'laptop': {'min': '1024px', 'max': '1280px'},\r\n\t\t},\r\n\t\textend: {\r\n\t\t\tcolors: {\r\n\t\t\t\tborder: 'hsl(var(--border))',\r\n\t\t\t\tinput: 'hsl(var(--input))',\r\n\t\t\t\tring: 'hsl(var(--ring))',\r\n\t\t\t\tbackground: 'hsl(var(--background))',\r\n\t\t\t\tforeground: 'hsl(var(--foreground))',\r\n\t\t\t\tprimary: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--primary))',\r\n\t\t\t\t\tforeground: 'hsl(var(--primary-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tsecondary: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--secondary))',\r\n\t\t\t\t\tforeground: 'hsl(var(--secondary-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tdestructive: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--destructive))',\r\n\t\t\t\t\tforeground: 'hsl(var(--destructive-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tmuted: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--muted))',\r\n\t\t\t\t\tforeground: 'hsl(var(--muted-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\taccent: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--accent))',\r\n\t\t\t\t\tforeground: 'hsl(var(--accent-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tpopover: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--popover))',\r\n\t\t\t\t\tforeground: 'hsl(var(--popover-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tcard: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--card))',\r\n\t\t\t\t\tforeground: 'hsl(var(--card-foreground))'\r\n\t\t\t\t},\r\n\t\t\t\tsidebar: {\r\n\t\t\t\t\tDEFAULT: 'hsl(var(--sidebar-background))',\r\n\t\t\t\t\tforeground: 'hsl(var(--sidebar-foreground))',\r\n\t\t\t\t\tprimary: 'hsl(var(--sidebar-primary))',\r\n\t\t\t\t\t'primary-foreground': 'hsl(var(--sidebar-primary-foreground))',\r\n\t\t\t\t\taccent: 'hsl(var(--sidebar-accent))',\r\n\t\t\t\t\t'accent-foreground': 'hsl(var(--sidebar-accent-foreground))',\r\n\t\t\t\t\tborder: 'hsl(var(--sidebar-border))',\r\n\t\t\t\t\tring: 'hsl(var(--sidebar-ring))'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tborderRadius: {\r\n\t\t\t\tlg: 'var(--radius)',\r\n\t\t\t\tmd: 'calc(var(--radius) - 2px)',\r\n\t\t\t\tsm: 'calc(var(--radius) - 4px)'\r\n\t\t\t},\r\n\t\t\tkeyframes: {\r\n\t\t\t\t'accordion-down': {\r\n\t\t\t\t\tfrom: {\r\n\t\t\t\t\t\theight: '0'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tto: {\r\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t'accordion-up': {\r\n\t\t\t\t\tfrom: {\r\n\t\t\t\t\t\theight: 'var(--radix-accordion-content-height)'\r\n\t\t\t\t\t},\r\n\t\t\t\t\tto: {\r\n\t\t\t\t\t\theight: '0'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tanimation: {\r\n\t\t\t\t'accordion-down': 'accordion-down 0.2s ease-out',\r\n\t\t\t\t'accordion-up': 'accordion-up 0.2s ease-out'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tplugins: [\r\n\t\trequire(\"tailwindcss-animate\")\r\n\t],\r\n} satisfies Config;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\Bruno\\.gemini\\antigravity\\scratch\\crmconsig\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]